1:"$Sreact.fragment"
2:I[2658,["487","static/chunks/487-d14c2623a9f3fdfd.js","45","static/chunks/45-a3006a7b4d051491.js","762","static/chunks/762-fb8a01463e9bf4fd.js","464","static/chunks/464-cfefa5bf5f0e766b.js","559","static/chunks/559-04b70e00e58d5c4b.js","177","static/chunks/app/layout-ab4602898f2b74c8.js"],"GoogleTagManager"]
3:I[438,["487","static/chunks/487-d14c2623a9f3fdfd.js","45","static/chunks/45-a3006a7b4d051491.js","762","static/chunks/762-fb8a01463e9bf4fd.js","464","static/chunks/464-cfefa5bf5f0e766b.js","559","static/chunks/559-04b70e00e58d5c4b.js","177","static/chunks/app/layout-ab4602898f2b74c8.js"],"default"]
4:I[6148,["487","static/chunks/487-d14c2623a9f3fdfd.js","45","static/chunks/45-a3006a7b4d051491.js","762","static/chunks/762-fb8a01463e9bf4fd.js","464","static/chunks/464-cfefa5bf5f0e766b.js","559","static/chunks/559-04b70e00e58d5c4b.js","177","static/chunks/app/layout-ab4602898f2b74c8.js"],"SidebarProvider"]
5:I[8491,["487","static/chunks/487-d14c2623a9f3fdfd.js","45","static/chunks/45-a3006a7b4d051491.js","762","static/chunks/762-fb8a01463e9bf4fd.js","464","static/chunks/464-cfefa5bf5f0e766b.js","559","static/chunks/559-04b70e00e58d5c4b.js","177","static/chunks/app/layout-ab4602898f2b74c8.js"],"default"]
c:I[6664,["219","static/chunks/app/global-error-b0d0eb5f8d1d5f85.js"],"default"]
:HL["https://codefug.github.io/_next/static/media/518331124efecf5c-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["https://codefug.github.io/_next/static/css/96413cdc35608d81.css","style"]
:HL["https://codefug.github.io/_next/static/css/0944061766e538e2.css","style"]
:HL["https://codefug.github.io/_next/static/css/fc37ac2b1a278e8c.css","style"]
0:{"P":null,"b":"SidpDY09K3KAz3NqdkUP0","p":"https://codefug.github.io","c":["","posts","2024-06-17"],"i":false,"f":[[["",{"children":["posts",{"children":[["id","2024-06-17","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"https://codefug.github.io/_next/static/css/96413cdc35608d81.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"https://codefug.github.io/_next/static/css/0944061766e538e2.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"ko","suppressHydrationWarning":true,"children":[["$","$L2",null,{"gtmId":"$undefined"}],["$","body",null,{"className":"__className_75a1fa antialiased","children":["$","$L3",null,{"attribute":"class","defaultTheme":"system","enableSystem":true,"disableTransitionOnChange":true,"children":["$","$L4",null,{"defaultOpen":false,"children":[["$","$L5",null,{"totalFrontMatterList":[{"id":"2025-07-20","title":"집합","excerpt":"JS의 집합에 대해서 알아보자.","date":"2025-07-20","categories":["data-structure","javascript"],"header":{"teaser":"/images/2025-07-20/Pasted image 20250720151432.png"}},{"id":"2025-06-21","title":"트리","excerpt":"JS의 트리에 대해서 알아보자.","date":"2025-06-21","categories":["data-structure","javascript"],"header":{"teaser":"/images/2025-06-21/Pasted image 20250621101921.png"}},{"id":"2025-06-14","title":"해시","excerpt":"JS의 해시에 대해서 알아보자.","date":"2025-06-14","categories":["data-structure","javascript"],"header":{"teaser":"/images/2025-06-14/Pasted image 20250617224108.png"}},{"id":"2025-06-07","title":"큐","excerpt":"JS의 큐에 대해서 알아보자.","date":"2025-06-07","categories":["data-structure","javascript"],"header":{"teaser":"/images/2025-06-07/Pasted image 20250617212028.png"}},{"id":"2025-05-31","title":"스택","excerpt":"JS의 스택에 대해서 알아보자.","date":"2025-05-31","categories":["data-structure","javascript"],"header":{"teaser":"/images/2025-05-31/Pasted image 20250617080823.png"}},{"id":"2025-05-24","title":"배열","excerpt":"JS의 배열에 대해서 알아보자.","date":"2025-05-24","categories":["data-structure","javascript"],"header":{"teaser":"/images/2025-05-24/Pasted image 20250615181200.png"}},{"id":"2024-11-10","title":"Asynchronous JavaScript","excerpt":"microtask queue, macrotask queue, call stack, web api와 관련된 비동기 동작 방식, 비동기 관련 역사와 비동기 코드의 다양한 활용법들을 알아보자.","date":"2024-11-10","categories":["javascript"],"header":{"teaser":"/images/logos/JS.svg"}},{"id":"2024-09-14-4","title":"(꼼꼼 프로젝트) streaming 방식의 tanstack query","excerpt":"infinite scroll, optimistic update 그리고 streaming 방식이 결합된 쿼리 처리 ( useSuspenseQuery, useSuspenseInfiniteQuery )","date":"2024-09-14","categories":["kkom-kkom"],"header":{"teaser":"/images/logos/tanstackQuery.png"}},{"id":"2024-09-14-3","title":"(꼼꼼 프로젝트) 클라이언트와 서버 둘다 호환되는 fetch 구현","excerpt":"서버 액션을 활용한 refresh token rotation, 커링 함수를 이용한 리팩토링","date":"2024-09-14","categories":["kkom-kkom"],"header":{"teaser":"/images/logos/fetch.png"}},{"id":"2024-09-14-2","title":"(꼼꼼 프로젝트) startTransition, progress bar 구현에 대한 고민","excerpt":"progress bar 로직 연구하기(startTransition), next-nprogress-bar","date":"2024-09-14","categories":["kkom-kkom"],"header":{"teaser":"/images/logos/nprogress.png"}},{"id":"2024-09-14-1","title":"(꼼꼼 프로젝트) toss slash 분석, zustand와 연결된 커스텀 overlay 훅 구현","excerpt":"stacking context, compound pattern, 전역 상태를 활용한다는 것의 의미, 토스 개발자 실력 흡수하기","date":"2024-09-14","categories":["kkom-kkom"],"header":{"teaser":"/images/logos/toss.png"}},{"id":"2024-09-11","title":"(꼼꼼 프로젝트) 공통 버튼 컴포넌트의 종류를 쉽게 관리하고 누구나 쉽게 확인할 수 있게 하는 방법","excerpt":"tailwind로 조건부 처리를 간편하게 하는 방법, 비개발자도 스타일을 쉽게 확인할 수 있도록 storybook 연동","date":"2024-09-11","categories":["kkom-kkom"],"header":{"teaser":"/images/logos/storybook.png"}},{"id":"2024-07-22-2","title":"(급페이 프로젝트) 개발환경에만 집중하기 위한 여정","excerpt":"접근 제한을 위한 미들웨어 처리, vercel CLI을 이용한 organization 무료 자동 배포, 프리뷰","date":"2024-07-22","categories":["gheuppay"],"header":{"teaser":"/images/logos/vercel.png"}},{"id":"2024-07-22-1","title":"(급페이 프로젝트) 알림창 무한 스크롤을 위한 여정 (mock fetching을 위한 MSW 도입기)","excerpt":"msw를 활용해서 프론트엔드 개발이 다 되어있지 않은 상태에서도 무한 스크롤 구현을 확인할 수 있게 되었습니다.","date":"2024-07-22","categories":["gheuppay"],"header":{"teaser":"/images/logos/msw.png"}},{"id":"2024-07-21","title":"(급페이 프로젝트) 카드 렌더링을 최적화하여 UX를 향상시키기 위한 머나먼 여정","excerpt":"server component 설계를 이용한 suspense 적극 활용, 이를 위해서 next cookie를 사용하면서 겪은 문제들을 적은 글입니다.","date":"2024-07-21","categories":["gheuppay"],"header":{"teaser":"/images/logos/next-cookie.png"}},{"id":"2024-06-18","title":"React Testing","excerpt":"React Testing Library, Vitest, Jest","date":"2024-06-18","categories":["reactdeepdive"],"header":{"teaser":"/images/logos/reactdeepdive.jpg"}},{"id":"2024-06-17","title":"로그인 구현 (zustand, zod + react-hook-form, RTR)","excerpt":"zustand를 이용한 로그인 상태 전역 관리, zod를 이용한 간단한 스키마 전개, react-hook-form을 이용한 간단한 validation, axios를 이용한 간단한 api 요청 처리","date":"2024-06-17","categories":["react"],"header":{"teaser":"/images/logos/zod.png"}},{"id":"2024-06-15","title":"Dev tool","excerpt":"리액트 과거, 현재, 미래","date":"2024-06-15","categories":["web"],"header":{"teaser":"/images/logos/reactdeepdive.jpg"}},{"id":"2024-06-14","title":"마이그레이션 중 발생한 Vite 환경 변수 처리","excerpt":"Vite_ENV","date":"2024-06-14","categories":["react"],"header":{"teaser":"/images/logos/react.png"}},{"id":"2024-06-10","title":"React Debugging","excerpt":"react-dev-tools 정리, 실습","date":"2024-06-10","categories":["react"],"header":{"teaser":"/images/logos/react.png"}},{"id":"2024-06-08","title":"자잘한 Next.js 트러블 슈팅들","excerpt":"react-responsive를 사용하지 못하는 상황, dotenv 사용시 문제 발생","date":"2024-06-08","categories":["nextjs"],"header":{"teaser":"/images/logos/Nextjs.png"}},{"id":"2024-05-31","title":"Next는 왜 쓸까","excerpt":"CSR SSG SSR","date":"2024-05-31","categories":["nextjs"],"header":{"teaser":"/images/logos/Nextjs.png"}},{"id":"2024-05-23","title":"리액트는 왜 쓸까","excerpt":"리액트 과거, 현재, 미래","date":"2024-05-23","categories":["react"],"header":{"teaser":"/images/logos/reactdeepdive.jpg"}},{"id":"2024-05-22","title":"TS는 왜 쓸까 (위대한 TS)","excerpt":"JS를 완벽하게 하기 위한 여정","date":"2024-05-22","categories":["typescript"],"header":{"teaser":"/images/logos/TS.png"}},{"id":"2024-05-20","title":"Fandom-k 프로젝트 회고3","excerpt":"Github Actions, 최종 결과","date":"2024-05-20","categories":["fandomk"],"header":{"teaser":"/images/logos/githubActions.png"}},{"id":"2024-05-19","title":"Fandom-k 프로젝트 회고2","excerpt":"fetch, scroll to Top, infinite scroll 라이브러리 제거","date":"2024-05-19","categories":["fandomk"],"header":{"teaser":"/images/logos/fetch.png"}},{"id":"2024-05-18","title":"Fandom-k 프로젝트 회고1","excerpt":"팀 프로젝트 세팅, infinite scroll, skeleton","date":"2024-05-18","categories":["fandomk"],"header":{"teaser":"/images/logos/infinite-scroll.png"}}]}],"$L6"]}]}]}]]}]]}],{"children":["posts","$L7",{"children":[["id","2024-06-17","d"],"$L8",{"children":["__PAGE__","$L9",{},null,false]},null,false]},null,false]},["$La",[],[]],false],"$Lb",false]],"m":"$undefined","G":["$c",[]],"s":false,"S":true}
d:I[1655,["487","static/chunks/487-d14c2623a9f3fdfd.js","45","static/chunks/45-a3006a7b4d051491.js","762","static/chunks/762-fb8a01463e9bf4fd.js","464","static/chunks/464-cfefa5bf5f0e766b.js","559","static/chunks/559-04b70e00e58d5c4b.js","177","static/chunks/app/layout-ab4602898f2b74c8.js"],"default"]
e:I[4483,[],""]
f:I[9503,[],""]
10:I[762,["762","static/chunks/762-fb8a01463e9bf4fd.js","345","static/chunks/app/not-found-8cae470c11fa9853.js"],""]
11:I[8792,["507","static/chunks/app/posts/%5Bid%5D/layout-09cee8bbecb3ba10.js"],"default"]
13:I[2481,[],"OutletBoundary"]
15:I[9055,[],"AsyncMetadataOutlet"]
17:I[2487,["487","static/chunks/487-d14c2623a9f3fdfd.js","45","static/chunks/45-a3006a7b4d051491.js","762","static/chunks/762-fb8a01463e9bf4fd.js","880","static/chunks/app/posts/%5Bid%5D/page-9b07e941c08849ec.js"],"Image"]
18:I[2481,[],"ViewportBoundary"]
1a:I[2481,[],"MetadataBoundary"]
1b:"$Sreact.suspense"
6:["$","$Ld",null,{"children":["$","$Le",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$Lf",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","div",null,{"children":[["$","h2",null,{"children":"Not Found"}],["$","p",null,{"children":"잘못된 페이지에요!"}],["$","$L10",null,{"href":"/","children":"홈으로 돌아가기"}]]}],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]
7:["$","$1","c",{"children":[null,["$","$Le",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$Lf",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}]
8:["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"https://codefug.github.io/_next/static/css/fc37ac2b1a278e8c.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","div",null,{"className":"prose mx-auto mb-10 overflow-auto dark:prose-invert","children":[["$","$Le",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$Lf",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}],["$","$L11",null,{}]]}]]}]
9:["$","$1","c",{"children":["$L12",null,["$","$L13",null,{"children":["$L14",["$","$L15",null,{"promise":"$@16"}]]}]]}]
a:["$","div","l",{"className":"flex h-full items-center justify-center","children":["$","div",null,{"className":"flex flex-col items-center","children":[["$","div",null,{"className":"scale-[1.15] animate-pulse transition-transform","children":["$","$L17",null,{"src":"/images/main-logo.png","alt":"로딩 중...","width":120,"height":120,"className":"drop-shadow-lg"}]}],["$","p",null,{"className":"mt-6 animate-pulse text-lg font-bold text-gray-600","children":"Codefug Blog"}]]}]}]
b:["$","$1","h",{"children":[null,[["$","$L18",null,{"children":"$L19"}],["$","meta",null,{"name":"next-size-adjust","content":""}]],["$","$L1a",null,{"children":["$","div",null,{"hidden":true,"children":["$","$1b",null,{"fallback":null,"children":"$L1c"}]}]}]]}]
19:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
14:null
1d:I[7071,[],"IconMark"]
16:{"metadata":[["$","title","0",{"children":"Codefug Blog"}],["$","meta","1",{"name":"description","content":"프로젝트 경험과 개발 노트를 공유하는 블로그"}],["$","meta","2",{"name":"author","content":"Codefug"}],["$","meta","3",{"name":"keywords","content":"개발,프로그래밍,React,Next.js,JavaScript,TypeScript,블로그"}],["$","meta","4",{"name":"creator","content":"Codefug"}],["$","meta","5",{"name":"publisher","content":"Codefug"}],["$","meta","6",{"property":"og:title","content":"Codefug Blog"}],["$","meta","7",{"property":"og:description","content":"project experiences and development notes"}],["$","meta","8",{"property":"og:url","content":"https://codefug-blog.vercel.app"}],["$","meta","9",{"property":"og:image","content":"https://codefug.github.io/images/main-logo.png"}],["$","meta","10",{"property":"og:image:alt","content":"Codefug Blog"}],["$","meta","11",{"property":"og:type","content":"website"}],["$","meta","12",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","13",{"name":"twitter:title","content":"Codefug Blog"}],["$","meta","14",{"name":"twitter:description","content":"project experiences and development notes"}],["$","meta","15",{"name":"twitter:image","content":"https://codefug.github.io/images/main-logo.png"}],["$","meta","16",{"name":"twitter:image:alt","content":"Codefug Blog"}],["$","link","17",{"rel":"icon","href":"/icon.ico?f00882ffa3186f37","type":"image/x-icon","sizes":"16x16"}],["$","$L1d","18",{}]],"error":null,"digest":"$undefined"}
1c:"$16:metadata"
1e:I[1457,["487","static/chunks/487-d14c2623a9f3fdfd.js","45","static/chunks/45-a3006a7b4d051491.js","762","static/chunks/762-fb8a01463e9bf4fd.js","880","static/chunks/app/posts/%5Bid%5D/page-9b07e941c08849ec.js"],"GtmPageView"]
1f:I[4662,["487","static/chunks/487-d14c2623a9f3fdfd.js","45","static/chunks/45-a3006a7b4d051491.js","762","static/chunks/762-fb8a01463e9bf4fd.js","880","static/chunks/app/posts/%5Bid%5D/page-9b07e941c08849ec.js"],"default"]
12:["$","section",null,{"children":[["$","$L1e",null,{"slug":"2024-06-17"}],["$","header",null,{"className":"mb-8","children":[["$","div",null,{"className":"relative mb-6 h-[300px] w-full overflow-hidden rounded-xl sm:h-[400px] md:h-[450px]","children":[["$","$L17",null,{"src":"/images/logos/zod.png","alt":"로그인 구현 (zustand, zod + react-hook-form, RTR)","fill":true,"sizes":"(max-width: 768px) 100vw, 1200px","priority":true,"className":"object-cover object-center transition-transform duration-500 hover:scale-105"}],["$","div",null,{"className":"absolute inset-0 bg-gradient-to-b from-transparent to-black/70"}],["$","div",null,{"className":"absolute left-4 top-4 flex flex-wrap gap-2 sm:left-6 sm:top-6","children":[["$","div","react",{"className":"inline-flex items-center rounded-md border px-2.5 py-0.5 transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-white/90 text-xs font-medium text-gray-800 hover:bg-white sm:text-sm","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-tag mr-1 h-3 w-3","children":[["$","path","vktsd0",{"d":"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z"}],["$","circle","kqv944",{"cx":"7.5","cy":"7.5","r":".5","fill":"currentColor"}],"$undefined"]}]," ","react"]}]]}]]}],["$","div",null,{"className":"mb-6 space-y-4","children":[["$","h1",null,{"className":"mb-0 text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-50 sm:text-4xl md:text-5xl","children":"로그인 구현 (zustand, zod + react-hook-form, RTR)"}],["$","div",null,{"className":"flex items-center justify-end gap-4 text-sm text-gray-600 dark:text-gray-400","children":["$","div",null,{"className":"flex items-center","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-calendar-days mr-2 h-4 w-4","children":[["$","path","1cmpym",{"d":"M8 2v4"}],["$","path","4m81vk",{"d":"M16 2v4"}],["$","rect","1hopcy",{"width":"18","height":"18","x":"3","y":"4","rx":"2"}],["$","path","8toen8",{"d":"M3 10h18"}],["$","path","6423bh",{"d":"M8 14h.01"}],["$","path","1etili",{"d":"M12 14h.01"}],["$","path","1gbofw",{"d":"M16 14h.01"}],["$","path","lrp35t",{"d":"M8 18h.01"}],["$","path","mhygvu",{"d":"M12 18h.01"}],["$","path","kzsmim",{"d":"M16 18h.01"}],"$undefined"]}],["$","time",null,{"dateTime":"2024-06-17","children":"2024-06-17"}]]}]}],["$","p",null,{"className":"text-lg leading-relaxed text-gray-600 dark:text-gray-300 md:text-xl","children":"zustand를 이용한 로그인 상태 전역 관리, zod를 이용한 간단한 스키마 전개, react-hook-form을 이용한 간단한 validation, axios를 이용한 간단한 api 요청 처리"}]]}],["$","div",null,{"className":"border-b border-gray-200 dark:border-gray-800"}]]}],["$","section",null,{"className":"lg:flex lg:items-baseline","children":[["$","$L1f",null,{}],["$","section",null,{"className":"max-w-full","children":[["$","h1",null,{"id":0,"className":"hltr-red","children":"로그인"}],"\n",["$","h2",null,{"id":1,"className":"hltr-orange","children":"로그인 상태관리"}],"\n",["$","p",null,{"children":"상태 관리와 기존 context api의 가장 큰 차이점은 context api는 상태를 주입하는 것 뿐이기 때문에 불필요한 리렌더링이 발생할 수 있어 성능이 좋지 않다. 상태 관리 라이브러리를 사용하면 리렌더링이 발생하지 않고 컴포넌트에게 전역 상태를 사용할 수 있다는 장점이 있다."}],"\n",["$","h3",null,{"id":2,"className":"hltr-yellow","children":"기존 context를 이용한 로그인 상태 관리 (전역)"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-keyword","children":"import"}]," ",["$","span",null,{"className":"hljs-title class_","children":"React"}],", { createContext, useState } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"react\""}],";\n\n",["$","span",null,{"className":"hljs-keyword","children":"type"}]," ",["$","span",null,{"className":"hljs-title class_","children":"User"}]," = {\n  ",["$","span",null,{"className":"hljs-attr","children":"accessToken"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}],";\n};\n\n","$L20"," ","$L21"," ","$L22"," = createContext<{\n  ","$L23",": ","$L24"," | ","$L25",";\n  ","$L26",": ","$L27"," ","$L28",";\n  ","$L29",": ","$L2a"," ","$L2b",";\n}>({\n  ","$L2c",": ","$L2d",",\n  ","$L2e",": ","$L2f"," {},\n  ","$L30",": ","$L31"," {},\n});\n\n","$L32"," ","$L33"," ","$L34","(","$L35",") {\n  ","$L36"," [user, setUser] = useState<","$L37"," | ","$L38",">(","$L39",");\n\n  ","$L3a"," ","$L3b"," = (","$L3c",") => {\n    ","$L3d",".","$L3e","(","$L3f",", accessToken);\n    ","$L40",".","$L41"," = ","$L42",";\n    ","$L43","({ accessToken });\n  };\n  ","$L44"," ","$L45"," = (","$L46",") => ","$L47","(","$L48",");\n\n  ","$L49"," (\n    ","$L4a","\n  );\n}\n\n","$L4b"," ","$L4c"," ","$L4d"," = (","$L4e",") => ","$L4f",".","$L50","(","$L51",");\n"]}]}],"\n","$L52","\n","$L53","\n","$L54","\n","$L55","\n","$L56","\n","$L57","\n","$L58","\n","$L59","\n","$L5a","\n","$L5b","\n","$L5c","\n","$L5d","\n","$L5e","\n","$L5f","\n","$L60","\n","$L61","\n","$L62","\n","$L63","\n","$L64","\n","$L65","\n","$L66","\n","$L67","\n","$L68","\n","$L69","\n","$L6a","\n","$L6b","\n","$L6c","\n","$L6d","\n","$L6e","\n","$L6f","\n","$L70","\n","$L71","\n","$L72","\n","$L73","\n","$L74","\n","$L75","\n","$L76","\n","$L77","\n","$L78","\n","$L79","\n","$L7a","\n","$L7b","\n","$L7c","\n","$L7d","\n","$L7e","\n","$L7f","\n","$L80","\n","$L81","\n","$L82","\n","$L83","\n","$L84","\n","$L85","\n","$L86","\n","$L87","\n","$L88","\n","$L89","\n","$L8a","\n","$L8b","\n","$L8c","\n","$L8d","\n","$L8e","\n","$L8f","\n","$L90","\n","$L91","\n","$L92","\n","$L93","\n","$L94","\n","$L95","\n","$L96","\n","$L97","\n","$L98","\n","$L99","\n","$L9a","\n","$L9b","\n","$L9c","\n","$L9d","\n","$L9e","\n","$L9f","\n","$La0","\n","$La1","\n","$La2","\n","$La3","\n","$La4","\n","$La5","\n","$La6","\n","$La7","\n","$La8","\n","$La9","\n","$Laa","\n","$Lab","\n","$Lac","\n","$Lad","\n","$Lae","\n","$Laf","\n","$Lb0","\n","$Lb1","\n","$Lb2","\n","$Lb3","\n","$Lb4","\n","$Lb5","\n","$Lb6","\n","$Lb7","\n","$Lb8","\n","$Lb9","\n","$Lba","\n","$Lbb"]}]]}]]}]
20:["$","span",null,{"className":"hljs-keyword","children":"export"}]
21:["$","span",null,{"className":"hljs-keyword","children":"const"}]
22:["$","span",null,{"className":"hljs-title class_","children":"AuthContext"}]
23:["$","span",null,{"className":"hljs-attr","children":"user"}]
24:["$","span",null,{"className":"hljs-title class_","children":"User"}]
25:["$","span",null,{"className":"hljs-literal","children":"null"}]
26:["$","span",null,{"className":"hljs-attr","children":"login"}]
27:["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":[["$","span",null,{"className":"hljs-attr","children":"accessToken"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}]]}],") =>"]}]
28:["$","span",null,{"className":"hljs-built_in","children":"void"}]
29:["$","span",null,{"className":"hljs-attr","children":"logout"}]
2a:["$","span",null,{"className":"hljs-function","children":"() =>"}]
2b:["$","span",null,{"className":"hljs-built_in","children":"void"}]
2c:["$","span",null,{"className":"hljs-attr","children":"user"}]
2d:["$","span",null,{"className":"hljs-literal","children":"null"}]
2e:["$","span",null,{"className":"hljs-attr","children":"login"}]
2f:["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":[["$","span",null,{"className":"hljs-attr","children":"accessToken"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}]]}],") =>"]}]
30:["$","span",null,{"className":"hljs-attr","children":"logout"}]
31:["$","span",null,{"className":"hljs-function","children":"() =>"}]
32:["$","span",null,{"className":"hljs-keyword","children":"export"}]
33:["$","span",null,{"className":"hljs-keyword","children":"function"}]
34:["$","span",null,{"className":"hljs-title function_","children":"AuthProvider"}]
35:["$","span",null,{"className":"hljs-params","children":"{ children }: { children: React.ReactNode }"}]
36:["$","span",null,{"className":"hljs-keyword","children":"const"}]
37:["$","span",null,{"className":"hljs-title class_","children":"User"}]
38:["$","span",null,{"className":"hljs-literal","children":"null"}]
39:["$","span",null,{"className":"hljs-literal","children":"null"}]
3a:["$","span",null,{"className":"hljs-keyword","children":"const"}]
3b:["$","span",null,{"className":"hljs-title function_","children":"login"}]
3c:["$","span",null,{"className":"hljs-params","children":[["$","span",null,{"className":"hljs-attr","children":"accessToken"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}]]}]
3d:["$","span",null,{"className":"hljs-variable language_","children":"localStorage"}]
3e:["$","span",null,{"className":"hljs-title function_","children":"setItem"}]
3f:["$","span",null,{"className":"hljs-string","children":"\"accessToken\""}]
40:["$","span",null,{"className":"hljs-variable language_","children":"document"}]
41:["$","span",null,{"className":"hljs-property","children":"cookie"}]
42:["$","span",null,{"className":"hljs-string","children":["`accessToken=",["$","span",null,{"className":"hljs-subst","children":["$${",["$","span",null,{"className":"hljs-variable language_","children":"localStorage"}],".getItem(",["$","span",null,{"className":"hljs-string","children":"\"accessToken\""}],")}"]}],"`"]}]
43:["$","span",null,{"className":"hljs-title function_","children":"setUser"}]
44:["$","span",null,{"className":"hljs-keyword","children":"const"}]
45:["$","span",null,{"className":"hljs-title function_","children":"logout"}]
46:["$","span",null,{"className":"hljs-params"}]
47:["$","span",null,{"className":"hljs-title function_","children":"setUser"}]
48:["$","span",null,{"className":"hljs-literal","children":"null"}]
49:["$","span",null,{"className":"hljs-keyword","children":"return"}]
4a:["$","span",null,{"className":"xml","children":[["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"AuthContext.Provider"}]," ",["$","span",null,{"className":"hljs-attr","children":"value"}],"=",["$","span",null,{"className":"hljs-string","children":"{{"}]," ",["$","span",null,{"className":"hljs-attr","children":"user"}],", ",["$","span",null,{"className":"hljs-attr","children":"login"}],", ",["$","span",null,{"className":"hljs-attr","children":"logout"}]," }}>"]}],"\n      {children}\n    ",["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"AuthContext.Provider"}],">"]}]]}]
4b:["$","span",null,{"className":"hljs-keyword","children":"export"}]
4c:["$","span",null,{"className":"hljs-keyword","children":"const"}]
4d:["$","span",null,{"className":"hljs-title function_","children":"useAuth"}]
4e:["$","span",null,{"className":"hljs-params"}]
4f:["$","span",null,{"className":"hljs-title class_","children":"React"}]
50:["$","span",null,{"className":"hljs-title function_","children":"useContext"}]
51:["$","span",null,{"className":"hljs-title class_","children":"AuthContext"}]
52:["$","p",null,{"children":"기존 로그인을 Context를 이용해서 구현한 방법이다.\n하지만 이전에 이야기한 것처럼 useContext를 활용한 방식은 props drilling을 없애기 위해서 주입하는 것이라 불필요한 리렌더링이 발생하여 성능이 좋지 않을 수 있다.\n이번에 전역 상태 관리 라이브러리 중 하나인 zustand를 간단하게 적용해보면서 이를 zustand를 적용한 방식으로 바꿔보자."}]
53:["$","h3",null,{"id":3,"className":"hltr-yellow","children":"zustand"}]
54:["$","p",null,{"children":["$","img",null,{"src":"/images/2024-06-17/Pasted%20image.png","alt":"alt text"}]}]
55:["$","p",null,{"children":"사이즈가 작고 빠르고 확장성 있는 상태 관리 라이브러리이다.\nhook에 기반한 API를 가졌으며 flux와 비슷한 컨벤션을 가지고 있다. (redux와 유사한 로직)"}]
56:["$","h4",null,{"id":4,"className":"hltr-green","children":"실제 적용"}]
57:["$","p",null,{"children":"로그인 상태는 라우트가 바뀌어도 갖고 있어야 하는 정보이므로 persist라는 미들웨어를 사용해서 로컬스토리지에 저장한다."}]
58:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-keyword","children":"import"}]," ",["$","span",null,{"className":"hljs-title class_","children":"Cookies"}]," ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"js-cookie\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { create, ",["$","span",null,{"className":"hljs-title class_","children":"StateCreator"}]," } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"zustand\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { persist } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"zustand/middleware\""}],";\n\n",["$","span",null,{"className":"hljs-keyword","children":"type"}]," ",["$","span",null,{"className":"hljs-title class_","children":"User"}]," = {\n  ",["$","span",null,{"className":"hljs-attr","children":"accessToken"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}],";\n};\n\n",["$","span",null,{"className":"hljs-keyword","children":"type"}]," ",["$","span",null,{"className":"hljs-title class_","children":"UserState"}]," = {\n  ",["$","span",null,{"className":"hljs-attr","children":"user"}],": ",["$","span",null,{"className":"hljs-title class_","children":"User"}]," | ",["$","span",null,{"className":"hljs-literal","children":"null"}],";\n  ",["$","span",null,{"className":"hljs-attr","children":"login"}],": ",["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":[["$","span",null,{"className":"hljs-attr","children":"accessToken"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}],", ",["$","span",null,{"className":"hljs-attr","children":"refreshToken"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}]]}],") =>"]}]," ",["$","span",null,{"className":"hljs-built_in","children":"void"}],";\n  ",["$","span",null,{"className":"hljs-attr","children":"logout"}],": ",["$","span",null,{"className":"hljs-function","children":"() =>"}]," ",["$","span",null,{"className":"hljs-built_in","children":"void"}],";\n};\n\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-attr","children":"useStoreSlice"}],": ",["$","span",null,{"className":"hljs-title class_","children":"StateCreator"}],"<",["$","span",null,{"className":"hljs-title class_","children":"UserState"}],"> = ",["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":"set"}],") =>"]}]," ({\n  ",["$","span",null,{"className":"hljs-attr","children":"user"}],": ",["$","span",null,{"className":"hljs-literal","children":"null"}],",\n  ",["$","span",null,{"className":"hljs-attr","children":"login"}],": ",["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":[["$","span",null,{"className":"hljs-attr","children":"accessToken"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}]]}],") =>"]}]," {\n    ",["$","span",null,{"className":"hljs-keyword","children":"return"}]," ",["$","span",null,{"className":"hljs-title function_","children":"set"}],"(",["$","span",null,{"className":"hljs-function","children":"() =>"}]," ({ ",["$","span",null,{"className":"hljs-attr","children":"user"}],": { accessToken } }));\n  },\n  ",["$","span",null,{"className":"hljs-attr","children":"logout"}],": ",["$","span",null,{"className":"hljs-function","children":"() =>"}]," ",["$","span",null,{"className":"hljs-title function_","children":"set"}],"(",["$","span",null,{"className":"hljs-function","children":"() =>"}]," ({ ",["$","span",null,{"className":"hljs-attr","children":"user"}],": ",["$","span",null,{"className":"hljs-literal","children":"null"}]," })),\n});\n\n",["$","span",null,{"className":"hljs-keyword","children":"const"}]," persistedUserStore = persist<",["$","span",null,{"className":"hljs-title class_","children":"UserState"}],">(useStoreSlice, {\n  ",["$","span",null,{"className":"hljs-attr","children":"name"}],": ",["$","span",null,{"className":"hljs-string","children":"\"user\""}],",\n});\n\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," useUserStore = ",["$","span",null,{"className":"hljs-title function_","children":"create"}],"(persistedUserStore);\n"]}]}]
59:["$","p",null,{"children":"이제 쓰고 싶은 컴포넌트에서 해당 store를 가져오면 된다."}]
5a:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-comment","children":"// 네트워크 요청을 보내기 전에 형식 검사"}],"\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"function"}]," ",["$","span",null,{"className":"hljs-title function_","children":"LoginPage"}],"(",["$","span",null,{"className":"hljs-params"}],") {\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," login = ",["$","span",null,{"className":"hljs-title function_","children":"useUserStore"}],"(",["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":"state"}],") =>"]}]," state.",["$","span",null,{"className":"hljs-property","children":"login"}],");\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," navigate = ",["$","span",null,{"className":"hljs-title function_","children":"useNavigate"}],"();\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," {\n    register,\n    handleSubmit,\n    ",["$","span",null,{"className":"hljs-attr","children":"formState"}],": { errors },\n  } = ",["$","span",null,{"className":"hljs-title function_","children":"useForm"}],"({ ",["$","span",null,{"className":"hljs-attr","children":"resolver"}],": ",["$","span",null,{"className":"hljs-title function_","children":"zodResolver"}],"(",["$","span",null,{"className":"hljs-title class_","children":"SignInSchema"}],") });\n"]}]}]
5b:["$","p",null,{"children":"위의 코드에서 useUserStore()로 한 스토어를 통째로 가져올 수 있는데 이는 스토어와 연결된 모든 컴포넌트들을 리렌더링시킬 수 있기 때문에 지양하는 것이 좋다."}]
5c:["$","p",null,{"children":"되도록이면 위처럼 하나씩 가져오자."}]
5d:["$","p",null,{"children":"이제 로컬스토리지에 담고 상태로 추적하며 이로 인해 컴포넌트가 바뀌는 함수는 처리가 완료되었다."}]
5e:["$","p",null,{"children":"다음은 이제 refresh Token에 대해서 고민해보자."}]
5f:["$","blockquote",null,{"children":["\n",["$","p",null,{"children":"refresh Token이란 access Token을 받기 위한 또 하나의 토큰이다. access Token보다 expire time이 길다.\n보통 세션 스토리지 (브라우저 닫히면 없어짐), 로컬 스토리지 (같은 Origin일 경우 expire time까지 있음), 쿠키 (네트워크 통신에서 사용한다. js-Cookies 같은 라이브러리로 편리하게 사용할 수 있다.)\n에 저장해둔다.\n끝에 나오겠지만 access Token과 refresh Token을 분리해서 관리하기 위해 refresh Token은 쿠키에, access Token은 로컬 스토리지에 저장하였다. (쿠키에 저장하는 것이 더 보안성이 좋다고 한다. (HTTPS로 인해) )"}],"\n"]}]
60:["$","h2",null,{"id":5,"className":"hltr-orange","children":"RTR"}]
61:["$","blockquote",null,{"children":["\n",["$","p",null,{"children":"RTR은 결국 쓰지 않았습니다 그래도 스스로 분석해낸 과정을 보고 싶으시면 봐주시고 아니면 React-hook-form 으로 넘어가 주시면 됩니다!"}],"\n"]}]
62:["$","p",null,{"children":["$","img",null,{"src":"/images/2024-06-17/Pasted%20image%2020240614123700.png","alt":""}]}]
63:["$","p",null,{"children":"보통 refresh 와 access 는 로컬스토리지, 쿠키에 저장한다. 기본값으로 access는 30분~1시간, refresh token은 2주의 시간을 가진다."}]
64:["$","p",null,{"children":"Access Token이 만료되면 Refresh Token과 함께 교체해주는 것"}]
65:["$","p",null,{"children":["$","img",null,{"src":"/images/2024-06-17/Pasted%20image%2020240614123857.png","alt":""}]}]
66:["$","p",null,{"children":"클라에서 auth 요청 > Auth0에서 검증 후 검증 코드를 보내줌 > 검증 코드를 이용해서 access Token 요청 > Auth0가 access Token, refresh Token 줌 > 이후 access Token 만기시 > refresh Token으로 Auth0에 access Token 요청 > Auth0가 새로운 access Token와 새로운 refresh Token을 줌."}]
67:["$","p",null,{"children":["계속 갱신하기 때문에 이미 사용된 토큰으로 access Token을 요청하는 ",["$","strong",null,{"children":"replay attack"}],"로부터 보호할 수 있다."]}]
68:["$","p",null,{"children":[["$","strong",null,{"children":"Replay Attack"}],["$","br",null,{}],"\n","공격자가 원본 메시지와 같은 자격증명을 얻기 위해 이전에 보내진 메시지를 가로채서 다시 보내는 것"]}]
69:["$","h4",null,{"id":6,"className":"hltr-green","children":"RTR 구현"}]
6a:["$","h5",null,{"id":7,"className":"hltr-cyan","children":"예제 분석"}]
6b:["$","p",null,{"children":"다음은 참고한 문서에서 나온 예제이다."}]
6c:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-typescript","children":[["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-title function_","children":"refreshTokenRotation"}]," = (",["$","span",null,{"className":"hljs-params"}],") => {\n  ",["$","span",null,{"className":"hljs-keyword","children":"let"}]," ",["$","span",null,{"className":"hljs-attr","children":"accessToken"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}]," = ",["$","span",null,{"className":"hljs-literal","children":"null"}],";\n  ",["$","span",null,{"className":"hljs-comment","children":"// accessToken 생성"}],"\n\n  ",["$","span",null,{"className":"hljs-keyword","children":"let"}]," ",["$","span",null,{"className":"hljs-attr","children":"expirationTime"}],": ",["$","span",null,{"className":"hljs-built_in","children":"number"}]," = ",["$","span",null,{"className":"hljs-literal","children":"null"}],";\n  ",["$","span",null,{"className":"hljs-comment","children":"// expirationTime 생성"}],"\n\n  ",["$","span",null,{"className":"hljs-keyword","children":"return"}]," {\n    ",["$","span",null,{"className":"hljs-attr","children":"getAccessToken"}],": ",["$","span",null,{"className":"hljs-title function_","children":"async"}]," () => {\n      ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," refreshToken = ",["$","span",null,{"className":"hljs-title function_","children":"getRefreshToken"}],"();\n      ",["$","span",null,{"className":"hljs-comment","children":"// getRefreshToken으로 refreshToken 가져오기"}],"\n\n      ",["$","span",null,{"className":"hljs-keyword","children":"if"}]," (!accessToken || expirationTime < ",["$","span",null,{"className":"hljs-keyword","children":"new"}]," ",["$","span",null,{"className":"hljs-title class_","children":"Date"}],"().",["$","span",null,{"className":"hljs-title function_","children":"getTime"}],"()) {\n        ",["$","span",null,{"className":"hljs-comment","children":"// accessToken이 없거나 expirationTime이 지금보다 작으면 (만기되면)"}],"\n\n        ",["$","span",null,{"className":"hljs-keyword","children":"await"}]," axios\n          .",["$","span",null,{"className":"hljs-title function_","children":"post"}],"(",["$","span",null,{"className":"hljs-string","children":"\"/api/refresh\""}],", {\n            refreshToken,\n          })\n          ",["$","span",null,{"className":"hljs-comment","children":"// refresh 요청, 토큰을 담아서"}],"\n          .",["$","span",null,{"className":"hljs-title function_","children":"then"}],"(",["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":"res"}],") =>"]}]," {\n            ",["$","span",null,{"className":"hljs-comment","children":"// 받은 응답으로 정보 저장"}],"\n            accessToken = res.",["$","span",null,{"className":"hljs-property","children":"data"}],".",["$","span",null,{"className":"hljs-property","children":"accessToken"}],";\n            expirationTime = res.",["$","span",null,{"className":"hljs-property","children":"data"}],".",["$","span",null,{"className":"hljs-property","children":"expirationTime"}],";\n            ",["$","span",null,{"className":"hljs-title function_","children":"setRefreshToken"}],"(res.",["$","span",null,{"className":"hljs-property","children":"data"}],".",["$","span",null,{"className":"hljs-property","children":"refreshToken"}],");\n          })\n          .",["$","span",null,{"className":"hljs-title function_","children":"catch"}],"(",["$","span",null,{"className":"hljs-function","children":"() =>"}]," {\n            ",["$","span",null,{"className":"hljs-comment","children":"// 안되면 로그인 만료되었다고 표현"}],"\n            accessToken = ",["$","span",null,{"className":"hljs-literal","children":"null"}],";\n            expirationTime = ",["$","span",null,{"className":"hljs-literal","children":"null"}],";\n            ",["$","span",null,{"className":"hljs-title function_","children":"alert"}],"(",["$","span",null,{"className":"hljs-string","children":"\"로그인이 만료 되었습니다.\""}],");\n          });\n      }\n      ",["$","span",null,{"className":"hljs-keyword","children":"return"}]," accessToken;\n    },\n    ",["$","span",null,{"className":"hljs-attr","children":"setAccessToken"}],": ",["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":[["$","span",null,{"className":"hljs-attr","children":"at"}],": ","$Lbc",", ","$Lbd",": ","$Lbe"]}],") =>"]}]," {\n      ","$Lbf","\n      accessToken = at;\n      expirationTime = et;\n    },\n    ","$Lc0","(","$Lc1",") {\n      ","$Lc2","\n      accessToken = ","$Lc3",";\n      expirationTime = ","$Lc4",";\n      ","$Lc5","();\n    },\n  };\n};\n"]}]}]
6d:["$","p",null,{"children":"분석이 완료된 후 실제 코드와 연결하여 적용해보았다."}]
6e:["$","h5",null,{"id":8,"className":"hltr-cyan","children":"응용 코드"}]
6f:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-comment","children":"// shared/util/RTR.ts"}],"\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { authInstance } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"../api/axios\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { deleteRefreshToken, getRefreshToken, setRefreshToken } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"./token\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { ",["$","span",null,{"className":"hljs-title class_","children":"InternalAxiosRequestConfig"}]," } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"axios\""}],";\n\n",["$","span",null,{"className":"hljs-comment","children":"// Refresh Token Rotation"}],"\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-title function_","children":"refreshTokenRotation"}]," = (",["$","span",null,{"className":"hljs-params"}],") => {\n  ",["$","span",null,{"className":"hljs-keyword","children":"let"}]," ",["$","span",null,{"className":"hljs-attr","children":"accessToken"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}]," | ",["$","span",null,{"className":"hljs-literal","children":"null"}]," = ",["$","span",null,{"className":"hljs-literal","children":"null"}],";\n  ",["$","span",null,{"className":"hljs-comment","children":"// accessToken 생성"}],"\n\n  ",["$","span",null,{"className":"hljs-keyword","children":"let"}]," ",["$","span",null,{"className":"hljs-attr","children":"expirationTime"}],": ",["$","span",null,{"className":"hljs-built_in","children":"number"}]," | ",["$","span",null,{"className":"hljs-literal","children":"null"}]," = ",["$","span",null,{"className":"hljs-literal","children":"null"}],";\n  ",["$","span",null,{"className":"hljs-comment","children":"// expirationTime 생성"}],"\n\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-title function_","children":"setAccessToken"}]," = (",["$","span",null,{"className":"hljs-params","children":[["$","span",null,{"className":"hljs-attr","children":"at"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}],", ",["$","span",null,{"className":"hljs-attr","children":"et"}],": ",["$","span",null,{"className":"hljs-built_in","children":"number"}]]}],") => {\n    ",["$","span",null,{"className":"hljs-comment","children":"// 접근 토큰 설정"}],"\n    accessToken = at;\n    expirationTime = et;\n  };\n\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-title function_","children":"deleteTokens"}]," = (",["$","span",null,{"className":"hljs-params"}],") => {\n    ",["$","span",null,{"className":"hljs-comment","children":"// 초기화 후 리프레쉬 토큰 삭제"}],"\n    accessToken = ",["$","span",null,{"className":"hljs-literal","children":"null"}],";\n    expirationTime = ",["$","span",null,{"className":"hljs-literal","children":"null"}],";\n    ",["$","span",null,{"className":"hljs-title function_","children":"deleteRefreshToken"}],"();\n  };\n\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-title function_","children":"moveHome"}]," = (",["$","span",null,{"className":"hljs-params"}],") => {\n    ",["$","span",null,{"className":"hljs-variable language_","children":"window"}],".",["$","span",null,{"className":"hljs-property","children":"location"}],".",["$","span",null,{"className":"hljs-property","children":"href"}]," = ",["$","span",null,{"className":"hljs-string","children":"\"/\""}],";\n  };\n\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-title function_","children":"isExpired"}]," = (",["$","span",null,{"className":"hljs-params"}],") => {\n    ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," now = ",["$","span",null,{"className":"hljs-keyword","children":"new"}]," ",["$","span",null,{"className":"hljs-title class_","children":"Date"}],"().",["$","span",null,{"className":"hljs-title function_","children":"getTime"}],"();\n    ","$Lc6"," (expirationTime ","$Lc7"," ","$Lc8",") < now;\n  };\n\n  ","$Lc9"," ","$Lca"," = ","$Lcb"," (","$Lcc",") => {\n    ","$Lcd"," refreshToken = ","$Lce","();\n    ","$Lcf","\n    ","$Ld0"," authInstance\n      .","$Ld1","(","$Ld2",", {\n        refreshToken,\n      })\n      ","$Ld3","\n      .","$Ld4","(","$Ld5"," {\n        ","$Ld6","\n        ","$Ld7"," {\n          ","$Ld8",": { accessToken, expirationTime, refreshToken },\n        } = res;\n        ","$Ld9","(accessToken, expirationTime);\n        ","$Lda","(refreshToken);\n      })\n      .","$Ldb","(","$Ldc"," {\n        ","$Ldd","\n        ","$Lde","();\n        ","$Ldf","(","$Le0",");\n        ","$Le1","();\n      });\n  };\n\n  ","$Le2"," {\n    ","$Le3",": ","$Le4"," ","$Le5"," (","$Le6","): ","$Le7","<","$Le8","> {\n      ","$Le9"," (!accessToken || ","$Lea","()) {\n        ","$Leb"," ","$Lec","();\n      }\n      ","$Led"," (config !== ","$Lee"," && config.","$Lef"," !== ","$Lf0",") {\n        config.","$Lf1",".","$Lf2"," = ","$Lf3",";\n      } ","$Lf4"," {\n        ","$Lf5",".","$Lf6","(","$Lf7",");\n      }\n      ","$Lf8"," config;\n    },\n  };\n};\n"]}]}]
70:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-keyword","children":"import"}]," axios ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"axios\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { ",["$","span",null,{"className":"hljs-variable constant_","children":"BASE_URL"}]," } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"../constants/constants\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { refreshTokenRotation } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"../util/RTR\""}],";\n\n",["$","span",null,{"className":"hljs-keyword","children":"const"}]," instance = axios.",["$","span",null,{"className":"hljs-title function_","children":"create"}],"({ ",["$","span",null,{"className":"hljs-attr","children":"baseURL"}],": ",["$","span",null,{"className":"hljs-variable constant_","children":"BASE_URL"}]," });\n",["$","span",null,{"className":"hljs-keyword","children":"const"}]," authInstance = axios.",["$","span",null,{"className":"hljs-title function_","children":"create"}],"({ ",["$","span",null,{"className":"hljs-attr","children":"baseURL"}],": ",["$","span",null,{"className":"hljs-variable constant_","children":"BASE_URL"}]," });\n",["$","span",null,{"className":"hljs-keyword","children":"const"}]," { setAuthHeader } = ",["$","span",null,{"className":"hljs-title function_","children":"refreshTokenRotation"}],"();\nauthInstance.",["$","span",null,{"className":"hljs-property","children":"interceptors"}],".",["$","span",null,{"className":"hljs-property","children":"request"}],".",["$","span",null,{"className":"hljs-title function_","children":"use"}],"(setAuthHeader);\n",["$","span",null,{"className":"hljs-comment","children":"// interceptor에 RTR이 적용된"}],"\n\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," { authInstance, instance };\n"]}]}]
71:["$","p",null,{"children":"이제 authorization이 필요한 네트워크 요청에 사용되는 axios instance가 완성되었다. 자동으로 accessToken을 검사해서 없으면 refreshToken을 이용해서 재조정해준다."}]
72:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-keyword","children":"import"}]," { useStore } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"@/app/store\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { postSignIn } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"@/shared/api/api\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { zodResolver } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"@hookform/resolvers/zod\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { ",["$","span",null,{"className":"hljs-title class_","children":"FieldValues"}],", useForm } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"react-hook-form\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { ",["$","span",null,{"className":"hljs-title class_","children":"Link"}],", useNavigate } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"react-router-dom\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { z } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"zod\""}],";\n\n",["$","span",null,{"className":"hljs-comment","children":"// schema 생성"}],"\n",["$","span",null,{"className":"hljs-keyword","children":"const"}]," schema = z.",["$","span",null,{"className":"hljs-title function_","children":"object"}],"({\n",["$","span",null,{"className":"hljs-comment","children":"// form 요소 유효성 검사 지정"}],"\n  ",["$","span",null,{"className":"hljs-attr","children":"email"}],": z.",["$","span",null,{"className":"hljs-title function_","children":"string"}],"().",["$","span",null,{"className":"hljs-title function_","children":"email"}],"({ ",["$","span",null,{"className":"hljs-attr","children":"message"}],": ",["$","span",null,{"className":"hljs-string","children":"\"잘못된 이메일 형식입니다\""}]," }), ",["$","span",null,{"className":"hljs-comment","children":"// error.[name].message에 담을 string 지정"}],"\n  ",["$","span",null,{"className":"hljs-attr","children":"password"}],": z.",["$","span",null,{"className":"hljs-title function_","children":"string"}],"().",["$","span",null,{"className":"hljs-title function_","children":"min"}],"(",["$","span",null,{"className":"hljs-number","children":"8"}],", { ",["$","span",null,{"className":"hljs-attr","children":"message"}],": ",["$","span",null,{"className":"hljs-string","children":"\"비밀번호를 8자 이상 입력해주세요\""}]," }),\n});\n\n",["$","span",null,{"className":"hljs-comment","children":"// 네트워크 요청을 보내기 전에 형식 검사"}],"\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"function"}]," ",["$","span",null,{"className":"hljs-title function_","children":"LoginPage"}],"(",["$","span",null,{"className":"hljs-params"}],") {\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," { login } = ",["$","span",null,{"className":"hljs-title function_","children":"useStore"}],"();\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," navigate = ",["$","span",null,{"className":"hljs-title function_","children":"useNavigate"}],"();\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," {\n    register,\n    handleSubmit,\n    ",["$","span",null,{"className":"hljs-attr","children":"formState"}],": { errors },\n  } = ",["$","span",null,{"className":"hljs-title function_","children":"useForm"}],"({ ",["$","span",null,{"className":"hljs-attr","children":"resolver"}],": ",["$","span",null,{"className":"hljs-title function_","children":"zodResolver"}],"(schema) });\n  ",["$","span",null,{"className":"hljs-comment","children":"// zod를 react-hook-form에서 사용하기 위한 resolver 지정"}],"\n\n",["$","span",null,{"className":"hljs-comment","children":"// 자체 async는 사용할 수 없다."}],"\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-title function_","children":"onSubmit"}]," = (",["$","span",null,{"className":"hljs-params","children":["$Lf9",": ","$Lfa"]}],") => {\n  ","$Lfb","\n  ","$Lfc","\n  ","$Lfd","\n    (","$Lfe"," () => {\n      ","$Lff"," data = ","$L100"," ","$L101","({\n        ","$L102",": d.","$L103",",\n        ","$L104",": d.","$L105",",\n      });\n      ","$L106"," (!data) ","$L107",";\n      ","$L108","(data.","$L109",");\n      ","$L10a","\n      ","$L10b","(","$L10c",");\n    })();\n  };\n\n  ","$L10d"," (\n    ","$L10e","\n  );\n}\n"]}]}]
73:["$","blockquote",null,{"children":["\n",["$","p",null,{"children":"하지만 위의 과정은 백엔드와의 소통이 필요하다. refresh 토큰을 받았을 때 refresh Token과 access Token을 같이 전달해주는 로직이 필요하고 더불어 두 개의 브라우저 (웹, 모바일) 에서 동시에 접속했을 때 하나의 기기에서 refresh Token을 받으면 다른 기기의 refresh Token은 stale하게 되어 로그아웃되는 사태가 발생한다."}],"\n",["$","p",null,{"children":[["$","s",null,{"children":"수많은 삽질 끝에"}]," 일반적으로 어떤 방식으로 로그인을 처리하는지\n알아보았고 그 과정에서 알게된 기술을 몽땅 적용해보기로 하였다."]}],"\n"]}]
74:["$","h2",null,{"id":9,"className":"hltr-orange","children":"react-hook-form"}]
75:["$","p",null,{"children":["$","img",null,{"src":"/images/2024-06-17/Pasted%20image%2020240721171036.png","alt":""}]}]
76:["$","p",null,{"children":"form validation은 항상 남아 있는 숙제이다."}]
77:["$","p",null,{"children":"처음 form을 접했을 때는 \"그냥 state로 input마다 박아넣으면 안되나?\" 라는 생각을 했었으나 이는 불필요한 리렌더링을 일으키게 된다."}]
78:["$","p",null,{"children":"이를 방지하기 위해 비제어 컴포넌트로 전부 만들면서 리렌더링을 줄이고 validation을 입히는 과정은 반복적이며 고통스럽다."}]
79:["$","p",null,{"children":"모든 과정을 자동화할 순 없을까? > 라이브러리 탄생"}]
7a:["$","p",null,{"children":"공식문서에서도 설명보단 \"그냥 일단 써봐\" 하는 느낌으로 간단하게 보여주고 있다. 다음은 우리의 친구 \"get started\"의 코드이다."}]
7b:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-keyword","children":"import"}]," { useForm, ",["$","span",null,{"className":"hljs-title class_","children":"SubmitHandler"}]," } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"react-hook-form\""}],";\n\n",["$","span",null,{"className":"hljs-keyword","children":"type"}]," ",["$","span",null,{"className":"hljs-title class_","children":"Inputs"}]," = {\n  ",["$","span",null,{"className":"hljs-attr","children":"example"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}],";\n  ",["$","span",null,{"className":"hljs-attr","children":"exampleRequired"}],": ",["$","span",null,{"className":"hljs-built_in","children":"string"}],";\n};\n\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"default"}]," ",["$","span",null,{"className":"hljs-keyword","children":"function"}]," ",["$","span",null,{"className":"hljs-title function_","children":"App"}],"(",["$","span",null,{"className":"hljs-params"}],") {\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," {\n    register,\n    handleSubmit,\n    watch,\n    ",["$","span",null,{"className":"hljs-attr","children":"formState"}],": { errors },\n  } = useForm<",["$","span",null,{"className":"hljs-title class_","children":"Inputs"}],">();\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-attr","children":"onSubmit"}],": ",["$","span",null,{"className":"hljs-title class_","children":"SubmitHandler"}],"<",["$","span",null,{"className":"hljs-title class_","children":"Inputs"}],"> = ",["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":"data"}],") =>"]}]," ",["$","span",null,{"className":"hljs-variable language_","children":"console"}],".",["$","span",null,{"className":"hljs-title function_","children":"log"}],"(data);\n\n  ",["$","span",null,{"className":"hljs-variable language_","children":"console"}],".",["$","span",null,{"className":"hljs-title function_","children":"log"}],"(",["$","span",null,{"className":"hljs-title function_","children":"watch"}],"(",["$","span",null,{"className":"hljs-string","children":"\"example\""}],")); ",["$","span",null,{"className":"hljs-comment","children":"// watch input value by passing the name of it"}],"\n\n  ",["$","span",null,{"className":"hljs-keyword","children":"return"}]," (\n    ",["$","span",null,{"className":"hljs-comment","children":"/* \"handleSubmit\" will validate your inputs before invoking \"onSubmit\" */"}],"\n    ",["$","span",null,{"className":"xml","children":[["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"form"}]," ",["$","span",null,{"className":"hljs-attr","children":"onSubmit"}],"=",["$","span",null,{"className":"hljs-string","children":"{handleSubmit(onSubmit)}"}],">"]}],"\n      {/* register your input into the hook by invoking the \"register\" function */}\n      ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"input"}]," ",["$","span",null,{"className":"hljs-attr","children":"defaultValue"}],"=",["$","span",null,{"className":"hljs-string","children":"\"test\""}]," {",["$","span",null,{"className":"hljs-attr","children":"...register"}],"(\"",["$","span",null,{"className":"hljs-attr","children":"example"}],"\")} />"]}],"\n\n      {/* include validation with required or other standard HTML validation rules */}\n      ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"input"}]," {",["$","span",null,{"className":"hljs-attr","children":"...register"}],"(\"",["$","span",null,{"className":"hljs-attr","children":"exampleRequired"}],"\", { ",["$","span",null,{"className":"hljs-attr","children":"required:"}]," ",["$","span",null,{"className":"hljs-attr","children":"true"}]," })} />"]}],"\n      {/* errors will return when field validation fails  */}\n      {errors.exampleRequired && ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"span"}],">"]}],"This field is required",["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"span"}],">"]}],"}\n\n      ","$L10f","\n    ","$L110"]}],"\n  );\n}\n"]}]}]
7c:["$","p",null,{"children":"위의 코드만 보고 따라치면 사실 간단한 validation은 완성이다."}]
7d:["$","p",null,{"children":"하지만 부족한 점이 존재한다. register에 config로 들어가 있는 validation을 적는 과정도 귀찮아진다."}]
7e:["$","p",null,{"children":"또한 다양한 옵션이 들어갔으면 좋겠고 그러한 스키마들을 분리해서 가독성을 높히고 싶다!"}]
7f:["$","p",null,{"children":"이 과정들도 귀찮지 아니한가? > schema 라이브러리 탄생"}]
80:["$","h2",null,{"id":10,"className":"hltr-orange","children":"react-hook-form zod resolver"}]
81:["$","p",null,{"children":["$","img",null,{"src":"/images/2024-06-17/Pasted%20image%2020240721171054.png","alt":""}]}]
82:["$","s",null,{"children":["$","p",null,{"children":"이 글을 쓰게된 이유이다. 멋있는 개발자가 된 느낌이었다. 이름도 어떻게 zod임?"}]}]
83:["$","blockquote",null,{"children":["\n",["$","p",null,{"children":"TypeScript-first schema validation with static type inference"}],"\n"]}]
84:["$","p",null,{"children":"즉 정적 타입 추론을 위한 것"}]
85:["$","p",null,{"children":"이것도 일단 써봐 느낌이다."}]
86:["$","p",null,{"children":"그래서 일단 써보았다."}]
87:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-keyword","children":"import"}]," { z } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"zod\""}],";\n\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-title class_","children":"SignUpSchema"}]," = z\n  .",["$","span",null,{"className":"hljs-title function_","children":"object"}],"({\n    ",["$","span",null,{"className":"hljs-attr","children":"nickname"}],": z.",["$","span",null,{"className":"hljs-title function_","children":"string"}],"().",["$","span",null,{"className":"hljs-title function_","children":"min"}],"(",["$","span",null,{"className":"hljs-number","children":"2"}],", { ",["$","span",null,{"className":"hljs-attr","children":"message"}],": ",["$","span",null,{"className":"hljs-string","children":"\"이름을 2자 이상 입력해주세요\""}]," }),\n    ",["$","span",null,{"className":"hljs-attr","children":"email"}],": z.",["$","span",null,{"className":"hljs-title function_","children":"string"}],"().",["$","span",null,{"className":"hljs-title function_","children":"email"}],"({ ",["$","span",null,{"className":"hljs-attr","children":"message"}],": ",["$","span",null,{"className":"hljs-string","children":"\"잘못된 이메일 형식입니다\""}]," }),\n    ",["$","span",null,{"className":"hljs-attr","children":"password"}],": z\n      .",["$","span",null,{"className":"hljs-title function_","children":"string"}],"()\n      .",["$","span",null,{"className":"hljs-title function_","children":"min"}],"(",["$","span",null,{"className":"hljs-number","children":"8"}],", { ",["$","span",null,{"className":"hljs-attr","children":"message"}],": ",["$","span",null,{"className":"hljs-string","children":"\"비밀번호를 8자 이상 입력해주세요\""}]," }),\n    ",["$","span",null,{"className":"hljs-attr","children":"passwordConfirmation"}],": z\n      .",["$","span",null,{"className":"hljs-title function_","children":"string"}],"()\n      .",["$","span",null,{"className":"hljs-title function_","children":"min"}],"(",["$","span",null,{"className":"hljs-number","children":"8"}],", { ",["$","span",null,{"className":"hljs-attr","children":"message"}],": ",["$","span",null,{"className":"hljs-string","children":"\"비밀번호를 8자 이상 입력해주세요\""}]," }),\n  })\n  .",["$","span",null,{"className":"hljs-title function_","children":"superRefine"}],"(",["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":"{ passwordConfirmation, password }, ctx"}],") =>"]}]," {\n    ",["$","span",null,{"className":"hljs-keyword","children":"if"}]," (passwordConfirmation !== password) {\n      ctx.",["$","span",null,{"className":"hljs-title function_","children":"addIssue"}],"({\n        ",["$","span",null,{"className":"hljs-attr","children":"code"}],": ",["$","span",null,{"className":"hljs-string","children":"\"custom\""}],",\n        ",["$","span",null,{"className":"hljs-attr","children":"message"}],": ",["$","span",null,{"className":"hljs-string","children":"\"비밀번호가 일치해야 합니다.\""}],",\n        ",["$","span",null,{"className":"hljs-attr","children":"path"}],": [",["$","span",null,{"className":"hljs-string","children":"\"passwordConfirmation\""}],"],\n      });\n    }\n  });\n\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"type"}]," ",["$","span",null,{"className":"hljs-title class_","children":"SignUpType"}]," = z.",["$","span",null,{"className":"hljs-property","children":"infer"}],"<",["$","span",null,{"className":"hljs-keyword","children":"typeof"}]," ",["$","span",null,{"className":"hljs-title class_","children":"SignUpSchema"}],">;\n"]}]}]
88:["$","p",null,{"children":"회원가입 관련 schema이다. 보다시피 파일을 분리시켜서 schema와 그 schema를 사용하는 react - hook -form을 분리시켰다."}]
89:["$","p",null,{"children":"코드의 가독성도 늘어나며 schema만 변경하면 되서 유지보수성이 늘어난다."}]
8a:["$","p",null,{"children":"우리의 목적은 로그인이니 로그인 관련 schema와 react-hook-form 처리를 구현해보자."}]
8b:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-keyword","children":"import"}]," { z } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"zod\""}],";\n\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-title class_","children":"SignInSchema"}]," = z.",["$","span",null,{"className":"hljs-title function_","children":"object"}],"({\n  ",["$","span",null,{"className":"hljs-attr","children":"email"}],": z.",["$","span",null,{"className":"hljs-title function_","children":"string"}],"().",["$","span",null,{"className":"hljs-title function_","children":"email"}],"({ ",["$","span",null,{"className":"hljs-attr","children":"message"}],": ",["$","span",null,{"className":"hljs-string","children":"\"잘못된 이메일 형식입니다\""}]," }),\n  ",["$","span",null,{"className":"hljs-attr","children":"password"}],": z.",["$","span",null,{"className":"hljs-title function_","children":"string"}],"().",["$","span",null,{"className":"hljs-title function_","children":"min"}],"(",["$","span",null,{"className":"hljs-number","children":"8"}],", { ",["$","span",null,{"className":"hljs-attr","children":"message"}],": ",["$","span",null,{"className":"hljs-string","children":"\"비밀번호를 8자 이상 입력해주세요\""}]," }),\n});\n\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"type"}]," ",["$","span",null,{"className":"hljs-title class_","children":"SignInInput"}]," = z.",["$","span",null,{"className":"hljs-property","children":"infer"}],"<",["$","span",null,{"className":"hljs-keyword","children":"typeof"}]," ",["$","span",null,{"className":"hljs-title class_","children":"SignInSchema"}],">;\n"]}]}]
8c:["$","p",null,{"children":"우선 string이고 기본적인 email validation을 입혔다. 원래는 noneEmpty 라는 메소드로 required 처리를 했다고 하는데 deprecated되었고 min으로 처리할 수 있게 되었다고 한다."}]
8d:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"function"}]," ",["$","span",null,{"className":"hljs-title function_","children":"LoginPage"}],"(",["$","span",null,{"className":"hljs-params"}],") {\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," login = ",["$","span",null,{"className":"hljs-title function_","children":"useUserStore"}],"(",["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":"state"}],") =>"]}]," state.",["$","span",null,{"className":"hljs-property","children":"login"}],");\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," navigate = ",["$","span",null,{"className":"hljs-title function_","children":"useNavigate"}],"();\n  ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," {\n    register,\n    handleSubmit,\n    ",["$","span",null,{"className":"hljs-attr","children":"formState"}],": { errors },\n  } = ",["$","span",null,{"className":"hljs-title function_","children":"useForm"}],"({ ",["$","span",null,{"className":"hljs-attr","children":"resolver"}],": ",["$","span",null,{"className":"hljs-title function_","children":"zodResolver"}],"(",["$","span",null,{"className":"hljs-title class_","children":"SignInSchema"}],") });\n",["$","span",null,{"className":"hljs-comment","children":"//..."}],"\n",["$","span",null,{"className":"hljs-keyword","children":"return"}]," (\n    ",["$","span",null,{"className":"xml","children":[["$","span",null,{"className":"hljs-tag","children":"<>"}],"\n      ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"form"}]," ",["$","span",null,{"className":"hljs-attr","children":"onSubmit"}],"=",["$","span",null,{"className":"hljs-string","children":"{handleSubmit(onSubmit)}"}],">"]}],"\n        ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"div"}],">"]}],"\n          ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"input"}]," {",["$","span",null,{"className":"hljs-attr","children":"...register"}],"(\"",["$","span",null,{"className":"hljs-attr","children":"email"}],"\")} />"]}],"\n          {errors.email?.message && (\n            ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"p"}]," ",["$","span",null,{"className":"hljs-attr","children":"style"}],"=",["$","span",null,{"className":"hljs-string","children":"{{"}]," ",["$","span",null,{"className":"hljs-attr","children":"color:"}]," \"",["$","span",null,{"className":"hljs-attr","children":"red"}],"\" }}>"]}],"{errors.email?.message as string}",["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"p"}],">"]}],"\n          )}\n        ",["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"div"}],">"]}],"\n        ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"div"}],">"]}],"\n          ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"input"}]," {",["$","span",null,{"className":"hljs-attr","children":"...register"}],"(\"",["$","span",null,{"className":"hljs-attr","children":"password"}],"\")} ",["$","span",null,{"className":"hljs-attr","children":"type"}],"=",["$","span",null,{"className":"hljs-string","children":"\"password\""}]," />"]}],"\n          {errors.password?.message && (\n            ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"p"}]," ",["$","span",null,{"className":"hljs-attr","children":"style"}],"=",["$","span",null,{"className":"hljs-string","children":"{{"}]," ",["$","span",null,{"className":"hljs-attr","children":"color:"}]," \"",["$","span",null,{"className":"hljs-attr","children":"red"}],"\" }}>"]}],"{errors.password?.message as string}",["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"p"}],">"]}],"\n          )}\n        ",["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"div"}],">"]}],"\n        ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"input"}]," ",["$","span",null,{"className":"hljs-attr","children":"type"}],"=",["$","span",null,{"className":"hljs-string","children":"\"submit\""}]," />"]}],"\n      ","$L111","\n      ","$L112","회원가입","$L113","\n    ","$L114"]}],"\n"]}]}]
8e:["$","p",null,{"children":"위 코드처럼 zodResolver라는 함수에 넣어서 schema를 적용시킨다."}]
8f:["$","p",null,{"children":"이제 끝난걸까?"}]
90:["$","p",null,{"children":"아니다. RTR이 실패했기 때문에 또다른 refresh Token 여정을 떠나야 한다!"}]
91:["$","p",null,{"children":"기존의 api 요청은 axios로 header나 기본 설정들을 간단하게 처리했었다."}]
92:["$","p",null,{"children":"refresh Token은 정말 기본적인 웹 개념이니깐 axios에서 처리할 수 있는 무언가를 만들지 않았을까? 하는 생각에 문서를 정독하였다."}]
93:["$","p",null,{"children":"그리고 찾아낸 interceptor"}]
94:["$","h2",null,{"id":11,"className":"hltr-orange","children":"axios interceptor"}]
95:["$","p",null,{"children":["$","img",null,{"src":"/images/2024-06-17/Pasted%20image%2020240721171000.png","alt":""}]}]
96:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-comment","children":"// 요청 인터셉터 추가하기"}],"\naxios.",["$","span",null,{"className":"hljs-property","children":"interceptors"}],".",["$","span",null,{"className":"hljs-property","children":"request"}],".",["$","span",null,{"className":"hljs-title function_","children":"use"}],"(\n  ",["$","span",null,{"className":"hljs-keyword","children":"function"}]," (",["$","span",null,{"className":"hljs-params","children":"config"}],") {\n    ",["$","span",null,{"className":"hljs-comment","children":"// 요청이 전달되기 전에 작업 수행"}],"\n    ",["$","span",null,{"className":"hljs-keyword","children":"return"}]," config;\n  },\n  ",["$","span",null,{"className":"hljs-keyword","children":"function"}]," (",["$","span",null,{"className":"hljs-params","children":"error"}],") {\n    ",["$","span",null,{"className":"hljs-comment","children":"// 요청 오류가 있는 작업 수행"}],"\n    ",["$","span",null,{"className":"hljs-keyword","children":"return"}]," ",["$","span",null,{"className":"hljs-title class_","children":"Promise"}],".",["$","span",null,{"className":"hljs-title function_","children":"reject"}],"(error);\n  },\n);\n\n",["$","span",null,{"className":"hljs-comment","children":"// 응답 인터셉터 추가하기"}],"\naxios.",["$","span",null,{"className":"hljs-property","children":"interceptors"}],".",["$","span",null,{"className":"hljs-property","children":"response"}],".",["$","span",null,{"className":"hljs-title function_","children":"use"}],"(\n  ",["$","span",null,{"className":"hljs-keyword","children":"function"}]," (",["$","span",null,{"className":"hljs-params","children":"response"}],") {\n    ",["$","span",null,{"className":"hljs-comment","children":"// 2xx 범위에 있는 상태 코드는 이 함수를 트리거 합니다."}],"\n    ",["$","span",null,{"className":"hljs-comment","children":"// 응답 데이터가 있는 작업 수행"}],"\n    ",["$","span",null,{"className":"hljs-keyword","children":"return"}]," response;\n  },\n  ",["$","span",null,{"className":"hljs-keyword","children":"function"}]," (",["$","span",null,{"className":"hljs-params","children":"error"}],") {\n    ",["$","span",null,{"className":"hljs-comment","children":"// 2xx 외의 범위에 있는 상태 코드는 이 함수를 트리거 합니다."}],"\n    ",["$","span",null,{"className":"hljs-comment","children":"// 응답 오류가 있는 작업 수행"}],"\n    ",["$","span",null,{"className":"hljs-keyword","children":"return"}]," ",["$","span",null,{"className":"hljs-title class_","children":"Promise"}],".",["$","span",null,{"className":"hljs-title function_","children":"reject"}],"(error);\n  },\n);\n"]}]}]
97:["$","p",null,{"children":"공식문서에 존재하는 코드이다. 정말 간단하게 되어있지만 config를 전달해서 작업을 수행하고, Promise.reject(error)로 작업에 error를 던지는 등 해석해야 될만한 거리들이 많다."}]
98:["$","p",null,{"children":"늘 그랬듯 일단 부딪혀 보기로 했다."}]
99:["$","pre",null,{"children":["$","code",null,{"className":"hljs language-tsx","children":[["$","span",null,{"className":"hljs-keyword","children":"import"}]," { useUserStore } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"@/app/store\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { ",["$","span",null,{"className":"hljs-variable constant_","children":"BASE_URL"}]," } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"../constants/constants\""}],";\n\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," axios, {\n  ",["$","span",null,{"className":"hljs-title class_","children":"AxiosError"}],",\n  ",["$","span",null,{"className":"hljs-title class_","children":"CreateAxiosDefaults"}],",\n  ",["$","span",null,{"className":"hljs-title class_","children":"InternalAxiosRequestConfig"}],",\n} ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"axios\""}],";\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," { postAuthRefreshToken } ",["$","span",null,{"className":"hljs-keyword","children":"from"}]," ",["$","span",null,{"className":"hljs-string","children":"\"./api\""}],";\n\n",["$","span",null,{"className":"hljs-comment","children":"// 재시도 확인 프로퍼티 설정"}],"\n",["$","span",null,{"className":"hljs-keyword","children":"interface"}]," ",["$","span",null,{"className":"hljs-title class_","children":"CustomAxiosRequestConfig"}]," ",["$","span",null,{"className":"hljs-keyword","children":"extends"}]," ",["$","span",null,{"className":"hljs-title class_","children":"InternalAxiosRequestConfig"}]," {\n  ",["$","span",null,{"className":"hljs-attr","children":"_retry"}],"?: ",["$","span",null,{"className":"hljs-built_in","children":"boolean"}],";\n}\n\n",["$","span",null,{"className":"hljs-comment","children":"// 기본 설정"}],"\n",["$","span",null,{"className":"hljs-keyword","children":"const"}]," ",["$","span",null,{"className":"hljs-attr","children":"baseConfig"}],": ",["$","span",null,{"className":"hljs-title class_","children":"CreateAxiosDefaults"}]," = {\n  ",["$","span",null,{"className":"hljs-attr","children":"baseURL"}],": ",["$","span",null,{"className":"hljs-string","children":["`",["$","span",null,{"className":"hljs-subst","children":"$${BASE_URL}"}],"`"]}],",\n};\n\n",["$","span",null,{"className":"hljs-comment","children":"// 쿠키 드러내고 인증 필요없는 인스턴스"}],"\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," instanceWithoutInterceptors = axios.",["$","span",null,{"className":"hljs-title function_","children":"create"}],"(baseConfig);\n\n",["$","span",null,{"className":"hljs-comment","children":"// 인증 필요한 인스턴스"}],"\n",["$","span",null,{"className":"hljs-keyword","children":"export"}]," ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," instance = axios.",["$","span",null,{"className":"hljs-title function_","children":"create"}],"(baseConfig);\n\ninstance.",["$","span",null,{"className":"hljs-property","children":"interceptors"}],".",["$","span",null,{"className":"hljs-property","children":"request"}],".",["$","span",null,{"className":"hljs-title function_","children":"use"}],"(\n  ",["$","span",null,{"className":"hljs-comment","children":"// 요청 전에 실행"}],"\n  ",["$","span",null,{"className":"hljs-keyword","children":"function"}]," (",["$","span",null,{"className":"hljs-params","children":"config"}],") {\n    ",["$","span",null,{"className":"hljs-comment","children":"// 토큰 가져오기"}],"\n    ",["$","span",null,{"className":"hljs-keyword","children":"const"}]," accessToken = useUserStore.",["$","span",null,{"className":"hljs-title function_","children":"getState"}],"().",["$","span",null,{"className":"hljs-property","children":"user"}],"?.",["$","span",null,{"className":"hljs-property","children":"accessToken"}],";\n\n    ",["$","span",null,{"className":"hljs-comment","children":"// 헤더에 토큰 추가"}],"\n    ",["$","span",null,{"className":"hljs-keyword","children":"if"}]," (accessToken) {\n      config.",["$","span",null,{"className":"hljs-property","children":"headers"}],".",["$","span",null,{"className":"hljs-property","children":"Authorization"}]," = ",["$","span",null,{"className":"hljs-string","children":["`Bearer ",["$","span",null,{"className":"hljs-subst","children":"$${accessToken}"}],"`"]}],";\n    }\n\n    ","$L115","\n    ","$L116"," config;\n  },\n  ","$L117","\n  ","$L118"," (","$L119",") {\n    ","$L11a"," ","$L11b",".","$L11c","(error);\n  },\n);\n\ninstance.","$L11d",".","$L11e",".","$L11f","(\n  ","$L120","\n  ","$L121"," (","$L122",") {\n    ","$L123"," response;\n  },\n  ","$L124","\n  ","$L125"," ","$L126"," (","$L127",") {\n    ","$L128","\n    ","$L129"," ","$L12a",": ","$L12b"," | ","$L12c"," = error.","$L12d",";\n\n    ","$L12e","\n    ","$L12f"," (\n      error.","$L130","?.","$L131"," === ","$L132"," &&\n      originalRequest &&\n      !originalRequest.","$L133","\n    ) {\n      originalRequest.","$L134"," = ","$L135",";\n\n      ","$L136"," {\n        ","$L137","\n        ","$L138"," response = ","$L139"," ","$L13a","();\n        ","$L13b","\n        useUserStore.","$L13c","({\n          ","$L13d",": { ","$L13e",": response.","$L13f"," },\n        });\n\n        ","$L140","\n        originalRequest.","$L141",".","$L142"," = ","$L143",";\n\n        ","$L144","\n        ","$L145"," ","$L146","(originalRequest);\n      } ","$L147"," (error) {\n        ","$L148","\n        ","$L149"," (error ","$L14a"," ","$L14b"," && error.","$L14c","?.","$L14d"," === ","$L14e",") {\n          ","$L14f","\n          useUserStore.","$L150","().","$L151","();\n          ","$L152",";\n        }\n      }\n    }\n\n    ","$L153"," ","$L154",".","$L155","(error);\n  },\n);\n"]}]}]
9a:["$","p",null,{"children":"우선 모든 instance가 인증이 필요한 건 아니다. accessToken 없이도 접근할 수 있는 데이터가 있으니 분리해준다. (instanceWithoutInterceptors)"}]
9b:["$","p",null,{"children":"두 가지로 분기를 나눠야 한다."}]
9c:["$","h3",null,{"id":12,"className":"hltr-yellow","children":"요청 전"}]
9d:["$","p",null,{"children":"zustand로 accessToken을 저장하고 있으니 꺼내와주고 Authorization에 토큰을 담는다. 끝"}]
9e:["$","h3",null,{"id":13,"className":"hltr-yellow","children":"요청 후"}]
9f:["$","p",null,{"children":"성공한 경우는 똑같지만 실패했을 때 refresh Token으로 accessToken을 받아와 줘야 한다."}]
a0:["$","p",null,{"children":"보통 401 (Unauthorization Error)로 표현되고 지금 api에도 그렇기 때문에 맞게 처리해준다."}]
a1:["$","p",null,{"children":"이후 instance 자체를 return으로 넣어서 다시 시도시켜주면 된다."}]
a2:["$","p",null,{"children":["이렇게 되면 ",["$","code",null,{"children":"_retry"}],"로 인해서 단 한번만 refresh Token으로 access Token을 갱신해서 요청을 다시 시행하고 아닐 경우 Promise.reject로 가서 마무리된다."]}]
a3:["$","h2",null,{"id":14,"className":"hltr-orange","children":"결과"}]
a4:["$","p",null,{"children":"로그인과 동시에 accessToken은 localStorage로 들어가는 것을 확인할 수 있고"}]
a5:["$","p",null,{"children":["$","img",null,{"src":"/images/2024-06-17/Pasted%20image%2020240721173745.png","alt":""}]}]
a6:["$","p",null,{"children":"refreshToken은 쿠키에 잘 있는 것을 확인할 수 있다."}]
a7:["$","p",null,{"children":["$","img",null,{"src":"/images/2024-06-17/Pasted%20image%2020240721173806.png","alt":""}]}]
a8:["$","p",null,{"children":"accessToken이 만료되면 network 탭에 다음과 같이 표시된다."}]
a9:["$","p",null,{"children":["$","img",null,{"src":"/images/2024-06-17/Pasted%20image%2020240721174651.png","alt":""}]}]
aa:["$","ol",null,{"children":["\n",["$","li",null,{"children":"인증이 필요한 요청을 실패한다."}],"\n",["$","li",null,{"children":"refresh-token 요청을 보낸다. access Token을 갱신한다."}],"\n",["$","li",null,{"children":"다시 인증이 필요한 요청을 보낸다."}],"\n",["$","li",null,{"children":"인증이 필요한 요청을 기반으로 인증을 보낸다."}],"\n"]}]
ab:["$","h2",null,{"id":15,"className":"hltr-orange","children":"후기"}]
ac:["$","p",null,{"children":"로그인이라는 작지만 거대한 기능을 알아보았다."}]
ad:["$","p",null,{"children":"자동 로그인이나 이를 감지하고 리렌더링되는 헤더 같은 컴포넌트 처리가 남아있긴 했지만"}]
ae:["$","p",null,{"children":"인증에 관련된 부분의 핵심적인 부분은 이정도인 것 같다. (OAuth나 OIDC 같은게 남긴 했지만)"}]
af:["$","p",null,{"children":"바닐라로 구현할 경우 굉장히 어려울 법한 부분들을 다양한 라이브러리가 채워주는 풍성한 프론트엔드 환경을 확인할 수 있었다."}]
b0:["$","p",null,{"children":"라이브러리를 학습하는 데 있어서 주저없어야 하는 부분이 이런 것 같다. 그냥 도구이기에 라는 마음가짐으로 임해보자."}]
b1:["$","h2",null,{"id":16,"className":"hltr-orange","children":"Reference"}]
b2:["$","a",null,{"href":"https://docs.pmnd.rs/zustand/getting-started/introduction","children":["$","p",null,{"children":"zustand 공식문서"}]}]
b3:["$","a",null,{"href":"https://react-hook-form.com/","children":"react-hook-form 공식문서"}]
b4:["$","a",null,{"href":"https://zod.dev/","children":"zod 공식 문서"}]
b5:["$","a",null,{"href":"https://github.com/react-hook-form/resolvers?tab=readme-ov-file#zod","children":["$","p",null,{"children":"react-hook-form/zod resolver"}]}]
b6:["$","a",null,{"href":"https://axios-http.com/docs/interceptors","children":"axios interceptors"}]
b7:["$","a",null,{"href":"https://github.com/colinhacks/zod/discussions","children":"zod discussion"}]
b8:["$","a",null,{"href":"https://velog.io/@chchaeun/%EC%9D%B8%EC%A6%9D%EA%B3%BC","children":["$","p",null,{"children":"개발새발.log"}]}]
b9:["$","a",null,{"href":"https://medium.com/@kirankumal714/implementing-refresh-token-in-react-using-axios-zustand-and-react-query-a5dbac2944b6","children":["$","p",null,{"children":"Kiran Kumal Medium"}]}]
ba:["$","a",null,{"href":"https://auth0.com/docs/secure/tokens/refresh-tokens/refresh-token-rotation#maintain-user-sessions-in-spas","children":["$","p",null,{"children":"auth0 by Okta"}]}]
bb:["$","blockquote",null,{"children":["\n",["$","p",null,{"children":"개인 학습을 위한 자료입니다!"}],"\n",["$","p",null,{"children":"잘못된 내용이 있다면 말씀 부탁드립니다. 감사합니다."}],"\n"]}]
bc:["$","span",null,{"className":"hljs-built_in","children":"string"}]
bd:["$","span",null,{"className":"hljs-attr","children":"et"}]
be:["$","span",null,{"className":"hljs-built_in","children":"number"}]
bf:["$","span",null,{"className":"hljs-comment","children":"// 접근 토큰 설정"}]
c0:["$","span",null,{"className":"hljs-title function_","children":"deleteTokens"}]
c1:["$","span",null,{"className":"hljs-params"}]
c2:["$","span",null,{"className":"hljs-comment","children":"// 초기화 후 리프레쉬 토큰 삭제"}]
c3:["$","span",null,{"className":"hljs-literal","children":"null"}]
c4:["$","span",null,{"className":"hljs-literal","children":"null"}]
c5:["$","span",null,{"className":"hljs-title function_","children":"deleteRefreshToken"}]
c6:["$","span",null,{"className":"hljs-keyword","children":"return"}]
c7:["$","span",null,{"className":"hljs-keyword","children":"as"}]
c8:["$","span",null,{"className":"hljs-built_in","children":"number"}]
c9:["$","span",null,{"className":"hljs-keyword","children":"const"}]
ca:["$","span",null,{"className":"hljs-title function_","children":"getNewTokens"}]
cb:["$","span",null,{"className":"hljs-keyword","children":"async"}]
cc:["$","span",null,{"className":"hljs-params"}]
cd:["$","span",null,{"className":"hljs-keyword","children":"const"}]
ce:["$","span",null,{"className":"hljs-title function_","children":"getRefreshToken"}]
cf:["$","span",null,{"className":"hljs-comment","children":"// getRefreshToken으로 refreshToken 가져오기"}]
d0:["$","span",null,{"className":"hljs-keyword","children":"await"}]
d1:["$","span",null,{"className":"hljs-title function_","children":"post"}]
d2:["$","span",null,{"className":"hljs-string","children":"\"/auth/refresh-token\""}]
d3:["$","span",null,{"className":"hljs-comment","children":"// refresh 요청, 토큰을 담아서"}]
d4:["$","span",null,{"className":"hljs-title function_","children":"then"}]
d5:["$","span",null,{"className":"hljs-function","children":["(",["$","span",null,{"className":"hljs-params","children":"res"}],") =>"]}]
d6:["$","span",null,{"className":"hljs-comment","children":"// 받은 응답으로 정보 저장"}]
d7:["$","span",null,{"className":"hljs-keyword","children":"const"}]
d8:["$","span",null,{"className":"hljs-attr","children":"data"}]
d9:["$","span",null,{"className":"hljs-title function_","children":"setAccessToken"}]
da:["$","span",null,{"className":"hljs-title function_","children":"setRefreshToken"}]
db:["$","span",null,{"className":"hljs-title function_","children":"catch"}]
dc:["$","span",null,{"className":"hljs-function","children":"() =>"}]
dd:["$","span",null,{"className":"hljs-comment","children":"// 안되면 로그인 만료되었다고 표현"}]
de:["$","span",null,{"className":"hljs-title function_","children":"deleteTokens"}]
df:["$","span",null,{"className":"hljs-title function_","children":"alert"}]
e0:["$","span",null,{"className":"hljs-string","children":"\"로그인이 만료 되었습니다.\""}]
e1:["$","span",null,{"className":"hljs-title function_","children":"moveHome"}]
e2:["$","span",null,{"className":"hljs-keyword","children":"return"}]
e3:["$","span",null,{"className":"hljs-attr","children":"setAuthHeader"}]
e4:["$","span",null,{"className":"hljs-keyword","children":"async"}]
e5:["$","span",null,{"className":"hljs-keyword","children":"function"}]
e6:["$","span",null,{"className":"hljs-params","children":["\n      ",["$","span",null,{"className":"hljs-attr","children":"config"}],": ",["$","span",null,{"className":"hljs-title class_","children":"InternalAxiosRequestConfig"}],",\n    "]}]
e7:["$","span",null,{"className":"hljs-title class_","children":"Promise"}]
e8:["$","span",null,{"className":"hljs-title class_","children":"InternalAxiosRequestConfig"}]
e9:["$","span",null,{"className":"hljs-keyword","children":"if"}]
ea:["$","span",null,{"className":"hljs-title function_","children":"isExpired"}]
eb:["$","span",null,{"className":"hljs-keyword","children":"await"}]
ec:["$","span",null,{"className":"hljs-title function_","children":"getNewTokens"}]
ed:["$","span",null,{"className":"hljs-keyword","children":"if"}]
ee:["$","span",null,{"className":"hljs-literal","children":"undefined"}]
ef:["$","span",null,{"className":"hljs-property","children":"headers"}]
f0:["$","span",null,{"className":"hljs-literal","children":"undefined"}]
f1:["$","span",null,{"className":"hljs-property","children":"headers"}]
f2:["$","span",null,{"className":"hljs-property","children":"Authorization"}]
f3:["$","span",null,{"className":"hljs-string","children":["`Bearer ",["$","span",null,{"className":"hljs-subst","children":"$${accessToken}"}],"`"]}]
f4:["$","span",null,{"className":"hljs-keyword","children":"else"}]
f5:["$","span",null,{"className":"hljs-variable language_","children":"console"}]
f6:["$","span",null,{"className":"hljs-title function_","children":"error"}]
f7:["$","span",null,{"className":"hljs-string","children":"\"axios config에 문제 발생\""}]
f8:["$","span",null,{"className":"hljs-keyword","children":"return"}]
f9:["$","span",null,{"className":"hljs-attr","children":"d"}]
fa:["$","span",null,{"className":"hljs-title class_","children":"FieldValues"}]
fb:["$","span",null,{"className":"hljs-comment","children":"// handleSubmit으로부터 FieldValues를 받아서 로그인 처리함."}]
fc:["$","span",null,{"className":"hljs-comment","children":"// 로그인 처리는 네트워크 요청 > accessToken을 zustand store에 담는 것으로 종료"}]
fd:["$","span",null,{"className":"hljs-comment","children":"// login자체에 localStorage, cookie에 해당 값을 저장하고 상태를 바꾸는 로직이 들어가 있어서 login에 값만 보내면 되게 설계되어 있음."}]
fe:["$","span",null,{"className":"hljs-title function_","children":"async"}]
ff:["$","span",null,{"className":"hljs-keyword","children":"const"}]
100:["$","span",null,{"className":"hljs-keyword","children":"await"}]
101:["$","span",null,{"className":"hljs-title function_","children":"postSignIn"}]
102:["$","span",null,{"className":"hljs-attr","children":"email"}]
103:["$","span",null,{"className":"hljs-property","children":"email"}]
104:["$","span",null,{"className":"hljs-attr","children":"password"}]
105:["$","span",null,{"className":"hljs-property","children":"password"}]
106:["$","span",null,{"className":"hljs-keyword","children":"if"}]
107:["$","span",null,{"className":"hljs-keyword","children":"return"}]
108:["$","span",null,{"className":"hljs-title function_","children":"login"}]
109:["$","span",null,{"className":"hljs-property","children":"accessToken"}]
10a:["$","span",null,{"className":"hljs-comment","children":"// 로그인 완료시 루트 라우트로 이동"}]
10b:["$","span",null,{"className":"hljs-title function_","children":"navigate"}]
10c:["$","span",null,{"className":"hljs-string","children":"\"/\""}]
10d:["$","span",null,{"className":"hljs-keyword","children":"return"}]
10e:["$","span",null,{"className":"xml","children":[["$","span",null,{"className":"hljs-tag","children":"<>"}],"\n     {/* 이벤트 핸들러를 submit event로 보낸다. */}\n      ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"form"}]," ",["$","span",null,{"className":"hljs-attr","children":"onSubmit"}],"=",["$","span",null,{"className":"hljs-string","children":"{handleSubmit(onSubmit)}"}],">"]}],"\n     {/* register를 이용해서 email을 지정 */}\n        ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"input"}]," {",["$","span",null,{"className":"hljs-attr","children":"...register"}],"(\"",["$","span",null,{"className":"hljs-attr","children":"email"}],"\")} />"]}],"\n     {/* zod에서 email을 가진 요소를 찾아서 그 안의 message(에러)를 꺼낸다. */}\n        {errors.email?.message && ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"p"}]," ",["$","span",null,{"className":"hljs-attr","children":"style"}],"=",["$","span",null,{"className":"hljs-string","children":"{{color:"}],"\"",["$","span",null,{"className":"hljs-attr","children":"red"}],"\"}}>"]}],"errors.email?.message as string}",["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"p"}],">"]}],"}\n        ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"input"}]," {",["$","span",null,{"className":"hljs-attr","children":"...register"}],"(\"",["$","span",null,{"className":"hljs-attr","children":"password"}],"\")} />"]}],"\n        {errors.password?.message && (\n          ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"p"}]," ",["$","span",null,{"className":"hljs-attr","children":"style"}],"=",["$","span",null,{"className":"hljs-string","children":"{{color:"}],"\"",["$","span",null,{"className":"hljs-attr","children":"red"}],"\"}}>"]}],"{errors.password?.message as string}",["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"p"}],">"]}],"\n        )}\n     {/* form event를 제출한다. */}\n        ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"input"}]," ",["$","span",null,{"className":"hljs-attr","children":"type"}],"=",["$","span",null,{"className":"hljs-string","children":"\"submit\""}]," />"]}],"\n      ",["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"form"}],">"]}],"\n      ",["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"Link"}]," ",["$","span",null,{"className":"hljs-attr","children":"to"}],"=",["$","span",null,{"className":"hljs-string","children":"\"/signup\""}],">"]}],"회원가입",["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"Link"}],">"]}],"\n    ",["$","span",null,{"className":"hljs-tag","children":"</>"}]]}]
10f:["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"input"}]," ",["$","span",null,{"className":"hljs-attr","children":"type"}],"=",["$","span",null,{"className":"hljs-string","children":"\"submit\""}]," />"]}]
110:["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"form"}],">"]}]
111:["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"form"}],">"]}]
112:["$","span",null,{"className":"hljs-tag","children":["<",["$","span",null,{"className":"hljs-name","children":"Link"}]," ",["$","span",null,{"className":"hljs-attr","children":"to"}],"=",["$","span",null,{"className":"hljs-string","children":"\"/signup\""}],">"]}]
113:["$","span",null,{"className":"hljs-tag","children":["</",["$","span",null,{"className":"hljs-name","children":"Link"}],">"]}]
114:["$","span",null,{"className":"hljs-tag","children":"</>"}]
115:["$","span",null,{"className":"hljs-comment","children":"// 설정 반환"}]
116:["$","span",null,{"className":"hljs-keyword","children":"return"}]
117:["$","span",null,{"className":"hljs-comment","children":"// 요청 에러 발생 시 실행"}]
118:["$","span",null,{"className":"hljs-keyword","children":"function"}]
119:["$","span",null,{"className":"hljs-params","children":"error"}]
11a:["$","span",null,{"className":"hljs-keyword","children":"return"}]
11b:["$","span",null,{"className":"hljs-title class_","children":"Promise"}]
11c:["$","span",null,{"className":"hljs-title function_","children":"reject"}]
11d:["$","span",null,{"className":"hljs-property","children":"interceptors"}]
11e:["$","span",null,{"className":"hljs-property","children":"response"}]
11f:["$","span",null,{"className":"hljs-title function_","children":"use"}]
120:["$","span",null,{"className":"hljs-comment","children":"// 응답 성공 시 실행"}]
121:["$","span",null,{"className":"hljs-keyword","children":"function"}]
122:["$","span",null,{"className":"hljs-params","children":"response"}]
123:["$","span",null,{"className":"hljs-keyword","children":"return"}]
124:["$","span",null,{"className":"hljs-comment","children":"// 응답 에러 발생 시 실행"}]
125:["$","span",null,{"className":"hljs-keyword","children":"async"}]
126:["$","span",null,{"className":"hljs-keyword","children":"function"}]
127:["$","span",null,{"className":"hljs-params","children":[["$","span",null,{"className":"hljs-attr","children":"error"}],": ",["$","span",null,{"className":"hljs-title class_","children":"AxiosError"}]]}]
128:["$","span",null,{"className":"hljs-comment","children":"// 에러 정보 가져오기"}]
129:["$","span",null,{"className":"hljs-keyword","children":"const"}]
12a:["$","span",null,{"className":"hljs-attr","children":"originalRequest"}]
12b:["$","span",null,{"className":"hljs-title class_","children":"CustomAxiosRequestConfig"}]
12c:["$","span",null,{"className":"hljs-literal","children":"undefined"}]
12d:["$","span",null,{"className":"hljs-property","children":"config"}]
12e:["$","span",null,{"className":"hljs-comment","children":"// 토큰 만료 시 재시도"}]
12f:["$","span",null,{"className":"hljs-keyword","children":"if"}]
130:["$","span",null,{"className":"hljs-property","children":"response"}]
131:["$","span",null,{"className":"hljs-property","children":"status"}]
132:["$","span",null,{"className":"hljs-number","children":"401"}]
133:["$","span",null,{"className":"hljs-property","children":"_retry"}]
134:["$","span",null,{"className":"hljs-property","children":"_retry"}]
135:["$","span",null,{"className":"hljs-literal","children":"true"}]
136:["$","span",null,{"className":"hljs-keyword","children":"try"}]
137:["$","span",null,{"className":"hljs-comment","children":"// 토큰 재발급"}]
138:["$","span",null,{"className":"hljs-keyword","children":"const"}]
139:["$","span",null,{"className":"hljs-keyword","children":"await"}]
13a:["$","span",null,{"className":"hljs-title function_","children":"postAuthRefreshToken"}]
13b:["$","span",null,{"className":"hljs-comment","children":"// 토큰 갱신"}]
13c:["$","span",null,{"className":"hljs-title function_","children":"setState"}]
13d:["$","span",null,{"className":"hljs-attr","children":"user"}]
13e:["$","span",null,{"className":"hljs-attr","children":"accessToken"}]
13f:["$","span",null,{"className":"hljs-property","children":"accessToken"}]
140:["$","span",null,{"className":"hljs-comment","children":"// 헤더에 토큰 추가"}]
141:["$","span",null,{"className":"hljs-property","children":"headers"}]
142:["$","span",null,{"className":"hljs-property","children":"Authorization"}]
143:["$","span",null,{"className":"hljs-string","children":["`Bearer ",["$","span",null,{"className":"hljs-subst","children":"$${response.accessToken}"}],"`"]}]
144:["$","span",null,{"className":"hljs-comment","children":"// 재시도"}]
145:["$","span",null,{"className":"hljs-keyword","children":"return"}]
146:["$","span",null,{"className":"hljs-title function_","children":"instance"}]
147:["$","span",null,{"className":"hljs-keyword","children":"catch"}]
148:["$","span",null,{"className":"hljs-comment","children":"// 토큰이 만료되었을 때"}]
149:["$","span",null,{"className":"hljs-keyword","children":"if"}]
14a:["$","span",null,{"className":"hljs-keyword","children":"instanceof"}]
14b:["$","span",null,{"className":"hljs-title class_","children":"AxiosError"}]
14c:["$","span",null,{"className":"hljs-property","children":"response"}]
14d:["$","span",null,{"className":"hljs-property","children":"status"}]
14e:["$","span",null,{"className":"hljs-number","children":"403"}]
14f:["$","span",null,{"className":"hljs-comment","children":"// 로그아웃"}]
150:["$","span",null,{"className":"hljs-title function_","children":"getState"}]
151:["$","span",null,{"className":"hljs-title function_","children":"logout"}]
152:["$","span",null,{"className":"hljs-keyword","children":"return"}]
153:["$","span",null,{"className":"hljs-keyword","children":"return"}]
154:["$","span",null,{"className":"hljs-title class_","children":"Promise"}]
155:["$","span",null,{"className":"hljs-title function_","children":"reject"}]
