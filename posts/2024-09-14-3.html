<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="https://codefug.github.io/_next/static/media/518331124efecf5c-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/images/logos/fetch.png"/><link rel="preload" as="image" href="/images/2024-09-14/Pasted%20image%2020240914193655.png"/><link rel="stylesheet" href="https://codefug.github.io/_next/static/css/b4bcb52feb7ee4f0.css" data-precedence="next"/><link rel="stylesheet" href="https://codefug.github.io/_next/static/css/7b1838e6bdc2260c.css" data-precedence="next"/><link rel="stylesheet" href="https://codefug.github.io/_next/static/css/fc37ac2b1a278e8c.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="https://codefug.github.io/_next/static/chunks/webpack-2ff3f3b37b43bc45.js"/><script src="https://codefug.github.io/_next/static/chunks/40bf5d38-c853b355f03f7884.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/20-7cfd66f21d76232c.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/main-app-f5ef7f4391a58bfb.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/893-1af1c230473151df.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/460-7903e3149ee4c004.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/252-c4d5671b15cb4929.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/200-6e59112152cdde6e.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/924-42d8c08601c8e333.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/layout-a240b55f7a9fc042.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/not-found-510f3dec4e3d85ef.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/posts/%5Bid%5D/layout-40b38b2a946b4cd6.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/posts/%5Bid%5D/page-a9de55f97c60b056.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/global-error-b850cc9c33842b8e.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtm.js?id=undefined" as="script"/><meta name="next-size-adjust" content=""/><title>Codefug Blog</title><meta name="description" content="project experiences and development notes"/><meta property="og:title" content="Codefug Blog"/><meta property="og:description" content="project experiences and development notes"/><meta property="og:url" content="https://codefug-blog.vercel.app"/><meta property="og:image" content="http://localhost:3000/images/main-logo.png"/><meta property="og:image:alt" content="Codefug Blog"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Codefug Blog"/><meta name="twitter:description" content="project experiences and development notes"/><meta name="twitter:image" content="http://localhost:3000/images/main-logo.png"/><meta name="twitter:image:alt" content="Codefug Blog"/><link rel="icon" href="/icon.ico?f00882ffa3186f37" type="image/x-icon" sizes="16x16"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="https://codefug.github.io/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_7ee20e antialiased"><script>((e,t,r,n,i,o,a,s)=>{let l=document.documentElement,u=["light","dark"];function c(t){var r;(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,n=r&&o?i.map(e=>o[e]||e):i;r?(l.classList.remove(...n),l.classList.add(o&&o[t]?o[t]:t)):l.setAttribute(e,t)}),r=t,s&&u.includes(r)&&(l.style.colorScheme=r)}if(n)c(n);else try{let e=localStorage.getItem(t)||r,n=a&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;c(n)}catch(e){}})("class","theme","system",null,["light","dark"],null,true,true)</script><div style="--sidebar-width:16rem;--sidebar-width-icon:3rem" class="group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar"><div class="group peer hidden text-sidebar-foreground md:block" data-state="collapsed" data-collapsible="offcanvas" data-variant="sidebar" data-side="left"><div class="relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear group-data-[collapsible=offcanvas]:w-0 group-data-[side=right]:rotate-180 group-data-[collapsible=icon]:w-[--sidebar-width-icon]"></div><div class="fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)] group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l"><div data-sidebar="sidebar" class="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"><div data-sidebar="content" class="flex min-h-0 flex-1 flex-col overflow-auto group-data-[collapsible=icon]:overflow-hidden group relative gap-0" style="scrollbar-width:none"><div class="absolute h-[150px] w-full bg-primary"></div><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><div data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 mb-2 mt-4 flex justify-center px-4 text-sm font-bold text-gray-400 group-hover:text-white">Codefug</div><div data-sidebar="group-content" class="w-full text-sm flex min-h-full flex-col items-center px-2"><span class="relative flex shrink-0 overflow-hidden rounded-full h-40 w-40"><span class="flex h-full w-full items-center justify-center rounded-full bg-muted group-hover:text-black group-hover:dark:text-white">이승현</span></span><h1 class="mt-4 text-center text-lg font-bold text-gray-400 group-hover:text-black dark:text-gray-500 group-hover:dark:text-white">이승현</h1><p class="text-sm text-gray-400 group-hover:text-black dark:text-gray-500 group-hover:dark:text-white">Web Frontend Developer</p></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«Rmplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">data-structure<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«Rmplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R16plb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">javascript<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R16plb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R1mplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">kkom-kkom<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R1mplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R26plb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">gheuppay<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R26plb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R2mplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">reactdeepdive<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R2mplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R36plb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">react<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R36plb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R3mplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">web<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R3mplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R46plb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">nextjs<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R46plb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R4mplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">typescript<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R4mplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R56plb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">fandomk<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R56plb»" hidden=""></div></div></div><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><div data-sidebar="group-content" class="w-full text-sm"><ul data-sidebar="menu" class="flex w-full min-w-0 flex-col gap-1"><li data-sidebar="menu-item" class="group/menu-item relative"><a class="text-gray-400 hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-none ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground h-8 text-sm" href="https://www.figma.com/proto/KSWARGDkXi9Wt8ARq2uGCa/leeseounghyun-resume?node-id=401-2&amp;node-type=canvas&amp;t=z2H9bL74afXrrgPS-1&amp;scaling=min-zoom&amp;content-scaling=fixed&amp;page-id=0%3A1" target="_blank" data-sidebar="menu-button" data-size="default" data-active="false">Portfolio</a></li><li data-sidebar="menu-item" class="group/menu-item relative"><a class="text-gray-400 hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-none ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground h-8 text-sm" data-sidebar="menu-button" data-size="default" data-active="false" href="/about">About</a></li><li data-sidebar="menu-item" class="group/menu-item relative"><a class="text-gray-400 hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-none ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground h-8 text-sm" data-sidebar="menu-button" data-size="default" data-active="false" href="/search">Search</a></li></ul></div></div></div><div data-sidebar="footer" class="flex flex-col gap-2 p-2"></div></div></div></div><main class="flex min-h-screen flex-col transition-[width] duration-200 ease-linear w-full"><header class="sticky left-0 right-0 top-0 z-30 transform bg-background transition-transform duration-300 translate-y-0"><div class="flex items-center justify-between gap-6 py-4"><section class="flex items-center gap-4"><div class="ml-2"><button class="flex h-7 w-7 items-center justify-center rounded-md hover:bg-accent hover:text-black hover:dark:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-panel-left-open"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"></path><path d="m14 9 3 3-3 3"></path></svg></button></div><a class="flex flex-shrink-0 items-center gap-2 hover:opacity-95 hover:drop-shadow-lg" href="/"><img alt="logo" loading="lazy" width="28" height="28" decoding="async" data-nimg="1" style="color:transparent" src="/images/main-logo.png"/><div class="hidden whitespace-nowrap text-lg font-bold text-black dark:text-white md:block">Codefug Blog</div></a></section><section class="flex items-center gap-4 text-sm font-semibold md:text-base"><nav class="flex items-center gap-4 text-sm font-semibold md:text-base"><a href="https://www.figma.com/proto/KSWARGDkXi9Wt8ARq2uGCa/leeseounghyun-resume?node-id=401-2&amp;node-type=canvas&amp;t=z2H9bL74afXrrgPS-1&amp;scaling=min-zoom&amp;content-scaling=fixed&amp;page-id=0%3A1" target="_blank" class="text-gray-400 hover:text-black hover:underline hover:drop-shadow-lg dark:hover:text-white">Portfolio</a><a class="text-gray-400 hover:text-black hover:underline hover:drop-shadow-lg dark:hover:text-white" href="/about">About</a><a class="text-gray-400 hover:text-black hover:underline hover:drop-shadow-lg dark:hover:text-white" href="/search"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search h-5 w-5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg></a></nav><button type="button" role="switch" aria-checked="false" data-state="unchecked" value="on" class="peer inline-flex h-7 w-16 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input"><span data-state="unchecked" class="pointer-events-none block h-6 w-6 rounded-full bg-theme-icon bg-center shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-[2.25rem] data-[state=unchecked]:translate-x-0 data-[state=checked]:bg-moon data-[state=unchecked]:bg-sun"></span></button><input type="checkbox" aria-hidden="true" style="transform:translateX(-100%);position:absolute;pointer-events:none;opacity:0;margin:0" tabindex="-1" value="on"/></section></div><div class="h-2 origin-left bg-primary" style="transform:scaleX(0)"></div></header><div class="mx-auto w-full max-w-[1400px] flex-1 px-4"><!--$--><div class="prose mx-auto overflow-auto dark:prose-invert"><section><header class="mb-8"><div class="relative mb-6 h-[300px] w-full overflow-hidden rounded-xl sm:h-[400px] md:h-[450px]"><img alt="(꼼꼼 프로젝트) 클라이언트와 서버 둘다 호환되는 fetch 구현" decoding="async" data-nimg="fill" class="object-cover object-center transition-transform duration-500 hover:scale-105" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="/images/logos/fetch.png"/><div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/70"></div><div class="absolute left-4 top-4 flex flex-wrap gap-2 sm:left-6 sm:top-6"><div class="inline-flex items-center rounded-md border px-2.5 py-0.5 transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-white/90 text-xs font-medium text-gray-800 hover:bg-white sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag mr-1 h-3 w-3"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z"></path><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"></circle></svg> <!-- -->kkom-kkom</div></div></div><div class="mb-6 space-y-4"><h1 class="mb-0 text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-50 sm:text-4xl md:text-5xl">(꼼꼼 프로젝트) 클라이언트와 서버 둘다 호환되는 fetch 구현</h1><div class="flex items-center justify-end gap-4 text-sm text-gray-600 dark:text-gray-400"><div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days mr-2 h-4 w-4"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path><path d="M8 14h.01"></path><path d="M12 14h.01"></path><path d="M16 14h.01"></path><path d="M8 18h.01"></path><path d="M12 18h.01"></path><path d="M16 18h.01"></path></svg><time dateTime="2024-09-14">2024-09-14</time></div></div><p class="text-lg leading-relaxed text-gray-600 dark:text-gray-300 md:text-xl">서버 액션을 활용한 refresh token rotation, 커링 함수를 이용한 리팩토링</p></div><div class="border-b border-gray-200 dark:border-gray-800"></div></header><section class="lg:flex lg:items-baseline"><section class="max-w-full"><h1 id="0" class="hltr-red">배경</h1>
<p>next.js에서는 서버 단의 fetch를 override해서 중복 통신 처리 같은 유익한 기능을 추가했다.</p>
<p>평소에는 서버 컴포넌트와 클라이언트 컴포넌트에서 그냥 fetch를 쓰면 해당 기능이 첨가된 통신을 사용할 수 있다.</p>
<p>여기서 문제는 access token과 refresh token이 들어갈 때이다.</p>
<p>서버 컴포넌트에서는 next/headers의 쿠키를 사용하여 쿠키에 접근하고 클라이언트 컴포넌트에서는 브라우저 쿠키로 쿠키에 접근한다.</p>
<p>서로 다른 방식은 refresh token rotation을 위한 함수를 구현할 때 문제가 된다.</p>
<h1 id="1" class="hltr-red">구현</h1>
<p>아래의 코드는 나에게 업무가 넘어오기 전 다른 팀원이 짠 코드다. middleware 활용하여 구현된 방식이었다.</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/server&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextFetchEvent</span>, <span class="hljs-title class_">NextRequest</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/server&quot;</span>;

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PostTeamIdAuthRefreshTokenResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./lib/apis/type&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params"><span class="hljs-attr">request</span>: <span class="hljs-title class_">NextRequest</span>, <span class="hljs-attr">event</span>: <span class="hljs-title class_">NextFetchEvent</span></span>) {
  <span class="hljs-keyword">const</span> hasAccessToken = request.<span class="hljs-property">cookies</span>.<span class="hljs-title function_">has</span>(<span class="hljs-string">&quot;accessToken&quot;</span>);
  <span class="hljs-keyword">const</span> hasRefreshToken = request.<span class="hljs-property">cookies</span>.<span class="hljs-title function_">has</span>(<span class="hljs-string">&quot;refreshToken&quot;</span>);
  <span class="hljs-keyword">const</span> { pathname } = request.<span class="hljs-property">nextUrl</span>;

  <span class="hljs-comment">// NOTE - 로그인 후 로그인, 회원가입 페이지에 접근하는 경우</span>
  <span class="hljs-keyword">if</span> (
    hasAccessToken &amp;&amp;
    (pathname.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;/login&quot;</span>) || pathname.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;/signup&quot;</span>))
  ) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&quot;/&quot;</span>, request.<span class="hljs-property">url</span>));
  }

  <span class="hljs-comment">// NOTE - 로그인 전에 랜딩, 로그인, 회원가입 페이지 외에 다른 페이지에 접근하는 경우</span>
  <span class="hljs-keyword">if</span> (
    !hasAccessToken &amp;&amp;
    !(
      pathname.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;/login&quot;</span>) ||
      pathname.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;/signup&quot;</span>) ||
      pathname === <span class="hljs-string">&quot;/&quot;</span>
    )
  ) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&quot;/login&quot;</span>, request.<span class="hljs-property">url</span>));
  }

  <span class="hljs-comment">// NOTE - accessToken이 만료되어서 refreshToken을 통해 새로운 토큰을 발급해야 하는 경우</span>
  <span class="hljs-keyword">if</span> (!hasAccessToken &amp;&amp; hasRefreshToken) {
    <span class="hljs-keyword">const</span> refreshTokenValue = request.<span class="hljs-property">cookies</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;refreshToken&quot;</span>)?.<span class="hljs-property">value</span>;

    <span class="hljs-comment">// NOTE - Fetch를 사용하여 새로운 accessToken을 발급받는 비동기 작업</span>
    <span class="hljs-keyword">const</span> fetchPromise = <span class="hljs-title function_">fetch</span>(
      <span class="hljs-string">`<span class="hljs-subst">${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}</span>/auth/refresh-token`</span>,
      {
        <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,
        <span class="hljs-attr">headers</span>: {
          <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,
        },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
          <span class="hljs-attr">refreshToken</span>: refreshTokenValue,
        }),
      },
    )
      .<span class="hljs-title function_">then</span>(<span class="hljs-title function_">async</span> (response) =&gt; {
        <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;refresh token 요청 실패&quot;</span>);
        }
        <span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">PostTeamIdAuthRefreshTokenResponse</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

        <span class="hljs-comment">// NextResponse 객체를 만들어 쿠키를 설정</span>
        <span class="hljs-keyword">const</span> nextResponse = <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
        nextResponse.<span class="hljs-property">cookies</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;accessToken&quot;</span>, data.<span class="hljs-property">accessToken</span>);

        <span class="hljs-keyword">return</span> nextResponse;
      })
      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&quot;/login&quot;</span>, request.<span class="hljs-property">url</span>));
      });

    <span class="hljs-comment">// waitUntil을 사용하여 비동기 작업이 완료될 때까지 기다림</span>
    event.<span class="hljs-title function_">waitUntil</span>(fetchPromise);

    <span class="hljs-comment">// 비동기 작업이 완료된 후 요청을 계속 진행하도록 합니다.</span>
    <span class="hljs-comment">// 이때 fetchPromise에서 반환한 NextResponse 객체 사용</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      fetchPromise.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">nextResponse</span>) =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(nextResponse);
      });
    });
  }

  <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
  <span class="hljs-attr">matcher</span>: <span class="hljs-string">&quot;/((?!api|_next/static|_next/image|favicon.ico).*)&quot;</span>,
};
</code></pre>
<p>라우트가 변경될 때 <code>waitUntil</code>이라는 메소드로 원하는 통신 이전에 토큰을 처리해주는 로직이었다.</p>
<p>하지만 다음의 상황에서 예외가 발생했다.</p>
<ol>
<li>서버 액션을 사용하지 않으면 프론트엔드 서버를 거치지 않고 요청을 하기 때문에 미들웨어를 거치지 않게 됨</li>
<li>refreshToken은 있으나 다시 로그인 하라고 분기 처리 (에러)</li>
</ol>
<p>고민해본 결과 axios의 interceptor처럼 fetch 요청 자체에 refreshToken을 처리해야 한다는 결론에 이르렀다.</p>
<h2 id="2" class="hltr-orange">서버 액션을 이용한 import</h2>
<p>next/headers는 클라이언트 단에 있을 수 없고 서버 컴포넌트, 서버 액션에서 호출할 수 있었다. (클라이언트 단에서 호출하면 에러 처리)</p>
<p>그건 조건부로 실제로 실행되는 것이 아니여도 import로 연결되어 있다면 전부 해당되었다.</p>
<p>이때 든 생각은 &quot;서버 액션과 일단 클라이언트 fetch를 연결하고 분기 처리하면 되지 않나?&quot; 였다.</p>
<p>그러곤 다음의 코드를 작성했다.</p>
<h3 id="3" class="hltr-yellow">myFetch</h3>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { clientFetch } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./clientFetch&quot;</span>;
<span class="hljs-keyword">import</span> serverFetch <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./serverFetch&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyFetchOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./types&quot;</span>;

<span class="hljs-comment">/**
 * myFetch는 서버와 클라이언트에서 사용할 수 있는 fetch 함수입니다.
 * 서버에서 사용할 때는 serverFetch를 사용하고, 클라이언트에서 사용할 때는 clientFetch를 사용합니다.
 * 사용하실 때는 fetch처럼 사용하시면 됩니다.
 * withCredentials 옵션을 사용하면 쿠키를 전송할 수 있습니다.
 * accessToken이 필요한 fetch에서 사용하시면 됩니다.
 * 내부적으로 accessToken이 만료되었을 때, refreshToken을 사용하여 새로운 accessToken을 발급받습니다.
 *
 * <span class="hljs-doctag">@author</span> 이승현
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">input</span>
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">init</span>
 * <span class="hljs-doctag">@returns</span> Promise&lt;T&gt;
 **/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> myFetch&lt;T&gt;(
  <span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span> | <span class="hljs-variable constant_">URL</span> | globalThis.<span class="hljs-property">Request</span>,
  <span class="hljs-attr">init</span>?: <span class="hljs-title class_">MyFetchOptions</span>,
): <span class="hljs-title class_">Promise</span>&lt;T&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">&quot;undefined&quot;</span>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">clientFetch</span>(input, init);
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    <span class="hljs-keyword">return</span> data;
  }
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">serverFetch</span>(input, init);
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
  <span class="hljs-keyword">return</span> data;
}
</code></pre>
<p>토큰 처리 기능이 붙혀진 fetch, myFetch 이다.</p>
<h3 id="4" class="hltr-yellow">clientFetch</h3>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { getCookie, setCookie } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;cookies-next&quot;</span>;

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PostAuthRefreshTokenResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../type&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">MyFetchOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./types&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">clientFetch</span>(<span class="hljs-params">
  <span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span> | URL | globalThis.<span class="hljs-title class_">Request</span>,
  <span class="hljs-attr">init</span>?: <span class="hljs-title class_">MyFetchOptions</span>,
</span>) {
  <span class="hljs-comment">// accessToken를 읽는다.</span>
  <span class="hljs-keyword">const</span> accessToken = <span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&quot;accessToken&quot;</span>);

  <span class="hljs-keyword">let</span> newInit = init;

  <span class="hljs-comment">// withCredentials는 토큰 인증 처리를 하겠다는 flag이다.</span>
  <span class="hljs-keyword">if</span> (newInit?.<span class="hljs-property">withCredentials</span> === <span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">const</span> headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>(init?.<span class="hljs-property">headers</span>);
    headers.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">`Bearer <span class="hljs-subst">${accessToken}</span>`</span>);
    newInit = { ...init, headers };
  }

  <span class="hljs-comment">// 토큰 처리를 한다.</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(input, newInit);

  <span class="hljs-comment">// 만약 토큰이 만료되었다면</span>
  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">status</span> === <span class="hljs-number">401</span>) {
    <span class="hljs-comment">// refresh token rotation 처리</span>
    <span class="hljs-keyword">const</span> refreshTokenValue = <span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&quot;refreshToken&quot;</span>);
    <span class="hljs-keyword">if</span> (refreshTokenValue) {
      <span class="hljs-keyword">const</span> newAccessToken = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(
        <span class="hljs-string">`<span class="hljs-subst">${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}</span>/auth/refresh-token`</span>,
        {
          <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,
          <span class="hljs-attr">headers</span>: {
            <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,
          },
          <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
            <span class="hljs-attr">refreshToken</span>: refreshTokenValue,
          }),
        },
      );
      <span class="hljs-keyword">if</span> (newAccessToken.<span class="hljs-property">ok</span>) {
        <span class="hljs-keyword">const</span> <span class="hljs-attr">newAccessTokenValue</span>: <span class="hljs-title class_">PostAuthRefreshTokenResponse</span> =
          <span class="hljs-keyword">await</span> newAccessToken.<span class="hljs-title function_">json</span>();
        <span class="hljs-title function_">setCookie</span>(<span class="hljs-string">&quot;accessToken&quot;</span>, newAccessTokenValue.<span class="hljs-property">accessToken</span>);
        <span class="hljs-keyword">const</span> headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>(init?.<span class="hljs-property">headers</span>);
        headers.<span class="hljs-title function_">set</span>(
          <span class="hljs-string">&quot;Authorization&quot;</span>,
          <span class="hljs-string">`Bearer <span class="hljs-subst">${newAccessTokenValue.accessToken}</span>`</span>,
        );
        <span class="hljs-keyword">const</span> newInitAfterFetch = { ...init, headers };
        <span class="hljs-keyword">const</span> newRes = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(input, newInitAfterFetch);
        <span class="hljs-keyword">return</span> newRes;
      }
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseError</span>(<span class="hljs-string">&quot;엑세스 토큰 호출 실패&quot;</span>, newAccessToken);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseError</span>(<span class="hljs-string">&quot;로그인을 다시 해주세요!&quot;</span>, res);
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!res.<span class="hljs-property">ok</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseError</span>(<span class="hljs-string">&quot;에러가 발생했습니다.&quot;</span>, res);
  }
  <span class="hljs-keyword">return</span> res;
}
</code></pre>
<p>클라이언트 (<code>window !== undefined</code>) 상태일 때 실행될 함수이다. refresh token rotation이 필요한 경우에 받고 fetch를 다시 하도록 하는 로직을 갖고 있다.</p>
<h3 id="5" class="hltr-yellow">serverFetch</h3>
<pre><code class="hljs language-tsx"><span class="hljs-string">&quot;use server&quot;</span>;

<span class="hljs-keyword">import</span> { cookies } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/headers&quot;</span>;

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyFetchOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;.&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PostTeamIdAuthRefreshTokenResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../type&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">serverFetch</span>(<span class="hljs-params">
  <span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span> | URL | globalThis.<span class="hljs-title class_">Request</span>,
  <span class="hljs-attr">init</span>?: <span class="hljs-title class_">MyFetchOptions</span>,
</span>) {
  <span class="hljs-keyword">const</span> cookieStore = <span class="hljs-title function_">cookies</span>();
  <span class="hljs-keyword">const</span> accessToken = cookieStore.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;accessToken&quot;</span>)?.<span class="hljs-property">value</span>;

  <span class="hljs-keyword">if</span> (init?.<span class="hljs-property">withCredentials</span> === <span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">const</span> headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>(init?.<span class="hljs-property">headers</span>);
    headers.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">`Bearer <span class="hljs-subst">${accessToken}</span>`</span>);
    init = { ...init, headers };
  }

  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(input, init);

  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">status</span> === <span class="hljs-number">401</span>) {
    <span class="hljs-keyword">const</span> refreshTokenValue = cookieStore.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;refreshToken&quot;</span>)?.<span class="hljs-property">value</span>;
    <span class="hljs-keyword">if</span> (refreshTokenValue) {
      <span class="hljs-keyword">const</span> newAccessToken = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(
        <span class="hljs-string">`<span class="hljs-subst">${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}</span>/auth/refresh-token`</span>,
        {
          <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,
          <span class="hljs-attr">headers</span>: {
            <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,
          },
          <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
            <span class="hljs-attr">refreshToken</span>: refreshTokenValue,
          }),
        },
      );
      <span class="hljs-keyword">if</span> (newAccessToken.<span class="hljs-property">ok</span>) {
        <span class="hljs-keyword">const</span> <span class="hljs-attr">newAccessTokenValue</span>: <span class="hljs-title class_">PostTeamIdAuthRefreshTokenResponse</span> =
          <span class="hljs-keyword">await</span> newAccessToken.<span class="hljs-title function_">json</span>();
        <span class="hljs-keyword">const</span> headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>(init?.<span class="hljs-property">headers</span>);
        headers.<span class="hljs-title function_">set</span>(
          <span class="hljs-string">&quot;Authorization&quot;</span>,
          <span class="hljs-string">`Bearer <span class="hljs-subst">${newAccessTokenValue.accessToken}</span>`</span>,
        );
        <span class="hljs-keyword">const</span> newInit = { ...init, headers };
        <span class="hljs-keyword">const</span> newRes = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(input, newInit);
        <span class="hljs-keyword">return</span> newRes;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;엑세스 토큰 호출 실패&quot;</span>);
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;로그인을 다시 해주세요!&quot;</span>);
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!res.<span class="hljs-property">ok</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-title function_">responseError</span>(res);
  }
  <span class="hljs-keyword">return</span> res;
}
</code></pre>
<p>서버 상태(<code>window===undefined</code>)일 때 실행될 함수이다. refresh token rotation을 next/headers의 cookie를 이용해서 실행한다.</p>
<p>다음의 로직이 실행되어 에러가 일어나지 않는 것이다.</p>
<ol>
<li>서버 액션을 클라이언트단에서 import하기 때문에 런타임 에러가 무시된다.</li>
<li>next/header를 에러처리 안하고 넘어간다.</li>
<li><code>window===undefined</code> 로 분기처리했기 때문에 클라이언트에서 서버 함수를 사용하는 경우의 수는 차단된다.</li>
<li>서버, 클라이언트 모두 사용 가능해짐</li>
</ol>
<h2 id="6" class="hltr-orange">axios의 base url 기능 구현</h2>
<p>코드 리뷰를 하던 중에 URL을 상수로 받아서 myFetch에 내려받는 코드를 발견하였다.</p>
<p><img src="/images/2024-09-14/Pasted%20image%2020240914193655.png" alt=""/></p>
<p>axios에서는 base url을 저장해놓고 사용하는 쪽에서는 해당 url 뒤에 있는 라우트만 적어서 사용하는 기능이 있다.</p>
<h3 id="7" class="hltr-yellow">커링 함수</h3>
<p>함수형 프로그래밍에서는 이걸 어떻게 구현할까 고민을 하다가 이전에 학습했던 커링 함수가 생각났다.</p>
<blockquote>
<p>커링 함수: 여러 개의 인자를 받는 함수를 하나의 인자만 받는 함수로 나눠서 순차적으로 호출될 수 있게 체인 형태로 구성한 것
한번에 하나의 인자만 전달하는 것을 원칙으로 한다. 각 단계에서 받은 인자들을 모두 마지막 단계에서 참조하기 때문에 메모리에 차곡차곡 쌓였다가 마지막 단계에서 호출해서 실행 컨텍스트가 끝나면 한번에 GC의 수거 대상이 된다.</p>
</blockquote>
<p>이를 이용해서 구현을 시작했다.</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// instance를 위한 커링 함수</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">newFetch</span> =
  (<span class="hljs-params"><span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span></span>) =&gt;
  &lt;T&gt;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span> | URL | globalThis.<span class="hljs-title class_">Request</span>, <span class="hljs-attr">init</span>?: <span class="hljs-title class_">MyFetchOptions</span></span>) =&gt;</span>
    myFetch&lt;T&gt;(url + input, init);

<span class="hljs-comment">// instance.tsx</span>
<span class="hljs-keyword">const</span> instance = <span class="hljs-title function_">newFetch</span>(<span class="hljs-string">`{url}`</span>);
</code></pre>
<p>위의 함수로 타입까지 다 처리된 base_url 첨가 myFetch를 사용할 수 있게 되었다.</p>
<p>사용하는 쪽에서는 이제 엄청 간단해졌다.</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// 호출부</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserHistory</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> instance&lt;<span class="hljs-title class_">GetTeamIdUserHistoryResponse</span>&gt;(
      <span class="hljs-string">&quot;/user/history&quot;</span>,
      {
        <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;GET&quot;</span>,
        <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>,
      },
    );
    <span class="hljs-keyword">return</span> response;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">throw</span> error;
  }
}
</code></pre>
<p>세부 로직은 속으로 숨겨져 있는 상태에서 instance와 withCredentials만 사용해서 token이 처리되었다!!!</p>
<p>제일 좋은 점은 api만 변경되었기 때문에 다른 코드를 변경할 필요 없이 myFetch를 instance로 변경만 하면 된다는 것이다.</p>
<pre><code class="hljs language-ts"><span class="hljs-comment">// getUserHistory를 사용하는 쪽</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GetTeamIdUserHistoryResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/lib/apis/type&quot;</span>;
<span class="hljs-keyword">import</span> { getUserHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/lib/apis/user&quot;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-title class_">DateBoxCard</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./date-box-card&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">DateBoxList</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserHistory</span>(); <span class="hljs-comment">// 변화가 없이 사용할 수 있다.</span>
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">tasksDone</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">const</span> <span class="hljs-attr">history</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">GetTeamIdUserHistoryResponse</span>[<span class="hljs-string">&quot;tasksDone&quot;</span>]&gt; =
    data.<span class="hljs-property">tasksDone</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> {
      acc.<span class="hljs-title function_">set</span>(cur.<span class="hljs-property">date</span>, [...(acc.<span class="hljs-title function_">get</span>(cur.<span class="hljs-property">date</span>) || []), cur]);
      <span class="hljs-keyword">return</span> acc;
    }, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>());

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;mt-[27px] flex flex-col gap-10 md:mt-6&quot;</span>&gt;</span>
      {[...history.entries()].map(([date, history]) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">DateBoxCard</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{date}</span> <span class="hljs-attr">date</span>=<span class="hljs-string">{date}</span> <span class="hljs-attr">tasksDone</span>=<span class="hljs-string">{history}</span> /&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span>
  );
}
</code></pre>
<h1 id="8" class="hltr-red">후기</h1>
<p>서버 액션을 사용해서 토큰 처리를 해보는 경험을 했다.</p>
<p>서버 액션으로 만들었을 때의 쾌감도 굉장했지만 base url을 구현할 때가 진짜 많이 성장했구나 생각했던 때였다.</p>
<p>몇개월 전에 코어 자바스크립트에서 봤던 내용인데 이제야 제대로 활용되어 이해된 느낌이 들었다.</p>
<p>지식은 차곡차곡 쌓이는 구나 생각하면서 짜릿했던 경험이다.</p>
<p>더 성장해보자.</p>
<blockquote>
<p>++ 2024-11-29</p>
<p>이후에 클라이언트에서 쿠키를 읽는 방식을 쓰면 해당 쿠키에 httpOnly를 적용할 수가 없는 것을 알게 되고 이는 보안 문제가 발생한다는 것을 알게 되면서 기존 클라이언트 단의 쿠키를 전부 서버 쿠키로 교체하게 되었다.</p>
<p>기존에 서버 액션과 클라이언트 단의 코드 분리를 통해서 쿠키를 읽는 로직은 사실상 크게 필요 없어진 것이다.</p>
<p>토큰을 저장하는 전략은 다양하고 그것을 공격하는 방법은 다양하기 때문에 프론트엔드 개발자로써 일하면서 항상 고민해야 하는 부분인 것 같다.</p>
</blockquote>
<blockquote>
<p>꼼꼼 프로젝트 진행 중에 겪은 경험들입니다. 오늘도 많이 성장한 것 같아요!</p>
<p>읽어주셔서 감사합니다! 지켜봐주세요!</p>
<p>감사합니다.</p>
</blockquote></section></section></section><!--$--><!--/$--><!--$--><!--/$--><section></section></div><!--/$--></div><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-arrow-up fixed bottom-5 right-5 h-8 w-8 opacity-50 hover:cursor-pointer hover:opacity-100"><circle cx="12" cy="12" r="10"></circle><path d="m16 12-4-4-4 4"></path><path d="M12 16V8"></path></svg><footer class="mt-6 border-t bg-background py-6"><div class="container mx-auto px-4"><div class="flex flex-col items-center justify-center gap-4"><div class="flex items-center justify-center gap-4"><div class="flex space-x-4"><a target="_blank" rel="noopener noreferrer" class="text-muted-foreground transition-colors hover:text-foreground" href="mailto:robot9917@gmail.com"><img alt="Email" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="transition-transform hover:scale-110" style="color:transparent" src="/icons/email.svg"/><span class="sr-only">GitHub</span></a></div><div class="flex space-x-4"><a target="_blank" rel="noopener noreferrer" class="text-muted-foreground transition-colors hover:text-foreground" href="https://github.com/codefug"><img alt="GitHub" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="transition-transform hover:scale-110" style="color:transparent" src="/icons/github.svg"/><span class="sr-only">GitHub</span></a></div></div><p class="text-sm text-muted-foreground">© <!-- -->2025<!-- --> CodeFug Blog</p></div></div></footer></main></div><script src="https://codefug.github.io/_next/static/chunks/webpack-2ff3f3b37b43bc45.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[1152,[\"893\",\"static/chunks/893-1af1c230473151df.js\",\"460\",\"static/chunks/460-7903e3149ee4c004.js\",\"252\",\"static/chunks/252-c4d5671b15cb4929.js\",\"200\",\"static/chunks/200-6e59112152cdde6e.js\",\"924\",\"static/chunks/924-42d8c08601c8e333.js\",\"177\",\"static/chunks/app/layout-a240b55f7a9fc042.js\"],\"GoogleTagManager\"]\n3:I[4953,[\"893\",\"static/chunks/893-1af1c230473151df.js\",\"460\",\"static/chunks/460-7903e3149ee4c004.js\",\"252\",\"static/chunks/252-c4d5671b15cb4929.js\",\"200\",\"static/chunks/200-6e59112152cdde6e.js\",\"924\",\"static/chunks/924-42d8c08601c8e333.js\",\"177\",\"static/chunks/app/layout-a240b55f7a9fc042.js\"],\"default\"]\n4:I[3777,[\"893\",\"static/chunks/893-1af1c230473151df.js\",\"460\",\"static/chunks/460-7903e3149ee4c004.js\",\"252\",\"static/chunks/252-c4d5671b15cb4929.js\",\"200\",\"static/chunks/200-6e59112152cdde6e.js\",\"924\",\"static/chunks/924-42d8c08601c8e333.js\",\"177\",\"static/chunks/app/layout-a240b55f7a9fc042.js\"],\"SidebarProvider\"]\n5:I[3577,[\"893\",\"static/chunks/893-1af1c230473151df.js\",\"460\",\"static/chunks/460-7903e3149ee4c004.js\",\"252\",\"static/chunks/252-c4d5671b15cb4929.js\",\"200\",\"static/chunks/200-6e59112152cdde6e.js\",\"924\",\"static/chunks/924-42d8c08601c8e333.js\",\"177\",\"static/chunks/app/layout-a240b55f7a9fc042.js\"],\"default\"]\n6:I[5440,[\"893\",\"static/chunks/893-1af1c230473151df.js\",\"460\",\"static/chunks/460-7903e3149ee4c004.js\",\"252\",\"static/chunks/252-c4d5671b15cb4929.js\",\"200\",\"static/chunks/200-6e59112152cdde6e.js\",\"924\",\"static/chunks/924-42d8c08601c8e333.js\",\"177\",\"static/chunks/app/layout-a240b55f7a9fc042.js\"],\"default\"]\n7:I[2329,[],\"\"]\n8:I[3725,[],\"\"]\n9:I[6252,[\"252\",\"static/chunks/252-c4d5671b15cb4929.js\",\"345\",\"static/chunks/app/not-found-510f3dec4e3d85ef.js\"],\"\"]\na:I[9816,[\"507\",\"static/chunks/app/posts/%5Bid%5D/layout-40b38b2a946b4cd6.js\"],\"default\"]\nc:I[2207,[],\"MetadataBoundary\"]\ne:I[2207,[],\"OutletBoundary\"]\n11:I[2533,[],\"AsyncMetadataOutlet\"]\n13:I[4893,[\"893\",\"static/chunks/893-1af1c230473151df.js\",\"460\",\"static/chunks/460-7903e3149ee4c004.js\",\"252\",\"static/chunks/252-c4d5671b15cb4929.js\""])</script><script>self.__next_f.push([1,",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-a9de55f97c60b056.js\"],\"Image\"]\n14:I[2207,[],\"ViewportBoundary\"]\n16:I[923,[\"219\",\"static/chunks/app/global-error-b850cc9c33842b8e.js\"],\"default\"]\n:HL[\"https://codefug.github.io/_next/static/media/518331124efecf5c-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"https://codefug.github.io/_next/static/css/b4bcb52feb7ee4f0.css\",\"style\"]\n:HL[\"https://codefug.github.io/_next/static/css/7b1838e6bdc2260c.css\",\"style\"]\n:HL[\"https://codefug.github.io/_next/static/css/fc37ac2b1a278e8c.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"Vlh1-2wLqIeysKwlZBUba\",\"p\":\"https://codefug.github.io\",\"c\":[\"\",\"posts\",\"2024-09-14-3\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2024-09-14-3\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://codefug.github.io/_next/static/css/b4bcb52feb7ee4f0.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"https://codefug.github.io/_next/static/css/7b1838e6bdc2260c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"$L2\",null,{\"gtmId\":\"$undefined\"}],[\"$\",\"body\",null,{\"className\":\"__className_7ee20e antialiased\",\"children\":[\"$\",\"$L3\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$L4\",null,{\"defaultOpen\":false,\"children\":[[\"$\",\"$L5\",null,{\"totalFrontMatterList\":[{\"id\":\"2025-05-24\",\"title\":\"배열\",\"excerpt\":\"JS의 배열에 대해서 알아보자.\",\"date\":\"2025-05-24\",\"categories\":[\"data-structure\",\"javascript\"],\"header\":{\"teaser\":\"/images/logos/JS.svg\"}},{\"id\":\"2024-11-10\",\"title\":\"Asynchronous JavaScript\",\"excerpt\":\"microtask queue, macrotask queue, call stack, web api와 관련된 비동기 동작 방식, 비동기 관련 역사와 비동기 코드의 다양한 활용법들을 알아보자.\",\"date\":\"2024-11-10\",\"categories\":[\"javascript\"],\"header\":{\"teaser\":\"/images/logos/JS.svg\"}},{\"id\":\"2024-09-14-4\",\"title\":\"(꼼꼼 프로젝트) streaming 방식의 tanstack query\",\"excerpt\":\"infinite scroll, optimistic update 그리고 streaming 방식이 결합된 쿼리 처리 ( useSuspenseQuery, useSuspenseInfiniteQuery )\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/tanstackQuery.png\"}},{\"id\":\"2024-09-14-3\",\"title\":\"(꼼꼼 프로젝트) 클라이언트와 서버 둘다 호환되는 fetch 구현\",\"excerpt\":\"서버 액션을 활용한 refresh token rotation, 커링 함수를 이용한 리팩토링\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/fetch.png\"}},{\"id\":\"2024-09-14-2\",\"title\":\"(꼼꼼 프로젝트) startTransition, progress bar 구현에 대한 고민\",\"excerpt\":\"progress bar 로직 연구하기(startTransition), next-nprogress-bar\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/nprogress.png\"}},{\"id\":\"2024-09-14-1\",\"title\":\"(꼼꼼 프로젝트) toss slash 분석, zustand와 연결된 커스텀 overlay 훅 구현\",\"excerpt\":\"stacking context, compound pattern, 전역 상태를 활용한다는 것의 의미, 토스 개발자 실력 흡수하기\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/toss.png\"}},{\"id\":\"2024-09-11\",\"title\":\"(꼼꼼 프로젝트) 공통 버튼 컴포넌트의 종류를 쉽게 관리하고 누구나 쉽게 확인할 수 있게 하는 방법\",\"excerpt\":\"tailwind로 조건부 처리를 간편하게 하는 방법, 비개발자도 스타일을 쉽게 확인할 수 있도록 storybook 연동\",\"date\":\"2024-09-11\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/storybook.png\"}},{\"id\":\"2024-07-22-2\",\"title\":\"(급페이 프로젝트) 개발환경에만 집중하기 위한 여정\",\"excerpt\":\"접근 제한을 위한 미들웨어 처리, vercel CLI을 이용한 organization 무료 자동 배포, 프리뷰\",\"date\":\"2024-07-22\",\"categories\":[\"gheuppay\"],\"header\":{\"teaser\":\"/images/logos/vercel.png\"}},{\"id\":\"2024-07-22-1\",\"title\":\"(급페이 프로젝트) 알림창 무한 스크롤을 위한 여정 (mock fetching을 위한 MSW 도입기)\",\"excerpt\":\"msw를 활용해서 프론트엔드 개발이 다 되어있지 않은 상태에서도 무한 스크롤 구현을 확인할 수 있게 되었습니다.\",\"date\":\"2024-07-22\",\"categories\":[\"gheuppay\"],\"header\":{\"teaser\":\"/images/logos/msw.png\"}},{\"id\":\"2024-07-21\",\"title\":\"(급페이 프로젝트) 카드 렌더링을 최적화하여 UX를 향상시키기 위한 머나먼 여정\",\"excerpt\":\"server component 설계를 이용한 suspense 적극 활용, 이를 위해서 next cookie를 사용하면서 겪은 문제들을 적은 글입니다.\",\"date\":\"2024-07-21\",\"categories\":[\"gheuppay\"],\"header\":{\"teaser\":\"/images/logos/next-cookie.png\"}},{\"id\":\"2024-06-18\",\"title\":\"React Testing\",\"excerpt\":\"React Testing Library, Vitest, Jest\",\"date\":\"2024-06-18\",\"categories\":[\"reactdeepdive\"],\"header\":{\"teaser\":\"/images/logos/reactdeepdive.jpg\"}},{\"id\":\"2024-06-17\",\"title\":\"로그인 구현 (zustand, zod + react-hook-form, RTR)\",\"excerpt\":\"zustand를 이용한 로그인 상태 전역 관리, zod를 이용한 간단한 스키마 전개, react-hook-form을 이용한 간단한 validation, axios를 이용한 간단한 api 요청 처리\",\"date\":\"2024-06-17\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/zod.png\"}},{\"id\":\"2024-06-15\",\"title\":\"Dev tool\",\"excerpt\":\"리액트 과거, 현재, 미래\",\"date\":\"2024-06-15\",\"categories\":[\"web\"],\"header\":{\"teaser\":\"/images/logos/reactdeepdive.jpg\"}},{\"id\":\"2024-06-14\",\"title\":\"마이그레이션 중 발생한 Vite 환경 변수 처리\",\"excerpt\":\"Vite_ENV\",\"date\":\"2024-06-14\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/react.png\"}},{\"id\":\"2024-06-10\",\"title\":\"React Debugging\",\"excerpt\":\"react-dev-tools 정리, 실습\",\"date\":\"2024-06-10\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/react.png\"}},{\"id\":\"2024-06-08\",\"title\":\"자잘한 Next.js 트러블 슈팅들\",\"excerpt\":\"react-responsive를 사용하지 못하는 상황, dotenv 사용시 문제 발생\",\"date\":\"2024-06-08\",\"categories\":[\"nextjs\"],\"header\":{\"teaser\":\"/images/logos/Nextjs.png\"}},{\"id\":\"2024-05-31\",\"title\":\"Next는 왜 쓸까\",\"excerpt\":\"CSR SSG SSR\",\"date\":\"2024-05-31\",\"categories\":[\"nextjs\"],\"header\":{\"teaser\":\"/images/logos/Nextjs.png\"}},{\"id\":\"2024-05-23\",\"title\":\"리액트는 왜 쓸까\",\"excerpt\":\"리액트 과거, 현재, 미래\",\"date\":\"2024-05-23\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/reactdeepdive.jpg\"}},{\"id\":\"2024-05-22\",\"title\":\"TS는 왜 쓸까 (위대한 TS)\",\"excerpt\":\"JS를 완벽하게 하기 위한 여정\",\"date\":\"2024-05-22\",\"categories\":[\"typescript\"],\"header\":{\"teaser\":\"/images/logos/TS.png\"}},{\"id\":\"2024-05-20\",\"title\":\"Fandom-k 프로젝트 회고3\",\"excerpt\":\"Github Actions, 최종 결과\",\"date\":\"2024-05-20\",\"categories\":[\"fandomk\"],\"header\":{\"teaser\":\"/images/logos/githubActions.png\"}},{\"id\":\"2024-05-19\",\"title\":\"Fandom-k 프로젝트 회고2\",\"excerpt\":\"fetch, scroll to Top, infinite scroll 라이브러리 제거\",\"date\":\"2024-05-19\",\"categories\":[\"fandomk\"],\"header\":{\"teaser\":\"/images/logos/fetch.png\"}},{\"id\":\"2024-05-18\",\"title\":\"Fandom-k 프로젝트 회고1\",\"excerpt\":\"팀 프로젝트 세팅, infinite scroll, skeleton\",\"date\":\"2024-05-18\",\"categories\":[\"fandomk\"],\"header\":{\"teaser\":\"/images/logos/infinite-scroll.png\"}}]}],[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h2\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":\"잘못된 페이지에요!\"}],[\"$\",\"$L9\",null,{\"href\":\"/\",\"children\":\"홈으로 돌아가기\"}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]}]}]]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"2024-09-14-3\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://codefug.github.io/_next/static/css/fc37ac2b1a278e8c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"div\",null,{\"className\":\"prose mx-auto overflow-auto dark:prose-invert\",\"children\":[[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"$La\",null,{}]]}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$Lb\",[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],null,[\"$\",\"$Le\",null,{\"children\":[\"$Lf\",\"$L10\",[\"$\",\"$L11\",null,{\"promise\":\"$@12\"}]]}]]}],{},null,false]},null,false]},null,false]},[[\"$\",\"div\",\"l\",{\"className\":\"flex h-full items-center justify-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"scale-[1.15] animate-pulse transition-transform\",\"children\":[\"$\",\"$L13\",null,{\"src\":\"/images/main-logo.png\",\"alt\":\"로딩 중...\",\"width\":120,\"height\":120,\"className\":\"drop-shadow-lg\"}]}],[\"$\",\"p\",null,{\"className\":\"mt-6 animate-pulse text-lg font-bold text-gray-600\",\"children\":\"Codefug Blog\"}]]}]}],[],[]],false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"G0OD6h-XDd_uRo2XyMyz6\",{\"children\":[[\"$\",\"$L14\",null,{\"children\":\"$L15\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$16\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"17:\"$Sreact.suspense\"\n18:I[2533,[],\"AsyncMetadata\"]\nd:[\"$\",\"$17\",null,{\"fallback\":null,\"children\":[\"$\",\"$L18\",null,{\"promise\":\"$@19\"}]}]\n"])</script><script>self.__next_f.push([1,"10:null\n"])</script><script>self.__next_f.push([1,"15:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nf:null\n"])</script><script>self.__next_f.push([1,"19:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Codefug Blog\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"project experiences and development notes\"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"Codefug Blog\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"project experiences and development notes\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:url\",\"content\":\"https://codefug-blog.vercel.app\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:image\",\"content\":\"http://localhost:3000/images/main-logo.png\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:image:alt\",\"content\":\"Codefug Blog\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:title\",\"content\":\"Codefug Blog\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:description\",\"content\":\"project experiences and development notes\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:image\",\"content\":\"http://localhost:3000/images/main-logo.png\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:image:alt\",\"content\":\"Codefug Blog\"}],[\"$\",\"link\",\"13\",{\"rel\":\"icon\",\"href\":\"/icon.ico?f00882ffa3186f37\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]],\"error\":null,\"digest\":\"$undefined\"}\n12:{\"metadata\":\"$19:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"1a:I[448,[\"893\",\"static/chunks/893-1af1c230473151df.js\",\"460\",\"static/chunks/460-7903e3149ee4c004.js\",\"252\",\"static/chunks/252-c4d5671b15cb4929.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-a9de55f97c60b056.js\"],\"GtmPageView\"]\n1b:I[4329,[\"893\",\"static/chunks/893-1af1c230473151df.js\",\"460\",\"static/chunks/460-7903e3149ee4c004.js\",\"252\",\"static/chunks/252-c4d5671b15cb4929.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-a9de55f97c60b056.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"b:[\"$\",\"section\",null,{\"children\":[[\"$\",\"$L1a\",null,{\"slug\":\"2024-09-14-3\"}],[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"relative mb-6 h-[300px] w-full overflow-hidden rounded-xl sm:h-[400px] md:h-[450px]\",\"children\":[[\"$\",\"$L13\",null,{\"src\":\"/images/logos/fetch.png\",\"alt\":\"(꼼꼼 프로젝트) 클라이언트와 서버 둘다 호환되는 fetch 구현\",\"fill\":true,\"sizes\":\"(max-width: 768px) 100vw, 1200px\",\"priority\":true,\"className\":\"object-cover object-center transition-transform duration-500 hover:scale-105\"}],[\"$\",\"div\",null,{\"className\":\"absolute inset-0 bg-gradient-to-b from-transparent to-black/70\"}],[\"$\",\"div\",null,{\"className\":\"absolute left-4 top-4 flex flex-wrap gap-2 sm:left-6 sm:top-6\",\"children\":[[\"$\",\"div\",\"kkom-kkom\",{\"className\":\"inline-flex items-center rounded-md border px-2.5 py-0.5 transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-white/90 text-xs font-medium text-gray-800 hover:bg-white sm:text-sm\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-tag mr-1 h-3 w-3\",\"children\":[[\"$\",\"path\",\"vktsd0\",{\"d\":\"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z\"}],[\"$\",\"circle\",\"kqv944\",{\"cx\":\"7.5\",\"cy\":\"7.5\",\"r\":\".5\",\"fill\":\"currentColor\"}],\"$undefined\"]}],\" \",\"kkom-kkom\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mb-6 space-y-4\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-0 text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-50 sm:text-4xl md:text-5xl\",\"children\":\"(꼼꼼 프로젝트) 클라이언트와 서버 둘다 호환되는 fetch 구현\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center justify-end gap-4 text-sm text-gray-600 dark:text-gray-400\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar-days mr-2 h-4 w-4\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],[\"$\",\"path\",\"6423bh\",{\"d\":\"M8 14h.01\"}],[\"$\",\"path\",\"1etili\",{\"d\":\"M12 14h.01\"}],[\"$\",\"path\",\"1gbofw\",{\"d\":\"M16 14h.01\"}],[\"$\",\"path\",\"lrp35t\",{\"d\":\"M8 18h.01\"}],[\"$\",\"path\",\"mhygvu\",{\"d\":\"M12 18h.01\"}],[\"$\",\"path\",\"kzsmim\",{\"d\":\"M16 18h.01\"}],\"$undefined\"]}],[\"$\",\"time\",null,{\"dateTime\":\"2024-09-14\",\"children\":\"2024-09-14\"}]]}]}],[\"$\",\"p\",null,{\"className\":\"text-lg leading-relaxed text-gray-600 dark:text-gray-300 md:text-xl\",\"children\":\"서버 액션을 활용한 refresh token rotation, 커링 함수를 이용한 리팩토링\"}]]}],[\"$\",\"div\",null,{\"className\":\"border-b border-gray-200 dark:border-gray-800\"}]]}],[\"$\",\"section\",null,{\"className\":\"lg:flex lg:items-baseline\",\"children\":[[\"$\",\"$L1b\",null,{}],[\"$\",\"section\",null,{\"className\":\"max-w-full\",\"children\":[[\"$\",\"h1\",null,{\"id\":0,\"className\":\"hltr-red\",\"children\":\"배경\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"next.js에서는 서버 단의 fetch를 override해서 중복 통신 처리 같은 유익한 기능을 추가했다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"평소에는 서버 컴포넌트와 클라이언트 컴포넌트에서 그냥 fetch를 쓰면 해당 기능이 첨가된 통신을 사용할 수 있다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"여기서 문제는 access token과 refresh token이 들어갈 때이다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"서버 컴포넌트에서는 next/headers의 쿠키를 사용하여 쿠키에 접근하고 클라이언트 컴포넌트에서는 브라우저 쿠키로 쿠키에 접근한다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"서로 다른 방식은 refresh token rotation을 위한 함수를 구현할 때 문제가 된다.\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":1,\"className\":\"hltr-red\",\"children\":\"구현\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"아래의 코드는 나에게 업무가 넘어오기 전 다른 팀원이 짠 코드다. middleware 활용하여 구현된 방식이었다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-ts\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NextResponse\"}],\" } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"next/server\\\"\"}],\";\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"type\"}],\" { \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NextFetchEvent\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NextRequest\"}],\" } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"next/server\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"PostTeamIdAuthRefreshTokenResponse\"}],\" } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"./lib/apis/type\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"middleware\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"request\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NextRequest\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"event\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NextFetchEvent\"}]]}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" hasAccessToken = request.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"cookies\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"has\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"accessToken\\\"\"}],\");\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" hasRefreshToken = request.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"cookies\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"has\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"refreshToken\\\"\"}],\");\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" { pathname } = request.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"nextUrl\"}],\";\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// NOTE - 로그인 후 로그인, 회원가입 페이지에 접근하는 경우\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (\\n    hasAccessToken \u0026\u0026\\n    (pathname.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"startsWith\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/login\\\"\"}],\") || pathname.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"startsWith\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/signup\\\"\"}],\"))\\n  ) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NextResponse\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"redirect\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"URL\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/\\\"\"}],\", request.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"url\"}],\"));\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// NOTE - 로그인 전에 랜딩, 로그인, 회원가입 페이지 외에 다른 페이지에 접근하는 경우\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (\\n    !hasAccessToken \u0026\u0026\\n    !(\\n      pathname.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"startsWith\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/login\\\"\"}],\") ||\\n      pathname.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"startsWith\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/signup\\\"\"}],\") ||\\n      pathname === \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/\\\"\"}],\"\\n    )\\n  ) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NextResponse\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"redirect\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"URL\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/login\\\"\"}],\", request.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"url\"}],\"));\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// NOTE - accessToken이 만료되어서 refreshToken을 통해 새로운 토큰을 발급해야 하는 경우\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (!hasAccessToken \u0026\u0026 hasRefreshToken) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" refreshTokenValue = request.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"cookies\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"get\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"refreshToken\\\"\"}],\")?.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"value\"}],\";\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// NOTE - Fetch를 사용하여 새로운 accessToken을 발급받는 비동기 작업\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" fetchPromise = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}\"}],\"/auth/refresh-token`\"]}],\",\\n      {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"method\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"POST\\\"\"}],\",\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"headers\"}],\": {\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Content-Type\\\"\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"application/json\\\"\"}],\",\\n        },\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"body\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"JSON\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"stringify\"}],\"({\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"refreshToken\"}],\": refreshTokenValue,\\n        }),\\n      },\\n    )\\n      .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"async\"}],\" (response) =\u003e {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (!response.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"ok\"}],\") {\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"refresh token 요청 실패\\\"\"}],\");\\n        }\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"data\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"PostTeamIdAuthRefreshTokenResponse\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"();\\n\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// NextResponse 객체를 만들어 쿠키를 설정\"}],\"\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" nextResponse = \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NextResponse\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"next\"}],\"();\\n        nextResponse.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"cookies\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"set\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"accessToken\\\"\"}],\", data.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"accessToken\"}],\");\\n\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" nextResponse;\\n      })\\n      .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error\"}],\") =\u003e\"]}],\" {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NextResponse\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"redirect\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"URL\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/login\\\"\"}],\", request.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"url\"}],\"));\\n      });\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// waitUntil을 사용하여 비동기 작업이 완료될 때까지 기다림\"}],\"\\n    event.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"waitUntil\"}],\"(fetchPromise);\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 비동기 작업이 완료된 후 요청을 계속 진행하도록 합니다.\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 이때 fetchPromise에서 반환한 NextResponse 객체 사용\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve\"}],\") =\u003e\"]}],\" {\\n      fetchPromise.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"nextResponse\"}],\") =\u003e\"]}],\" {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(nextResponse);\\n      });\\n    });\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NextResponse\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"next\"}],\"();\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" config = {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"matcher\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/((?!api|_next/static|_next/image|favicon.ico).*)\\\"\"}],\",\\n};\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"라우트가 변경될 때 \",[\"$\",\"code\",null,{\"children\":\"waitUntil\"}],\"이라는 메소드로 원하는 통신 이전에 토큰을 처리해주는 로직이었다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"하지만 다음의 상황에서 예외가 발생했다.\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"서버 액션을 사용하지 않으면 프론트엔드 서버를 거치지 않고 요청을 하기 때문에 미들웨어를 거치지 않게 됨\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"refreshToken은 있으나 다시 로그인 하라고 분기 처리 (에러)\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"고민해본 결과 axios의 interceptor처럼 fetch 요청 자체에 refreshToken을 처리해야 한다는 결론에 이르렀다.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":2,\"className\":\"hltr-orange\",\"children\":\"서버 액션을 이용한 import\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"next/headers는 클라이언트 단에 있을 수 없고 서버 컴포넌트, 서버 액션에서 호출할 수 있었다. (클라이언트 단에서 호출하면 에러 처리)\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"그건 조건부로 실제로 실행되는 것이 아니여도 import로 연결되어 있다면 전부 해당되었다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이때 든 생각은 \\\"서버 액션과 일단 클라이언트 fetch를 연결하고 분기 처리하면 되지 않나?\\\" 였다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"그러곤 다음의 코드를 작성했다.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":3,\"className\":\"hltr-yellow\",\"children\":\"myFetch\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-ts\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { clientFetch } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"./clientFetch\\\"\"}],\";\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" serverFetch \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"./serverFetch\\\"\"}],\";\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"MyFetchOptions\"}],\" } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"./types\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":[\"/**\\n * myFetch는 서버와 클라이언트에서 사용할 수 있는 fetch 함수입니다.\\n * 서버에서 사용할 때는 serverFetch를 사용하고, 클라이언트에서 사용할 때는 clientFetch를 사용합니다.\\n * 사용하실 때는 fetch처럼 사용하시면 됩니다.\\n * withCredentials 옵션을 사용하면 쿠키를 전송할 수 있습니다.\\n * accessToken이 필요한 fetch에서 사용하시면 됩니다.\\n * 내부적으로 accessToken이 만료되었을 때, refreshToken을 사용하여 새로운 accessToken을 발급받습니다.\\n *\\n * \",[\"$\",\"span\",null,{\"className\":\"hljs-doctag\",\"children\":\"@author\"}],\" 이승현\\n * \",[\"$\",\"span\",null,{\"className\":\"hljs-doctag\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-variable\",\"children\":\"input\"}],\"\\n * \",[\"$\",\"span\",null,{\"className\":\"hljs-doctag\",\"children\":\"@param\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-variable\",\"children\":\"init\"}],\"\\n * \",[\"$\",\"span\",null,{\"className\":\"hljs-doctag\",\"children\":\"@returns\"}],\" Promise\u003cT\u003e\\n **/\"]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" myFetch\u003cT\u003e(\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"input\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"string\"}],\" | \",[\"$\",\"span\",null,{\"className\":\"hljs-variable constant_\",\"children\":\"URL\"}],\" | globalThis.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"Request\"}],\",\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"init\"}],\"?: \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"MyFetchOptions\"}],\",\\n): \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"\u003cT\u003e {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"typeof\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"window\"}],\" !== \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"undefined\\\"\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" response = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"clientFetch\"}],\"(input, init);\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" data = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"();\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" data;\\n  }\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" response = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"serverFetch\"}],\"(input, init);\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" data = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"();\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" data;\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"토큰 처리 기능이 붙혀진 fetch, myFetch 이다.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":4,\"className\":\"hltr-yellow\",\"children\":\"clientFetch\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-ts\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { getCookie, setCookie } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"cookies-next\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"PostAuthRefreshTokenResponse\"}],\" } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"../type\\\"\"}],\";\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"type\"}],\" { \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"MyFetchOptions\"}],\" } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"./types\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"clientFetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"input\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"string\"}],\" | URL | globalThis.\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Request\"}],\",\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"init\"}],\"?: \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"MyFetchOptions\"}],\",\\n\"]}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// accessToken를 읽는다.\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" accessToken = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getCookie\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"accessToken\\\"\"}],\");\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" newInit = init;\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// withCredentials는 토큰 인증 처리를 하겠다는 flag이다.\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (newInit?.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"withCredentials\"}],\" === \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"true\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" headers = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Headers\"}],\"(init?.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"headers\"}],\");\\n    headers.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"set\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Authorization\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`Bearer \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${accessToken}\"}],\"`\"]}],\");\\n    newInit = { ...init, headers };\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 토큰 처리를 한다.\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" res = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(input, newInit);\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 만약 토큰이 만료되었다면\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (res.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"status\"}],\" === \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"401\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// refresh token rotation 처리\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" refreshTokenValue = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getCookie\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"refreshToken\\\"\"}],\");\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (refreshTokenValue) {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" newAccessToken = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}\"}],\"/auth/refresh-token`\"]}],\",\\n        {\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"method\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"POST\\\"\"}],\",\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"headers\"}],\": {\\n            \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Content-Type\\\"\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"application/json\\\"\"}],\",\\n          },\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"body\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"JSON\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"stringify\"}],\"({\\n            \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"refreshToken\"}],\": refreshTokenValue,\\n          }),\\n        },\\n      );\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (newAccessToken.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"ok\"}],\") {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"newAccessTokenValue\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"PostAuthRefreshTokenResponse\"}],\" =\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" newAccessToken.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"();\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"setCookie\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"accessToken\\\"\"}],\", newAccessTokenValue.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"accessToken\"}],\");\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" headers = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Headers\"}],\"(init?.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"headers\"}],\");\\n        headers.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"set\"}],\"(\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Authorization\\\"\"}],\",\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`Bearer \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${newAccessTokenValue.accessToken}\"}],\"`\"]}],\",\\n        );\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" newInitAfterFetch = { ...init, headers };\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" newRes = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(input, newInitAfterFetch);\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" newRes;\\n      }\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"ResponseError\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"엑세스 토큰 호출 실패\\\"\"}],\", newAccessToken);\\n    } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"ResponseError\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"로그인을 다시 해주세요!\\\"\"}],\", res);\\n    }\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (!res.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"ok\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"ResponseError\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러가 발생했습니다.\\\"\"}],\", res);\\n  }\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" res;\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"클라이언트 (\",[\"$\",\"code\",null,{\"children\":\"window !== undefined\"}],\") 상태일 때 실행될 함수이다. refresh token rotation이 필요한 경우에 받고 fetch를 다시 하도록 하는 로직을 갖고 있다.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":5,\"className\":\"hltr-yellow\",\"children\":\"serverFetch\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-tsx\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"use server\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { cookies } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"next/headers\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"MyFetchOptions\"}],\" } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\".\\\"\"}],\";\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"PostTeamIdAuthRefreshTokenResponse\"}],\" } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"../type\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"serverFetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"input\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"string\"}],\" | URL | globalThis.\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Request\"}],\",\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"init\"}],\"?: \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"MyFetchOptions\"}],\",\\n\"]}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" cookieStore = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"cookies\"}],\"();\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" accessToken = cookieStore.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"get\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"accessToken\\\"\"}],\")?.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"value\"}],\";\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (init?.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"withCredentials\"}],\" === \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"true\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" headers = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Headers\"}],\"(init?.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"headers\"}],\");\\n    headers.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"set\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Authorization\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`Bearer \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${accessToken}\"}],\"`\"]}],\");\\n    init = { ...init, headers };\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" res = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(input, init);\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (res.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"status\"}],\" === \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"401\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" refreshTokenValue = cookieStore.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"get\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"refreshToken\\\"\"}],\")?.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"value\"}],\";\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (refreshTokenValue) {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" newAccessToken = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}\"}],\"/auth/refresh-token`\"]}],\",\\n        {\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"method\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"POST\\\"\"}],\",\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"headers\"}],\": {\\n            \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Content-Type\\\"\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"application/json\\\"\"}],\",\\n          },\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"body\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"JSON\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"stringify\"}],\"({\\n            \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"refreshToken\"}],\": refreshTokenValue,\\n          }),\\n        },\\n      );\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (newAccessToken.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"ok\"}],\") {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"newAccessTokenValue\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"PostTeamIdAuthRefreshTokenResponse\"}],\" =\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" newAccessToken.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"();\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" headers = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Headers\"}],\"(init?.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"headers\"}],\");\\n        headers.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"set\"}],\"(\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Authorization\\\"\"}],\",\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`Bearer \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${newAccessTokenValue.accessToken}\"}],\"`\"]}],\",\\n        );\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" newInit = { ...init, headers };\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" newRes = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(input, newInit);\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" newRes;\\n      } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"엑세스 토큰 호출 실패\\\"\"}],\");\\n      }\\n    } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"로그인을 다시 해주세요!\\\"\"}],\");\\n    }\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (!res.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"ok\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"responseError\"}],\"(res);\\n  }\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" res;\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"서버 상태(\",[\"$\",\"code\",null,{\"children\":\"window===undefined\"}],\")일 때 실행될 함수이다. refresh token rotation을 next/headers의 cookie를 이용해서 실행한다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"다음의 로직이 실행되어 에러가 일어나지 않는 것이다.\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"서버 액션을 클라이언트단에서 import하기 때문에 런타임 에러가 무시된다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"next/header를 에러처리 안하고 넘어간다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"window===undefined\"}],\" 로 분기처리했기 때문에 클라이언트에서 서버 함수를 사용하는 경우의 수는 차단된다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"서버, 클라이언트 모두 사용 가능해짐\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":6,\"className\":\"hltr-orange\",\"children\":\"axios의 base url 기능 구현\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"코드 리뷰를 하던 중에 URL을 상수로 받아서 myFetch에 내려받는 코드를 발견하였다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-09-14/Pasted%20image%2020240914193655.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"axios에서는 base url을 저장해놓고 사용하는 쪽에서는 해당 url 뒤에 있는 라우트만 적어서 사용하는 기능이 있다.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":7,\"className\":\"hltr-yellow\",\"children\":\"커링 함수\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"함수형 프로그래밍에서는 이걸 어떻게 구현할까 고민을 하다가 이전에 학습했던 커링 함수가 생각났다.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"커링 함수: 여러 개의 인자를 받는 함수를 하나의 인자만 받는 함수로 나눠서 순차적으로 호출될 수 있게 체인 형태로 구성한 것\\n한번에 하나의 인자만 전달하는 것을 원칙으로 한다. 각 단계에서 받은 인자들을 모두 마지막 단계에서 참조하기 때문에 메모리에 차곡차곡 쌓였다가 마지막 단계에서 호출해서 실행 컨텍스트가 끝나면 한번에 GC의 수거 대상이 된다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이를 이용해서 구현을 시작했다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-ts\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// instance를 위한 커링 함수\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"newFetch\"}],\" =\\n  (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"url\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"string\"}]]}],\") =\u003e\\n  \u003cT\u003e\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"input\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"string\"}],\" | URL | globalThis.\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Request\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"init\"}],\"?: \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"MyFetchOptions\"}]]}],\") =\u003e\"]}],\"\\n    myFetch\u003cT\u003e(url + input, init);\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// instance.tsx\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" instance = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"newFetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"`{url}`\"}],\");\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위의 함수로 타입까지 다 처리된 base_url 첨가 myFetch를 사용할 수 있게 되었다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"사용하는 쪽에서는 이제 엄청 간단해졌다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-ts\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 호출부\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getUserHistory\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"try\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" response = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" instance\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"GetTeamIdUserHistoryResponse\"}],\"\u003e(\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/user/history\\\"\"}],\",\\n      {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"method\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"GET\\\"\"}],\",\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"withCredentials\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"true\"}],\",\\n      },\\n    );\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" response;\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"catch\"}],\" (error) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" error;\\n  }\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"세부 로직은 속으로 숨겨져 있는 상태에서 instance와 withCredentials만 사용해서 token이 처리되었다!!!\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"제일 좋은 점은 api만 변경되었기 때문에 다른 코드를 변경할 필요 없이 myFetch를 instance로 변경만 하면 된다는 것이다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-ts\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// getUserHistory를 사용하는 쪽\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"GetTeamIdUserHistoryResponse\"}],\" } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"@/lib/apis/type\\\"\"}],\";\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { getUserHistory } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"@/lib/apis/user\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"DateBoxCard\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"./date-box-card\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"default\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"DateBoxList\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" data = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getUserHistory\"}],\"(); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 변화가 없이 사용할 수 있다.\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (data.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"tasksDone\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"length\"}],\" === \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\") \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"null\"}],\";\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"history\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Map\"}],\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"string\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"GetTeamIdUserHistoryResponse\"}],\"[\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"tasksDone\\\"\"}],\"]\u003e =\\n    data.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"tasksDone\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reduce\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"acc, cur\"}],\") =\u003e\"]}],\" {\\n      acc.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"set\"}],\"(cur.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"date\"}],\", [...(acc.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"get\"}],\"(cur.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"date\"}],\") || []), cur]);\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" acc;\\n    }, \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Map\"}],\"());\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" (\\n    \",[\"$\",\"span\",null,{\"className\":\"xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"section\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"className\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"mt-[27px] flex flex-col gap-10 md:mt-6\\\"\"}],\"\u003e\"]}],\"\\n      {[...history.entries()].map(([date, history]) =\u003e (\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"DateBoxCard\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"key\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{date}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"date\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{date}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"tasksDone\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{history}\"}],\" /\u003e\"]}],\"\\n      ))}\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"section\"}],\"\u003e\"]}]]}],\"\\n  );\\n}\\n\"]}]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":8,\"className\":\"hltr-red\",\"children\":\"후기\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"서버 액션을 사용해서 토큰 처리를 해보는 경험을 했다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"서버 액션으로 만들었을 때의 쾌감도 굉장했지만 base url을 구현할 때가 진짜 많이 성장했구나 생각했던 때였다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"몇개월 전에 코어 자바스크립트에서 봤던 내용인데 이제야 제대로 활용되어 이해된 느낌이 들었다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"지식은 차곡차곡 쌓이는 구나 생각하면서 짜릿했던 경험이다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"더 성장해보자.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"++ 2024-11-29\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이후에 클라이언트에서 쿠키를 읽는 방식을 쓰면 해당 쿠키에 httpOnly를 적용할 수가 없는 것을 알게 되고 이는 보안 문제가 발생한다는 것을 알게 되면서 기존 클라이언트 단의 쿠키를 전부 서버 쿠키로 교체하게 되었다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"기존에 서버 액션과 클라이언트 단의 코드 분리를 통해서 쿠키를 읽는 로직은 사실상 크게 필요 없어진 것이다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"토큰을 저장하는 전략은 다양하고 그것을 공격하는 방법은 다양하기 때문에 프론트엔드 개발자로써 일하면서 항상 고민해야 하는 부분인 것 같다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"꼼꼼 프로젝트 진행 중에 겪은 경험들입니다. 오늘도 많이 성장한 것 같아요!\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"읽어주셔서 감사합니다! 지켜봐주세요!\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"감사합니다.\"}],\"\\n\"]}]]}]]}]]}]\n"])</script></body></html>