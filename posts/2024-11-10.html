<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="https://codefug.github.io/_next/static/media/518331124efecf5c-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/images/logos/JS.svg"/><link rel="preload" as="image" href="https://velog.velcdn.com/images/codefug/post/1863b8a0-6521-495b-85f2-22b0f35b6380/image.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241108212123.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241109193930.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241109221737.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241109214448.png"/><link rel="preload" as="image" href="/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_1.jpg"/><link rel="preload" as="image" href="/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_2.jpg"/><link rel="preload" as="image" href="/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_3.jpg"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241107193715.png"/><link rel="stylesheet" href="https://codefug.github.io/_next/static/css/4e45607bcfa6a776.css" data-precedence="next"/><link rel="stylesheet" href="https://codefug.github.io/_next/static/css/7b1838e6bdc2260c.css" data-precedence="next"/><link rel="stylesheet" href="https://codefug.github.io/_next/static/css/fc37ac2b1a278e8c.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="https://codefug.github.io/_next/static/chunks/webpack-cb9a9adc3ea1ef6e.js"/><script src="https://codefug.github.io/_next/static/chunks/96e220d1-2531cf7c679f7c43.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/770-52cce3cb203b2422.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/main-app-9f1a6571a5a98ceb.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/299-20a67a2580c87e66.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/635-8456b2984470c35f.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/70-d82343500dd0d9ac.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/584-131c0b3bf6034f9e.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/668-d1e9350793e28fea.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/layout-e5095dc886e81597.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/not-found-8b0af7c225bbe321.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/posts/%5Bid%5D/layout-6a37c5d18e0b4ffc.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/posts/%5Bid%5D/page-a37ccfd5df9b4a85.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/global-error-e65e17ac78cfa06a.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtm.js?id=undefined" as="script"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241107200211.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241107195926.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241107195831.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241107200104.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241107200545.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241107200740.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241107204412.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241110210716.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241107212119.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241110214430.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241107214313.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241108150808.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241108151347.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241108152428.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241108152443.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241108154631.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241108160624.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241108161157.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241108195640.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241108205243.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241110152440.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241110193617.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241110193853.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241110193713.png"/><link rel="preload" as="image" href="/images/2024-11-10/Pasted%20image%2020241110155653.png"/><meta name="next-size-adjust" content=""/><title>Codefug Blog</title><meta name="description" content="project experiences and development notes"/><meta property="og:title" content="Codefug Blog"/><meta property="og:description" content="project experiences and development notes"/><meta property="og:url" content="https://codefug-blog.vercel.app"/><meta property="og:image" content="http://localhost:3000/images/main-logo.png"/><meta property="og:image:alt" content="Codefug Blog"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Codefug Blog"/><meta name="twitter:description" content="project experiences and development notes"/><meta name="twitter:image" content="http://localhost:3000/images/main-logo.png"/><meta name="twitter:image:alt" content="Codefug Blog"/><link rel="icon" href="/icon.ico?f00882ffa3186f37" type="image/x-icon" sizes="16x16"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="https://codefug.github.io/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_7ee20e antialiased"><script>((e,t,r,n,i,o,a,s)=>{let l=document.documentElement,u=["light","dark"];function c(t){var r;(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,n=r&&o?i.map(e=>o[e]||e):i;r?(l.classList.remove(...n),l.classList.add(o&&o[t]?o[t]:t)):l.setAttribute(e,t)}),r=t,s&&u.includes(r)&&(l.style.colorScheme=r)}if(n)c(n);else try{let e=localStorage.getItem(t)||r,n=a&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;c(n)}catch(e){}})("class","theme","system",null,["light","dark"],null,true,true)</script><div style="--sidebar-width:16rem;--sidebar-width-icon:3rem" class="group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar"><div class="group peer hidden text-sidebar-foreground md:block" data-state="collapsed" data-collapsible="offcanvas" data-variant="sidebar" data-side="left"><div class="relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear group-data-[collapsible=offcanvas]:w-0 group-data-[side=right]:rotate-180 group-data-[collapsible=icon]:w-[--sidebar-width-icon]"></div><div class="fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)] group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l"><div data-sidebar="sidebar" class="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"><div dir="ltr" class="relative overflow-hidden h-full w-full overflow-y-auto" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit]" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div data-sidebar="content" class="flex min-h-0 flex-1 flex-col overflow-auto group-data-[collapsible=icon]:overflow-hidden group relative gap-0"><div class="absolute h-[150px] w-full bg-primary"></div><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><div data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 mb-2 mt-4 flex justify-center px-4 text-sm font-bold text-gray-400 group-hover:text-white">Codefug</div><div data-sidebar="group-content" class="w-full text-sm flex min-h-full flex-col items-center px-2"><span class="relative flex shrink-0 overflow-hidden rounded-full h-40 w-40"><span class="flex h-full w-full items-center justify-center rounded-full bg-muted group-hover:text-black group-hover:dark:text-white">이승현</span></span><h1 class="mt-4 text-center text-lg font-bold text-gray-400 group-hover:text-black dark:text-gray-500 group-hover:dark:text-white">이승현</h1><p class="text-sm text-gray-400 group-hover:text-black dark:text-gray-500 group-hover:dark:text-white">Web Frontend Developer</p></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«Rbcplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">javascript<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«Rbcplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«Rjcplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">kkom-kkom<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«Rjcplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«Rrcplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">gheuppay<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«Rrcplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R13cplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">reactdeepdive<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R13cplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R1bcplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">react<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R1bcplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R1jcplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">web<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R1jcplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R1rcplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">nextjs<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R1rcplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R23cplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">typescript<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R23cplb»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R2bcplb»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">fandomk<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R2bcplb»" hidden=""></div></div></div><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><div data-sidebar="group-content" class="w-full text-sm"><ul data-sidebar="menu" class="flex w-full min-w-0 flex-col gap-1"><li data-sidebar="menu-item" class="group/menu-item relative"><a class="text-gray-400 hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-none ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground h-8 text-sm" href="https://www.figma.com/proto/KSWARGDkXi9Wt8ARq2uGCa/leeseounghyun-resume?node-id=401-2&amp;node-type=canvas&amp;t=z2H9bL74afXrrgPS-1&amp;scaling=min-zoom&amp;content-scaling=fixed&amp;page-id=0%3A1" target="_blank" data-sidebar="menu-button" data-size="default" data-active="false">Portfolio</a></li><li data-sidebar="menu-item" class="group/menu-item relative"><a class="text-gray-400 hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-none ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground h-8 text-sm" data-sidebar="menu-button" data-size="default" data-active="false" href="/about">About</a></li><li data-sidebar="menu-item" class="group/menu-item relative"><a class="text-gray-400 hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-none ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground h-8 text-sm" data-sidebar="menu-button" data-size="default" data-active="false" href="/search">Search</a></li></ul></div></div></div><div data-sidebar="footer" class="flex flex-col gap-2 p-2"></div></div></div></div></div></div></div><style>
:root {
  --bprogress-color: #1f1d80;
  --bprogress-height: 4px;
  --bprogress-spinner-size: 18px;
  --bprogress-spinner-animation-duration: 400ms;
  --bprogress-spinner-border-size: 2px;
  --bprogress-box-shadow: 0 0 10px #1f1d80, 0 0 5px #1f1d80;
  --bprogress-z-index: 99999;
  --bprogress-spinner-top: 15px;
  --bprogress-spinner-bottom: auto;
  --bprogress-spinner-right: 15px;
  --bprogress-spinner-left: auto;
}

.bprogress {
  width: 0;
  height: 0;
  pointer-events: none;
  z-index: var(--bprogress-z-index);
}

.bprogress .bar {
  background: var(--bprogress-color);
  position: fixed;
  z-index: var(--bprogress-z-index);
  top: 0;
  left: 0;
  width: 100%;
  height: var(--bprogress-height);
}

/* Fancy blur effect */
.bprogress .peg {
  display: block;
  position: absolute;
  right: 0;
  width: 100px;
  height: 100%;
  box-shadow: var(--bprogress-box-shadow);
  opacity: 1.0;
  transform: rotate(3deg) translate(0px, -4px);
}

/* Remove these to get rid of the spinner */
.bprogress .spinner {
  display: block;
  position: fixed;
  z-index: var(--bprogress-z-index);
  top: var(--bprogress-spinner-top);
  bottom: var(--bprogress-spinner-bottom);
  right: var(--bprogress-spinner-right);
  left: var(--bprogress-spinner-left);
}

.bprogress .spinner-icon {
  width: var(--bprogress-spinner-size);
  height: var(--bprogress-spinner-size);
  box-sizing: border-box;
  border: solid var(--bprogress-spinner-border-size) transparent;
  border-top-color: var(--bprogress-color);
  border-left-color: var(--bprogress-color);
  border-radius: 50%;
  -webkit-animation: bprogress-spinner var(--bprogress-spinner-animation-duration) linear infinite;
  animation: bprogress-spinner var(--bprogress-spinner-animation-duration) linear infinite;
}

.bprogress-custom-parent {
  overflow: hidden;
  position: relative;
}

.bprogress-custom-parent .bprogress .spinner,
.bprogress-custom-parent .bprogress .bar {
  position: absolute;
}

.bprogress .indeterminate {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--bprogress-height);
  overflow: hidden;
}

.bprogress .indeterminate .inc,
.bprogress .indeterminate .dec {
  position: absolute;
  top: 0;
  height: 100%;
  background-color: var(--bprogress-color);
}

.bprogress .indeterminate .inc {
  animation: bprogress-indeterminate-increase 2s infinite;
}

.bprogress .indeterminate .dec {
  animation: bprogress-indeterminate-decrease 2s 0.5s infinite;
}

@-webkit-keyframes bprogress-spinner {
  0%   { -webkit-transform: rotate(0deg); transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); transform: rotate(360deg); }
}

@keyframes bprogress-spinner {
  0%   { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes bprogress-indeterminate-increase {
  from { left: -5%; width: 5%; }
  to { left: 130%; width: 100%; }
}

@keyframes bprogress-indeterminate-decrease {
  from { left: -80%; width: 80%; }
  to { left: 110%; width: 10%; }
}
</style><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><main class="flex min-h-screen flex-col transition-[width] duration-200 ease-linear w-full"><header class="sticky left-0 right-0 top-0 z-30 transform bg-background transition-transform duration-300 translate-y-0"><div class="flex items-center justify-between gap-6 py-4"><section class="flex items-center gap-4"><div class="ml-2"><button class="flex h-7 w-7 items-center justify-center rounded-md hover:bg-accent hover:text-black hover:dark:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-panel-left-open"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"></path><path d="m14 9 3 3-3 3"></path></svg></button></div><a class="flex flex-shrink-0 items-center gap-2 hover:opacity-95 hover:drop-shadow-lg" href="/"><img alt="logo" loading="lazy" width="28" height="28" decoding="async" data-nimg="1" style="color:transparent" src="/images/main-logo.png"/><div class="hidden whitespace-nowrap text-lg font-bold text-black dark:text-white md:block">Codefug Blog</div></a></section><section class="flex items-center gap-4 text-sm font-semibold md:text-base"><nav class="flex items-center gap-4 text-sm font-semibold md:text-base"><a href="https://www.figma.com/proto/KSWARGDkXi9Wt8ARq2uGCa/leeseounghyun-resume?node-id=401-2&amp;node-type=canvas&amp;t=z2H9bL74afXrrgPS-1&amp;scaling=min-zoom&amp;content-scaling=fixed&amp;page-id=0%3A1" target="_blank" class="text-gray-400 hover:text-black hover:underline hover:drop-shadow-lg dark:hover:text-white">Portfolio</a><a class="text-gray-400 hover:text-black hover:underline hover:drop-shadow-lg dark:hover:text-white" href="/about">About</a><a class="text-gray-400 hover:text-black hover:underline hover:drop-shadow-lg dark:hover:text-white" href="/search"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search h-5 w-5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg></a></nav><button type="button" role="switch" aria-checked="false" data-state="unchecked" value="on" class="peer inline-flex h-7 w-16 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input"><span data-state="unchecked" class="pointer-events-none block h-6 w-6 rounded-full bg-theme-icon bg-center shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-[2.25rem] data-[state=unchecked]:translate-x-0 data-[state=checked]:bg-moon data-[state=unchecked]:bg-sun"></span></button><input type="checkbox" aria-hidden="true" style="transform:translateX(-100%);position:absolute;pointer-events:none;opacity:0;margin:0" tabindex="-1" value="on"/></section></div><div class="h-2 origin-left bg-primary" style="transform:scaleX(0)"></div></header><div class="mx-auto w-full max-w-[1400px] flex-1 px-4"><!--$--><div class="prose mx-auto overflow-auto dark:prose-invert"><section><header class="mb-8"><div class="relative mb-6 h-[300px] w-full overflow-hidden rounded-xl sm:h-[400px] md:h-[450px]"><img alt="Asynchronous JavaScript" decoding="async" data-nimg="fill" class="object-cover object-center transition-transform duration-500 hover:scale-105" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="/images/logos/JS.svg"/><div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/70"></div><div class="absolute left-4 top-4 flex flex-wrap gap-2 sm:left-6 sm:top-6"><div class="inline-flex items-center rounded-md border px-2.5 py-0.5 transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-white/90 text-xs font-medium text-gray-800 hover:bg-white sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag mr-1 h-3 w-3"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z"></path><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"></circle></svg> <!-- -->javascript</div></div></div><div class="mb-6 space-y-4"><h1 class="mb-0 text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-50 sm:text-4xl md:text-5xl">Asynchronous JavaScript</h1><div class="flex items-center justify-end gap-4 text-sm text-gray-600 dark:text-gray-400"><div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days mr-2 h-4 w-4"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path><path d="M8 14h.01"></path><path d="M12 14h.01"></path><path d="M16 14h.01"></path><path d="M8 18h.01"></path><path d="M12 18h.01"></path><path d="M16 18h.01"></path></svg><time dateTime="2024-11-10">2024-11-10</time></div></div><p class="text-lg leading-relaxed text-gray-600 dark:text-gray-300 md:text-xl">microtask queue, macrotask queue, call stack, web api와 관련된 비동기 동작 방식, 비동기 관련 역사와 비동기 코드의 다양한 활용법들을 알아보자.</p></div><div class="border-b border-gray-200 dark:border-gray-800"></div></header><section class="lg:flex lg:items-baseline"><section class="max-w-full"><p><img src="https://velog.velcdn.com/images/codefug/post/1863b8a0-6521-495b-85f2-22b0f35b6380/image.png" alt=""/></p>
<h1 id="0"><mark style="background:#FF5582A6">비동기 통신의 이해</mark></h1>
<p>JS는 Single Thread에서 작동한다. 즉 한 번에 하나의 작업만 동기 방식으로 처리할 수 있다.</p>
<blockquote>
<p>동기(synchronous) : 직렬 방식으로 작업을 처리하는 것, 요청이 시작하고 응답을 받은 후에야 다음 작업 처리</p>
</blockquote>
<blockquote>
<p>비동기(Asynchronous) : 병렬 방식으로 작업을 처리하는 것, 요청이 시작한 후 응답과 관계 없이 다음 작업 처리</p>
</blockquote>
<p>사용자가 검색어를 입력해 검색을 위한 네트워크 요청이 발생한 순간에도 다른 작업을 처리할 수 있다. (비동기적 작업 방식)</p>
<blockquote>
<p>리액트에서는 16 버전에 접어들면서 비동기식으로 작동하는 방법이 소개 되었다.</p>
</blockquote>
<h2 id="1"><mark style="background:#FFB86CA6">싱글 스레드 자바스크립트</mark></h2>
<p>과거, 프로그램을 실행하는 단위가 오직 <strong>Process</strong> 뿐이었다.</p>
<blockquote>
<p><strong>Process</strong></p>
<p>프로그램을 구동해 프로그램의 상태가 메모리 상에서 실행되는 작업 단위</p>
</blockquote>
<p>현재, 하나의 프로그램에 여러가지 작업이 필요해졌고 더 작은 실행 단위인 <strong>thread</strong>가 탄생했다.</p>
<p>thread: 하나의 process에는 여러 개의 thread를 만들 수 있고, thread 끼리 메모리를 공유할 수 있다. 여러 작업을 동시 수행</p>
<p>JavaScript는 기본적으로 싱글 쓰레드 이다.</p>
<h2 id="2"><mark style="background:#FFF3A3A6">JS가 멀티 쓰레드가 아닌 이유</mark></h2>
<ol>
<li>멀티 쓰레드는 내부적으로 처리가 복잡하며 같은 자원에 대해 여러 번 수정하는 등 동시성 문제가 발생할 수 있기에 이에 대한 처리가 필요하다.</li>
<li>각각 격리되어 있는 <strong>Process</strong>와 다르게 하나의 <strong>Thread</strong>가 문제가 생기면 다른 <strong>Thread</strong>도 문제가 발생할 수 있다.</li>
<li>JS이 <strong>멀티 스레딩</strong>을 지원해서 동시에 여러 쓰레드가 DOM을 조작할 수 있었다면 메모리 공유로 인해 동시에 같은 자원에 접근하게 되고 이 때문에 타이밍 이슈가 발생할 수 있고 DOM 표시에 큰 문제를 발생시킬 수 있다.</li>
</ol>
<h2 id="3"><mark style="background:#FFB86CA6">Event Loop</mark></h2>
<p>비동기 동작과 뗄 수 없는 개념은 <code>Event Loop</code>이다.</p>
<p><code>Node.js</code>와 마찬가지로 브라우저 측 자바스크립트 실행 흐름도 <code>Event Loop</code>에 기반을 둔다.</p>
<p><code>Event Loop</code>를 잘 알고 있어야 올바른 아키텍처 설계가 가능하다.</p>
<h3 id="4"><mark style="background:#FFF3A3A6">자바스크립트 엔진 동작 방식</mark></h3>
<p>자바스크립트 엔진은 다음의 알고리즘을 갖고 있다.</p>
<ol>
<li>처리해야 할 task가 있는 경우<!-- -->
<ol>
<li>먼저 들어온 task부터 차례대로 처리한다.</li>
</ol>
</li>
<li>처리해야 할 task가 없는 경우<!-- -->
<ol>
<li>잠들어 있다가 새로운 task가 추가되면 다시 1번 과정으로 돌아간다.</li>
</ol>
</li>
</ol>
<p>자바스크립트 엔진은 대부분 시간을 아무런 일도 하지 않고 쉬다가 스크립트나 핸들러, 이벤트가 활성화될 때만 돌아간다.</p>
<p>자바스크립트 엔진을 활성화하는 task는 다음과 같다.</p>
<ol>
<li>외부 스크립트 <code>&lt;script src=&quot;...&quot;&gt;</code>가 로드될 때, 이 스크립트를 실행하는 것</li>
<li>사용자가 마우스를 움직일 때 <code>mousemove</code> 이벤트와 이벤트 핸들러를 실행하는 것</li>
<li><code>setTimeout</code>에서 설정한 시간이 다 된 경우, 콜백 함수를 실행하는 것</li>
<li>기타 등등</li>
</ol>
<p>task는 하나의 집합을 이룬다. 자바스크립트 엔진은 해당 task를 차례대로 처리하며 새로운 task가 추가될 때까지 기다린다. task를 기다리는 동안 CPU 자원 소비는 0에 가까워지고 엔진은 잠들게 된다.</p>
<p>엔진이 바쁠 때 task가 추가되면 해당 task는 <strong>Macrotask queue</strong>에 추가된다.</p>
<blockquote>
<p>참고로 <code>task queue</code>의 구조는 <code>queue</code>가 아닌 <code>set</code>이다. 선택된 큐에서 실행 가능한 가장 오래된 task를 가져와야 하기 때문이다.
무조건 먼저 들어온 첫번째 큐를 <code>dequeue</code>하는 것이 아니라 실행 가능한 것들 중에 가장 오래된 task를 차례대로 실행시킨다.</p>
<p><a href="https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3">https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3</a></p>
</blockquote>
<p><img src="/images/2024-11-10/Pasted%20image%2020241108212123.png" alt=""/></p>
<p>(<code>script</code>를 처리하는데 중간에 <code>mousemove</code> 핸들러도 실행되고 <code>setTimeout</code>에서 설정한 시간이 지나서 콜백이 들어온 경우의 상태를 그림으로 나타냄)</p>
<p>JavaScript 엔진은 이들을 차례대로 처리한다.</p>
<p>이때 알아야 할 두가지는</p>
<ol>
<li>엔진이 task를 처리하는 동안은 렌더링이 일어나지 않는다. 처리를 완료하면 DOM 변경을 화면에 반영한다.</li>
<li>task에 긴 시간이 걸리면 task를 처리하는 동안 발생한 새로운 task를 처리하지 못한다. ( 응답 없는 페이지라는 alert 창은 페이지 전체와 함께 현재 task를 최소시킬지 말지를 선택하게 한다. )</li>
</ol>
<h3 id="5"><mark style="background:#FFF3A3A6">예시 1: CPU 소모가 많은 task 쪼개기</mark></h3>
<p>CPU 소모가 아주 많은 task 하나가 있다고 가정해보자.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;

<span class="hljs-keyword">let</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">count</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// CPU 소모가 많은 무거운 작업을 수행</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1e9</span>; j++) {
    i++;
  }

  <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;처리에 걸린 시간: &quot;</span> + (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start) + <span class="hljs-string">&quot;ms&quot;</span>);
}

<span class="hljs-title function_">count</span>();
</code></pre>
<p>1e9 (0이 9개)을 센 다음 alert를 하는 코드인데 해당 count()가 실행되는 동안 브라우저는 사용자 이벤트 처리나 DOM 관련 작업을 완전히 멈추게 되는 것을 확인할 수 있다.
( 실행시키고 페이지에 마우스 우클릭을 하면 alert가 나올때까지 아무것도 안 보이다가 alert가 나오고 마우스 우클릭시 나오는 메뉴가 나온다. )</p>
<p>코드를 쪼개서 이를 개선해보자.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;

<span class="hljs-keyword">let</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">count</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// 무거운 작업을 쪼갠 후 이를 수행 (*)</span>
  <span class="hljs-keyword">do</span> {
    i++;
    <span class="hljs-comment">// 2* 1e6, 3* 1e6 등 1e6의 배수에서 do while 문을 나가게 된다.</span>
  } <span class="hljs-keyword">while</span> (i % <span class="hljs-number">1e6</span> != <span class="hljs-number">0</span>);

  <span class="hljs-keyword">if</span> (i == <span class="hljs-number">1e9</span>) {
    <span class="hljs-comment">// 위의 do while문을 1e3번 반복하면 도착</span>
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;처리에 걸린 시간: &quot;</span> + (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start) + <span class="hljs-string">&quot;ms&quot;</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 1e6의 배수이지만 1e9가 아닐 경우</span>
    <span class="hljs-built_in">setTimeout</span>(count); <span class="hljs-comment">// 새로운 호출을 스케줄링 (**)</span>
  }
}

<span class="hljs-title function_">count</span>();
</code></pre>
<p>do while문을 1e3번 반복해서 alert가 나오게 되는데 그 이전까지 setTimeout으로 count를 넘기기 때문에 동기적인 코드들은 돌아갈 수 있게 되고 이 때문에 이벤트 핸들러, DOM 관련 동작 들을 해결할 수 있게 된다.</p>
<p>위 코드는 사실 조금의 시간차가 존재한다. 다음처럼 setTimeout을 앞으로 끌어오면 이를 해결할 수 있다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;

<span class="hljs-keyword">let</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">count</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// 스케줄링 코드를 함수 앞부분으로 옮김</span>
  <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">1e9</span> - <span class="hljs-number">1e6</span>) {
    <span class="hljs-built_in">setTimeout</span>(count); <span class="hljs-comment">// 새로운 호출을 스케줄링함</span>
  }

  <span class="hljs-keyword">do</span> {
    i++;
  } <span class="hljs-keyword">while</span> (i % <span class="hljs-number">1e6</span> != <span class="hljs-number">0</span>);

  <span class="hljs-keyword">if</span> (i == <span class="hljs-number">1e9</span>) {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;처리에 걸린 시간: &quot;</span> + (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start) + <span class="hljs-string">&quot;ms&quot;</span>);
  }
}

<span class="hljs-title function_">count</span>();
</code></pre>
<p>부분 카운팅 (<code>do...while</code>)이 일어나기 전에 부분 재스케줄링(<code>setTimeout</code>)이 일어나게 된다.</p>
<p>setTimeout 호출이 많은 경우, 브라우저 최소 대기 시간이 4밀리초이기 때문에 숫자 세기 전에 스케줄링을 하면 숫자를 세면서 대기 시간을 소모하기 때문에 실행이 더 빨라진다.
(setTimeout 로직이 뒤쪽에 있으면 setTimeout(count) 실행되고 바로 다음 macrotask로 count 함수가 실행돼야 되는데 안 가고 4ms 있다가 실행된다는 뜻)</p>
<h3 id="6"><mark style="background:#FFF3A3A6">예시 2: Progress bar</mark></h3>
<p>task를 여러 개로 쪼갤 때의 장점은 진행 상태를 나타내주는 <code>progress bar</code>를 만들 때도 드러난다.</p>
<pre><code class="hljs language-js">&lt;div id=<span class="hljs-string">&quot;progress&quot;</span>&gt;&lt;/div&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">count</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e6</span>; i++) {
      i++;
      progress.<span class="hljs-property">innerHTML</span> = i;
    }
  }

  <span class="hljs-title function_">count</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>브라우저는 시간이 오래 걸리든 아니든 상관 없이 현재 작업 중인 task가 끝나야 DOM 변경분을 화면에 렌더링한다.</p>
<p>그래서 위의 코드는 <code>progress bar</code>의 기능을 완수하지 못한다. i가 전부 지나가야(현재 작업 중인 task가 끝나야) DOM을 렌더링하기 때문이다.</p>
<pre><code class="hljs language-js">&lt;div id=<span class="hljs-string">&quot;progress&quot;</span>&gt;&lt;/div&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">count</span>(<span class="hljs-params"></span>) {

    <span class="hljs-comment">// 무거운 작업을 쪼갠 후 이를 수행</span>
    <span class="hljs-keyword">do</span> {
      i++;
      progress.<span class="hljs-property">innerHTML</span> = i;
    } <span class="hljs-keyword">while</span> (i % <span class="hljs-number">1e3</span> != <span class="hljs-number">0</span>);

    <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">1e7</span>) {
      <span class="hljs-built_in">setTimeout</span>(count);
    }

  }

  <span class="hljs-title function_">count</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>위처럼 코드를 분할하게 되면 i가 변화하는 과정을 출력해 줄 수 있다, <code>setTimeout</code>으로 <code>count</code>를 넘기기 때문에 count와 count 함수 사이에서 동기적인 동작들을 수행할 수 있게 되고 결론적으로 <code>progress.innerHTML</code>이 변경되었다는 DOM 변경 동작이 일어나게 된다.</p>
<h3 id="7"><mark style="background:#FFF3A3A6">예시 3: 이벤트 처리가 끝난 이후에 작업</mark></h3>
<p>이벤트 핸들러를 만들 때 특정 액션을 모든 이벤트 버블링이 끝나고 실행시키고 싶다면 <code>ms</code>가 0인 <code>setTimeout</code>을 사용하면 된다.</p>
<pre><code class="hljs language-js">menu.<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  <span class="hljs-comment">// ...</span>

  <span class="hljs-comment">// 클릭한 메뉴 내 항목 정보가 담긴 커스텀 이벤트 생성</span>
  <span class="hljs-keyword">let</span> customEvent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">&quot;menu-open&quot;</span>, {
    <span class="hljs-attr">bubbles</span>: <span class="hljs-literal">true</span>,
  });

  <span class="hljs-comment">// 비동기로 커스텀 이벤트를 디스패칭</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> menu.<span class="hljs-title function_">dispatchEvent</span>(customEvent));
};
</code></pre>
<p>위를 살펴보면 &quot;menu-open&quot; 이라는 커스텀 이벤트를 만든 후 해당 이벤트를 setTimeout으로 넘겼다.</p>
<p>이제 menu의 click 이벤트가 완전히 핸들링된 후에 <code>menu-open</code> 이벤트를 dispatching하게 된다.</p>
<h2 id="8"><mark style="background:#FFB86CA6">Macrotask와 Microtask</mark></h2>
<h3 id="9"><mark style="background:#FFF3A3A6">Microtask</mark></h3>
<p><code>Microtask</code>는 주로 <code>Promise</code>를 사용해 만든다.</p>
<p><code>Promise</code>와 함께 쓰이는 <code>.then/catch/finally</code>의 핸들러 (소비 함수)가 <code>Microtask</code>가 된다. 또는 <code>Promise</code>를 핸들링하는 <code>await</code>를 사용해 만들기도 한다.</p>
<blockquote>
<p>이 외에도 표준 API인 <code>queueMicrotask(func)</code>를 사용해서 함수 <code>func</code>를 <code>Microtask Queue</code>에 넣어서 처리할 수 있다.</p>
</blockquote>
<blockquote>
<p>자바스크립트 엔진은 <strong>Macrotask</strong>를 하나 처리할 때마다 js 엔진은 다른 <code>Macrotask</code>를 수행하거나 렌더링하는 등의 작업을 하기 전에 <strong>Microtask Queue</strong>에 있는 모든 task를 실행한다.</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;timeout&quot;</span>));

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;promise&quot;</span>));

<span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;code&quot;</span>);

<span class="hljs-comment">// (현재 호출 스택에서 script 태그에 있는 코드를 읽는 Macrotask중이며 코드를 한 줄씩 넣으면서 실행 중에 있음)</span>
<span class="hljs-comment">// 1. setTimeout(()=&gt;alert(&quot;timeout&quot;)) - 호출 스택에서 실행, ms가 지나면 콜백 함수를 Macrotask queue에 등록</span>
<span class="hljs-comment">// 2. Promise.resolve().then(()=&gt;alert(&quot;promise&quot;)) - 콜백 함수를 Microtask Queue에 등록</span>
<span class="hljs-comment">// 3. alert(&quot;code&quot;) - 바로 호출된다. (현재 script 태그를 읽는 Macrotask를 수행 중이다.)</span>
<span class="hljs-comment">// 4. script 태그에 있는 코드를 읽는 Macrotask 종료</span>
<span class="hljs-comment">// 5. Microtask queue에 있는 then() 콜백 함수 실행 (호출 스택으로 이동해서 실행, 이 과정에서 이벤트 루프는 다 비워질 때까지 안 돌아감)</span>
<span class="hljs-comment">// 6. Microtask queue 비워짐</span>
<span class="hljs-comment">// 7. ()=&gt;alert(&quot;timeout&quot;) - 다음 Macrotask 실행 (호출 스택에서 Macrotask 하나 이동)</span>
<span class="hljs-comment">// (해당 Macrotask가 끝나면 다시 Microtask 실행해서 Microtask queue 비우고 렌더링 &gt; 다음 Macrotask 실행 반복)</span>
</code></pre>
<h3 id="10"><mark style="background:#FFF3A3A6">처리 로직</mark></h3>
<p><img src="/images/2024-11-10/Pasted%20image%2020241109193930.png" alt=""/></p>
<p><code>Macrotask (script, mousemove, setTimeout 등)</code> 하나가 처리되고 난 후 <code>Microtask</code> 전부가 처리되고 그 이후 렌더링이 진행되는 것을 확인할 수 있다.</p>
<p><strong>Microtask는 다른 이벤트 핸들러나 렌더링 작업, 혹은 다른 Macrotask가 실행되기 전에 전부 처리된다.</strong></p>
<p>script 태그에 있는 코드를 읽는 작업도 <code>Macrotask</code>이기 때문에 script 코드를 한 줄씩 호출 스택에 담고 실행하는 과정이 끝난 후에 Microtask들을 실행한다.</p>
<p>이런 처리순서가 아주 중요한 이유는 마우스 좌표 변경이나 네트워크 통신에 의한 데이터 변경같이 애플리케이션 환경에 변화를 주는 작업에 영향을 받지 않고 모든 <code>Microtask</code>를 동일한 환경에서 처리할 수 있기 때문이다.</p>
<p>&quot;현재 실행 중인 macrotask 실행이 끝나면 &gt; 현재 존재하는 모든 microtask 실행 &gt; 렌더링 &gt; 다음 macrotask 실행&quot; 의 순서를 가진다.</p>
<p>위 과정을 확인하기 위해서 리페인트 전에 콜백 함수를 호출하는 <strong>requestAnimationFrame</strong>으로 확인해보자.</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241109221737.png" alt=""/></p>
<blockquote>
<p><strong>requestAnimationFrame</strong></p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241109214448.png" alt=""/></p>
<p>브라우저 리페인트 전에 애니메이션 처리를 하기 위해 사용하는 윈도우 메소드,</p>
<p>별도의 큐에서 관리되어 프레임 단위로 렌더링할 수 있도록 보장한다. ( 초당 프레임 기준은 모니터 주사율에 의해 설정된다. )</p>
<p>프레임 단위의 렌더링을 보장하기 때문에 애니메이션 동작이 더 부드러워진다.</p>
</blockquote>
<p>만약 임의로 특정 함수를 <code>Microtask Queue</code>로 보내고 싶다면 <code>queueMicrotask</code> 함수를 사용하면 된다.
( <code>setTimeout</code>과 다른 점은 만약 <code>ms</code>가 0초인 <code>setTimeout</code>을 이용할 때는 <code>Macrotask queue</code>로 보내져서 기존의 <code>Microtask Queue</code>가 다 끝나고 다음 <code>Macrotask</code>가 실행될 때 특정 함수가 실행될 것이다.)</p>
<pre><code class="hljs language-js">&lt;div id=<span class="hljs-string">&quot;progress&quot;</span>&gt;&lt;/div&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">count</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// 무거운 작업을 쪼갠 후 이를 수행</span>
    <span class="hljs-keyword">do</span> {
      i++;
      progress.<span class="hljs-property">innerHTML</span> = i;
    } <span class="hljs-keyword">while</span> (i % <span class="hljs-number">1e3</span> != <span class="hljs-number">0</span>);

    <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">1e6</span>) {
      <span class="hljs-title function_">queueMicrotask</span>(count);
    }
  }

  <span class="hljs-title function_">count</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>렌더링이 되기 전에 Microtask Queue에 있는 count 함수가 재귀 호출을 하며 Microtask Queue에 새로운 count 함수를 추가하는 방식이므로 실제 화면에는 최종값만 보이게 된다. ( microtask queue가 비워져야 브라우저 렌더링이 일어남. )</p>
<p>다음 예제를 통해 확실히 알아가보자.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// sync, macro, micro 원소 안에 숫자가 있고 button으로 이들을 제어한다고 가정.</span>
button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">100000</span>; i++) {
    sync.<span class="hljs-property">innerHTML</span> = i;

    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      macro.<span class="hljs-property">innerHTML</span> = i;
    }, <span class="hljs-number">0</span>);

    <span class="hljs-title function_">queueMicrotask</span>(<span class="hljs-function">() =&gt;</span> {
      micro.<span class="hljs-property">innerHTML</span> = i;
    });
  }
});
</code></pre>
<p>위 핸들러를 실행시키면 다음의 결과가 나온다.</p>
<ol>
<li><code>sync</code>는 렌더링이 일어나지 않다가 100,000 상태가 된다.</li>
<li><code>micro</code>는 렌더링이 일어나지 않다가 100,000 상태가 된다.</li>
<li><code>macro</code>는 잠시 기다리다가 1부터 100,000까지 차례대로 렌더링된다.</li>
</ol>
<p><img src="/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_1.jpg" alt=""/></p>
<p>이때 차례대로 실행되는 코드들(<code>sync.innerHTML = i</code>, <code>setTimeout</code>, <code>queryMicrotask</code>) 이 실행되고 있을 때는 브라우저에서 다른 동작을 할 수 없다. ( 콜 스택에 있는거 다 버리고 동작을 진행할 수는 없으니 )</p>
<blockquote>
<p><code>setTimeout</code>의 타이밍 함수 (시간을 새서 콜백을 던져주는 함수)같은 WEB API는 <code>Macrotask queue</code>가 할당되는 외부 쓰레드에서 진행된다. 작업을 할당해 처리하는 것은 브라우저나 Node.js의 역할이다.</p>
</blockquote>
<p><img src="/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_2.jpg" alt=""/>
<img src="/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_3.jpg" alt=""/></p>
<p>단, 만약 중간에 다른 <code>Macrotask</code>(마우스 이벤트 등등)가 <code>Macrotask queue</code>로 들어와서 먼저 실행 가능 상태가 된다면 <code>queue</code>에서는 해당 <code>Macrotask</code>를 처리할 것이다.</p>
<p>이제 &quot;왜&quot; 사용하는지 알게 되었으니 비동기 작업을 &quot;어떻게&quot; 사용하는지, 그 흐름을 더 자세히 알아보자.</p>
<h1 id="11"><mark style="background:#FF5582A6">비동기 작업의 역사와 개념</mark></h1>
<h2 id="12"><mark style="background:#FFB86CA6">콜백</mark></h2>
<p>호스트 환경이 제공하는 함수를 사용하면 비동기 동작을 스케줄링할 수 있다. ( <code>setTimeout</code> 같은 함수)</p>
<p>스크립트나 모듈을 로드하는 함수도 비동기라고 할 수 있는데 이를 예시로 살펴보자.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-params">src</span>) {
  <span class="hljs-comment">// &lt;script&gt; 태그를 만들고 페이지에 태그를 추가한다.</span>
  <span class="hljs-comment">// 태그가 페이지에 추가되면 src에 있는 스크립트를 로딩하고 실행한다.</span>
  <span class="hljs-keyword">let</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);
  script.<span class="hljs-property">src</span> = src;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">append</span>(script);
}

<span class="hljs-comment">// 해당 경로에 있는 스크립트를 불러오고 실행한다.</span>
<span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/my/script.js&quot;</span>);
<span class="hljs-comment">// ...</span>
</code></pre>
<p>이때 스크립트는 비동기적으로 실행된다.</p>
<p>따라서 loadScript 아래 코드들은 loadScript가 끝나는 것을 기다리지 않는다.</p>
<pre><code class="hljs language-js"><span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/my/script.js&quot;</span>); <span class="hljs-comment">// script.js엔 &quot;function newFunction() {…}&quot;이 있다.</span>

<span class="hljs-comment">// script.js에 있는 newFunction을 사용하려고 하는데</span>
<span class="hljs-comment">// 함수가 존재하지 않는다는 에러가 발생한다!</span>
<span class="hljs-title function_">newFunction</span>();
</code></pre>
<p>여기에 콜백을 추가해보자.</p>
<blockquote>
<p><strong>콜백 함수</strong></p>
<p>주로 함수 안에 전달인자로 다른 함수에 전달되는 함수를 의미한다. 일종의 루틴이나 동작을 완료하기 위해 외부 함수 내부에서 호출된다.</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-params">src, callback</span>) {
  <span class="hljs-keyword">let</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;script&#x27;</span>);
  script.<span class="hljs-property">src</span> = src;

  <span class="hljs-comment">// script가 load 이벤트를 일으키면 (load 되면) callback에 script를 담아서 실행시킨다.</span>
  script.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">callback</span>(script);

  <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">append</span>(script);
}

<span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&#x27;/my/script.js&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// 콜백 함수는 스크립트 로드가 끝나면 실행됩니다.</span>
  <span class="hljs-title function_">newFunction</span>(); <span class="hljs-comment">// 이제 함수 호출이 제대로 동작합니다.</span>
  ...
});
</code></pre>
<p>위의 방식을 콜백 기반 비동기 프로그래밍이라고 한다.</p>
<p>loadScript에 콜백 함수를 전해줘서 newFunction이 비동기 실행과 나란히 일어날 수 있게 해준다.</p>
<h3 id="13"><mark style="background:#FFF3A3A6">에러 핸들링</mark></h3>
<p>스크립트 로딩이 실패하는 경우 발생하는 에러를 핸들링할 수 있어야 한다.</p>
<p>다음과 같이 개선해보자.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-params">src, callback</span>) {
  <span class="hljs-keyword">let</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);
  script.<span class="hljs-property">src</span> = src;

  <span class="hljs-comment">// 성공 시 null과 script를 인수에 넣고</span>
  script.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, script);
  <span class="hljs-comment">// 실패 시 에러 객체를 인수에 넣는다.</span>
  script.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span>
    <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${src}</span>를 불러오는 도중에 에러가 발생했습니다.`</span>));

  <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">append</span>(script);
}

<span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/my/script.js&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">error, script</span>) {
  <span class="hljs-keyword">if</span> (error) {
    <span class="hljs-comment">// 에러 처리</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 스크립트 로딩이 성공적으로 끝남</span>
  }
});
</code></pre>
<p>위 패턴은 <strong>오류 우선 콜백</strong>으로 에러를 처리하기 위해 사용되는 흔한 패턴이다.</p>
<ol>
<li>callback의 첫 번째 인수는 에러를 위해 남겨둔다.</li>
<li>두 번째 혹은 그 이상의 인수들은 에러가 발생하지 않았을 때 콜백 함수에 넘겨줄 인수들이다.</li>
</ol>
<h3 id="14"><mark style="background:#FFF3A3A6">콜백 속 콜백</mark></h3>
<p>만약 두 개의 스크립트를 차례대로 불러오려 한다면 콜백 안에 콜백을 넣어야 한다.</p>
<pre><code class="hljs language-js"><span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/my/script.js&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">script</span>) {
  <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/my/script2.js&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">script</span>) {
    <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/my/script3.js&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">script</span>) {
      <span class="hljs-comment">// 세 스크립트 로딩이 끝난 후 실행됨</span>
    });
  });
});
</code></pre>
<h4 id="15"><mark style="background:#BBFABBA6">콜백 지옥</mark></h4>
<p><img src="/images/2024-11-10/Pasted%20image%2020241107193715.png" alt=""/></p>
<p>위 방식은 멸망의 피라미드, 콜백 지옥이라 부르는 상황을 만든다.
(코드가 오른쪽으로 점점 옮겨지면서 가독성도 해치고 코드 재사용이 어려운 상황)</p>
<p>이를 해결하기 위해서 논리적으로 다음과 같이 짤 수는 있는데</p>
<pre><code class="hljs language-js"><span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;1.js&quot;</span>, step1);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">step1</span>(<span class="hljs-params">error, script</span>) {
  <span class="hljs-keyword">if</span> (error) {
    <span class="hljs-title function_">handleError</span>(error);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;2.js&quot;</span>, step2);
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">step2</span>(<span class="hljs-params">error, script</span>) {
  <span class="hljs-keyword">if</span> (error) {
    <span class="hljs-title function_">handleError</span>(error);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;3.js&quot;</span>, step3);
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">step3</span>(<span class="hljs-params">error, script</span>) {
  <span class="hljs-keyword">if</span> (error) {
    <span class="hljs-title function_">handleError</span>(error);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 모든 스크립트가 로딩되면 다른 동작을 수행한다.</span>
  }
}
</code></pre>
<p>이는 모양만 개선되었지 내부 로직은 결국 위아래 옮겨 다니면서 파악해야 하고 재사용이 어려운 문제를 그대로 갖고 있다.</p>
<h3 id="16"><mark style="background:#FFF3A3A6">무조건 콜백을 사용하면 안될까?</mark></h3>
<p>아니다.</p>
<p>특정 동작이 끝나는 것이 보장되고 그다음 코드를 실행해야 할 때 사용하면 여전히 유용하다.</p>
<pre><code class="hljs language-js"><span class="hljs-title function_">showCircle</span>(<span class="hljs-number">150</span>, <span class="hljs-number">150</span>, <span class="hljs-number">100</span>, <span class="hljs-function">(<span class="hljs-params">div</span>) =&gt;</span> {
  div.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&quot;message-ball&quot;</span>);
  div.<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;안녕하세요!&quot;</span>);
});
</code></pre>
<p>showCircle(cx, cy, radius, callback)은 천천히 커지는 원을 만드는 함수라고 치자.</p>
<p>함수 내부에서 해당 callback을 이용해서 원을 다 만든 후에 요소에 &quot;안녕하세요!&quot;를 그리는 함수를 실행하도록 할 수 있다.</p>
<blockquote>
<p>콜백을 활용하면 해당 task를 Microtask Queue가 아니라 Macrotask queue로 task를 이동시킨다. ( <code>setTimeout</code>의 동작 방식 )
Microtask Queue와 Macrotask queue의 차이는 이 글의 하단 부분에서 이해할 수 있다.</p>
</blockquote>
<h2 id="17"><mark style="background:#FFB86CA6">Promise</mark></h2>
<p>시간이 얼마나 걸리던 상관없이 약속한 결과를 만들어내는 &quot;제작 코드&quot;가 준비되었을 때, 모든 &quot;소비 코드&quot;가 결과를 사용할 수 있도록 해준다.</p>
<blockquote>
<p><strong>제작 코드</strong></p>
<p>원격에서 스크립트를 불러오는 것 같은 시간이 걸리는 일</p>
</blockquote>
<blockquote>
<p><strong>소비 코드</strong></p>
<p>제작 코드의 결과를 기다렸다가 이를 소비한다. 소비의 주체(함수)는 여럿이 될 수 있다.</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
  <span class="hljs-comment">// executor (제작 코드, &#x27;가수&#x27;)</span>
});

<span class="hljs-comment">// promise.then/catch/finally 등등</span>
</code></pre>
<h3 id="18"><mark style="background:#FFF3A3A6">executor 함수</mark></h3>
<p><code>new Promise</code>에 전달되는 콜백은 executor라고 해서 <code>new Promise</code>가 만들어질 때 자동으로 실행되며 결과를 최종적으로 만들어내는 제작 코드를 포함한다.</p>
<p>executor에서는 resolve, reject를 신경 쓰지 않고 코드를 작성하면 되는데 상황에 따라 resolve, reject 중 하나를 호출해야 한다.</p>
<ol>
<li>resolve(value) - 일이 성공적으로 끝났을 때 그 결과를 나타내는 value와 함께 호출</li>
<li>reject(error) - 에러 발생 시 에러 객체를 나타내는 <code>error</code>와 함께 호출</li>
</ol>
<p><img src="/images/2024-11-10/Pasted%20image%2020241107200211.png" alt=""/></p>
<p>new Promise 생성자가 반환하는 promise 객체는 PromiseState, PromiseResult라는 내부 프로퍼티를 가진다.</p>
<p>resolve, reject 둘 다 일어나지 않았을 때</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241107195926.png" alt=""/></p>
<p>resolve일 때</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241107195831.png" alt=""/></p>
<p>reject일 때</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241107200104.png" alt=""/></p>
<h4 id="19"><mark style="background:#BBFABBA6">executor 예시</mark></h4>
<ol>
<li>executor는 <code>new Promise</code>에 의해 자동으로 그리고 즉각적으로 호출된다.</li>
<li>executor는 인자로 <code>resolve</code>와 <code>reject</code> 함수를 받는다. 이 함수들은 자바스크립트 엔진이 미리 정의한 함수이므로 개발자가 따로 만들 필요가 없다. 다만, <code>resolve</code>나 <code>reject</code> 중 하나는 반드시 호출해야 합니다.</li>
</ol>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
  <span class="hljs-comment">// Promise가 만들어지면 executor 함수는 자동으로 실행된다.</span>

  <span class="hljs-comment">// 1초 뒤에 일이 성공적으로 끝났다는 신호가 전달되면서 result는 &#x27;완료&#x27;가 된다.</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;완료&quot;</span>), <span class="hljs-number">1000</span>);
});
</code></pre>
<p><img src="/images/2024-11-10/Pasted%20image%2020241107200545.png" alt=""/></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
  <span class="hljs-comment">// 1초 뒤에 에러와 함께 실행이 종료되었다는 신호를 보냅니다.</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>)), <span class="hljs-number">1000</span>);
});
</code></pre>
<p><img src="/images/2024-11-10/Pasted%20image%2020241107200740.png" alt=""/></p>
<p><code>resolve</code>나 <code>reject</code>가 완료된 <code>Promise</code>를 <code>settled Promise</code> 라고 부른다.</p>
<h3 id="20"><mark style="background:#FFF3A3A6">주의사항</mark></h3>
<h4 id="21"><mark style="background:#BBFABBA6">1. 한번 처리된 Promise는 바뀌지 않는다.</mark></h4>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
  <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;완료&quot;</span>);

  <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;…&quot;</span>)); <span class="hljs-comment">// 무시됨</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;…&quot;</span>)); <span class="hljs-comment">// 무시됨</span>
});
</code></pre>
<h4 id="22"><mark style="background:#BBFABBA6">2. Error 객체와 함께 reject해야 한다.</mark></h4>
<h4 id="23"><mark style="background:#BBFABBA6">3. 꼭 Promise가 비동기적인 것을 다루지 않아도 된다.</mark></h4>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
  <span class="hljs-comment">// 일을 끝마치는 데 시간이 들지 않음</span>
  <span class="hljs-title function_">resolve</span>(<span class="hljs-number">123</span>); <span class="hljs-comment">// 결과(123)를 즉시 resolve에 전달함</span>
});
</code></pre>
<p>위 방식대로 하면 즉시 이행 상태가 된다.</p>
<h4 id="24"><mark style="background:#BBFABBA6">4. PromiseState와 PromiseResult는 내부 프로퍼티이기 때문에 직접 접근할 수 있다.</mark></h4>
<h3 id="25"><mark style="background:#FFF3A3A6">소비함수</mark></h3>
<p>소비 함수는 <code>.then</code>, <code>.catch</code>, <code>.finally</code> 메서드를 사용해 등록된다.</p>
<h4 id="26"><mark style="background:#BBFABBA6">.then</mark></h4>
<p>Promise fulfilled 혹은 rejected가 완료되면 이후에 실행되는 소비함수</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;완료!&quot;</span>), <span class="hljs-number">1000</span>);
});

<span class="hljs-comment">// resolve 함수는 .then의 첫 번째 함수(인수)를 실행합니다.</span>
promise.<span class="hljs-title function_">then</span>(
  <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(result), <span class="hljs-comment">// 1초 후 &quot;완료!&quot;를 출력</span>
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(error), <span class="hljs-comment">// 실행되지 않음</span>
);
</code></pre>
<p>성공 처리만 하고 싶다면 두번째 인수를 생략하면 된다.</p>
<h4 id="27"><mark style="background:#BBFABBA6">.catch</mark></h4>
<p><code>.then(null, 에러처리함수)</code> 형태로 에러만을 처리해도 되지만 <code>.catch</code>를 활용해서 간결하게 표현할 수 있다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>)), <span class="hljs-number">1000</span>);
});

<span class="hljs-comment">// .catch(f)는 promise.then(null, f)과 동일하게 작동합니다</span>
promise.<span class="hljs-title function_">catch</span>(alert); <span class="hljs-comment">// 1초 뒤 &quot;Error: 에러 발생!&quot; 출력</span>
</code></pre>
<h4 id="28"><mark style="background:#BBFABBA6">.finally</mark></h4>
<p>Promise가 처리되면 항상 실행되는 메소드</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-comment">/* 시간이 걸리는 어떤 일을 수행하고, 그 후 resolve, reject를 호출함 */</span>
})
  <span class="hljs-comment">// 성공·실패 여부와 상관없이 Promise가 처리되면 실행됨</span>
  .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> 로딩 인디케이터 중지)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-title function_">alert</span>(result), <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-title function_">alert</span>(error));
</code></pre>
<p>finally는 인수가 없으며 자동으로 다음 핸들러에 결과 혹은 에러를 전달한다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;결과&quot;</span>), <span class="hljs-number">2000</span>);
})
  .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Promise가 준비되었습니다.&quot;</span>))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(result)); <span class="hljs-comment">// &lt;-- .then에서 result를 다룰 수 있음</span>

<span class="hljs-comment">// 2초 후</span>
<span class="hljs-comment">// &quot;Promise가 준비되었습니다.&quot;</span>
<span class="hljs-comment">// &quot;결과&quot;</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>);
})
  .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Promise가 준비되었습니다.&quot;</span>))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(err)); <span class="hljs-comment">// &lt;-- .catch에서 에러 객체를 다룰 수 있음</span>

<span class="hljs-comment">// &quot;Promise가 준비되었습니다.&quot;</span>
<span class="hljs-comment">// &quot;에러 발생&quot;</span>
</code></pre>
<h4 id="29"><mark style="background:#BBFABBA6">실제 사용 예시</mark></h4>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-params">src, callback</span>) {
  <span class="hljs-keyword">let</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);
  script.<span class="hljs-property">src</span> = src;

  script.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, script);
  script.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span>
    <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${src}</span>를 불러오는 도중에 에러가 발생함`</span>));

  <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">append</span>(script);
}
</code></pre>
<p>위 코드는 콜백 방식이다. onload와 onerror 안에 직접 callback을 박아 넣어서 구현했다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-params">src</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
    <span class="hljs-keyword">let</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);
    script.<span class="hljs-property">src</span> = src;

    script.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(script);
    script.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span>
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${src}</span>를 불러오는 도중에 에러가 발생함`</span>));

    <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">append</span>(script);
  });
}
</code></pre>
<p>Promise를 사용하면 callback 로직을 밖으로 뺄 수 있다. 안으로 넘겨주는 인자만 받을 수 있으며 다음과 같이 사용할 수 있다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-title function_">loadScript</span>(
  <span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.js&quot;</span>,
);

promise.<span class="hljs-title function_">then</span>(
  <span class="hljs-function">(<span class="hljs-params">script</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">`<span class="hljs-subst">${script.src}</span>을 불러왔습니다!`</span>),
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">`Error: <span class="hljs-subst">${error.message}</span>`</span>),
);

promise.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">script</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;또 다른 핸들러...&quot;</span>));
</code></pre>
<p>이제 then, catch, finally 메소드를 활용해서 소비 함수만 던져주면 저장된 promise에서 알아서 소비 함수 안에 인자를 넣어서 실행시킨다.</p>
<h3 id="30"><mark style="background:#FFF3A3A6">Promise Chaining</mark></h3>
<p><img src="/images/2024-11-10/Pasted%20image%2020241107204412.png" alt=""/></p>
<p>Promise를 연결해서 비동기 작업을 차례대로 처리하는 방법</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>), <span class="hljs-number">1000</span>); <span class="hljs-comment">// (*)</span>
})
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) {
    <span class="hljs-comment">// (**)</span>

    <span class="hljs-title function_">alert</span>(result); <span class="hljs-comment">// 1</span>

    <span class="hljs-keyword">return</span> result * <span class="hljs-number">2</span>;
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) {
    <span class="hljs-comment">// (***)</span>

    <span class="hljs-title function_">alert</span>(result); <span class="hljs-comment">// 2</span>

    <span class="hljs-keyword">return</span> result * <span class="hljs-number">2</span>;
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) {
    <span class="hljs-title function_">alert</span>(result); <span class="hljs-comment">// 4</span>

    <span class="hljs-keyword">return</span> result * <span class="hljs-number">2</span>;
  });
</code></pre>
<p>위의 코드가 가능한 이유는 <code>.then</code>이 Promise를 반환하기 때문이다. <code>.then</code>의 리턴값이 해당 Promise의 <code>result</code>가 된다.</p>
<h4 id="31"><mark style="background:#BBFABBA6">또 다른 Promise를 소비 함수 안에서 반환하기</mark></h4>
<p>기본적으로 <code>.then</code>이 리턴할 값을 <code>Promise</code>로 만들어서 리턴하지만 <code>.then</code>에서 <code>Promise</code>를 만들어서 리턴시킬 수도 있다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>), <span class="hljs-number">1000</span>);
})
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) {
    <span class="hljs-title function_">alert</span>(result); <span class="hljs-comment">// 1</span>

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-comment">// (*)</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(result * <span class="hljs-number">2</span>), <span class="hljs-number">1000</span>);
    });
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) {
    <span class="hljs-comment">// (**)</span>

    <span class="hljs-title function_">alert</span>(result); <span class="hljs-comment">// 2</span>

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(result * <span class="hljs-number">2</span>), <span class="hljs-number">1000</span>);
    });
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) {
    <span class="hljs-title function_">alert</span>(result); <span class="hljs-comment">// 4</span>
  });
</code></pre>
<h4 id="32"><mark style="background:#BBFABBA6">실제 예시</mark></h4>
<pre><code class="hljs language-js"><span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/article/promise-chaining/one.js&quot;</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">script</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/article/promise-chaining/two.js&quot;</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">script</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/article/promise-chaining/three.js&quot;</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">script</span>) {
    <span class="hljs-comment">// 불러온 스크립트 안에 정의된 함수를 호출해</span>
    <span class="hljs-comment">// 실제로 스크립트들이 정상적으로 로드되었는지 확인한다.</span>
    <span class="hljs-title function_">one</span>();
    <span class="hljs-title function_">two</span>();
    <span class="hljs-title function_">three</span>();
  });
</code></pre>
<p>이제 loadScript를 개선할 수 있다.</p>
<p>Promise의 executor는 즉시 실행되고 다음 메소드로 연결된 소비 함수가 실행되기 때문에 위의 Promise를 리턴하는 함수 loadScript에 바로 메소드를 연결해줘도 된다.</p>
<pre><code class="hljs language-js"><span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/article/promise-chaining/one.js&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">script1</span>) =&gt;</span> {
  <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/article/promise-chaining/two.js&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">script2</span>) =&gt;</span> {
    <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">&quot;/article/promise-chaining/three.js&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">script3</span>) =&gt;</span> {
      <span class="hljs-comment">// 여기서 script1, script2, script3에 정의된 함수를 사용할 수 있다.</span>
      <span class="hljs-title function_">one</span>();
      <span class="hljs-title function_">two</span>();
      <span class="hljs-title function_">three</span>();
    });
  });
});
</code></pre>
<p>하지만 이는 다른 콜백지옥을 만들게 된다.</p>
<p>이때 가장 내부에 있는 loadScript는 외부 스코프에 전부 접근할 수 있어서 필요에 의해선 위 코드처럼 사용하는 게 좋을 수도 있다.</p>
<h4 id="33"><mark style="background:#BBFABBA6">참고 사항</mark></h4>
<h5 id="34"><mark style="background:#ABF7F7A6">thenable</mark></h5>
<p>핸들러(executor, 소비함수 등등)는 Promise가 아닌 <code>thenable</code> 객체를 반환하기도 한다.</p>
<p>thenable 객체는 서드파티 라이브러리가 Promise와 호환 가능한 자체 객체를 구현할 수 있다는 점에서 나오게 되었다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Thenable</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">num</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span> = num;
  }
  <span class="hljs-title function_">then</span>(<span class="hljs-params">resolve, reject</span>) {
    <span class="hljs-title function_">alert</span>(resolve); <span class="hljs-comment">// 아래 코드에서 alert를 넣었으므로 function() { [native code] }이 바로 일단 나온다.</span>
    <span class="hljs-comment">// 1초 후 this.num*2와 함께 이행됨</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span> * <span class="hljs-number">2</span>), <span class="hljs-number">1000</span>); <span class="hljs-comment">// (**)</span>
  }
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thenable</span>(result); <span class="hljs-comment">// (*)</span>
  })
  .<span class="hljs-title function_">then</span>(alert); <span class="hljs-comment">// 1,000밀리 초 후 2를 보여줌</span>
</code></pre>
<p><img src="/images/2024-11-10/Pasted%20image%2020241110210716.png" alt=""/></p>
<h3 id="35"><mark style="background:#FFF3A3A6">fetch와 체이닝 함께 응용</mark></h3>
<p>프론트 단에서 네트워크 요청 시 <code>Promise</code>를 자주 사용한다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-title function_">fetch</span>(url);
</code></pre>
<p>위 코드를 실행하면 <code>url</code>에 네트워크 요청을 보내고 <code>Promise</code>를 반환한다.</p>
<p>fetch는 <code>resolve</code>시 <code>url</code>로 연결해서 얻은 자원을 핸들러로 넘겨준다.</p>
<pre><code class="hljs language-js"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/article/promise-chaining/user.json&quot;</span>)
  <span class="hljs-comment">// 원격 서버가 응답하면 .then 아래 코드가 실행됩니다.</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-comment">// response.text()는 응답 텍스트 전체가 다운로드되면</span>
    <span class="hljs-comment">// 응답 텍스트를 새로운 이행 Promise를 만들고, 이를 반환합니다.</span>
    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">text</span>();
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">text</span>) =&gt;</span> {
    <span class="hljs-comment">// 원격에서 받아온 파일의 내용</span>
    <span class="hljs-title function_">alert</span>(text); <span class="hljs-comment">// {&quot;name&quot;: &quot;Violet-Bora-Lee&quot;, &quot;isAdmin&quot;: true}</span>
  });
</code></pre>
<ol>
<li>원격 서버가 헤더와 함께 응답을 보내면 <code>Promise</code>는 <code>response</code> 객체와 함께 <code>fulfilled</code>된다.</li>
<li><code>response</code> 전체가 완전히 다운로드되기 전에 Promise는 <code>fulfilled</code>가 된다.</li>
<li><code>response</code>가 다 다운로드 되고 전체를 읽기 위해서는 <code>response.text()</code>를 호출해야 한다. ( <code>response.text()</code>는 서버에서 전송한 텍스트 전체가 다운로드되면 이 텍스트를 <code>result</code>값으로 갖는 <code>fulfilled</code>된 <code>Promise</code>를 반환한다. )</li>
</ol>
<p><code>response.json()</code>을 사용하면 데이터를 읽고 <code>JSON</code>으로 파싱할 수 있다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// 위 코드와 동일한 기능을 하지만, response.json()은 원격 서버에서 불러온 내용을 JSON으로 변경해줍니다.</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/article/promise-chaining/user.json&quot;</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(user.<span class="hljs-property">name</span>)); <span class="hljs-comment">// Violet-Bora-Lee, 이름만 성공적으로 가져옴</span>
</code></pre>
<p><code>fetch</code>를 순차적으로 보내는 예시를 확인해보자.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// user.json에 요청을 보냅니다.</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/article/promise-chaining/user.json&quot;</span>)
  <span class="hljs-comment">// 응답받은 내용을 json으로 불러옵니다.</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
  <span class="hljs-comment">// GitHub에 요청을 보냅니다.</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.github.com/users/<span class="hljs-subst">${user.name}</span>`</span>))
  <span class="hljs-comment">// 응답받은 내용을 json 형태로 불러옵니다.</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
  <span class="hljs-comment">// 3초간 아바타 이미지(githubUser.avatar_url)를 보여줍니다.</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">githubUser</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;img&quot;</span>);
    img.<span class="hljs-property">src</span> = githubUser.<span class="hljs-property">avatar_url</span>;
    img.<span class="hljs-property">className</span> = <span class="hljs-string">&quot;promise-avatar-example&quot;</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">append</span>(img);

    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> img.<span class="hljs-title function_">remove</span>(), <span class="hljs-number">3000</span>); <span class="hljs-comment">// (*)</span>
  });
</code></pre>
<p>만약 마지막 then에서 무언가를 더 하고 싶다면 <code>Promise</code>를 리턴해주면 된다.</p>
<pre><code class="hljs language-js"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/article/promise-chaining/user.json&quot;</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.github.com/users/<span class="hljs-subst">${user.name}</span>`</span>))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(
    <span class="hljs-function">(<span class="hljs-params">githubUser</span>) =&gt;</span>
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
        <span class="hljs-comment">// (*)</span>
        <span class="hljs-keyword">let</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;img&quot;</span>);
        img.<span class="hljs-property">src</span> = githubUser.<span class="hljs-property">avatar_url</span>;
        img.<span class="hljs-property">className</span> = <span class="hljs-string">&quot;promise-avatar-example&quot;</span>;
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">append</span>(img);

        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          img.<span class="hljs-title function_">remove</span>();
          <span class="hljs-title function_">resolve</span>(githubUser); <span class="hljs-comment">// (**)</span>
        }, <span class="hljs-number">3000</span>);
      }),
  )
  <span class="hljs-comment">// 3초 후 동작함</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">githubUser</span>) =&gt;</span>
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">`<span class="hljs-subst">${githubUser.name}</span>의 이미지를 성공적으로 출력하였습니다.`</span>),
  );
</code></pre>
<p>위의 코드는 다음과 같이 정리해서 가독성을 높일 수 있다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">loadJson</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(url).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>());
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadGithubUser</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.github.com/users/<span class="hljs-subst">${name}</span>`</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span>
    response.<span class="hljs-title function_">json</span>(),
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">showAvatar</span>(<span class="hljs-params">githubUser</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
    <span class="hljs-keyword">let</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;img&quot;</span>);
    img.<span class="hljs-property">src</span> = githubUser.<span class="hljs-property">avatar_url</span>;
    img.<span class="hljs-property">className</span> = <span class="hljs-string">&quot;promise-avatar-example&quot;</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">append</span>(img);

    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      img.<span class="hljs-title function_">remove</span>();
      <span class="hljs-title function_">resolve</span>(githubUser);
    }, <span class="hljs-number">3000</span>);
  });
}

<span class="hljs-comment">// 함수를 이용하여 다시 동일 작업 수행</span>
<span class="hljs-title function_">loadJson</span>(<span class="hljs-string">&quot;/article/promise-chaining/user.json&quot;</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> <span class="hljs-title function_">loadGithubUser</span>(user.<span class="hljs-property">name</span>))
  .<span class="hljs-title function_">then</span>(showAvatar)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">githubUser</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">`Finished showing <span class="hljs-subst">${githubUser.name}</span>`</span>));
<span class="hljs-comment">// ...</span>
</code></pre>
<p>결론적으로 Promise Chaining은 다음의 구조이다.</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241107212119.png" alt=""/></p>
<h3 id="36"><mark style="background:#FFF3A3A6">Promise와 Error Handling</mark></h3>
<pre><code class="hljs language-js"><span class="hljs-comment">// 없는 url일 경우</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;https://no-such-server.blabla&quot;</span>) <span class="hljs-comment">// 거부</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(err));
<span class="hljs-comment">// TypeError: failed to fetch ( 출력되는 내용은 다를 수 있음 )</span>
</code></pre>
<p><code>Promise</code>가 거부되면 제어 흐름이 제일 가까운 <code>rejection</code> 핸들러로 넘어간다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// JSON의 형식이 잘못되면</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/article/promise-chaining/user.json&quot;</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.github.com/users/<span class="hljs-subst">${user.name}</span>`</span>))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(
    <span class="hljs-function">(<span class="hljs-params">githubUser</span>) =&gt;</span>
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;img&quot;</span>);
        img.<span class="hljs-property">src</span> = githubUser.<span class="hljs-property">avatar_url</span>;
        img.<span class="hljs-property">className</span> = <span class="hljs-string">&quot;promise-avatar-example&quot;</span>;
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">append</span>(img);

        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          img.<span class="hljs-title function_">remove</span>();
          <span class="hljs-title function_">resolve</span>(githubUser);
        }, <span class="hljs-number">3000</span>);
      }),
  )
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(error.<span class="hljs-property">message</span>));
</code></pre>
<p>체인 끝에 catch를 붙이면 위쪽 Promise 중 하나라도 거부되면 해당 catch가 에러를 잡게 된다.</p>
<h4 id="37"><mark style="background:#BBFABBA6">암시적 try...catch</mark></h4>
<p><code>Promise executor</code>와 <code>Promise</code> 핸들러 코드 주위에는 암시적 <code>try...catch</code>가 존재한다. 예외가 발생하면 암시적 <code>try...catch</code>에서 예외를 잡고 이를 <code>reject</code>처럼 다룬다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// 아래 두 코드는 같은 기능을 한다.</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>);
}).<span class="hljs-title function_">catch</span>(alert); <span class="hljs-comment">// Error: 에러 발생!</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>));
}).<span class="hljs-title function_">catch</span>(alert); <span class="hljs-comment">// Error: 에러 발생!</span>
</code></pre>
<p><code>throw</code>를 사용해서 에러를 던지면 이 자체가 거부된 <code>Promise</code>를 의미하게 된다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;OK&quot;</span>);
})
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>); <span class="hljs-comment">// Promise가 거부됨</span>
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-title function_">alert</span>(error);
    <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;
  }); <span class="hljs-comment">// Error: 에러 발생!</span>
</code></pre>
<p><img src="/images/2024-11-10/Pasted%20image%2020241110214430.png" alt=""/></p>
<p>해당 암시적 <code>try... catch</code>는 핸들러 위쪽에서 발생한 비정상 에러 또한 잡는다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;OK&quot;</span>);
})
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-title function_">blabla</span>(); <span class="hljs-comment">// 존재하지 않는 함수</span>
  })
  .<span class="hljs-title function_">catch</span>(alert); <span class="hljs-comment">// ReferenceError: blabla is not defined</span>
</code></pre>
<p>단 동기적 에러가 암시적 <code>try...catch</code>에서 처리되는 것이다. 다음과 같이 비동기 코드가 executor 내부에 존재하고 내부에 에러가 발생한다면 해당 에러를 감지할 수 없다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>);
  }, <span class="hljs-number">1000</span>);
}).<span class="hljs-title function_">catch</span>(alert);
</code></pre>
<h4 id="38"><mark style="background:#BBFABBA6">다시 던지기</mark></h4>
<p><code>.catch</code>가 정상적으로 종료되면 <code>fulfilled</code>인 <code>Promise</code>를 리턴할 것이다. 그래서 다음과 같은 로직이 가능하다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// 실행 순서: catch -&gt; then</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>);
})
  .<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;에러가 잘 처리되었습니다. 정상적으로 실행이 이어집니다.&quot;</span>);
    <span class="hljs-comment">// catch 이후 리턴되는 fulfilled상태의 Promise가 .then을 만난다.</span>
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;다음 핸들러가 실행됩니다.&quot;</span>));
</code></pre>
<p>위를 활용해서 에러 핸들링을 세분화시킬 수 있다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// 실행 순서: catch -&gt; catch</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>);
})
  .<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-comment">// (*)</span>

    <span class="hljs-comment">// URIError만 처리하는 소비 함수</span>
    <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">URIError</span>) {
      <span class="hljs-comment">// 에러 처리</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;처리할 수 없는 에러&quot;</span>);

      <span class="hljs-keyword">throw</span> error; <span class="hljs-comment">// URIError가 아닐 경우 다음 에러 핸들러로 전달</span>
    }
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-comment">/* 여기는 실행되지 않습니다. */</span>
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-comment">// (**)</span>

    <span class="hljs-title function_">alert</span>(<span class="hljs-string">`알 수 없는 에러가 발생함: <span class="hljs-subst">${error}</span>`</span>);
    <span class="hljs-comment">// 반환값이 없음 =&gt; 실행이 계속됨</span>
  });
</code></pre>
<h4 id="39"><mark style="background:#BBFABBA6">처리되지 못한 거부</mark></h4>
<pre><code class="hljs language-js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  <span class="hljs-title function_">noSuchFunction</span>(); <span class="hljs-comment">// 존재하지 않는 함수를 호출하기 때문에 에러가 발생함</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 성공상태의 Promise를 처리하는 핸들러. 한 개 혹은 여러 개가 있을 수 있음</span>
}); <span class="hljs-comment">// 끝에 .catch가 없음!</span>
</code></pre>
<p>예외를 처리해 줄 핸들러가 없으면 에러가 갇혀 버린다.</p>
<p><code>try...catch</code>에서 일반적인 에러가 발생하고 이를 처리하지 못했을 때 스크립트가 죽고 콘솔 창에 메시지가 출력되는데
<code>rejected Promise</code>가 처리되지 않아도 동일한 일이 발생한다.</p>
<p>JS 엔진은 <code>Promise reject</code>를 추적하다가 에러가 갇힌 걸 확인하면 전역 에러를 생성한다.</p>
<p>브라우저에서는 <code>unhandledrejection</code> 이벤트로 이런 에러를 처리한다. (HTML 명세서에 정의된 표준 이벤트이다.)</p>
<pre><code class="hljs language-js"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;unhandledrejection&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) {
  <span class="hljs-comment">// unhandledrejection 이벤트엔 두 개의 특수 프로퍼티가 있습니다.</span>
  <span class="hljs-title function_">alert</span>(event.<span class="hljs-property">promise</span>); <span class="hljs-comment">// [object Promise] - 에러를 생성하는 Promise</span>
  <span class="hljs-title function_">alert</span>(event.<span class="hljs-property">reason</span>); <span class="hljs-comment">// Error: 에러 발생! - 처리하지 못한 에러 객체</span>
});

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>);
}); <span class="hljs-comment">// 에러를 처리할 수 있는 .catch 핸들러가 없음</span>
</code></pre>
<p><img src="/images/2024-11-10/Pasted%20image%2020241107214313.png" alt=""/></p>
<h3 id="40"><mark style="background:#FFF3A3A6">Promise API</mark></h3>
<h4 id="41"><mark style="background:#BBFABBA6">Promise.all</mark></h4>
<p>여러 개의 Promise를 동시에 실행시키고 모든 Promise가 준비될 때까지 기다린다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// let promise = Promise.all([...promises...]);</span>
<span class="hljs-comment">// Promise인 배열을 받고 새로운 Promise를 반환한다.</span>

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>), <span class="hljs-number">3000</span>)), <span class="hljs-comment">// 1</span>
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>), <span class="hljs-number">2000</span>)), <span class="hljs-comment">// 2</span>
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>), <span class="hljs-number">1000</span>)), <span class="hljs-comment">// 3</span>
]).<span class="hljs-title function_">then</span>(alert); <span class="hljs-comment">// Promise 전체가 처리되면 1, 2, 3이 반환됩니다. 각 Promise는 배열을 구성하는 요소가 됩니다.</span>
</code></pre>
<p>각 Promise 요청이 다 끝나면 배열의 순서에 따라서 결과 값이 또 다른 배열 형태로 소비 함수로 전달된다.</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241108150808.png" alt=""/></p>
<p><code>fetch</code>는 인수에 존재하는 url에 요청을 보내서 <code>response</code>를 <code>Promise</code> 형태로 리턴하는 함수이다. 이를 활용한 예제를 살펴보면</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> urls = [
  <span class="hljs-string">&quot;https://api.github.com/users/iliakan&quot;</span>,
  <span class="hljs-string">&quot;https://api.github.com/users/Violet-Bora-Lee&quot;</span>,
  <span class="hljs-string">&quot;https://api.github.com/users/jeresig&quot;</span>,
];

<span class="hljs-comment">// fetch를 사용해 url을 Promise로 매핑합니다.</span>
<span class="hljs-keyword">let</span> requests = urls.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">url</span>) =&gt;</span> <span class="hljs-title function_">fetch</span>(url));

<span class="hljs-comment">// Promise.all은 모든 작업이 이행될 때까지 기다립니다.</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(requests).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">responses</span>) =&gt;</span>
  responses.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">`<span class="hljs-subst">${response.url}</span>: <span class="hljs-subst">${response.status}</span>`</span>)),
);
</code></pre>
<p><img src="/images/2024-11-10/Pasted%20image%2020241108151347.png" alt=""/></p>
<p><code>Promise.all</code>을 이용해서 요청 응답을 배열로 받은 후 그 배열을 다시 <code>Promise.all</code>을 이용해서 <code>json()</code>으로 파싱, 다음 소비 함수에서 해당 파싱된 데이터를 콘솔 창에 띄우는 로직이다.</p>
<p>결론적으로 다음과 같이 중간에 소비 함수의 로직을 늘릴 수도 있다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> names = [<span class="hljs-string">&quot;iliakan&quot;</span>, <span class="hljs-string">&quot;Violet-Bora-Lee&quot;</span>, <span class="hljs-string">&quot;jeresig&quot;</span>];

<span class="hljs-keyword">let</span> requests = names.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span>
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.github.com/users/<span class="hljs-subst">${name}</span>`</span>),
);

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(requests)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">responses</span>) =&gt;</span> {
    <span class="hljs-comment">// 모든 응답이 성공적으로 이행되었습니다.</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> response <span class="hljs-keyword">of</span> responses) {
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">`<span class="hljs-subst">${response.url}</span>: <span class="hljs-subst">${response.status}</span>`</span>); <span class="hljs-comment">// 모든 url의 응답코드가 200입니다.</span>
    }

    <span class="hljs-keyword">return</span> responses;
  })
  <span class="hljs-comment">// 응답 메시지가 담긴 배열을 response.json()로 매핑해, 내용을 읽습니다.</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">responses</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(responses.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-title function_">json</span>())))
  <span class="hljs-comment">// JSON 형태의 응답 메시지는 파싱 되어 배열 &#x27;users&#x27;에 저장됩니다.</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">users</span>) =&gt;</span> users.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(user.<span class="hljs-property">name</span>)));
</code></pre>
<h5 id="42"><mark style="background:#ABF7F7A6">Promise.all의 에러 핸들링</mark></h5>
<p>내부 배열에서 하나라도 rejected가 일어나면 전체를 에러라고 판단한다.</p>
<pre><code class="hljs language-js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>), <span class="hljs-number">1000</span>)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>)), <span class="hljs-number">2000</span>),
  ),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>), <span class="hljs-number">3000</span>)),
]).<span class="hljs-title function_">catch</span>(alert); <span class="hljs-comment">// Error: 에러 발생!</span>
</code></pre>
<blockquote>
<p><strong>Promise reject가 일어나도 호출은 계속 일어난다.</strong></p>
<p>별도의 처리 (AbortController) 가 없다면 Promise rejected가 일어나도 다른 Promise 처리가 취소되진 않는다. 단, 결과는 무시된다.</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241108152428.png" alt=""/></p>
<p>위 예시는 rejected되는 Promise를 배열에 넣고 Promise.all을 돌린 예시이다.
첫 번째 인수인 Promise가 rejected되어 전역 에러가 일어났다. (catch 메소드가 뒤에 없으므로)
이때 네트워크 요청에서 보면 fetch 자체는 일어난 것을 확인할 수 있다.</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241108152443.png" alt=""/></p>
</blockquote>
<blockquote>
<p><strong>Promise.all의 인수에 있는 배열</strong></p>
<p>해당 배열은 꼭 Promise 객체가 아니어도 된다. 밑의 예시처럼 숫자를 넣을 수도 있는데 이때는 해당 숫자를 그대로 소비 함수로 전달한다.</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>), <span class="hljs-number">1000</span>);
  }),
  <span class="hljs-number">2</span>,
  <span class="hljs-number">3</span>,
]).<span class="hljs-title function_">then</span>(alert); <span class="hljs-comment">// 1, 2, 3</span>
</code></pre>
<h4 id="43"><mark style="background:#BBFABBA6">Promise.allSettled</mark></h4>
<p>Promise.all은 하나라도 에러가 나면 전부 결과를 못 받는다.</p>
<pre><code class="hljs language-js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/template.html&quot;</span>),
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/style.css&quot;</span>),
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/data.json&quot;</span>),
]).<span class="hljs-title function_">then</span>(render); <span class="hljs-comment">// render 메서드는 fetch 결과 전부가 있어야 제대로 동작합니다.</span>
</code></pre>
<p>위 예시와 같이 html, css, json이 전부 필요한 render 함수가 소비 함수일 경우 유용하다.</p>
<p><code>.allSettled</code>는 하나가 에러가 나더라도 다른 요청을 받을 수 있게 하려고 태어났다.</p>
<ol>
<li>응답이 성공하였을 때 – <code>{status:&quot;fulfilled&quot;, value:result}</code></li>
<li>에러가 발생하였을 때 – <code>{status:&quot;rejected&quot;, reason:error}</code></li>
</ol>
<pre><code class="hljs language-js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(urls.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">url</span>) =&gt;</span> <span class="hljs-title function_">fetch</span>(url))).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">results</span>) =&gt;</span> {
  <span class="hljs-comment">// (*)</span>
  results.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">result, num</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">status</span> == <span class="hljs-string">&quot;fulfilled&quot;</span>) {
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">`<span class="hljs-subst">${urls[num]}</span>: <span class="hljs-subst">${result.value.status}</span>`</span>);
      <span class="hljs-comment">// 응답이 성공하면 결과가 value 프로퍼티 안에 들어가게 된다.</span>
    }
    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">status</span> == <span class="hljs-string">&quot;rejected&quot;</span>) {
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">`<span class="hljs-subst">${urls[num]}</span>: <span class="hljs-subst">${result.reason}</span>`</span>);
      <span class="hljs-comment">// 에러가 발생하면 에러 객체가 reason 프로퍼티 안에 들어가게 된다.</span>
    }
  });
});
</code></pre>
<p><img src="/images/2024-11-10/Pasted%20image%2020241108154631.png" alt=""/></p>
<h4 id="44"><mark style="background:#BBFABBA6">Promise.race</mark></h4>
<p>Promise.all과 유사하게 Promise 배열 전체를 처리하지만 가장 먼저 처리되는 Promise의 결과를 반환한다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">//let promise = Promise.race(iterable);</span>

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>), <span class="hljs-number">1000</span>)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>)), <span class="hljs-number">2000</span>),
  ),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>), <span class="hljs-number">3000</span>)),
]).<span class="hljs-title function_">then</span>(alert); <span class="hljs-comment">// 1</span>
</code></pre>
<h4 id="45"><mark style="background:#BBFABBA6">Promise.resolve와 Promise.reject</mark></h4>
<p>resolve와 reject 메소드는 async/ await의 등장으로 잘 사용되지 않는다. 하지만 추후 나올 폴리 필을 이해하기 위해서라도 필요하기에 한번 알아보도록 하자.
( <code>async function</code>은 리턴값을 무조건 Promise로 꺼내고 내부에 throw Error해주면 rejected 상태의 Promise를 리턴한다. )</p>
<h5 id="46"><mark style="background:#ABF7F7A6">Promise.resolve</mark></h5>
<p>Promise.resolve(value)는 결과값이 value인 fulfilled한 Promise를 생성한다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// let promise = new Promise(resolve =&gt; resolve(value));</span>

<span class="hljs-keyword">let</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadCached</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">if</span> (cache.<span class="hljs-title function_">has</span>(url)) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(cache.<span class="hljs-title function_">get</span>(url));
  }

  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(url)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">text</span>())
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">text</span>) =&gt;</span> {
      cache.<span class="hljs-title function_">set</span>(url, text);
      <span class="hljs-keyword">return</span> text;
    });
}
</code></pre>
<p><code>loadCached</code>는 <code>fetch</code>를 할 때 <code>cache</code>에 해당 데이터를 저장해두고 다음에 같은 요청을 보냈을 때 <code>cache</code>에서 꺼내서 전달한다.
이때 <code>Promise.resolve</code>를 이용해서 <code>loadCached</code>가 항상 <code>Promise</code>를 반환한다는 걸 정해둬서 사용하는 단에서는 <code>loadCached</code> 함수에 <code>.then/catch</code> 등의 메소드를 통해서 소비 함수를 넣을 수 있게 된다.</p>
<h6 id="47"><mark style="background:#ADCCFFA6">Promise.resolve를 이용한 Promise allSettled의 폴리필</mark></h6>
<p>allSettled는 나온 지 얼마 안 되어서 구식 브라우저에서는 폴리 필이 필요하다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Promise</span>.<span class="hljs-property">allSettled</span>) {
  <span class="hljs-title class_">Promise</span>.<span class="hljs-property">allSettled</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">promises</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
      promises.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span>
        <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(p).<span class="hljs-title function_">then</span>(
          <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
            <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;fulfilled&quot;</span>,
            value,
          }),
          <span class="hljs-function">(<span class="hljs-params">reason</span>) =&gt;</span> ({
            <span class="hljs-comment">// then의 두 번째 인수이다. then의 두 번째 인수는 error 핸들러이다. (catch와 같음.)</span>
            <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;rejected&quot;</span>,
            reason,
          }),
        ),
      ),
    );
  };
}
</code></pre>
<h5 id="48"><mark style="background:#ABF7F7A6">Promise.reject</mark></h5>
<p><code>Promise.reject(error)</code>는 결과값이 <code>error</code>인 <code>rejected Promise</code>를 반환한다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
ㄴ;
</code></pre>
<p><img src="/images/2024-11-10/Pasted%20image%2020241108160624.png" alt=""/></p>
<h3 id="49"><mark style="background:#FFF3A3A6">Fetch: Abort</mark></h3>
<blockquote>
<p>글 흐름을 위해 Promise 파트에 넣어놓긴 했지만 엄밀히 말하면 Promise API는 아니다.</p>
</blockquote>
<p>Promise.all 에서도 에러 발생시 Promise 결과는 무시되나 호출은 막을 수 없다고 하였다.
AbortController라는 빌트인 객체를 활용하면 Promise 호출 자체를 막을 수 있다.</p>
<h4 id="50"><mark style="background:#BBFABBA6">AbortController Object</mark></h4>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
</code></pre>
<p>AbortController는 프로퍼티 하나, 메소드 하나를 갖고 있다.</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241108161157.png" alt=""/></p>
<ol>
<li><code>signal</code>은 프로토타입 체인을 가치지 않고 바로 인스턴스에서 찾을 수 있으며 <code>event listener</code>를 세팅할 수 있는 프로퍼티이다.</li>
<li><code>abort</code>는 프로토타입 체인을 이용해서 <code>AbortController</code>에 있는 메소드를 가져오는 것이며 <code>abort</code>가 실행되면 다음의 과정이 일어난다.<!-- -->
<ol>
<li>instance.signal이 &quot;abort&quot; event를 발생시킨다.</li>
<li>instance.signal.aborted가 true가 된다.</li>
</ol>
</li>
</ol>
<p>따라서 signal에 취소 가능한 작업을 리스너로 달아 놓고
abort() 함수로 취소하는 것이다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
<span class="hljs-keyword">let</span> signal = controller.<span class="hljs-property">signal</span>;

<span class="hljs-comment">// 취소가능한 작업을 수행하는 곳에 signal 객체를 주고, controller.abort()가 실행되면 실행될 리스너를 세팅한다.</span>
signal.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;abort&quot;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;abort!&quot;</span>));

<span class="hljs-comment">// 아래 코드를 어떤 곳에 넣어서 원할 때 실행할 수 있도록 한다.</span>
controller.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">// abort!</span>

<span class="hljs-comment">// abort event가 트리거되면 aborted가 true로 바뀐다.</span>
<span class="hljs-title function_">alert</span>(signal.<span class="hljs-property">aborted</span>); <span class="hljs-comment">// true</span>
</code></pre>
<p>다른 event를 구현해서 동일 기능을 만들어서 fetch와 쓸 수도 있지만, 내부적으로 fetch는 <code>AbortController</code>를 인식하기 때문에 <code>AbortController</code>를 사용하는 것이 좋다.</p>
<h4 id="51"><mark style="background:#BBFABBA6">fetch와 함께 사용</mark></h4>
<p><code>fetch</code> 옵션에 <code>signal</code>이라는 프로퍼티가 존재한다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
<span class="hljs-title function_">fetch</span>(url, {
  <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span>,
});
</code></pre>
<p>이제 이전과 같이 <code>controller.abort()</code> 함수로 <code>fetch</code> 요청을 제어해주면 된다.</p>
<blockquote>
<p>단, fetch가 abort하는 시기보다 더 빨리 끝나면 이미 나온 결과를 없애진 않는다.</p>
</blockquote>
<h4 id="52"><mark style="background:#BBFABBA6">AbortController는 확장성 있다.</mark></h4>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> urls = [...]; <span class="hljs-comment">// a list of urls to fetch in parallel</span>

<span class="hljs-keyword">let</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();

<span class="hljs-comment">// an array of fetch promises</span>
<span class="hljs-keyword">let</span> fetchJobs = urls.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">url</span> =&gt;</span> <span class="hljs-title function_">fetch</span>(url, {
  <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span>
}));

<span class="hljs-keyword">let</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(fetchJobs);

<span class="hljs-comment">// if controller.abort() is called from elsewhere,</span>
<span class="hljs-comment">// it aborts all fetches</span>
</code></pre>
<p>위와 같이 <code>signal</code>로 하나의 <code>controller</code>를 등록해두면 등록된 모든 <code>fetch</code>가 하나의 <code>controller</code>의 신호를 따르게 된다.</p>
<p>또한 <code>Promise</code>와 함께 사용할 수 있으며 <code>Promise.all</code>을 통해서 <code>fetch</code>와 해당 <code>Promise</code>를 결합할 수도 있다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> urls = [...];
<span class="hljs-keyword">let</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();

<span class="hljs-keyword">let</span> ourJob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> { <span class="hljs-comment">// our task</span>
  ...
  controller.<span class="hljs-property">signal</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;abort&#x27;</span>, reject);
});

<span class="hljs-keyword">let</span> fetchJobs = urls.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">url</span> =&gt;</span> <span class="hljs-title function_">fetch</span>(url, { <span class="hljs-comment">// fetches</span>
  <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span>
}));

<span class="hljs-comment">// Wait for fetches and our task in parallel</span>
<span class="hljs-keyword">let</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([...fetchJobs, ourJob]);

<span class="hljs-comment">// if controller.abort() is called from elsewhere,</span>
<span class="hljs-comment">// it aborts all fetches and ourJob</span>
</code></pre>
<h3 id="53"><mark style="background:#FFF3A3A6">Promisification</mark></h3>
<p>콜백을 받는 함수를 Promise를 반환하는 함수로 바꾸는 것을 <code>Promisification</code> 이라고 한다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-params">src, callback</span>) {
  <span class="hljs-keyword">let</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);
  script.<span class="hljs-property">src</span> = src;

  script.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, script);
  script.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span>
    <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${src}</span>를 불러오는 도중에 에러가 발생함`</span>));

  <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">append</span>(script);
}

<span class="hljs-comment">// 사용법:</span>
<span class="hljs-comment">// loadScript(&#x27;path/script.js&#x27;, (err, script) =&gt; {...})</span>
</code></pre>
<p>위 함수는 콜백 함수를 활용한 함수로써 이를 <code>Promisification</code> 해보자.</p>
<p>src라는 인수를 받아야 되고 콜백을 받지 않고 사용하는 단에서 제어할 수 있어야 한다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> loadScriptPromise = <span class="hljs-function">(<span class="hljs-params">src</span>)=&gt;</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=&gt;</span>{
    <span class="hljs-comment">// 여기서 (err, script)=&gt;{...} 이건 위의 코드에서 보면 기존의 사용법에서 쓰이는 콜백 함수이다.</span>
    <span class="hljs-comment">// 콜백 함수가 내부로 숨겨진 것일 뿐이다.</span>
    <span class="hljs-title function_">loadScript</span>(src,<span class="hljs-function">(<span class="hljs-params">err, script</span>)=&gt;</span>{
	  <span class="hljs-keyword">if</span> (err) <span class="hljs-title function_">reject</span>(err);
	  <span class="hljs-keyword">else</span> <span class="hljs-title function_">resolve</span>(script);
    })
  })
}

<span class="hljs-comment">// 사용법:</span>
<span class="hljs-comment">// loadScriptPromise(&#x27;path/script.js&#x27;).then(...)</span>
</code></pre>
<p>이러한 <code>Promisification</code> 은 하나의 함수에서만 쓸 수 있다. 이를 확장성 있게 하려면 헬퍼 함수를 만들어 보자.</p>
<p>헬퍼 함수는 함수 <code>f</code>를 받아서 래퍼 함수를 반환해야 한다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">promisify</span>(<span class="hljs-params">f</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) { <span class="hljs-comment">// 래퍼 함수를 반환함</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">callback</span>(<span class="hljs-params">err, result</span>) {
      <span class="hljs-comment">// f에 사용할 커스텀 콜백</span>
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-title function_">reject</span>(err);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">resolve</span>(result);
        }
      }

      args.<span class="hljs-title function_">push</span>(callback); <span class="hljs-comment">// 위에서 만든 커스텀 콜백을 함수 f의 인수 끝에 추가합니다.</span>

      <span class="hljs-comment">// 처음 promisify를 선언할 때 넣었던 함수를 가져와서</span>
      <span class="hljs-comment">// 호출할 때의 this, 그리고 호출할 때 넣은 args를 가져와서 실행시킨다.</span>
      f.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, ...args); <span class="hljs-comment">// 기존 함수를 호출합니다.</span>
    });
  };
};

<span class="hljs-comment">// 사용법:</span>
<span class="hljs-keyword">let</span> loadScriptPromise = <span class="hljs-title function_">promisify</span>(loadScript);
<span class="hljs-title function_">loadScriptPromise</span>(...).<span class="hljs-title function_">then</span>(...);
</code></pre>
<p>위 코드에서 여러 인수를 처리하기 위해선 다음과 같은 리팩토링이 필요하다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// 콜백의 성공 결과를 담은 배열을 얻게 해주는 promisify(f, true)</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">promisify</span>(<span class="hljs-params">f, manyArgs = <span class="hljs-literal">false</span></span>) { <span class="hljs-comment">// args 다수 여부 확인</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">callback</span>(<span class="hljs-params">err, ...results</span>) { <span class="hljs-comment">// f에 사용할 커스텀 콜백</span>
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-title function_">reject</span>(err);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// args 다수 여부로 판단해서 리턴될 Promise의 result에 하나만 넣을지 여러 개 넣을지 판단</span>
          <span class="hljs-title function_">resolve</span>(manyArgs ? results : results[<span class="hljs-number">0</span>]);
        }
      }

      args.<span class="hljs-title function_">push</span>(callback);

      f.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, ...args);
    });
  };
};

<span class="hljs-comment">// 사용법:</span>
<span class="hljs-comment">// 여기서 promisify에 들어가는 f는 여러 인수가 필요하고 콜백이 마지막 인수로 들어가는 함수이다.</span>
<span class="hljs-comment">// f(arg1, arg2, ..., (err, ...results)=&gt;{});</span>
f = <span class="hljs-title function_">promisify</span>(f, <span class="hljs-literal">true</span>);
<span class="hljs-title function_">f</span>(...).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">arrayOfResults</span> =&gt;</span> ..., <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> ...);
</code></pre>
<blockquote>
<p>단, <code>Promisification</code> 은 콜백을 완전히 대체하지는 못한다. 콜백은 여러 번 호출할 수 있고 Promise는 하나의 결과만 가질 수 있기 때문이다. ( Promisification한 함수의 콜백을 여러 번 호출해도 두 번째부터는 무시된다. )</p>
</blockquote>
<p>사실 이를 미리 처리해주는 <code>promisify</code> 라이브러리나 <code>Node.js</code> 내장 함수가 존재한다.</p>
<h3 id="54"><mark style="background:#FFF3A3A6">Microtask 처리</mark></h3>
<p><code>Promise</code> 핸들러 (<code>.then/catch/finally</code>)는 항상 비동기적으로 실행된다.</p>
<p><code>Promise</code>가 즉시 이행돼도 <code>.then/catch/finally</code> 아래에 있는 코드들은 이 핸들러가 실행되기 전에 실행된다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>();

promise.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Promise 성공!&quot;</span>));

<span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;코드 종료&quot;</span>);

<span class="hljs-comment">// 결과</span>
<span class="hljs-comment">// alert(&quot;코드 종료&quot;);</span>
<span class="hljs-comment">// alert(&quot;Promise 성공!&quot;);</span>
</code></pre>
<h4 id="55"><mark style="background:#BBFABBA6">Microtask Queue</mark></h4>
<p>비동기 작업을 처리하려면 적절한 관리가 필요하다.
이를 위해 ECMA에선 <code>PromiseJobs</code>라는 내부 큐(<code>Internal Queue</code>)를 명시한다. ( <code>V8</code>엔진에서 이를 <code>Microtask Queue</code> 라고 부르기 때문에 <code>Microtask Queue</code>를 더 자주 쓴다. )</p>
<p><code>Microtask Queue</code>는 다음처럼 동작한다.</p>
<ol>
<li>먼저 들어온 작업을 먼저 실행한다. (<code>FIFO</code>)</li>
<li>실행할 것이 아무것도 남아있지 않을 때만 큐에 있는 작업이 실행되기 시작한다.</li>
</ol>
<p>요약하면 어떤 <code>Promise</code> 가 준비되었을 때 이 <code>Promise</code>의 <code>.then/catch/finally</code> 핸들러는 큐에 들어가게 되며 여전히 실행되지 않는다.</p>
<p>이후 현재 코드에서 자유로운 상태가 되었을 때 자바스크립트 엔진은 큐에서 작업을 꺼내 실행한다.</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241108195640.png" alt=""/></p>
<p><code>Promise</code> 핸들러는 항상 내부 큐(<code>Promise jobs</code>이자 <code>Microtask Queue</code>)를 통과하게 된다.</p>
<p>여러 개의 <code>.then/catch/finally</code>를 사용해 만든 체인의 경우, 각 핸들러는 비동기적으로 실행된다. 큐에 들어간 핸들러 각각은 현재 코드가 완료되고, 큐에 들어있는 이전 핸들러의 실행이 완료되었을 때 실행된다.</p>
<pre><code class="hljs language-js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Promise Fulfilled&quot;</span>))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;finish&quot;</span>));
</code></pre>
<p>위와 같이 하면 비동기 동작을 차례대로 진행할 수 있다.</p>
<h4 id="56"><mark style="background:#BBFABBA6">처리되지 못한 거부</mark></h4>
<p><code>unhandledrejection</code> 이벤트는 <code>Promise</code>를 실행할 때 <code>.catch</code> 없이 에러가 전달돼서 전역 에러가 난 것을 의미한다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Promise 실패!&quot;</span>));

<span class="hljs-comment">// Promise 실패!</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;unhandledrejection&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> <span class="hljs-title function_">alert</span>(event.<span class="hljs-property">reason</span>));
</code></pre>
<blockquote>
<p><strong>unhandled rejection</strong></p>
<p>자바스크립트 엔진은 처리되지 못한 거부(unhandled rejection)를 찾을 때 <code>Microtask Queue</code>를 확인한다.
Microtask Queue 끝에도 Promise error가 처리되지 않았다면 발생한다.</p>
</blockquote>
<h5 id="57"><mark style="background:#ABF7F7A6">만약 catch를 나중에 처리한다면</mark></h5>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> promise = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Promise 실패!&quot;</span>));
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> promise.<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;잡았다!&quot;</span>)), <span class="hljs-number">1000</span>);

<span class="hljs-comment">// Error: Promise 실패!</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;unhandledrejection&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">reason</span>),
);
</code></pre>
<p><img src="/images/2024-11-10/Pasted%20image%2020241108205243.png" alt=""/></p>
<p><code>unhandledrejection</code>의 핸들러 함수 &gt; rejected Promise 있다고 알림 &gt; catch 소비 함수
순서인 것을 확인할 수 있다.</p>
<p>이는 다음의 과정 때문에 그러하다.</p>
<ol>
<li>현재 <code>Macrotask</code>가 끝나면 (<code>window.addEventListener</code>까지 다 끝나고 나면) <code>Microtask Queue</code>를 확인한다.</li>
<li><code>unhandledrejection</code>은 <code>Microtask Queue</code>에 있는 작업이 <code>rejected</code>된 상태로 남아있을 때 발동된다. 즉 <code>rejected Promise</code> 상태로 남아 있는 것을 발견하고 <code>unhandledrejection</code>을 발동시킨다.</li>
<li>등록된 핸들러 <code>(console.log(event.reason))</code> 실행</li>
<li><code>Web API</code>에서 <code>1,000ms</code>가 끝나고 <code>setTimeout</code>의 콜백 함수 <code>( ()=&gt;promise.catch(()=&gt;console.log(&#x27;잡았다!&#x27;)) )</code>가 <code>Macrotask Queue</code>로 이동된다.</li>
<li><code>()=&gt;promise.catch(()=&gt;console.log(&#x27;잡았다!&#x27;))</code>를 실행해서 <code>promise.catch(()=&gt;console.log(&#x27;잡았다!&#x27;)</code> 리턴한다.</li>
<li><code>rejected Promise</code>가 담겨있는 변수 <code>promise</code>를 <code>.catch</code>핸들러로 찍었기에 <code>()=&gt;console.log(&#x27;잡았다!&#x27;)</code>를 <code>Microtask Queue</code>로 이동시킨다.</li>
<li>이동이 끝나면 <code>Macrotask</code> 하나가 끝났으니 <code>Microtask Queue</code>를 비워질 때까지 실행한다. 여기서 <code>()=&gt;console.log(&#x27;잡았다!&#x27;)</code>가 실행된다.</li>
</ol>
<h2 id="58"><mark style="background:#FFB86CA6">async, await</mark></h2>
<p><code>Promise</code>를 편하게 사용하기 위해 <code>async</code>, <code>await</code> 문법이 탄생하게 되었다.</p>
<h3 id="59"><mark style="background:#FFF3A3A6">async function</mark></h3>
<pre><code class="hljs language-js"><span class="hljs-keyword">async</span> funciton <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>){
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}
</code></pre>
<p><code>function</code> 앞에 <code>async</code>를 붙이면 해당 함수는 항상 Promise를 반환한다.
만약 Promise가 아닌 값을 반환하더라도 fulfilled 상태의 Promise로 값을 감싸서 반환한다.</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241110152440.png" alt=""/></p>
<p>즉 다음의 코드들은 같은 기능을 한다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">async</span> funciton <span class="hljs-title function_">f1</span>(<span class="hljs-params"></span>){
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}

<span class="hljs-keyword">async</span> funciton <span class="hljs-title function_">f2</span>(<span class="hljs-params"></span>){
	<span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
}
</code></pre>
<h3 id="60"><mark style="background:#FFF3A3A6">await</mark></h3>
<pre><code class="hljs language-js"><span class="hljs-comment">// await는 async function 안에서만 동작한다.</span>
<span class="hljs-keyword">let</span> value = <span class="hljs-keyword">await</span> promise;
</code></pre>
<p><code>await</code> 키워드를 만나면 Promise가 처리될 때까지 기다린다. <code>await</code>키워드 아래에 있는 동일 블록의 코드들은 <code>Microtask Queue</code>로 이동한다. ( 기능적으로 <code>.then</code>으로 넘기는 것과 같다. )</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;완료!&quot;</span>), <span class="hljs-number">1000</span>);
  });

  <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> promise; <span class="hljs-comment">// Promise가 이행될 때까지 기다림 (*)</span>

  <span class="hljs-title function_">alert</span>(result); <span class="hljs-comment">// &quot;완료!&quot;</span>
}

<span class="hljs-title function_">f</span>();
</code></pre>
<p>Promise가 처리될 때까지 기다리는 동안 엔진은 다른 일(다른 스크립트 실행, 이벤트 처리)을 처리할 수 있기 때문에 CPU 리소스가 낭비되지 않는다.</p>
<blockquote>
<p>즉, <code>await</code>은 <code>promise.then</code>보다 좀 더 세련되게 Promise의 <code>result</code> 값을 얻을 수 있도록 해주는 문법이다.</p>
</blockquote>
<p><strong>fetch와 체이닝 함께 응용</strong> 파트에서 예시로 있었던 <code>showAvatar</code> 코드를 <code>async / await</code> 문법으로 정리해보면 다음과 같다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">showAvatar</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-comment">// JSON 읽기</span>
  <span class="hljs-keyword">const</span> loadJsonResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);
  <span class="hljs-keyword">const</span> { name } = <span class="hljs-keyword">await</span> loadJsonResponse.<span class="hljs-title function_">json</span>();

  <span class="hljs-comment">// github 사용자 정보 읽기</span>
  <span class="hljs-keyword">const</span> githubUserResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(
    <span class="hljs-string">`https://api.github.com/users/<span class="hljs-subst">${name}</span>`</span>,
  );
  <span class="hljs-keyword">const</span> githubUser = <span class="hljs-keyword">await</span> githubUserResponse.<span class="hljs-title function_">json</span>();

  <span class="hljs-comment">// 아바타 보여주기</span>
  <span class="hljs-keyword">let</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;img&quot;</span>);
  img.<span class="hljs-property">src</span> = githubUser.<span class="hljs-property">avatar_url</span>;
  img.<span class="hljs-property">className</span> = <span class="hljs-string">&quot;promise-avatar-example&quot;</span>;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">append</span>(img);

  <span class="hljs-comment">// 3초 대기</span>
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">3000</span>));
  <span class="hljs-comment">// await가 실행되면 해당 Promise가 처리되는 동작을 executor로 잡고 그 아래의 코드들은 Microtask Queue로 간다고 생각하면 된다. (.then과 동작이 똑같음.)</span>

  img.<span class="hljs-title function_">remove</span>();

  <span class="hljs-keyword">return</span> githubUser;
}

<span class="hljs-title function_">showAvatar</span>();
</code></pre>
<blockquote>
<p>await은 최상위 레벨 코드에서 동작하지 않는다.
이를 위해서 <code>IIFE ( Immediately Invoked function expression )</code>를 사용할 수 있습니다.</p>
</blockquote>
<pre><code class="hljs language-js">(<span class="hljs-title function_">async</span> ()=&gt;{
	<span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/article/promise-chaining/user.json`</span>);
	<span class="hljs-keyword">let</span> user = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
	...
})();
</code></pre>
<blockquote>
<p><code>promise.then</code>처럼 <code>await</code>도 <code>thenable</code> 객체를 받을 수 있다.</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Thenable</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">num</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span> = num;
  }
  <span class="hljs-title function_">then</span>(<span class="hljs-params">resolve, reject</span>) {
    <span class="hljs-title function_">alert</span>(resolve);
    <span class="hljs-comment">// 1000밀리 초 후에 이행됨(result는 this.num*2)</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span> * <span class="hljs-number">2</span>), <span class="hljs-number">1000</span>); <span class="hljs-comment">// (*)</span>
  }
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// 1초 후, 변수 result는 2가 됨</span>
  <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thenable</span>(<span class="hljs-number">1</span>);
  <span class="hljs-comment">// new Promise((resolve)=&gt;setTimeout(()=&gt; resolve(this.num*2),1000)).then((result)=&gt;alert(result)) 와 같다.</span>
  <span class="hljs-title function_">alert</span>(result);
}

<span class="hljs-title function_">f</span>();
</code></pre>
<blockquote>
<p><code>class method</code>에도 <code>async</code>를 사용할 수 있다. <code>async</code>가 붙은 메서드는 <code>async</code> 함수와 같이 Promise를 반환하며 await을 사용할 수 있다.</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Waiter</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">wait</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
  }
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Waiter</span>().<span class="hljs-title function_">wait</span>().<span class="hljs-title function_">then</span>(alert); <span class="hljs-comment">// 1</span>
</code></pre>
<h3 id="61"><mark style="background:#FFF3A3A6">에러 핸들링</mark></h3>
<p><code>await promise</code>는 Promise 객체의 <code>result</code>에 저장된 값을 반환한다.
반면 <code>Promise</code>가 거부되면 마치 <code>throw</code>문을 작성한 것처럼 에러를 던진다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// 아래 두 코드의 기능은 같다.</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>));
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;에러 발생!&quot;</span>);
}
</code></pre>
<p><code>await</code>가 던진 에러는 <code>throw</code>가 던진 에러를 잡을 때처럼 <code>try...catch</code>를 사용해 잡을 수 있다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;http://유효하지-않은-주소&quot;</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-title function_">alert</span>(err); <span class="hljs-comment">// TypeError: failed to fetch</span>
  }
}

<span class="hljs-title function_">f</span>();
</code></pre>
<p>에러가 발생하면 <code>catch</code> 블록으로 제어 흐름이 넘어가게 된다.</p>
<p>원래 <code>async function</code>에 리턴값이 없으면 <code>fulfilled Promise</code>에 <code>undefined</code>가 담겨서 리턴되지만</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241110193617.png" alt=""/></p>
<p><code>async function</code>에서 <code>await</code>한 <code>Promise</code>가 <code>reject</code>된다면 <code>rejected</code>된 <code>Promise</code>에 에러가 담겨서 리턴된다. (또한,에러도 발생한다.)</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241110193853.png" alt=""/></p>
<p>위의 코드에서 <code>.catch</code>를 이어서 사용해서 해당 <code>Error</code>를 핸들링할 수 있다.</p>
<p><img src="/images/2024-11-10/Pasted%20image%2020241110193713.png" alt=""/></p>
<blockquote>
<p>여기서 <code>.catch</code>로 핸들링 되지 않은 에러는 전역 에러로 처리되는데 이는 <code>unhandledrejection</code>이벤트의 핸들러로 처리할 수 있다.</p>
</blockquote>
<blockquote>
<p><code>.then</code>을 <code>await</code>가 대신해주고 <code>.catch</code>를 <code>try..catch</code>로 대신해주기 때문에 동일한 기능을 쓰지만 사용하는 쪽에서 훨씬 편하게 쓸 수 있다. 하지만 <code>await</code>은 최상위 레벨 코드에서는 사용할 수 없어서 (async가 없는 최상위 레벨 코드) <code>.then/ .catch</code>를 사용해야만 하는 경우가 발생한다.</p>
</blockquote>
<blockquote>
<p><code>async/ await</code>은 <code>Promise.all</code>과도 함께 쓸 수 있다, 에러 핸들링 역시 똑같이 <code>try...catch</code>를 활용할 수 있다.</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-comment">// Promise 처리 결과가 담긴 배열을 기다립니다.</span>
<span class="hljs-keyword">let</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
  <span class="hljs-title function_">fetch</span>(url1),
  <span class="hljs-title function_">fetch</span>(url2),
  ...
]);
</code></pre>
<blockquote>
<p>감을 익히기 위한 세 가지 과제가 있습니다. 한번 풀어보면 좋을 것 같다.
<a href="https://ko.javascript.info/async-await#tasks">https://ko.javascript.info/async-await#tasks</a></p>
</blockquote>
<h1 id="62"><mark style="background:#FF5582A6">비동기 관련 문제 풀이</mark></h1>
<p>다음은 비동기 관련 로직을 완벽하게 이해하기 위해서 만들어 본 문제이다.
각 <code>queue</code>와 <code>Web API</code>를 생각하면서 결과값은 무엇이고 왜인지 생각해보자.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">testFn</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 바로 실행</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// setTimeout 바로 실행, Web API로 타이밍 함수 넘김</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
  }, <span class="hljs-number">500</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// 바로 실행</span>
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-title function_">async</span> (resolve) =&gt; {
    <span class="hljs-comment">// executor 함수는 Promise 생성과 함께 바로 실행된다.</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;전&quot;</span>);
    <span class="hljs-keyword">await</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 여기까지 바로 실행, await 아래 내부 코드들은 전부 Microtask Queue로</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>); <span class="hljs-comment">// console.log(4)라는 콜백은 setTimeout이 실행되고 Web API에서 5000이라는 ms가 지난 후에 Macrotask queue로 전달된다.</span>
    }, <span class="hljs-number">5000</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;다음&quot;</span>);
    <span class="hljs-title function_">resolve</span>(<span class="hljs-number">4</span>);
  });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// 바로 실행</span>
  <span class="hljs-keyword">const</span> t = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-comment">// Promise 내부의 executor는 바로 실행되고 아래 코드들은 전부 Microtask queue로 이동</span>
    <span class="hljs-comment">// new Promise((resolve)=&gt;{console.log(6); resolve(&#x27;a&#x27;)}).then((t)=&gt;{console.log(t); console.log(7)})과 같다.</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">6</span>);
    <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;a&quot;</span>);
  });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(t);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">7</span>);
};
</code></pre>
<p><img src="/images/2024-11-10/Pasted%20image%2020241110155653.png" alt=""/></p>
<h2 id="63"><mark style="background:#FFB86CA6">풀이</mark></h2>
<table><thead><tr><th style="text-align:left"></th><th>1번째 task (testFn이라는 Macrotask 실행)</th><th>2번째 task (testFn 관련 Microtask 전부 실행)</th><th>코드 실행부터 500ms 지남</th><th>3번째 task ( 2를 출력하는 Macrotask 실행 )</th><th>Microtask Queue 비어있는 것 확인하고 다음으로 넘어감</th><th>코드 실행부터 5000ms 지남</th><th>4번째 task ( 4를 출력하는 Macrotask 실행)</th></tr></thead><tbody><tr><td style="text-align:left">Macrotask queue 상태</td><td></td><td></td><td>()=&gt;console.log(2)</td><td></td><td></td><td>()=&gt;console.log(4)</td><td></td></tr><tr><td style="text-align:left">Microtask queue 상태</td><td>console.log(4, &quot;다음&quot;), resolve(4), console.log(t), console.log(7)</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td style="text-align:left">Web API</td><td>500ms를 기다리면 ()=&gt;console.log(2)를 task queue로 넘기는 동작 실행,<br/>5,000ms를 기다리면 ()=&gt;console.log(4)를 taskqueue로 넘기는 동작 실행</td><td>500ms를 기다리면 ()=&gt;console.log(2)를 task queue로 넘기는 동작 실행,<br/>5,000ms를 기다리면 ()=&gt;console.log(4)를 taskqueue로 넘기는 동작 실행</td><td>5,000ms를 기다리면 ()=&gt;console.log(4)를 taskqueue로 넘기는 동작 실행</td><td>5,000ms를 기다리면 ()=&gt;console.log(4)를 taskqueue로 넘기는 동작 실행</td><td>5,000ms를 기다리면 ()=&gt;console.log(4)를 taskqueue로 넘기는 동작 실행</td><td></td><td></td></tr><tr><td style="text-align:left">출력</td><td>1, 3, 4 &#x27;전&#x27;, 5, 6</td><td>4 &quot;다음&quot;, a, 7</td><td></td><td>2</td><td></td><td></td><td>4</td></tr></tbody></table>
<blockquote>
<p><code>Macrotask</code> &gt; <code>Microtask</code> &gt; <code>requestAnimationFrame</code> &gt; <code>브라우저 렌더링</code> 순서로 렌더링이 진행되기 때문에 위의 코드 실행 중간에 이벤트가 발생해서 <code>Macrotask</code>가 하나 생기게 되면 해당 <code>Macrotask</code>에 관련된 브라우저 렌더링이 일어나고 위의 코드로 복귀하게 될 수 있다.</p>
</blockquote>
<h1 id="64"><mark style="background:#FF5582A6">마무리</mark></h1>
<blockquote>
<p>기존에는 비동기 코드가 Microtask Queue와 이벤트 루프를 활용해서 돌아간다는 정도만 알고 있었다면, 이제는 브라우저 렌더링 흐름과 함께 이해하면서
<strong>비동기 방식이 왜 필요한지</strong>를 더 정확히 알 수 있었다.<br/>
<!-- -->기본기를 탄탄하게 다져 보자는 생각으로 시작한 글이기에, 촘촘하게 배우려고 노력했고, 파편화된 지식을 모을 좋은 기회가 되었다.<br/>
<strong>이 기술이 왜 필요한지에</strong> 집중하면서부터는 좀 더 다양한 시각으로 볼 수 있게 된 것 같다.<br/>
<!-- -->이제 더 나아가 보자.</p>
</blockquote>
<h1 id="65"><mark style="background:#FF5582A6">참고 문헌</mark></h1>
<ul>
<li><a href="https://wikibook.co.kr/react-deep-dive/">https://wikibook.co.kr/react-deep-dive/</a></li>
<li><a href="https://ko.javascript.info/async">https://ko.javascript.info/async</a></li>
<li><a href="https://product.kyobobook.co.kr/detail/S000001766397">https://product.kyobobook.co.kr/detail/S000001766397</a></li>
<li><a href="https://inpa.tistory.com/entry/%F0%9F%8C%90-requestAnimationFrame-%EA%B0%80%EC%9D%B4%EB%93%9C">https://inpa.tistory.com/entry/%F0%9F%8C%90-requestAnimationFrame-%EA%B0%80%EC%9D%B4%EB%93%9C</a></li>
<li><a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">https://www.youtube.com/watch?v=8aGhZQkoFbQ</a></li>
</ul></section></section></section><!--$--><!--/$--><!--$--><!--/$--><section></section></div><!--/$--></div><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-arrow-up fixed bottom-5 right-5 h-8 w-8 opacity-50 hover:cursor-pointer hover:opacity-100"><circle cx="12" cy="12" r="10"></circle><path d="m16 12-4-4-4 4"></path><path d="M12 16V8"></path></svg><footer class="mt-6 border-t bg-background py-6"><div class="container mx-auto px-4"><div class="flex flex-col items-center justify-center gap-4"><div class="flex items-center justify-center gap-4"><div class="flex space-x-4"><a target="_blank" rel="noopener noreferrer" class="text-muted-foreground transition-colors hover:text-foreground" href="mailto:robot9917@gmail.com"><img alt="Email" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="transition-transform hover:scale-110" style="color:transparent" src="/icons/email.svg"/><span class="sr-only">GitHub</span></a></div><div class="flex space-x-4"><a target="_blank" rel="noopener noreferrer" class="text-muted-foreground transition-colors hover:text-foreground" href="https://github.com/codefug"><img alt="GitHub" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="transition-transform hover:scale-110" style="color:transparent" src="/icons/github.svg"/><span class="sr-only">GitHub</span></a></div></div><p class="text-sm text-muted-foreground">© <!-- -->2025<!-- --> CodeFug Blog</p></div></div></footer></main></div><script src="https://codefug.github.io/_next/static/chunks/webpack-cb9a9adc3ea1ef6e.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[6424,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"584\",\"static/chunks/584-131c0b3bf6034f9e.js\",\"668\",\"static/chunks/668-d1e9350793e28fea.js\",\"177\",\"static/chunks/app/layout-e5095dc886e81597.js\"],\"GoogleTagManager\"]\n3:I[9229,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"584\",\"static/chunks/584-131c0b3bf6034f9e.js\",\"668\",\"static/chunks/668-d1e9350793e28fea.js\",\"177\",\"static/chunks/app/layout-e5095dc886e81597.js\"],\"default\"]\n4:I[2943,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"584\",\"static/chunks/584-131c0b3bf6034f9e.js\",\"668\",\"static/chunks/668-d1e9350793e28fea.js\",\"177\",\"static/chunks/app/layout-e5095dc886e81597.js\"],\"SidebarProvider\"]\n5:I[6226,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"584\",\"static/chunks/584-131c0b3bf6034f9e.js\",\"668\",\"static/chunks/668-d1e9350793e28fea.js\",\"177\",\"static/chunks/app/layout-e5095dc886e81597.js\"],\"default\"]\n6:I[323,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"584\",\"static/chunks/584-131c0b3bf6034f9e.js\",\"668\",\"static/chunks/668-d1e9350793e28fea.js\",\"177\",\"static/chunks/app/layout-e5095dc886e81597.js\"],\"default\"]\n7:I[831,[],\"\"]\n8:I[8307,[],\"\"]\n9:I[70,[\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"345\",\"static/chunks/app/not-found-8b0af7c225bbe321.js\"],\"\"]\na:I[8092,[\"507\",\"static/chunks/app/posts/%5Bid%5D/layout-6a37c5d18e0b4ffc.js\"],\"default\"]\nc:I[9757,[],\"MetadataBoundary\"]\ne:I[9757,[],\"OutletBoundary\"]\n11:I[8475,[],\"AsyncMetadataOutlet\"]\n13:I[4299,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"880\",\"static/chu"])</script><script>self.__next_f.push([1,"nks/app/posts/%5Bid%5D/page-a37ccfd5df9b4a85.js\"],\"Image\"]\n14:I[9757,[],\"ViewportBoundary\"]\n16:I[7882,[\"219\",\"static/chunks/app/global-error-e65e17ac78cfa06a.js\"],\"default\"]\n:HL[\"https://codefug.github.io/_next/static/media/518331124efecf5c-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"https://codefug.github.io/_next/static/css/4e45607bcfa6a776.css\",\"style\"]\n:HL[\"https://codefug.github.io/_next/static/css/7b1838e6bdc2260c.css\",\"style\"]\n:HL[\"https://codefug.github.io/_next/static/css/fc37ac2b1a278e8c.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"BCuTkdIfYD1bubeTTnV-H\",\"p\":\"https://codefug.github.io\",\"c\":[\"\",\"posts\",\"2024-11-10\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2024-11-10\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://codefug.github.io/_next/static/css/4e45607bcfa6a776.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"https://codefug.github.io/_next/static/css/7b1838e6bdc2260c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"$L2\",null,{\"gtmId\":\"$undefined\"}],[\"$\",\"body\",null,{\"className\":\"__className_7ee20e antialiased\",\"children\":[\"$\",\"$L3\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$L4\",null,{\"defaultOpen\":false,\"children\":[[\"$\",\"$L5\",null,{\"totalFrontMatterList\":[{\"id\":\"2024-11-10\",\"title\":\"Asynchronous JavaScript\",\"excerpt\":\"microtask queue, macrotask queue, call stack, web api와 관련된 비동기 동작 방식, 비동기 관련 역사와 비동기 코드의 다양한 활용법들을 알아보자.\",\"date\":\"2024-11-10\",\"categories\":[\"javascript\"],\"header\":{\"teaser\":\"/images/logos/JS.svg\"}},{\"id\":\"2024-09-14-4\",\"title\":\"(꼼꼼 프로젝트) streaming 방식의 tanstack query\",\"excerpt\":\"infinite scroll, optimistic update 그리고 streaming 방식이 결합된 쿼리 처리 ( useSuspenseQuery, useSuspenseInfiniteQuery )\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/tanstackQuery.png\"}},{\"id\":\"2024-09-14-3\",\"title\":\"(꼼꼼 프로젝트) 클라이언트와 서버 둘다 호환되는 fetch 구현\",\"excerpt\":\"서버 액션을 활용한 refresh token rotation, 커링 함수를 이용한 리팩토링\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/fetch.png\"}},{\"id\":\"2024-09-14-2\",\"title\":\"(꼼꼼 프로젝트) startTransition, progress bar 구현에 대한 고민\",\"excerpt\":\"progress bar 로직 연구하기(startTransition), next-nprogress-bar\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/nprogress.png\"}},{\"id\":\"2024-09-14-1\",\"title\":\"(꼼꼼 프로젝트) toss slash 분석, zustand와 연결된 커스텀 overlay 훅 구현\",\"excerpt\":\"stacking context, compound pattern, 전역 상태를 활용한다는 것의 의미, 토스 개발자 실력 흡수하기\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/toss.png\"}},{\"id\":\"2024-09-11\",\"title\":\"(꼼꼼 프로젝트) 공통 버튼 컴포넌트의 종류를 쉽게 관리하고 누구나 쉽게 확인할 수 있게 하는 방법\",\"excerpt\":\"tailwind로 조건부 처리를 간편하게 하는 방법, 비개발자도 스타일을 쉽게 확인할 수 있도록 storybook 연동\",\"date\":\"2024-09-11\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/storybook.png\"}},{\"id\":\"2024-07-22-2\",\"title\":\"(급페이 프로젝트) 개발환경에만 집중하기 위한 여정\",\"excerpt\":\"접근 제한을 위한 미들웨어 처리, vercel CLI을 이용한 organization 무료 자동 배포, 프리뷰\",\"date\":\"2024-07-22\",\"categories\":[\"gheuppay\"],\"header\":{\"teaser\":\"/images/logos/vercel.png\"}},{\"id\":\"2024-07-22-1\",\"title\":\"(급페이 프로젝트) 알림창 무한 스크롤을 위한 여정 (mock fetching을 위한 MSW 도입기)\",\"excerpt\":\"msw를 활용해서 프론트엔드 개발이 다 되어있지 않은 상태에서도 무한 스크롤 구현을 확인할 수 있게 되었습니다.\",\"date\":\"2024-07-22\",\"categories\":[\"gheuppay\"],\"header\":{\"teaser\":\"/images/logos/msw.png\"}},{\"id\":\"2024-07-21\",\"title\":\"(급페이 프로젝트) 카드 렌더링을 최적화하여 UX를 향상시키기 위한 머나먼 여정\",\"excerpt\":\"server component 설계를 이용한 suspense 적극 활용, 이를 위해서 next cookie를 사용하면서 겪은 문제들을 적은 글입니다.\",\"date\":\"2024-07-21\",\"categories\":[\"gheuppay\"],\"header\":{\"teaser\":\"/images/logos/next-cookie.png\"}},{\"id\":\"2024-06-18\",\"title\":\"React Testing\",\"excerpt\":\"React Testing Library, Vitest, Jest\",\"date\":\"2024-06-18\",\"categories\":[\"reactdeepdive\"],\"header\":{\"teaser\":\"/images/logos/reactdeepdive.jpg\"}},{\"id\":\"2024-06-17\",\"title\":\"로그인 구현 (zustand, zod + react-hook-form, RTR)\",\"excerpt\":\"zustand를 이용한 로그인 상태 전역 관리, zod를 이용한 간단한 스키마 전개, react-hook-form을 이용한 간단한 validation, axios를 이용한 간단한 api 요청 처리\",\"date\":\"2024-06-17\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/zod.png\"}},{\"id\":\"2024-06-15\",\"title\":\"Dev tool\",\"excerpt\":\"리액트 과거, 현재, 미래\",\"date\":\"2024-06-15\",\"categories\":[\"web\"],\"header\":{\"teaser\":\"/images/logos/reactdeepdive.jpg\"}},{\"id\":\"2024-06-14\",\"title\":\"마이그레이션 중 발생한 Vite 환경 변수 처리\",\"excerpt\":\"Vite_ENV\",\"date\":\"2024-06-14\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/react.png\"}},{\"id\":\"2024-06-10\",\"title\":\"React Debugging\",\"excerpt\":\"react-dev-tools 정리, 실습\",\"date\":\"2024-06-10\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/react.png\"}},{\"id\":\"2024-06-08\",\"title\":\"자잘한 Next.js 트러블 슈팅들\",\"excerpt\":\"react-responsive를 사용하지 못하는 상황, dotenv 사용시 문제 발생\",\"date\":\"2024-06-08\",\"categories\":[\"nextjs\"],\"header\":{\"teaser\":\"/images/logos/Nextjs.png\"}},{\"id\":\"2024-05-31\",\"title\":\"Next는 왜 쓸까\",\"excerpt\":\"CSR SSG SSR\",\"date\":\"2024-05-31\",\"categories\":[\"nextjs\"],\"header\":{\"teaser\":\"/images/logos/Nextjs.png\"}},{\"id\":\"2024-05-23\",\"title\":\"리액트는 왜 쓸까\",\"excerpt\":\"리액트 과거, 현재, 미래\",\"date\":\"2024-05-23\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/reactdeepdive.jpg\"}},{\"id\":\"2024-05-22\",\"title\":\"TS는 왜 쓸까 (위대한 TS)\",\"excerpt\":\"JS를 완벽하게 하기 위한 여정\",\"date\":\"2024-05-22\",\"categories\":[\"typescript\"],\"header\":{\"teaser\":\"/images/logos/TS.png\"}},{\"id\":\"2024-05-20\",\"title\":\"Fandom-k 프로젝트 회고3\",\"excerpt\":\"Github Actions, 최종 결과\",\"date\":\"2024-05-20\",\"categories\":[\"fandomk\"],\"header\":{\"teaser\":\"/images/logos/githubActions.png\"}},{\"id\":\"2024-05-19\",\"title\":\"Fandom-k 프로젝트 회고2\",\"excerpt\":\"fetch, scroll to Top, infinite scroll 라이브러리 제거\",\"date\":\"2024-05-19\",\"categories\":[\"fandomk\"],\"header\":{\"teaser\":\"/images/logos/fetch.png\"}},{\"id\":\"2024-05-18\",\"title\":\"Fandom-k 프로젝트 회고1\",\"excerpt\":\"팀 프로젝트 세팅, infinite scroll, skeleton\",\"date\":\"2024-05-18\",\"categories\":[\"fandomk\"],\"header\":{\"teaser\":\"/images/logos/infinite-scroll.png\"}}]}],[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h2\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":\"잘못된 페이지에요!\"}],[\"$\",\"$L9\",null,{\"href\":\"/\",\"children\":\"홈으로 돌아가기\"}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]}]}]]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"2024-11-10\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://codefug.github.io/_next/static/css/fc37ac2b1a278e8c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"div\",null,{\"className\":\"prose mx-auto overflow-auto dark:prose-invert\",\"children\":[[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"$La\",null,{}]]}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$Lb\",[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],null,[\"$\",\"$Le\",null,{\"children\":[\"$Lf\",\"$L10\",[\"$\",\"$L11\",null,{\"promise\":\"$@12\"}]]}]]}],{},null,false]},null,false]},null,false]},[[\"$\",\"div\",\"l\",{\"className\":\"flex h-full items-center justify-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"scale-[1.15] animate-pulse transition-transform\",\"children\":[\"$\",\"$L13\",null,{\"src\":\"/images/main-logo.png\",\"alt\":\"로딩 중...\",\"width\":120,\"height\":120,\"className\":\"drop-shadow-lg\"}]}],[\"$\",\"p\",null,{\"className\":\"mt-6 animate-pulse text-lg font-bold text-gray-600\",\"children\":\"Codefug Blog\"}]]}]}],[],[]],false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"i-cGaslz7lcNEZcngfrAT\",{\"children\":[[\"$\",\"$L14\",null,{\"children\":\"$L15\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$16\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"17:\"$Sreact.suspense\"\n18:I[8475,[],\"AsyncMetadata\"]\nd:[\"$\",\"$17\",null,{\"fallback\":null,\"children\":[\"$\",\"$L18\",null,{\"promise\":\"$@19\"}]}]\n"])</script><script>self.__next_f.push([1,"10:null\n"])</script><script>self.__next_f.push([1,"15:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nf:null\n"])</script><script>self.__next_f.push([1,"19:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Codefug Blog\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"project experiences and development notes\"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"Codefug Blog\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"project experiences and development notes\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:url\",\"content\":\"https://codefug-blog.vercel.app\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:image\",\"content\":\"http://localhost:3000/images/main-logo.png\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:image:alt\",\"content\":\"Codefug Blog\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:title\",\"content\":\"Codefug Blog\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:description\",\"content\":\"project experiences and development notes\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:image\",\"content\":\"http://localhost:3000/images/main-logo.png\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:image:alt\",\"content\":\"Codefug Blog\"}],[\"$\",\"link\",\"13\",{\"rel\":\"icon\",\"href\":\"/icon.ico?f00882ffa3186f37\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]],\"error\":null,\"digest\":\"$undefined\"}\n12:{\"metadata\":\"$19:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"1a:I[2464,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-a37ccfd5df9b4a85.js\"],\"GtmPageView\"]\n1b:I[9792,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-a37ccfd5df9b4a85.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"b:[\"$\",\"section\",null,{\"children\":[[\"$\",\"$L1a\",null,{\"slug\":\"2024-11-10\"}],[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"relative mb-6 h-[300px] w-full overflow-hidden rounded-xl sm:h-[400px] md:h-[450px]\",\"children\":[[\"$\",\"$L13\",null,{\"src\":\"/images/logos/JS.svg\",\"alt\":\"Asynchronous JavaScript\",\"fill\":true,\"sizes\":\"(max-width: 768px) 100vw, 1200px\",\"priority\":true,\"className\":\"object-cover object-center transition-transform duration-500 hover:scale-105\"}],[\"$\",\"div\",null,{\"className\":\"absolute inset-0 bg-gradient-to-b from-transparent to-black/70\"}],[\"$\",\"div\",null,{\"className\":\"absolute left-4 top-4 flex flex-wrap gap-2 sm:left-6 sm:top-6\",\"children\":[[\"$\",\"div\",\"javascript\",{\"className\":\"inline-flex items-center rounded-md border px-2.5 py-0.5 transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-white/90 text-xs font-medium text-gray-800 hover:bg-white sm:text-sm\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-tag mr-1 h-3 w-3\",\"children\":[[\"$\",\"path\",\"vktsd0\",{\"d\":\"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z\"}],[\"$\",\"circle\",\"kqv944\",{\"cx\":\"7.5\",\"cy\":\"7.5\",\"r\":\".5\",\"fill\":\"currentColor\"}],\"$undefined\"]}],\" \",\"javascript\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mb-6 space-y-4\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-0 text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-50 sm:text-4xl md:text-5xl\",\"children\":\"Asynchronous JavaScript\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center justify-end gap-4 text-sm text-gray-600 dark:text-gray-400\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar-days mr-2 h-4 w-4\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],[\"$\",\"path\",\"6423bh\",{\"d\":\"M8 14h.01\"}],[\"$\",\"path\",\"1etili\",{\"d\":\"M12 14h.01\"}],[\"$\",\"path\",\"1gbofw\",{\"d\":\"M16 14h.01\"}],[\"$\",\"path\",\"lrp35t\",{\"d\":\"M8 18h.01\"}],[\"$\",\"path\",\"mhygvu\",{\"d\":\"M12 18h.01\"}],[\"$\",\"path\",\"kzsmim\",{\"d\":\"M16 18h.01\"}],\"$undefined\"]}],[\"$\",\"time\",null,{\"dateTime\":\"2024-11-10\",\"children\":\"2024-11-10\"}]]}]}],[\"$\",\"p\",null,{\"className\":\"text-lg leading-relaxed text-gray-600 dark:text-gray-300 md:text-xl\",\"children\":\"microtask queue, macrotask queue, call stack, web api와 관련된 비동기 동작 방식, 비동기 관련 역사와 비동기 코드의 다양한 활용법들을 알아보자.\"}]]}],[\"$\",\"div\",null,{\"className\":\"border-b border-gray-200 dark:border-gray-800\"}]]}],[\"$\",\"section\",null,{\"className\":\"lg:flex lg:items-baseline\",\"children\":[[\"$\",\"$L1b\",null,{}],[\"$\",\"section\",null,{\"className\":\"max-w-full\",\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://velog.velcdn.com/images/codefug/post/1863b8a0-6521-495b-85f2-22b0f35b6380/image.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":0,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FF5582A6\"},\"children\":\"비동기 통신의 이해\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"JS는 Single Thread에서 작동한다. 즉 한 번에 하나의 작업만 동기 방식으로 처리할 수 있다.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"동기(synchronous) : 직렬 방식으로 작업을 처리하는 것, 요청이 시작하고 응답을 받은 후에야 다음 작업 처리\"}],\"\\n\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"비동기(Asynchronous) : 병렬 방식으로 작업을 처리하는 것, 요청이 시작한 후 응답과 관계 없이 다음 작업 처리\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"사용자가 검색어를 입력해 검색을 위한 네트워크 요청이 발생한 순간에도 다른 작업을 처리할 수 있다. (비동기적 작업 방식)\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"리액트에서는 16 버전에 접어들면서 비동기식으로 작동하는 방법이 소개 되었다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":1,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"싱글 스레드 자바스크립트\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"과거, 프로그램을 실행하는 단위가 오직 \",[\"$\",\"strong\",null,{\"children\":\"Process\"}],\" 뿐이었다.\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Process\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"프로그램을 구동해 프로그램의 상태가 메모리 상에서 실행되는 작업 단위\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"현재, 하나의 프로그램에 여러가지 작업이 필요해졌고 더 작은 실행 단위인 \",[\"$\",\"strong\",null,{\"children\":\"thread\"}],\"가 탄생했다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"thread: 하나의 process에는 여러 개의 thread를 만들 수 있고, thread 끼리 메모리를 공유할 수 있다. 여러 작업을 동시 수행\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"JavaScript는 기본적으로 싱글 쓰레드 이다.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":2,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"JS가 멀티 쓰레드가 아닌 이유\"}]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"멀티 쓰레드는 내부적으로 처리가 복잡하며 같은 자원에 대해 여러 번 수정하는 등 동시성 문제가 발생할 수 있기에 이에 대한 처리가 필요하다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"각각 격리되어 있는 \",[\"$\",\"strong\",null,{\"children\":\"Process\"}],\"와 다르게 하나의 \",[\"$\",\"strong\",null,{\"children\":\"Thread\"}],\"가 문제가 생기면 다른 \",[\"$\",\"strong\",null,{\"children\":\"Thread\"}],\"도 문제가 발생할 수 있다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"JS이 \",[\"$\",\"strong\",null,{\"children\":\"멀티 스레딩\"}],\"을 지원해서 동시에 여러 쓰레드가 DOM을 조작할 수 있었다면 메모리 공유로 인해 동시에 같은 자원에 접근하게 되고 이 때문에 타이밍 이슈가 발생할 수 있고 DOM 표시에 큰 문제를 발생시킬 수 있다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":3,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"Event Loop\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"비동기 동작과 뗄 수 없는 개념은 \",[\"$\",\"code\",null,{\"children\":\"Event Loop\"}],\"이다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Node.js\"}],\"와 마찬가지로 브라우저 측 자바스크립트 실행 흐름도 \",[\"$\",\"code\",null,{\"children\":\"Event Loop\"}],\"에 기반을 둔다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Event Loop\"}],\"를 잘 알고 있어야 올바른 아키텍처 설계가 가능하다.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":4,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"자바스크립트 엔진 동작 방식\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"자바스크립트 엔진은 다음의 알고리즘을 갖고 있다.\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"처리해야 할 task가 있는 경우\",\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"먼저 들어온 task부터 차례대로 처리한다.\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"처리해야 할 task가 없는 경우\",\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"잠들어 있다가 새로운 task가 추가되면 다시 1번 과정으로 돌아간다.\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"자바스크립트 엔진은 대부분 시간을 아무런 일도 하지 않고 쉬다가 스크립트나 핸들러, 이벤트가 활성화될 때만 돌아간다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"자바스크립트 엔진을 활성화하는 task는 다음과 같다.\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"외부 스크립트 \",[\"$\",\"code\",null,{\"children\":\"\u003cscript src=\\\"...\\\"\u003e\"}],\"가 로드될 때, 이 스크립트를 실행하는 것\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"사용자가 마우스를 움직일 때 \",[\"$\",\"code\",null,{\"children\":\"mousemove\"}],\" 이벤트와 이벤트 핸들러를 실행하는 것\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\"에서 설정한 시간이 다 된 경우, 콜백 함수를 실행하는 것\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"기타 등등\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"task는 하나의 집합을 이룬다. 자바스크립트 엔진은 해당 task를 차례대로 처리하며 새로운 task가 추가될 때까지 기다린다. task를 기다리는 동안 CPU 자원 소비는 0에 가까워지고 엔진은 잠들게 된다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"엔진이 바쁠 때 task가 추가되면 해당 task는 \",[\"$\",\"strong\",null,{\"children\":\"Macrotask queue\"}],\"에 추가된다.\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"참고로 \",[\"$\",\"code\",null,{\"children\":\"task queue\"}],\"의 구조는 \",[\"$\",\"code\",null,{\"children\":\"queue\"}],\"가 아닌 \",[\"$\",\"code\",null,{\"children\":\"set\"}],\"이다. 선택된 큐에서 실행 가능한 가장 오래된 task를 가져와야 하기 때문이다.\\n무조건 먼저 들어온 첫번째 큐를 \",[\"$\",\"code\",null,{\"children\":\"dequeue\"}],\"하는 것이 아니라 실행 가능한 것들 중에 가장 오래된 task를 차례대로 실행시킨다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3\",\"children\":\"https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241108212123.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"(\",[\"$\",\"code\",null,{\"children\":\"script\"}],\"를 처리하는데 중간에 \",[\"$\",\"code\",null,{\"children\":\"mousemove\"}],\" 핸들러도 실행되고 \",[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\"에서 설정한 시간이 지나서 콜백이 들어온 경우의 상태를 그림으로 나타냄)\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"JavaScript 엔진은 이들을 차례대로 처리한다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이때 알아야 할 두가지는\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"엔진이 task를 처리하는 동안은 렌더링이 일어나지 않는다. 처리를 완료하면 DOM 변경을 화면에 반영한다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"task에 긴 시간이 걸리면 task를 처리하는 동안 발생한 새로운 task를 처리하지 못한다. ( 응답 없는 페이지라는 alert 창은 페이지 전체와 함께 현재 task를 최소시킬지 말지를 선택하게 한다. )\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":5,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"예시 1: CPU 소모가 많은 task 쪼개기\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"CPU 소모가 아주 많은 task 하나가 있다고 가정해보자.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" i = \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" start = \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Date\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"now\"}],\"();\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// CPU 소모가 많은 무거운 작업을 수행\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"for\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" j = \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\"; j \u003c \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e9\"}],\"; j++) {\\n    i++;\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"처리에 걸린 시간: \\\"\"}],\" + (\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Date\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"now\"}],\"() - start) + \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"ms\\\"\"}],\");\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"();\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"1e9 (0이 9개)을 센 다음 alert를 하는 코드인데 해당 count()가 실행되는 동안 브라우저는 사용자 이벤트 처리나 DOM 관련 작업을 완전히 멈추게 되는 것을 확인할 수 있다.\\n( 실행시키고 페이지에 마우스 우클릭을 하면 alert가 나올때까지 아무것도 안 보이다가 alert가 나오고 마우스 우클릭시 나오는 메뉴가 나온다. )\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"코드를 쪼개서 이를 개선해보자.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" i = \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" start = \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Date\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"now\"}],\"();\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 무거운 작업을 쪼갠 후 이를 수행 (*)\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"do\"}],\" {\\n    i++;\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 2* 1e6, 3* 1e6 등 1e6의 배수에서 do while 문을 나가게 된다.\"}],\"\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"while\"}],\" (i % \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e6\"}],\" != \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\");\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (i == \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e9\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 위의 do while문을 1e3번 반복하면 도착\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"처리에 걸린 시간: \\\"\"}],\" + (\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Date\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"now\"}],\"() - start) + \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"ms\\\"\"}],\");\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1e6의 배수이지만 1e9가 아닐 경우\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(count); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 새로운 호출을 스케줄링 (**)\"}],\"\\n  }\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"();\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"do while문을 1e3번 반복해서 alert가 나오게 되는데 그 이전까지 setTimeout으로 count를 넘기기 때문에 동기적인 코드들은 돌아갈 수 있게 되고 이 때문에 이벤트 핸들러, DOM 관련 동작 들을 해결할 수 있게 된다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위 코드는 사실 조금의 시간차가 존재한다. 다음처럼 setTimeout을 앞으로 끌어오면 이를 해결할 수 있다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" i = \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" start = \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Date\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"now\"}],\"();\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 스케줄링 코드를 함수 앞부분으로 옮김\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (i \u003c \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e9\"}],\" - \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e6\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(count); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 새로운 호출을 스케줄링함\"}],\"\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"do\"}],\" {\\n    i++;\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"while\"}],\" (i % \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e6\"}],\" != \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\");\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (i == \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e9\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"처리에 걸린 시간: \\\"\"}],\" + (\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Date\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"now\"}],\"() - start) + \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"ms\\\"\"}],\");\\n  }\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"();\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"부분 카운팅 (\",[\"$\",\"code\",null,{\"children\":\"do...while\"}],\")이 일어나기 전에 부분 재스케줄링(\",[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\")이 일어나게 된다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"setTimeout 호출이 많은 경우, 브라우저 최소 대기 시간이 4밀리초이기 때문에 숫자 세기 전에 스케줄링을 하면 숫자를 세면서 대기 시간을 소모하기 때문에 실행이 더 빨라진다.\\n(setTimeout 로직이 뒤쪽에 있으면 setTimeout(count) 실행되고 바로 다음 macrotask로 count 함수가 실행돼야 되는데 안 가고 4ms 있다가 실행된다는 뜻)\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":6,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"예시 2: Progress bar\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"task를 여러 개로 쪼갤 때의 장점은 진행 상태를 나타내주는 \",[\"$\",\"code\",null,{\"children\":\"progress bar\"}],\"를 만들 때도 드러난다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[\"\u003cdiv id=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"progress\\\"\"}],\"\u003e\u003c/div\u003e\\n\\n\",[\"$\",\"span\",null,{\"className\":\"xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"script\"}],\"\u003e\"]}],[\"$\",\"span\",null,{\"className\":\"javascript\",\"children\":[\"\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"for\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" i = \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\"; i \u003c \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e6\"}],\"; i++) {\\n      i++;\\n      progress.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"innerHTML\"}],\" = i;\\n    }\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"();\\n\"]}],[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"script\"}],\"\u003e\"]}]]}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"브라우저는 시간이 오래 걸리든 아니든 상관 없이 현재 작업 중인 task가 끝나야 DOM 변경분을 화면에 렌더링한다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"그래서 위의 코드는 \",[\"$\",\"code\",null,{\"children\":\"progress bar\"}],\"의 기능을 완수하지 못한다. i가 전부 지나가야(현재 작업 중인 task가 끝나야) DOM을 렌더링하기 때문이다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[\"\u003cdiv id=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"progress\\\"\"}],\"\u003e\u003c/div\u003e\\n\\n\",[\"$\",\"span\",null,{\"className\":\"xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"script\"}],\"\u003e\"]}],[\"$\",\"span\",null,{\"className\":\"javascript\",\"children\":[\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" i = \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\";\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 무거운 작업을 쪼갠 후 이를 수행\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"do\"}],\" {\\n      i++;\\n      progress.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"innerHTML\"}],\" = i;\\n    } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"while\"}],\" (i % \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e3\"}],\" != \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\");\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (i \u003c \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e7\"}],\") {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(count);\\n    }\\n\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"();\\n\"]}],[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"script\"}],\"\u003e\"]}]]}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"위처럼 코드를 분할하게 되면 i가 변화하는 과정을 출력해 줄 수 있다, \",[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\"으로 \",[\"$\",\"code\",null,{\"children\":\"count\"}],\"를 넘기기 때문에 count와 count 함수 사이에서 동기적인 동작들을 수행할 수 있게 되고 결론적으로 \",[\"$\",\"code\",null,{\"children\":\"progress.innerHTML\"}],\"이 변경되었다는 DOM 변경 동작이 일어나게 된다.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":7,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"예시 3: 이벤트 처리가 끝난 이후에 작업\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이벤트 핸들러를 만들 때 특정 액션을 모든 이벤트 버블링이 끝나고 실행시키고 싶다면 \",[\"$\",\"code\",null,{\"children\":\"ms\"}],\"가 0인 \",[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\"을 사용하면 된다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[\"menu.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"onclick\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// ...\"}],\"\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 클릭한 메뉴 내 항목 정보가 담긴 커스텀 이벤트 생성\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" customEvent = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"CustomEvent\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"menu-open\\\"\"}],\", {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"bubbles\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"true\"}],\",\\n  });\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 비동기로 커스텀 이벤트를 디스패칭\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" menu.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"dispatchEvent\"}],\"(customEvent));\\n};\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위를 살펴보면 \\\"menu-open\\\" 이라는 커스텀 이벤트를 만든 후 해당 이벤트를 setTimeout으로 넘겼다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이제 menu의 click 이벤트가 완전히 핸들링된 후에 \",[\"$\",\"code\",null,{\"children\":\"menu-open\"}],\" 이벤트를 dispatching하게 된다.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":8,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"Macrotask와 Microtask\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":9,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"Microtask\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Microtask\"}],\"는 주로 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 사용해 만든다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"와 함께 쓰이는 \",[\"$\",\"code\",null,{\"children\":\".then/catch/finally\"}],\"의 핸들러 (소비 함수)가 \",[\"$\",\"code\",null,{\"children\":\"Microtask\"}],\"가 된다. 또는 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 핸들링하는 \",[\"$\",\"code\",null,{\"children\":\"await\"}],\"를 사용해 만들기도 한다.\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이 외에도 표준 API인 \",[\"$\",\"code\",null,{\"children\":\"queueMicrotask(func)\"}],\"를 사용해서 함수 \",[\"$\",\"code\",null,{\"children\":\"func\"}],\"를 \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\"에 넣어서 처리할 수 있다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"자바스크립트 엔진은 \",[\"$\",\"strong\",null,{\"children\":\"Macrotask\"}],\"를 하나 처리할 때마다 js 엔진은 다른 \",[\"$\",\"code\",null,{\"children\":\"Macrotask\"}],\"를 수행하거나 렌더링하는 등의 작업을 하기 전에 \",[\"$\",\"strong\",null,{\"children\":\"Microtask Queue\"}],\"에 있는 모든 task를 실행한다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"timeout\\\"\"}],\"));\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"().\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"promise\\\"\"}],\"));\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"code\\\"\"}],\");\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (현재 호출 스택에서 script 태그에 있는 코드를 읽는 Macrotask중이며 코드를 한 줄씩 넣으면서 실행 중에 있음)\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1. setTimeout(()=\u003ealert(\\\"timeout\\\")) - 호출 스택에서 실행, ms가 지나면 콜백 함수를 Macrotask queue에 등록\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 2. Promise.resolve().then(()=\u003ealert(\\\"promise\\\")) - 콜백 함수를 Microtask Queue에 등록\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 3. alert(\\\"code\\\") - 바로 호출된다. (현재 script 태그를 읽는 Macrotask를 수행 중이다.)\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 4. script 태그에 있는 코드를 읽는 Macrotask 종료\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 5. Microtask queue에 있는 then() 콜백 함수 실행 (호출 스택으로 이동해서 실행, 이 과정에서 이벤트 루프는 다 비워질 때까지 안 돌아감)\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 6. Microtask queue 비워짐\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 7. ()=\u003ealert(\\\"timeout\\\") - 다음 Macrotask 실행 (호출 스택에서 Macrotask 하나 이동)\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (해당 Macrotask가 끝나면 다시 Microtask 실행해서 Microtask queue 비우고 렌더링 \u003e 다음 Macrotask 실행 반복)\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":10,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"처리 로직\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241109193930.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Macrotask (script, mousemove, setTimeout 등)\"}],\" 하나가 처리되고 난 후 \",[\"$\",\"code\",null,{\"children\":\"Microtask\"}],\" 전부가 처리되고 그 이후 렌더링이 진행되는 것을 확인할 수 있다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Microtask는 다른 이벤트 핸들러나 렌더링 작업, 혹은 다른 Macrotask가 실행되기 전에 전부 처리된다.\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"script 태그에 있는 코드를 읽는 작업도 \",[\"$\",\"code\",null,{\"children\":\"Macrotask\"}],\"이기 때문에 script 코드를 한 줄씩 호출 스택에 담고 실행하는 과정이 끝난 후에 Microtask들을 실행한다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이런 처리순서가 아주 중요한 이유는 마우스 좌표 변경이나 네트워크 통신에 의한 데이터 변경같이 애플리케이션 환경에 변화를 주는 작업에 영향을 받지 않고 모든 \",[\"$\",\"code\",null,{\"children\":\"Microtask\"}],\"를 동일한 환경에서 처리할 수 있기 때문이다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"\\\"현재 실행 중인 macrotask 실행이 끝나면 \u003e 현재 존재하는 모든 microtask 실행 \u003e 렌더링 \u003e 다음 macrotask 실행\\\" 의 순서를 가진다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"위 과정을 확인하기 위해서 리페인트 전에 콜백 함수를 호출하는 \",[\"$\",\"strong\",null,{\"children\":\"requestAnimationFrame\"}],\"으로 확인해보자.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241109221737.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"requestAnimationFrame\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241109214448.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"브라우저 리페인트 전에 애니메이션 처리를 하기 위해 사용하는 윈도우 메소드,\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"별도의 큐에서 관리되어 프레임 단위로 렌더링할 수 있도록 보장한다. ( 초당 프레임 기준은 모니터 주사율에 의해 설정된다. )\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"프레임 단위의 렌더링을 보장하기 때문에 애니메이션 동작이 더 부드러워진다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"만약 임의로 특정 함수를 \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\"로 보내고 싶다면 \",[\"$\",\"code\",null,{\"children\":\"queueMicrotask\"}],\" 함수를 사용하면 된다.\\n( \",[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\"과 다른 점은 만약 \",[\"$\",\"code\",null,{\"children\":\"ms\"}],\"가 0초인 \",[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\"을 이용할 때는 \",[\"$\",\"code\",null,{\"children\":\"Macrotask queue\"}],\"로 보내져서 기존의 \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\"가 다 끝나고 다음 \",[\"$\",\"code\",null,{\"children\":\"Macrotask\"}],\"가 실행될 때 특정 함수가 실행될 것이다.)\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[\"\u003cdiv id=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"progress\\\"\"}],\"\u003e\u003c/div\u003e\\n\\n\",[\"$\",\"span\",null,{\"className\":\"xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"script\"}],\"\u003e\"]}],[\"$\",\"span\",null,{\"className\":\"javascript\",\"children\":[\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" i = \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\";\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 무거운 작업을 쪼갠 후 이를 수행\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"do\"}],\" {\\n      i++;\\n      progress.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"innerHTML\"}],\" = i;\\n    } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"while\"}],\" (i % \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e3\"}],\" != \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\");\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (i \u003c \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1e6\"}],\") {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"queueMicrotask\"}],\"(count);\\n    }\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"count\"}],\"();\\n\"]}],[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"script\"}],\"\u003e\"]}]]}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"렌더링이 되기 전에 Microtask Queue에 있는 count 함수가 재귀 호출을 하며 Microtask Queue에 새로운 count 함수를 추가하는 방식이므로 실제 화면에는 최종값만 보이게 된다. ( microtask queue가 비워져야 브라우저 렌더링이 일어남. )\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"다음 예제를 통해 확실히 알아가보자.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// sync, macro, micro 원소 안에 숫자가 있고 button으로 이들을 제어한다고 가정.\"}],\"\\nbutton.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"addEventListener\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"click\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"for\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" i = \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\"; i \u003c= \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"100000\"}],\"; i++) {\\n    sync.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"innerHTML\"}],\" = i;\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n      macro.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"innerHTML\"}],\" = i;\\n    }, \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\");\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"queueMicrotask\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n      micro.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"innerHTML\"}],\" = i;\\n    });\\n  }\\n});\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위 핸들러를 실행시키면 다음의 결과가 나온다.\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"sync\"}],\"는 렌더링이 일어나지 않다가 100,000 상태가 된다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"micro\"}],\"는 렌더링이 일어나지 않다가 100,000 상태가 된다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"macro\"}],\"는 잠시 기다리다가 1부터 100,000까지 차례대로 렌더링된다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_1.jpg\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이때 차례대로 실행되는 코드들(\",[\"$\",\"code\",null,{\"children\":\"sync.innerHTML = i\"}],\", \",[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\", \",[\"$\",\"code\",null,{\"children\":\"queryMicrotask\"}],\") 이 실행되고 있을 때는 브라우저에서 다른 동작을 할 수 없다. ( 콜 스택에 있는거 다 버리고 동작을 진행할 수는 없으니 )\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\"의 타이밍 함수 (시간을 새서 콜백을 던져주는 함수)같은 WEB API는 \",[\"$\",\"code\",null,{\"children\":\"Macrotask queue\"}],\"가 할당되는 외부 쓰레드에서 진행된다. 작업을 할당해 처리하는 것은 브라우저나 Node.js의 역할이다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_2.jpg\",\"alt\":\"\"}],\"\\n\",[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_3.jpg\",\"alt\":\"\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"단, 만약 중간에 다른 \",[\"$\",\"code\",null,{\"children\":\"Macrotask\"}],\"(마우스 이벤트 등등)가 \",[\"$\",\"code\",null,{\"children\":\"Macrotask queue\"}],\"로 들어와서 먼저 실행 가능 상태가 된다면 \",[\"$\",\"code\",null,{\"children\":\"queue\"}],\"에서는 해당 \",[\"$\",\"code\",null,{\"children\":\"Macrotask\"}],\"를 처리할 것이다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이제 \\\"왜\\\" 사용하는지 알게 되었으니 비동기 작업을 \\\"어떻게\\\" 사용하는지, 그 흐름을 더 자세히 알아보자.\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":11,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FF5582A6\"},\"children\":\"비동기 작업의 역사와 개념\"}]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":12,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"콜백\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"호스트 환경이 제공하는 함수를 사용하면 비동기 동작을 스케줄링할 수 있다. ( \",[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\" 같은 함수)\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"스크립트나 모듈을 로드하는 함수도 비동기라고 할 수 있는데 이를 예시로 살펴보자.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"src\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// \u003cscript\u003e 태그를 만들고 페이지에 태그를 추가한다.\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 태그가 페이지에 추가되면 src에 있는 스크립트를 로딩하고 실행한다.\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" script = \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"createElement\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"script\\\"\"}],\");\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"src\"}],\" = src;\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"head\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(script);\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 해당 경로에 있는 스크립트를 불러오고 실행한다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/my/script.js\\\"\"}],\");\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// ...\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이때 스크립트는 비동기적으로 실행된다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"따라서 loadScript 아래 코드들은 loadScript가 끝나는 것을 기다리지 않는다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/my/script.js\\\"\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// script.js엔 \\\"function newFunction() {…}\\\"이 있다.\"}],\"\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// script.js에 있는 newFunction을 사용하려고 하는데\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 함수가 존재하지 않는다는 에러가 발생한다!\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"newFunction\"}],\"();\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"여기에 콜백을 추가해보자.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"콜백 함수\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"주로 함수 안에 전달인자로 다른 함수에 전달되는 함수를 의미한다. 일종의 루틴이나 동작을 완료하기 위해 외부 함수 내부에서 호출된다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"src, callback\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" script = \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"createElement\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'script'\"}],\");\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"src\"}],\" = src;\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// script가 load 이벤트를 일으키면 (load 되면) callback에 script를 담아서 실행시킨다.\"}],\"\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"onload\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"callback\"}],\"(script);\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"head\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(script);\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'/my/script.js'\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 콜백 함수는 스크립트 로드가 끝나면 실행됩니다.\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"newFunction\"}],\"(); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 이제 함수 호출이 제대로 동작합니다.\"}],\"\\n  ...\\n});\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위의 방식을 콜백 기반 비동기 프로그래밍이라고 한다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"loadScript에 콜백 함수를 전해줘서 newFunction이 비동기 실행과 나란히 일어날 수 있게 해준다.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":13,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"에러 핸들링\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"스크립트 로딩이 실패하는 경우 발생하는 에러를 핸들링할 수 있어야 한다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"다음과 같이 개선해보자.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"src, callback\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" script = \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"createElement\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"script\\\"\"}],\");\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"src\"}],\" = src;\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 성공 시 null과 script를 인수에 넣고\"}],\"\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"onload\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"callback\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"null\"}],\", script);\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 실패 시 에러 객체를 인수에 넣는다.\"}],\"\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"onerror\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"callback\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${src}\"}],\"를 불러오는 도중에 에러가 발생했습니다.`\"]}],\"));\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"head\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(script);\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/my/script.js\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error, script\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (error) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 에러 처리\"}],\"\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 스크립트 로딩이 성공적으로 끝남\"}],\"\\n  }\\n});\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"위 패턴은 \",[\"$\",\"strong\",null,{\"children\":\"오류 우선 콜백\"}],\"으로 에러를 처리하기 위해 사용되는 흔한 패턴이다.\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"callback의 첫 번째 인수는 에러를 위해 남겨둔다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"두 번째 혹은 그 이상의 인수들은 에러가 발생하지 않았을 때 콜백 함수에 넘겨줄 인수들이다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":14,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"콜백 속 콜백\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"만약 두 개의 스크립트를 차례대로 불러오려 한다면 콜백 안에 콜백을 넣어야 한다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/my/script.js\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"script\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/my/script2.js\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"script\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/my/script3.js\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"script\"}],\") {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 세 스크립트 로딩이 끝난 후 실행됨\"}],\"\\n    });\\n  });\\n});\\n\"]}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":15,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"콜백 지옥\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241107193715.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위 방식은 멸망의 피라미드, 콜백 지옥이라 부르는 상황을 만든다.\\n(코드가 오른쪽으로 점점 옮겨지면서 가독성도 해치고 코드 재사용이 어려운 상황)\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이를 해결하기 위해서 논리적으로 다음과 같이 짤 수는 있는데\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"1.js\\\"\"}],\", step1);\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"step1\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error, script\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (error) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"handleError\"}],\"(error);\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// ...\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"2.js\\\"\"}],\", step2);\\n  }\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"step2\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error, script\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (error) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"handleError\"}],\"(error);\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// ...\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"3.js\\\"\"}],\", step3);\\n  }\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"step3\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error, script\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (error) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"handleError\"}],\"(error);\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 모든 스크립트가 로딩되면 다른 동작을 수행한다.\"}],\"\\n  }\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이는 모양만 개선되었지 내부 로직은 결국 위아래 옮겨 다니면서 파악해야 하고 재사용이 어려운 문제를 그대로 갖고 있다.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":16,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"무조건 콜백을 사용하면 안될까?\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"아니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"특정 동작이 끝나는 것이 보장되고 그다음 코드를 실행해야 할 때 사용하면 여전히 유용하다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"showCircle\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"150\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"150\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"100\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"div\"}],\") =\u003e\"]}],\" {\\n  div.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"classList\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"add\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"message-ball\\\"\"}],\");\\n  div.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"안녕하세요!\\\"\"}],\");\\n});\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"showCircle(cx, cy, radius, callback)은 천천히 커지는 원을 만드는 함수라고 치자.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"함수 내부에서 해당 callback을 이용해서 원을 다 만든 후에 요소에 \\\"안녕하세요!\\\"를 그리는 함수를 실행하도록 할 수 있다.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"콜백을 활용하면 해당 task를 Microtask Queue가 아니라 Macrotask queue로 task를 이동시킨다. ( \",[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\"의 동작 방식 )\\nMicrotask Queue와 Macrotask queue의 차이는 이 글의 하단 부분에서 이해할 수 있다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":17,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"Promise\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"시간이 얼마나 걸리던 상관없이 약속한 결과를 만들어내는 \\\"제작 코드\\\"가 준비되었을 때, 모든 \\\"소비 코드\\\"가 결과를 사용할 수 있도록 해준다.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"제작 코드\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"원격에서 스크립트를 불러오는 것 같은 시간이 걸리는 일\"}],\"\\n\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"소비 코드\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"제작 코드의 결과를 기다렸다가 이를 소비한다. 소비의 주체(함수)는 여럿이 될 수 있다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// executor (제작 코드, '가수')\"}],\"\\n});\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// promise.then/catch/finally 등등\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":18,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"executor 함수\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"new Promise\"}],\"에 전달되는 콜백은 executor라고 해서 \",[\"$\",\"code\",null,{\"children\":\"new Promise\"}],\"가 만들어질 때 자동으로 실행되며 결과를 최종적으로 만들어내는 제작 코드를 포함한다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"executor에서는 resolve, reject를 신경 쓰지 않고 코드를 작성하면 되는데 상황에 따라 resolve, reject 중 하나를 호출해야 한다.\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"resolve(value) - 일이 성공적으로 끝났을 때 그 결과를 나타내는 value와 함께 호출\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"reject(error) - 에러 발생 시 에러 객체를 나타내는 \",[\"$\",\"code\",null,{\"children\":\"error\"}],\"와 함께 호출\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241107200211.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"new Promise 생성자가 반환하는 promise 객체는 PromiseState, PromiseResult라는 내부 프로퍼티를 가진다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"resolve, reject 둘 다 일어나지 않았을 때\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241107195926.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"resolve일 때\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241107195831.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"reject일 때\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241107200104.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":19,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"executor 예시\"}]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"executor는 \",[\"$\",\"code\",null,{\"children\":\"new Promise\"}],\"에 의해 자동으로 그리고 즉각적으로 호출된다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"executor는 인자로 \",[\"$\",\"code\",null,{\"children\":\"resolve\"}],\"와 \",[\"$\",\"code\",null,{\"children\":\"reject\"}],\" 함수를 받는다. 이 함수들은 자바스크립트 엔진이 미리 정의한 함수이므로 개발자가 따로 만들 필요가 없다. 다만, \",[\"$\",\"code\",null,{\"children\":\"resolve\"}],\"나 \",[\"$\",\"code\",null,{\"children\":\"reject\"}],\" 중 하나는 반드시 호출해야 합니다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Promise가 만들어지면 executor 함수는 자동으로 실행된다.\"}],\"\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1초 뒤에 일이 성공적으로 끝났다는 신호가 전달되면서 result는 '완료'가 된다.\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"완료\\\"\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\");\\n});\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241107200545.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1초 뒤에 에러와 함께 실행이 종료되었다는 신호를 보냅니다.\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\")), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\");\\n});\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241107200740.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"resolve\"}],\"나 \",[\"$\",\"code\",null,{\"children\":\"reject\"}],\"가 완료된 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 \",[\"$\",\"code\",null,{\"children\":\"settled Promise\"}],\" 라고 부른다.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":20,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"주의사항\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":21,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"1. 한번 처리된 Promise는 바뀌지 않는다.\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"완료\\\"\"}],\");\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"…\\\"\"}],\")); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 무시됨\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"…\\\"\"}],\")); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 무시됨\"}],\"\\n});\\n\"]}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":22,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"2. Error 객체와 함께 reject해야 한다.\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":23,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"3. 꼭 Promise가 비동기적인 것을 다루지 않아도 된다.\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 일을 끝마치는 데 시간이 들지 않음\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"123\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 결과(123)를 즉시 resolve에 전달함\"}],\"\\n});\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위 방식대로 하면 즉시 이행 상태가 된다.\"}],\"\\n\",[\"$\",\"h4\",null,{\"id\":24,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"4. PromiseState와 PromiseResult는 내부 프로퍼티이기 때문에 직접 접근할 수 있다.\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":25,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"소비함수\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"소비 함수는 \",[\"$\",\"code\",null,{\"children\":\".then\"}],\", \",[\"$\",\"code\",null,{\"children\":\".catch\"}],\", \",[\"$\",\"code\",null,{\"children\":\".finally\"}],\" 메서드를 사용해 등록된다.\"]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":26,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\".then\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Promise fulfilled 혹은 rejected가 완료되면 이후에 실행되는 소비함수\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"완료!\\\"\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\");\\n});\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// resolve 함수는 .then의 첫 번째 함수(인수)를 실행합니다.\"}],\"\\npromise.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(result), \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1초 후 \\\"완료!\\\"를 출력\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(error), \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 실행되지 않음\"}],\"\\n);\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"성공 처리만 하고 싶다면 두번째 인수를 생략하면 된다.\"}],\"\\n\",[\"$\",\"h4\",null,{\"id\":27,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\".catch\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\".then(null, 에러처리함수)\"}],\" 형태로 에러만을 처리해도 되지만 \",[\"$\",\"code\",null,{\"children\":\".catch\"}],\"를 활용해서 간결하게 표현할 수 있다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\")), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\");\\n});\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// .catch(f)는 promise.then(null, f)과 동일하게 작동합니다\"}],\"\\npromise.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(alert); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1초 뒤 \\\"Error: 에러 발생!\\\" 출력\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":28,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\".finally\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Promise가 처리되면 항상 실행되는 메소드\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"/* 시간이 걸리는 어떤 일을 수행하고, 그 후 resolve, reject를 호출함 */\"}],\"\\n})\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 성공·실패 여부와 상관없이 Promise가 처리되면 실행됨\"}],\"\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"finally\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" 로딩 인디케이터 중지)\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\" =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(result), \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error\"}],\" =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(error));\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"finally는 인수가 없으며 자동으로 다음 핸들러에 결과 혹은 에러를 전달한다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"결과\\\"\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2000\"}],\");\\n})\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"finally\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Promise가 준비되었습니다.\\\"\"}],\"))\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(result)); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// \u003c-- .then에서 result를 다룰 수 있음\"}],\"\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 2초 후\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// \\\"Promise가 준비되었습니다.\\\"\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// \\\"결과\\\"\"}],\"\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\");\\n})\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"finally\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Promise가 준비되었습니다.\\\"\"}],\"))\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"err\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(err)); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// \u003c-- .catch에서 에러 객체를 다룰 수 있음\"}],\"\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// \\\"Promise가 준비되었습니다.\\\"\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// \\\"에러 발생\\\"\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":29,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"실제 사용 예시\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"src, callback\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" script = \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"createElement\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"script\\\"\"}],\");\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"src\"}],\" = src;\\n\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"onload\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"callback\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"null\"}],\", script);\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"onerror\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"callback\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${src}\"}],\"를 불러오는 도중에 에러가 발생함`\"]}],\"));\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"head\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(script);\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위 코드는 콜백 방식이다. onload와 onerror 안에 직접 callback을 박아 넣어서 구현했다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"src\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" script = \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"createElement\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"script\\\"\"}],\");\\n    script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"src\"}],\" = src;\\n\\n    script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"onload\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(script);\\n    script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"onerror\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${src}\"}],\"를 불러오는 도중에 에러가 발생함`\"]}],\"));\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"head\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(script);\\n  });\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Promise를 사용하면 callback 로직을 밖으로 뺄 수 있다. 안으로 넘겨주는 인자만 받을 수 있으며 다음과 같이 사용할 수 있다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.js\\\"\"}],\",\\n);\\n\\npromise.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"script\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${script.src}\"}],\"을 불러왔습니다!`\"]}],\"),\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`Error: \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${error.message}\"}],\"`\"]}],\"),\\n);\\n\\npromise.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"script\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"또 다른 핸들러...\\\"\"}],\"));\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이제 then, catch, finally 메소드를 활용해서 소비 함수만 던져주면 저장된 promise에서 알아서 소비 함수 안에 인자를 넣어서 실행시킨다.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":30,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"Promise Chaining\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241107204412.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Promise를 연결해서 비동기 작업을 차례대로 처리하는 방법\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (*)\"}],\"\\n})\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (**)\"}],\"\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(result); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1\"}],\"\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" result * \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2\"}],\";\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (***)\"}],\"\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(result); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 2\"}],\"\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" result * \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2\"}],\";\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(result); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 4\"}],\"\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" result * \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2\"}],\";\\n  });\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"위의 코드가 가능한 이유는 \",[\"$\",\"code\",null,{\"children\":\".then\"}],\"이 Promise를 반환하기 때문이다. \",[\"$\",\"code\",null,{\"children\":\".then\"}],\"의 리턴값이 해당 Promise의 \",[\"$\",\"code\",null,{\"children\":\"result\"}],\"가 된다.\"]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":31,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"또 다른 Promise를 소비 함수 안에서 반환하기\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"기본적으로 \",[\"$\",\"code\",null,{\"children\":\".then\"}],\"이 리턴할 값을 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"로 만들어서 리턴하지만 \",[\"$\",\"code\",null,{\"children\":\".then\"}],\"에서 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 만들어서 리턴시킬 수도 있다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\");\\n})\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(result); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1\"}],\"\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (*)\"}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(result * \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\");\\n    });\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (**)\"}],\"\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(result); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 2\"}],\"\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(result * \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\");\\n    });\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(result); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 4\"}],\"\\n  });\\n\"]}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":32,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"실제 예시\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/one.js\\\"\"}],\")\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"script\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/two.js\\\"\"}],\");\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"script\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/three.js\\\"\"}],\");\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"script\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 불러온 스크립트 안에 정의된 함수를 호출해\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 실제로 스크립트들이 정상적으로 로드되었는지 확인한다.\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"one\"}],\"();\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"two\"}],\"();\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"three\"}],\"();\\n  });\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이제 loadScript를 개선할 수 있다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Promise의 executor는 즉시 실행되고 다음 메소드로 연결된 소비 함수가 실행되기 때문에 위의 Promise를 리턴하는 함수 loadScript에 바로 메소드를 연결해줘도 된다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/one.js\\\"\"}],\").\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"script1\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/two.js\\\"\"}],\").\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"script2\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/three.js\\\"\"}],\").\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"script3\"}],\") =\u003e\"]}],\" {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 여기서 script1, script2, script3에 정의된 함수를 사용할 수 있다.\"}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"one\"}],\"();\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"two\"}],\"();\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"three\"}],\"();\\n    });\\n  });\\n});\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"하지만 이는 다른 콜백지옥을 만들게 된다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이때 가장 내부에 있는 loadScript는 외부 스코프에 전부 접근할 수 있어서 필요에 의해선 위 코드처럼 사용하는 게 좋을 수도 있다.\"}],\"\\n\",[\"$\",\"h4\",null,{\"id\":33,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"참고 사항\"}]}],\"\\n\",[\"$\",\"h5\",null,{\"id\":34,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#ABF7F7A6\"},\"children\":\"thenable\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"핸들러(executor, 소비함수 등등)는 Promise가 아닌 \",[\"$\",\"code\",null,{\"children\":\"thenable\"}],\" 객체를 반환하기도 한다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"thenable 객체는 서드파티 라이브러리가 Promise와 호환 가능한 자체 객체를 구현할 수 있다는 점에서 나오게 되었다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Thenable\"}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"constructor\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"num\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"this\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"num\"}],\" = num;\\n  }\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(resolve); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 아래 코드에서 alert를 넣었으므로 function() { [native code] }이 바로 일단 나온다.\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1초 후 this.num*2와 함께 이행됨\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"this\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"num\"}],\" * \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (**)\"}],\"\\n  }\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\"))\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Thenable\"}],\"(result); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (*)\"}],\"\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(alert); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1,000밀리 초 후 2를 보여줌\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241110210716.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":35,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"fetch와 체이닝 함께 응용\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"프론트 단에서 네트워크 요청 시 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 자주 사용한다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(url);\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"위 코드를 실행하면 \",[\"$\",\"code\",null,{\"children\":\"url\"}],\"에 네트워크 요청을 보내고 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 반환한다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"fetch는 \",[\"$\",\"code\",null,{\"children\":\"resolve\"}],\"시 \",[\"$\",\"code\",null,{\"children\":\"url\"}],\"로 연결해서 얻은 자원을 핸들러로 넘겨준다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/user.json\\\"\"}],\")\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 원격 서버가 응답하면 .then 아래 코드가 실행됩니다.\"}],\"\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// response.text()는 응답 텍스트 전체가 다운로드되면\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 응답 텍스트를 새로운 이행 Promise를 만들고, 이를 반환합니다.\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"text\"}],\"();\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"text\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 원격에서 받아온 파일의 내용\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(text); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// {\\\"name\\\": \\\"Violet-Bora-Lee\\\", \\\"isAdmin\\\": true}\"}],\"\\n  });\\n\"]}]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"원격 서버가 헤더와 함께 응답을 보내면 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"는 \",[\"$\",\"code\",null,{\"children\":\"response\"}],\" 객체와 함께 \",[\"$\",\"code\",null,{\"children\":\"fulfilled\"}],\"된다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"response\"}],\" 전체가 완전히 다운로드되기 전에 Promise는 \",[\"$\",\"code\",null,{\"children\":\"fulfilled\"}],\"가 된다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"response\"}],\"가 다 다운로드 되고 전체를 읽기 위해서는 \",[\"$\",\"code\",null,{\"children\":\"response.text()\"}],\"를 호출해야 한다. ( \",[\"$\",\"code\",null,{\"children\":\"response.text()\"}],\"는 서버에서 전송한 텍스트 전체가 다운로드되면 이 텍스트를 \",[\"$\",\"code\",null,{\"children\":\"result\"}],\"값으로 갖는 \",[\"$\",\"code\",null,{\"children\":\"fulfilled\"}],\"된 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 반환한다. )\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"response.json()\"}],\"을 사용하면 데이터를 읽고 \",[\"$\",\"code\",null,{\"children\":\"JSON\"}],\"으로 파싱할 수 있다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 위 코드와 동일한 기능을 하지만, response.json()은 원격 서버에서 불러온 내용을 JSON으로 변경해줍니다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/user.json\\\"\"}],\")\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"())\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"user\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(user.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"name\"}],\")); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Violet-Bora-Lee, 이름만 성공적으로 가져옴\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"fetch\"}],\"를 순차적으로 보내는 예시를 확인해보자.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// user.json에 요청을 보냅니다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/user.json\\\"\"}],\")\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 응답받은 내용을 json으로 불러옵니다.\"}],\"\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"())\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// GitHub에 요청을 보냅니다.\"}],\"\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"user\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`https://api.github.com/users/\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${user.name}\"}],\"`\"]}],\"))\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 응답받은 내용을 json 형태로 불러옵니다.\"}],\"\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"())\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 3초간 아바타 이미지(githubUser.avatar_url)를 보여줍니다.\"}],\"\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"githubUser\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" img = \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"createElement\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"img\\\"\"}],\");\\n    img.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"src\"}],\" = githubUser.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"avatar_url\"}],\";\\n    img.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"className\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"promise-avatar-example\\\"\"}],\";\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"body\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(img);\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" img.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"remove\"}],\"(), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3000\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (*)\"}],\"\\n  });\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"만약 마지막 then에서 무언가를 더 하고 싶다면 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 리턴해주면 된다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/user.json\\\"\"}],\")\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"())\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"user\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`https://api.github.com/users/\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${user.name}\"}],\"`\"]}],\"))\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"())\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"githubUser\"}],\") =\u003e\"]}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (*)\"}],\"\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" img = \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"createElement\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"img\\\"\"}],\");\\n        img.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"src\"}],\" = githubUser.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"avatar_url\"}],\";\\n        img.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"className\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"promise-avatar-example\\\"\"}],\";\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"body\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(img);\\n\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n          img.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"remove\"}],\"();\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(githubUser); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (**)\"}],\"\\n        }, \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3000\"}],\");\\n      }),\\n  )\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 3초 후 동작함\"}],\"\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"githubUser\"}],\") =\u003e\"]}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${githubUser.name}\"}],\"의 이미지를 성공적으로 출력하였습니다.`\"]}],\"),\\n  );\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위의 코드는 다음과 같이 정리해서 가독성을 높일 수 있다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadJson\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"url\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(url).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"());\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadGithubUser\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"name\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`https://api.github.com/users/\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${name}\"}],\"`\"]}],\").\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\"\\n    response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"(),\\n  );\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"showAvatar\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"githubUser\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" img = \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"createElement\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"img\\\"\"}],\");\\n    img.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"src\"}],\" = githubUser.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"avatar_url\"}],\";\\n    img.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"className\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"promise-avatar-example\\\"\"}],\";\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"body\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(img);\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n      img.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"remove\"}],\"();\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(githubUser);\\n    }, \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3000\"}],\");\\n  });\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 함수를 이용하여 다시 동일 작업 수행\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadJson\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/user.json\\\"\"}],\")\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"user\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadGithubUser\"}],\"(user.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"name\"}],\"))\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(showAvatar)\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"githubUser\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`Finished showing \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${githubUser.name}\"}],\"`\"]}],\"));\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// ...\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"결론적으로 Promise Chaining은 다음의 구조이다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241107212119.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":36,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"Promise와 Error Handling\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 없는 url일 경우\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"https://no-such-server.blabla\\\"\"}],\") \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 거부\"}],\"\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"())\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"err\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(err));\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// TypeError: failed to fetch ( 출력되는 내용은 다를 수 있음 )\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"가 거부되면 제어 흐름이 제일 가까운 \",[\"$\",\"code\",null,{\"children\":\"rejection\"}],\" 핸들러로 넘어간다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// JSON의 형식이 잘못되면\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/article/promise-chaining/user.json\\\"\"}],\")\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"())\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"user\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`https://api.github.com/users/\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${user.name}\"}],\"`\"]}],\"))\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"())\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"githubUser\"}],\") =\u003e\"]}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" img = \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"createElement\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"img\\\"\"}],\");\\n        img.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"src\"}],\" = githubUser.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"avatar_url\"}],\";\\n        img.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"className\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"promise-avatar-example\\\"\"}],\";\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"body\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(img);\\n\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n          img.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"remove\"}],\"();\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(githubUser);\\n        }, \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3000\"}],\");\\n      }),\\n  )\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(error.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"message\"}],\"));\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"체인 끝에 catch를 붙이면 위쪽 Promise 중 하나라도 거부되면 해당 catch가 에러를 잡게 된다.\"}],\"\\n\",[\"$\",\"h4\",null,{\"id\":37,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"암시적 try...catch\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Promise executor\"}],\"와 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\" 핸들러 코드 주위에는 암시적 \",[\"$\",\"code\",null,{\"children\":\"try...catch\"}],\"가 존재한다. 예외가 발생하면 암시적 \",[\"$\",\"code\",null,{\"children\":\"try...catch\"}],\"에서 예외를 잡고 이를 \",[\"$\",\"code\",null,{\"children\":\"reject\"}],\"처럼 다룬다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 아래 두 코드는 같은 기능을 한다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\");\\n}).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(alert); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Error: 에러 발생!\"}],\"\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\"));\\n}).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(alert); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Error: 에러 발생!\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"throw\"}],\"를 사용해서 에러를 던지면 이 자체가 거부된 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 의미하게 된다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"OK\\\"\"}],\");\\n})\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Promise가 거부됨\"}],\"\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(error);\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3\"}],\";\\n  }); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Error: 에러 발생!\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241110214430.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"해당 암시적 \",[\"$\",\"code\",null,{\"children\":\"try... catch\"}],\"는 핸들러 위쪽에서 발생한 비정상 에러 또한 잡는다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"OK\\\"\"}],\");\\n})\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"blabla\"}],\"(); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 존재하지 않는 함수\"}],\"\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(alert); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// ReferenceError: blabla is not defined\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"단 동기적 에러가 암시적 \",[\"$\",\"code\",null,{\"children\":\"try...catch\"}],\"에서 처리되는 것이다. 다음과 같이 비동기 코드가 executor 내부에 존재하고 내부에 에러가 발생한다면 해당 에러를 감지할 수 없다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\");\\n  }, \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\");\\n}).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(alert);\\n\"]}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":38,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"다시 던지기\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\".catch\"}],\"가 정상적으로 종료되면 \",[\"$\",\"code\",null,{\"children\":\"fulfilled\"}],\"인 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 리턴할 것이다. 그래서 다음과 같은 로직이 가능하다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 실행 순서: catch -\u003e then\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\");\\n})\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러가 잘 처리되었습니다. 정상적으로 실행이 이어집니다.\\\"\"}],\");\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// catch 이후 리턴되는 fulfilled상태의 Promise가 .then을 만난다.\"}],\"\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"다음 핸들러가 실행됩니다.\\\"\"}],\"));\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위를 활용해서 에러 핸들링을 세분화시킬 수 있다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 실행 순서: catch -\u003e catch\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\");\\n})\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (*)\"}],\"\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// URIError만 처리하는 소비 함수\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (error \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"instanceof\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"URIError\"}],\") {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 에러 처리\"}],\"\\n    } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"처리할 수 없는 에러\\\"\"}],\");\\n\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" error; \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// URIError가 아닐 경우 다음 에러 핸들러로 전달\"}],\"\\n    }\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"/* 여기는 실행되지 않습니다. */\"}],\"\\n  })\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"error\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (**)\"}],\"\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`알 수 없는 에러가 발생함: \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${error}\"}],\"`\"]}],\");\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 반환값이 없음 =\u003e 실행이 계속됨\"}],\"\\n  });\\n\"]}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":39,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"처리되지 못한 거부\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"noSuchFunction\"}],\"(); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 존재하지 않는 함수를 호출하기 때문에 에러가 발생함\"}],\"\\n}).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 성공상태의 Promise를 처리하는 핸들러. 한 개 혹은 여러 개가 있을 수 있음\"}],\"\\n}); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 끝에 .catch가 없음!\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"예외를 처리해 줄 핸들러가 없으면 에러가 갇혀 버린다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"try...catch\"}],\"에서 일반적인 에러가 발생하고 이를 처리하지 못했을 때 스크립트가 죽고 콘솔 창에 메시지가 출력되는데\\n\",[\"$\",\"code\",null,{\"children\":\"rejected Promise\"}],\"가 처리되지 않아도 동일한 일이 발생한다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"JS 엔진은 \",[\"$\",\"code\",null,{\"children\":\"Promise reject\"}],\"를 추적하다가 에러가 갇힌 걸 확인하면 전역 에러를 생성한다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"브라우저에서는 \",[\"$\",\"code\",null,{\"children\":\"unhandledrejection\"}],\" 이벤트로 이런 에러를 처리한다. (HTML 명세서에 정의된 표준 이벤트이다.)\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"window\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"addEventListener\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"unhandledrejection\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"event\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// unhandledrejection 이벤트엔 두 개의 특수 프로퍼티가 있습니다.\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(event.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"promise\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// [object Promise] - 에러를 생성하는 Promise\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(event.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"reason\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Error: 에러 발생! - 처리하지 못한 에러 객체\"}],\"\\n});\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\");\\n}); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 에러를 처리할 수 있는 .catch 핸들러가 없음\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241107214313.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":40,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"Promise API\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":41,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"Promise.all\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"여러 개의 Promise를 동시에 실행시키고 모든 Promise가 준비될 때까지 기다린다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// let promise = Promise.all([...promises...]);\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Promise인 배열을 받고 새로운 Promise를 반환한다.\"}],\"\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"([\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3000\"}],\")), \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2000\"}],\")), \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 2\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\")), \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 3\"}],\"\\n]).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(alert); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Promise 전체가 처리되면 1, 2, 3이 반환됩니다. 각 Promise는 배열을 구성하는 요소가 됩니다.\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"각 Promise 요청이 다 끝나면 배열의 순서에 따라서 결과 값이 또 다른 배열 형태로 소비 함수로 전달된다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241108150808.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"fetch\"}],\"는 인수에 존재하는 url에 요청을 보내서 \",[\"$\",\"code\",null,{\"children\":\"response\"}],\"를 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\" 형태로 리턴하는 함수이다. 이를 활용한 예제를 살펴보면\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" urls = [\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"https://api.github.com/users/iliakan\\\"\"}],\",\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"https://api.github.com/users/Violet-Bora-Lee\\\"\"}],\",\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"https://api.github.com/users/jeresig\\\"\"}],\",\\n];\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// fetch를 사용해 url을 Promise로 매핑합니다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" requests = urls.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"map\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"url\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(url));\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Promise.all은 모든 작업이 이행될 때까지 기다립니다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"(requests).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"responses\"}],\") =\u003e\"]}],\"\\n  responses.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"forEach\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${response.url}\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${response.status}\"}],\"`\"]}],\")),\\n);\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241108151347.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Promise.all\"}],\"을 이용해서 요청 응답을 배열로 받은 후 그 배열을 다시 \",[\"$\",\"code\",null,{\"children\":\"Promise.all\"}],\"을 이용해서 \",[\"$\",\"code\",null,{\"children\":\"json()\"}],\"으로 파싱, 다음 소비 함수에서 해당 파싱된 데이터를 콘솔 창에 띄우는 로직이다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"결론적으로 다음과 같이 중간에 소비 함수의 로직을 늘릴 수도 있다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" names = [\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"iliakan\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Violet-Bora-Lee\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"jeresig\\\"\"}],\"];\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" requests = names.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"map\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"name\"}],\") =\u003e\"]}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`https://api.github.com/users/\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${name}\"}],\"`\"]}],\"),\\n);\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"(requests)\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"responses\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 모든 응답이 성공적으로 이행되었습니다.\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"for\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" response \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"of\"}],\" responses) {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${response.url}\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${response.status}\"}],\"`\"]}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 모든 url의 응답코드가 200입니다.\"}],\"\\n    }\\n\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" responses;\\n  })\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 응답 메시지가 담긴 배열을 response.json()로 매핑해, 내용을 읽습니다.\"}],\"\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"responses\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"(responses.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"map\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"r\"}],\") =\u003e\"]}],\" r.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"())))\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// JSON 형태의 응답 메시지는 파싱 되어 배열 'users'에 저장됩니다.\"}],\"\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"users\"}],\") =\u003e\"]}],\" users.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"forEach\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"user\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(user.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"name\"}],\")));\\n\"]}]}],\"\\n\",[\"$\",\"h5\",null,{\"id\":42,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#ABF7F7A6\"},\"children\":\"Promise.all의 에러 핸들링\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"내부 배열에서 하나라도 rejected가 일어나면 전체를 에러라고 판단한다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"([\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\")),\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\")), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2000\"}],\"),\\n  ),\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3000\"}],\")),\\n]).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(alert); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Error: 에러 발생!\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Promise reject가 일어나도 호출은 계속 일어난다.\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"별도의 처리 (AbortController) 가 없다면 Promise rejected가 일어나도 다른 Promise 처리가 취소되진 않는다. 단, 결과는 무시된다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241108152428.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위 예시는 rejected되는 Promise를 배열에 넣고 Promise.all을 돌린 예시이다.\\n첫 번째 인수인 Promise가 rejected되어 전역 에러가 일어났다. (catch 메소드가 뒤에 없으므로)\\n이때 네트워크 요청에서 보면 fetch 자체는 일어난 것을 확인할 수 있다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241108152443.png\",\"alt\":\"\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Promise.all의 인수에 있는 배열\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"해당 배열은 꼭 Promise 객체가 아니어도 된다. 밑의 예시처럼 숫자를 넣을 수도 있는데 이때는 해당 숫자를 그대로 소비 함수로 전달한다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"([\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\");\\n  }),\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2\"}],\",\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3\"}],\",\\n]).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(alert); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1, 2, 3\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":43,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"Promise.allSettled\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Promise.all은 하나라도 에러가 나면 전부 결과를 못 받는다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"([\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/template.html\\\"\"}],\"),\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/style.css\\\"\"}],\"),\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"/data.json\\\"\"}],\"),\\n]).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(render); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// render 메서드는 fetch 결과 전부가 있어야 제대로 동작합니다.\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위 예시와 같이 html, css, json이 전부 필요한 render 함수가 소비 함수일 경우 유용하다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\".allSettled\"}],\"는 하나가 에러가 나더라도 다른 요청을 받을 수 있게 하려고 태어났다.\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"응답이 성공하였을 때 – \",[\"$\",\"code\",null,{\"children\":\"{status:\\\"fulfilled\\\", value:result}\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"에러가 발생하였을 때 – \",[\"$\",\"code\",null,{\"children\":\"{status:\\\"rejected\\\", reason:error}\"}]]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"allSettled\"}],\"(urls.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"map\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"url\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(url))).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"results\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (*)\"}],\"\\n  results.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"forEach\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"result, num\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (result.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"status\"}],\" == \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"fulfilled\\\"\"}],\") {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${urls[num]}\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${result.value.status}\"}],\"`\"]}],\");\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 응답이 성공하면 결과가 value 프로퍼티 안에 들어가게 된다.\"}],\"\\n    }\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (result.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"status\"}],\" == \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"rejected\\\"\"}],\") {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${urls[num]}\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${result.reason}\"}],\"`\"]}],\");\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 에러가 발생하면 에러 객체가 reason 프로퍼티 안에 들어가게 된다.\"}],\"\\n    }\\n  });\\n});\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241108154631.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":44,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"Promise.race\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Promise.all과 유사하게 Promise 배열 전체를 처리하지만 가장 먼저 처리되는 Promise의 결과를 반환한다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"//let promise = Promise.race(iterable);\"}],\"\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"race\"}],\"([\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\")),\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\")), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2000\"}],\"),\\n  ),\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3000\"}],\")),\\n]).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(alert); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":45,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"Promise.resolve와 Promise.reject\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"resolve와 reject 메소드는 async/ await의 등장으로 잘 사용되지 않는다. 하지만 추후 나올 폴리 필을 이해하기 위해서라도 필요하기에 한번 알아보도록 하자.\\n( \",[\"$\",\"code\",null,{\"children\":\"async function\"}],\"은 리턴값을 무조건 Promise로 꺼내고 내부에 throw Error해주면 rejected 상태의 Promise를 리턴한다. )\"]}],\"\\n\",[\"$\",\"h5\",null,{\"id\":46,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#ABF7F7A6\"},\"children\":\"Promise.resolve\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Promise.resolve(value)는 결과값이 value인 fulfilled한 Promise를 생성한다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// let promise = new Promise(resolve =\u003e resolve(value));\"}],\"\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" cache = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Map\"}],\"();\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadCached\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"url\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (cache.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"has\"}],\"(url)) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(cache.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"get\"}],\"(url));\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(url)\\n    .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"response\"}],\") =\u003e\"]}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"text\"}],\"())\\n    .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"text\"}],\") =\u003e\"]}],\" {\\n      cache.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"set\"}],\"(url, text);\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" text;\\n    });\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"loadCached\"}],\"는 \",[\"$\",\"code\",null,{\"children\":\"fetch\"}],\"를 할 때 \",[\"$\",\"code\",null,{\"children\":\"cache\"}],\"에 해당 데이터를 저장해두고 다음에 같은 요청을 보냈을 때 \",[\"$\",\"code\",null,{\"children\":\"cache\"}],\"에서 꺼내서 전달한다.\\n이때 \",[\"$\",\"code\",null,{\"children\":\"Promise.resolve\"}],\"를 이용해서 \",[\"$\",\"code\",null,{\"children\":\"loadCached\"}],\"가 항상 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 반환한다는 걸 정해둬서 사용하는 단에서는 \",[\"$\",\"code\",null,{\"children\":\"loadCached\"}],\" 함수에 \",[\"$\",\"code\",null,{\"children\":\".then/catch\"}],\" 등의 메소드를 통해서 소비 함수를 넣을 수 있게 된다.\"]}],\"\\n\",[\"$\",\"h6\",null,{\"id\":47,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#ADCCFFA6\"},\"children\":\"Promise.resolve를 이용한 Promise allSettled의 폴리필\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"allSettled는 나온 지 얼마 안 되어서 구식 브라우저에서는 폴리 필이 필요하다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (!\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"allSettled\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"allSettled\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"promises\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"(\\n      promises.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"map\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"p\"}],\") =\u003e\"]}],\"\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(p).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"value\"}],\") =\u003e\"]}],\" ({\\n            \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"status\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"fulfilled\\\"\"}],\",\\n            value,\\n          }),\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"reason\"}],\") =\u003e\"]}],\" ({\\n            \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// then의 두 번째 인수이다. then의 두 번째 인수는 error 핸들러이다. (catch와 같음.)\"}],\"\\n            \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"status\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"rejected\\\"\"}],\",\\n            reason,\\n          }),\\n        ),\\n      ),\\n    );\\n  };\\n}\\n\"]}]}],\"\\n\",[\"$\",\"h5\",null,{\"id\":48,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#ABF7F7A6\"},\"children\":\"Promise.reject\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Promise.reject(error)\"}],\"는 결과값이 \",[\"$\",\"code\",null,{\"children\":\"error\"}],\"인 \",[\"$\",\"code\",null,{\"children\":\"rejected Promise\"}],\"를 반환한다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(error);\\nㄴ;\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241108160624.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":49,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"Fetch: Abort\"}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"글 흐름을 위해 Promise 파트에 넣어놓긴 했지만 엄밀히 말하면 Promise API는 아니다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Promise.all 에서도 에러 발생시 Promise 결과는 무시되나 호출은 막을 수 없다고 하였다.\\nAbortController라는 빌트인 객체를 활용하면 Promise 호출 자체를 막을 수 있다.\"}],\"\\n\",[\"$\",\"h4\",null,{\"id\":50,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"AbortController Object\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" controller = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"AbortController\"}],\"();\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"AbortController는 프로퍼티 하나, 메소드 하나를 갖고 있다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241108161157.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"signal\"}],\"은 프로토타입 체인을 가치지 않고 바로 인스턴스에서 찾을 수 있으며 \",[\"$\",\"code\",null,{\"children\":\"event listener\"}],\"를 세팅할 수 있는 프로퍼티이다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"abort\"}],\"는 프로토타입 체인을 이용해서 \",[\"$\",\"code\",null,{\"children\":\"AbortController\"}],\"에 있는 메소드를 가져오는 것이며 \",[\"$\",\"code\",null,{\"children\":\"abort\"}],\"가 실행되면 다음의 과정이 일어난다.\",\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"instance.signal이 \\\"abort\\\" event를 발생시킨다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"instance.signal.aborted가 true가 된다.\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"따라서 signal에 취소 가능한 작업을 리스너로 달아 놓고\\nabort() 함수로 취소하는 것이다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" controller = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"AbortController\"}],\"();\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" signal = controller.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"signal\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 취소가능한 작업을 수행하는 곳에 signal 객체를 주고, controller.abort()가 실행되면 실행될 리스너를 세팅한다.\"}],\"\\nsignal.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"addEventListener\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"abort\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"abort!\\\"\"}],\"));\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 아래 코드를 어떤 곳에 넣어서 원할 때 실행할 수 있도록 한다.\"}],\"\\ncontroller.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"abort\"}],\"(); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// abort!\"}],\"\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// abort event가 트리거되면 aborted가 true로 바뀐다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(signal.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"aborted\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// true\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"다른 event를 구현해서 동일 기능을 만들어서 fetch와 쓸 수도 있지만, 내부적으로 fetch는 \",[\"$\",\"code\",null,{\"children\":\"AbortController\"}],\"를 인식하기 때문에 \",[\"$\",\"code\",null,{\"children\":\"AbortController\"}],\"를 사용하는 것이 좋다.\"]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":51,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"fetch와 함께 사용\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"fetch\"}],\" 옵션에 \",[\"$\",\"code\",null,{\"children\":\"signal\"}],\"이라는 프로퍼티가 존재한다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" controller = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"AbortController\"}],\"();\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(url, {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"signal\"}],\": controller.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"signal\"}],\",\\n});\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이제 이전과 같이 \",[\"$\",\"code\",null,{\"children\":\"controller.abort()\"}],\" 함수로 \",[\"$\",\"code\",null,{\"children\":\"fetch\"}],\" 요청을 제어해주면 된다.\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"단, fetch가 abort하는 시기보다 더 빨리 끝나면 이미 나온 결과를 없애진 않는다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":52,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"AbortController는 확장성 있다.\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" urls = [...]; \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// a list of urls to fetch in parallel\"}],\"\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" controller = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"AbortController\"}],\"();\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// an array of fetch promises\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" fetchJobs = urls.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"map\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"url\"}],\" =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(url, {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"signal\"}],\": controller.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"signal\"}],\"\\n}));\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" results = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"(fetchJobs);\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// if controller.abort() is called from elsewhere,\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// it aborts all fetches\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"위와 같이 \",[\"$\",\"code\",null,{\"children\":\"signal\"}],\"로 하나의 \",[\"$\",\"code\",null,{\"children\":\"controller\"}],\"를 등록해두면 등록된 모든 \",[\"$\",\"code\",null,{\"children\":\"fetch\"}],\"가 하나의 \",[\"$\",\"code\",null,{\"children\":\"controller\"}],\"의 신호를 따르게 된다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"또한 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"와 함께 사용할 수 있으며 \",[\"$\",\"code\",null,{\"children\":\"Promise.all\"}],\"을 통해서 \",[\"$\",\"code\",null,{\"children\":\"fetch\"}],\"와 해당 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 결합할 수도 있다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" urls = [...];\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" controller = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"AbortController\"}],\"();\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" ourJob = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" { \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// our task\"}],\"\\n  ...\\n  controller.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"signal\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"addEventListener\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"'abort'\"}],\", reject);\\n});\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" fetchJobs = urls.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"map\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"url\"}],\" =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(url, { \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// fetches\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"signal\"}],\": controller.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"signal\"}],\"\\n}));\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Wait for fetches and our task in parallel\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" results = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"([...fetchJobs, ourJob]);\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// if controller.abort() is called from elsewhere,\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// it aborts all fetches and ourJob\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":53,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"Promisification\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"콜백을 받는 함수를 Promise를 반환하는 함수로 바꾸는 것을 \",[\"$\",\"code\",null,{\"children\":\"Promisification\"}],\" 이라고 한다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"src, callback\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" script = \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"createElement\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"script\\\"\"}],\");\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"src\"}],\" = src;\\n\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"onload\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"callback\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"null\"}],\", script);\\n  script.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"onerror\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"callback\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${src}\"}],\"를 불러오는 도중에 에러가 발생함`\"]}],\"));\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"head\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(script);\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 사용법:\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// loadScript('path/script.js', (err, script) =\u003e {...})\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"위 함수는 콜백 함수를 활용한 함수로써 이를 \",[\"$\",\"code\",null,{\"children\":\"Promisification\"}],\" 해보자.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"src라는 인수를 받아야 되고 콜백을 받지 않고 사용하는 단에서 제어할 수 있어야 한다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" loadScriptPromise = \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"src\"}],\")=\u003e\"]}],\"{\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\")=\u003e\"]}],\"{\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 여기서 (err, script)=\u003e{...} 이건 위의 코드에서 보면 기존의 사용법에서 쓰이는 콜백 함수이다.\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 콜백 함수가 내부로 숨겨진 것일 뿐이다.\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScript\"}],\"(src,\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"err, script\"}],\")=\u003e\"]}],\"{\\n\\t  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (err) \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(err);\\n\\t  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(script);\\n    })\\n  })\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 사용법:\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// loadScriptPromise('path/script.js').then(...)\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이러한 \",[\"$\",\"code\",null,{\"children\":\"Promisification\"}],\" 은 하나의 함수에서만 쓸 수 있다. 이를 확장성 있게 하려면 헬퍼 함수를 만들어 보자.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"헬퍼 함수는 함수 \",[\"$\",\"code\",null,{\"children\":\"f\"}],\"를 받아서 래퍼 함수를 반환해야 한다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"promisify\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"f\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"...args\"}],\") { \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 래퍼 함수를 반환함\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"callback\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"err, result\"}],\") {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// f에 사용할 커스텀 콜백\"}],\"\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (err) {\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(err);\\n        } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(result);\\n        }\\n      }\\n\\n      args.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"push\"}],\"(callback); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 위에서 만든 커스텀 콜백을 함수 f의 인수 끝에 추가합니다.\"}],\"\\n\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 처음 promisify를 선언할 때 넣었던 함수를 가져와서\"}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 호출할 때의 this, 그리고 호출할 때 넣은 args를 가져와서 실행시킨다.\"}],\"\\n      f.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"call\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"this\"}],\", ...args); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 기존 함수를 호출합니다.\"}],\"\\n    });\\n  };\\n};\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 사용법:\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" loadScriptPromise = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"promisify\"}],\"(loadScript);\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"loadScriptPromise\"}],\"(...).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(...);\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위 코드에서 여러 인수를 처리하기 위해선 다음과 같은 리팩토링이 필요하다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 콜백의 성공 결과를 담은 배열을 얻게 해주는 promisify(f, true)\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"promisify\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"f, manyArgs = \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"false\"}]]}],\") { \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// args 다수 여부 확인\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"...args\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"callback\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"err, ...results\"}],\") { \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// f에 사용할 커스텀 콜백\"}],\"\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (err) {\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(err);\\n        } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// args 다수 여부로 판단해서 리턴될 Promise의 result에 하나만 넣을지 여러 개 넣을지 판단\"}],\"\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(manyArgs ? results : results[\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\"]);\\n        }\\n      }\\n\\n      args.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"push\"}],\"(callback);\\n\\n      f.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"call\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"this\"}],\", ...args);\\n    });\\n  };\\n};\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 사용법:\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 여기서 promisify에 들어가는 f는 여러 인수가 필요하고 콜백이 마지막 인수로 들어가는 함수이다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// f(arg1, arg2, ..., (err, ...results)=\u003e{});\"}],\"\\nf = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"promisify\"}],\"(f, \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"true\"}],\");\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f\"}],\"(...).\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"arrayOfResults\"}],\" =\u003e\"]}],\" ..., \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"err\"}],\" =\u003e\"]}],\" ...);\\n\"]}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"단, \",[\"$\",\"code\",null,{\"children\":\"Promisification\"}],\" 은 콜백을 완전히 대체하지는 못한다. 콜백은 여러 번 호출할 수 있고 Promise는 하나의 결과만 가질 수 있기 때문이다. ( Promisification한 함수의 콜백을 여러 번 호출해도 두 번째부터는 무시된다. )\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"사실 이를 미리 처리해주는 \",[\"$\",\"code\",null,{\"children\":\"promisify\"}],\" 라이브러리나 \",[\"$\",\"code\",null,{\"children\":\"Node.js\"}],\" 내장 함수가 존재한다.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":54,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"Microtask 처리\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Promise\"}],\" 핸들러 (\",[\"$\",\"code\",null,{\"children\":\".then/catch/finally\"}],\")는 항상 비동기적으로 실행된다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"가 즉시 이행돼도 \",[\"$\",\"code\",null,{\"children\":\".then/catch/finally\"}],\" 아래에 있는 코드들은 이 핸들러가 실행되기 전에 실행된다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"();\\n\\npromise.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Promise 성공!\\\"\"}],\"));\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"코드 종료\\\"\"}],\");\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 결과\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// alert(\\\"코드 종료\\\");\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// alert(\\\"Promise 성공!\\\");\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":55,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"Microtask Queue\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"비동기 작업을 처리하려면 적절한 관리가 필요하다.\\n이를 위해 ECMA에선 \",[\"$\",\"code\",null,{\"children\":\"PromiseJobs\"}],\"라는 내부 큐(\",[\"$\",\"code\",null,{\"children\":\"Internal Queue\"}],\")를 명시한다. ( \",[\"$\",\"code\",null,{\"children\":\"V8\"}],\"엔진에서 이를 \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\" 라고 부르기 때문에 \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\"를 더 자주 쓴다. )\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\"는 다음처럼 동작한다.\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"먼저 들어온 작업을 먼저 실행한다. (\",[\"$\",\"code\",null,{\"children\":\"FIFO\"}],\")\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"실행할 것이 아무것도 남아있지 않을 때만 큐에 있는 작업이 실행되기 시작한다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"요약하면 어떤 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\" 가 준비되었을 때 이 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"의 \",[\"$\",\"code\",null,{\"children\":\".then/catch/finally\"}],\" 핸들러는 큐에 들어가게 되며 여전히 실행되지 않는다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이후 현재 코드에서 자유로운 상태가 되었을 때 자바스크립트 엔진은 큐에서 작업을 꺼내 실행한다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241108195640.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Promise\"}],\" 핸들러는 항상 내부 큐(\",[\"$\",\"code\",null,{\"children\":\"Promise jobs\"}],\"이자 \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\")를 통과하게 된다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"여러 개의 \",[\"$\",\"code\",null,{\"children\":\".then/catch/finally\"}],\"를 사용해 만든 체인의 경우, 각 핸들러는 비동기적으로 실행된다. 큐에 들어간 핸들러 각각은 현재 코드가 완료되고, 큐에 들어있는 이전 핸들러의 실행이 완료되었을 때 실행된다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"()\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Promise Fulfilled\\\"\"}],\"))\\n  .\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"finish\\\"\"}],\"));\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위와 같이 하면 비동기 동작을 차례대로 진행할 수 있다.\"}],\"\\n\",[\"$\",\"h4\",null,{\"id\":56,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"처리되지 못한 거부\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"unhandledrejection\"}],\" 이벤트는 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 실행할 때 \",[\"$\",\"code\",null,{\"children\":\".catch\"}],\" 없이 에러가 전달돼서 전역 에러가 난 것을 의미한다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Promise 실패!\\\"\"}],\"));\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Promise 실패!\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"window\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"addEventListener\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"unhandledrejection\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"event\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(event.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"reason\"}],\"));\\n\"]}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"unhandled rejection\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"자바스크립트 엔진은 처리되지 못한 거부(unhandled rejection)를 찾을 때 \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\"를 확인한다.\\nMicrotask Queue 끝에도 Promise error가 처리되지 않았다면 발생한다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h5\",null,{\"id\":57,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#ABF7F7A6\"},\"children\":\"만약 catch를 나중에 처리한다면\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"Promise 실패!\\\"\"}],\"));\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" promise.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"catch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"err\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"잡았다!\\\"\"}],\")), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\");\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Error: Promise 실패!\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"window\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"addEventListener\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"unhandledrejection\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"event\"}],\") =\u003e\"]}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(event.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"reason\"}],\"),\\n);\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241108205243.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"unhandledrejection\"}],\"의 핸들러 함수 \u003e rejected Promise 있다고 알림 \u003e catch 소비 함수\\n순서인 것을 확인할 수 있다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이는 다음의 과정 때문에 그러하다.\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"현재 \",[\"$\",\"code\",null,{\"children\":\"Macrotask\"}],\"가 끝나면 (\",[\"$\",\"code\",null,{\"children\":\"window.addEventListener\"}],\"까지 다 끝나고 나면) \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\"를 확인한다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"unhandledrejection\"}],\"은 \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\"에 있는 작업이 \",[\"$\",\"code\",null,{\"children\":\"rejected\"}],\"된 상태로 남아있을 때 발동된다. 즉 \",[\"$\",\"code\",null,{\"children\":\"rejected Promise\"}],\" 상태로 남아 있는 것을 발견하고 \",[\"$\",\"code\",null,{\"children\":\"unhandledrejection\"}],\"을 발동시킨다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"등록된 핸들러 \",[\"$\",\"code\",null,{\"children\":\"(console.log(event.reason))\"}],\" 실행\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Web API\"}],\"에서 \",[\"$\",\"code\",null,{\"children\":\"1,000ms\"}],\"가 끝나고 \",[\"$\",\"code\",null,{\"children\":\"setTimeout\"}],\"의 콜백 함수 \",[\"$\",\"code\",null,{\"children\":\"( ()=\u003epromise.catch(()=\u003econsole.log('잡았다!')) )\"}],\"가 \",[\"$\",\"code\",null,{\"children\":\"Macrotask Queue\"}],\"로 이동된다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"()=\u003epromise.catch(()=\u003econsole.log('잡았다!'))\"}],\"를 실행해서 \",[\"$\",\"code\",null,{\"children\":\"promise.catch(()=\u003econsole.log('잡았다!')\"}],\" 리턴한다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"rejected Promise\"}],\"가 담겨있는 변수 \",[\"$\",\"code\",null,{\"children\":\"promise\"}],\"를 \",[\"$\",\"code\",null,{\"children\":\".catch\"}],\"핸들러로 찍었기에 \",[\"$\",\"code\",null,{\"children\":\"()=\u003econsole.log('잡았다!')\"}],\"를 \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\"로 이동시킨다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"이동이 끝나면 \",[\"$\",\"code\",null,{\"children\":\"Macrotask\"}],\" 하나가 끝났으니 \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\"를 비워질 때까지 실행한다. 여기서 \",[\"$\",\"code\",null,{\"children\":\"()=\u003econsole.log('잡았다!')\"}],\"가 실행된다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":58,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"async, await\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"를 편하게 사용하기 위해 \",[\"$\",\"code\",null,{\"children\":\"async\"}],\", \",[\"$\",\"code\",null,{\"children\":\"await\"}],\" 문법이 탄생하게 되었다.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":59,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"async function\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" funciton \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\"){\\n\\t\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\";\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"function\"}],\" 앞에 \",[\"$\",\"code\",null,{\"children\":\"async\"}],\"를 붙이면 해당 함수는 항상 Promise를 반환한다.\\n만약 Promise가 아닌 값을 반환하더라도 fulfilled 상태의 Promise로 값을 감싸서 반환한다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241110152440.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"즉 다음의 코드들은 같은 기능을 한다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" funciton \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f1\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\"){\\n\\t\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\";\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" funciton \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f2\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\"){\\n\\t\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\");\\n}\\n\"]}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":60,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"await\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// await는 async function 안에서만 동작한다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" value = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" promise;\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"await\"}],\" 키워드를 만나면 Promise가 처리될 때까지 기다린다. \",[\"$\",\"code\",null,{\"children\":\"await\"}],\"키워드 아래에 있는 동일 블록의 코드들은 \",[\"$\",\"code\",null,{\"children\":\"Microtask Queue\"}],\"로 이동한다. ( 기능적으로 \",[\"$\",\"code\",null,{\"children\":\".then\"}],\"으로 넘기는 것과 같다. )\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" promise = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"완료!\\\"\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\");\\n  });\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" result = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" promise; \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Promise가 이행될 때까지 기다림 (*)\"}],\"\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(result); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// \\\"완료!\\\"\"}],\"\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f\"}],\"();\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Promise가 처리될 때까지 기다리는 동안 엔진은 다른 일(다른 스크립트 실행, 이벤트 처리)을 처리할 수 있기 때문에 CPU 리소스가 낭비되지 않는다.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"즉, \",[\"$\",\"code\",null,{\"children\":\"await\"}],\"은 \",[\"$\",\"code\",null,{\"children\":\"promise.then\"}],\"보다 좀 더 세련되게 Promise의 \",[\"$\",\"code\",null,{\"children\":\"result\"}],\" 값을 얻을 수 있도록 해주는 문법이다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"fetch와 체이닝 함께 응용\"}],\" 파트에서 예시로 있었던 \",[\"$\",\"code\",null,{\"children\":\"showAvatar\"}],\" 코드를 \",[\"$\",\"code\",null,{\"children\":\"async / await\"}],\" 문법으로 정리해보면 다음과 같다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"showAvatar\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"url\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// JSON 읽기\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" loadJsonResponse = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(url);\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" { name } = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" loadJsonResponse.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"();\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// github 사용자 정보 읽기\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" githubUserResponse = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`https://api.github.com/users/\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${name}\"}],\"`\"]}],\",\\n  );\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" githubUser = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" githubUserResponse.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"();\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 아바타 보여주기\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" img = \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"createElement\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"img\\\"\"}],\");\\n  img.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"src\"}],\" = githubUser.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"avatar_url\"}],\";\\n  img.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"className\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"promise-avatar-example\\\"\"}],\";\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"body\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"append\"}],\"(img);\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 3초 대기\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(resolve, \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3000\"}],\"));\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// await가 실행되면 해당 Promise가 처리되는 동작을 executor로 잡고 그 아래의 코드들은 Microtask Queue로 간다고 생각하면 된다. (.then과 동작이 똑같음.)\"}],\"\\n\\n  img.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"remove\"}],\"();\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" githubUser;\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"showAvatar\"}],\"();\\n\"]}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"await은 최상위 레벨 코드에서 동작하지 않는다.\\n이를 위해서 \",[\"$\",\"code\",null,{\"children\":\"IIFE ( Immediately Invoked function expression )\"}],\"를 사용할 수 있습니다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"async\"}],\" ()=\u003e{\\n\\t\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" response = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"`/article/promise-chaining/user.json`\"}],\");\\n\\t\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" user = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" response.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"json\"}],\"();\\n\\t...\\n})();\\n\"]}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"promise.then\"}],\"처럼 \",[\"$\",\"code\",null,{\"children\":\"await\"}],\"도 \",[\"$\",\"code\",null,{\"children\":\"thenable\"}],\" 객체를 받을 수 있다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Thenable\"}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"constructor\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"num\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"this\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"num\"}],\" = num;\\n  }\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve, reject\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(resolve);\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1000밀리 초 후에 이행됨(result는 this.num*2)\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"this\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"num\"}],\" * \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2\"}],\"), \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1000\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// (*)\"}],\"\\n  }\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1초 후, 변수 result는 2가 됨\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" result = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Thenable\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\");\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// new Promise((resolve)=\u003esetTimeout(()=\u003e resolve(this.num*2),1000)).then((result)=\u003ealert(result)) 와 같다.\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(result);\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f\"}],\"();\\n\"]}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"class method\"}],\"에도 \",[\"$\",\"code\",null,{\"children\":\"async\"}],\"를 사용할 수 있다. \",[\"$\",\"code\",null,{\"children\":\"async\"}],\"가 붙은 메서드는 \",[\"$\",\"code\",null,{\"children\":\"async\"}],\" 함수와 같이 Promise를 반환하며 await을 사용할 수 있다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Waiter\"}],\" {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"wait\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\");\\n  }\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Waiter\"}],\"().\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"wait\"}],\"().\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(alert); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 1\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":61,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"에러 핸들링\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"await promise\"}],\"는 Promise 객체의 \",[\"$\",\"code\",null,{\"children\":\"result\"}],\"에 저장된 값을 반환한다.\\n반면 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"가 거부되면 마치 \",[\"$\",\"code\",null,{\"children\":\"throw\"}],\"문을 작성한 것처럼 에러를 던진다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 아래 두 코드의 기능은 같다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"reject\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\"));\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"throw\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Error\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"에러 발생!\\\"\"}],\");\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"await\"}],\"가 던진 에러는 \",[\"$\",\"code\",null,{\"children\":\"throw\"}],\"가 던진 에러를 잡을 때처럼 \",[\"$\",\"code\",null,{\"children\":\"try...catch\"}],\"를 사용해 잡을 수 있다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"try\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" response = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"http://유효하지-않은-주소\\\"\"}],\");\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"catch\"}],\" (err) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"alert\"}],\"(err); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// TypeError: failed to fetch\"}],\"\\n  }\\n}\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"f\"}],\"();\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"에러가 발생하면 \",[\"$\",\"code\",null,{\"children\":\"catch\"}],\" 블록으로 제어 흐름이 넘어가게 된다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"원래 \",[\"$\",\"code\",null,{\"children\":\"async function\"}],\"에 리턴값이 없으면 \",[\"$\",\"code\",null,{\"children\":\"fulfilled Promise\"}],\"에 \",[\"$\",\"code\",null,{\"children\":\"undefined\"}],\"가 담겨서 리턴되지만\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241110193617.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"async function\"}],\"에서 \",[\"$\",\"code\",null,{\"children\":\"await\"}],\"한 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"가 \",[\"$\",\"code\",null,{\"children\":\"reject\"}],\"된다면 \",[\"$\",\"code\",null,{\"children\":\"rejected\"}],\"된 \",[\"$\",\"code\",null,{\"children\":\"Promise\"}],\"에 에러가 담겨서 리턴된다. (또한,에러도 발생한다.)\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241110193853.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"위의 코드에서 \",[\"$\",\"code\",null,{\"children\":\".catch\"}],\"를 이어서 사용해서 해당 \",[\"$\",\"code\",null,{\"children\":\"Error\"}],\"를 핸들링할 수 있다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241110193713.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"여기서 \",[\"$\",\"code\",null,{\"children\":\".catch\"}],\"로 핸들링 되지 않은 에러는 전역 에러로 처리되는데 이는 \",[\"$\",\"code\",null,{\"children\":\"unhandledrejection\"}],\"이벤트의 핸들러로 처리할 수 있다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\".then\"}],\"을 \",[\"$\",\"code\",null,{\"children\":\"await\"}],\"가 대신해주고 \",[\"$\",\"code\",null,{\"children\":\".catch\"}],\"를 \",[\"$\",\"code\",null,{\"children\":\"try..catch\"}],\"로 대신해주기 때문에 동일한 기능을 쓰지만 사용하는 쪽에서 훨씬 편하게 쓸 수 있다. 하지만 \",[\"$\",\"code\",null,{\"children\":\"await\"}],\"은 최상위 레벨 코드에서는 사용할 수 없어서 (async가 없는 최상위 레벨 코드) \",[\"$\",\"code\",null,{\"children\":\".then/ .catch\"}],\"를 사용해야만 하는 경우가 발생한다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"async/ await\"}],\"은 \",[\"$\",\"code\",null,{\"children\":\"Promise.all\"}],\"과도 함께 쓸 수 있다, 에러 핸들링 역시 똑같이 \",[\"$\",\"code\",null,{\"children\":\"try...catch\"}],\"를 활용할 수 있다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Promise 처리 결과가 담긴 배열을 기다립니다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"let\"}],\" results = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"([\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(url1),\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetch\"}],\"(url2),\\n  ...\\n]);\\n\"]}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"감을 익히기 위한 세 가지 과제가 있습니다. 한번 풀어보면 좋을 것 같다.\\n\",[\"$\",\"a\",null,{\"href\":\"https://ko.javascript.info/async-await#tasks\",\"children\":\"https://ko.javascript.info/async-await#tasks\"}]]}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":62,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FF5582A6\"},\"children\":\"비동기 관련 문제 풀이\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"다음은 비동기 관련 로직을 완벽하게 이해하기 위해서 만들어 본 문제이다.\\n각 \",[\"$\",\"code\",null,{\"children\":\"queue\"}],\"와 \",[\"$\",\"code\",null,{\"children\":\"Web API\"}],\"를 생각하면서 결과값은 무엇이고 왜인지 생각해보자.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-js\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"testFn\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") =\u003e {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 바로 실행\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// setTimeout 바로 실행, Web API로 타이밍 함수 넘김\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"2\"}],\");\\n  }, \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"500\"}],\");\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"3\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 바로 실행\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"async\"}],\" (resolve) =\u003e {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// executor 함수는 Promise 생성과 함께 바로 실행된다.\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"4\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"전\\\"\"}],\");\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"setTimeout\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 여기까지 바로 실행, await 아래 내부 코드들은 전부 Microtask Queue로\"}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"4\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// console.log(4)라는 콜백은 setTimeout이 실행되고 Web API에서 5000이라는 ms가 지난 후에 Macrotask queue로 전달된다.\"}],\"\\n    }, \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"5000\"}],\");\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"4\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"다음\\\"\"}],\");\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"4\"}],\");\\n  });\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"5\"}],\"); \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 바로 실행\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" t = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"resolve\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// Promise 내부의 executor는 바로 실행되고 아래 코드들은 전부 Microtask queue로 이동\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// new Promise((resolve)=\u003e{console.log(6); resolve('a')}).then((t)=\u003e{console.log(t); console.log(7)})과 같다.\"}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"6\"}],\");\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"resolve\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"a\\\"\"}],\");\\n  });\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(t);\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"log\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"7\"}],\");\\n};\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-11-10/Pasted%20image%2020241110155653.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":63,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"풀이\"}]}],\"\\n\",[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"style\":{\"textAlign\":\"left\"}}],[\"$\",\"th\",null,{\"children\":\"1번째 task (testFn이라는 Macrotask 실행)\"}],[\"$\",\"th\",null,{\"children\":\"2번째 task (testFn 관련 Microtask 전부 실행)\"}],[\"$\",\"th\",null,{\"children\":\"코드 실행부터 500ms 지남\"}],[\"$\",\"th\",null,{\"children\":\"3번째 task ( 2를 출력하는 Macrotask 실행 )\"}],[\"$\",\"th\",null,{\"children\":\"Microtask Queue 비어있는 것 확인하고 다음으로 넘어감\"}],[\"$\",\"th\",null,{\"children\":\"코드 실행부터 5000ms 지남\"}],[\"$\",\"th\",null,{\"children\":\"4번째 task ( 4를 출력하는 Macrotask 실행)\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"Macrotask queue 상태\"}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{\"children\":\"()=\u003econsole.log(2)\"}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{\"children\":\"()=\u003econsole.log(4)\"}],[\"$\",\"td\",null,{}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"Microtask queue 상태\"}],[\"$\",\"td\",null,{\"children\":\"console.log(4, \\\"다음\\\"), resolve(4), console.log(t), console.log(7)\"}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"Web API\"}],[\"$\",\"td\",null,{\"children\":[\"500ms를 기다리면 ()=\u003econsole.log(2)를 task queue로 넘기는 동작 실행,\",[\"$\",\"br\",null,{}],\"5,000ms를 기다리면 ()=\u003econsole.log(4)를 taskqueue로 넘기는 동작 실행\"]}],[\"$\",\"td\",null,{\"children\":[\"500ms를 기다리면 ()=\u003econsole.log(2)를 task queue로 넘기는 동작 실행,\",[\"$\",\"br\",null,{}],\"5,000ms를 기다리면 ()=\u003econsole.log(4)를 taskqueue로 넘기는 동작 실행\"]}],[\"$\",\"td\",null,{\"children\":\"5,000ms를 기다리면 ()=\u003econsole.log(4)를 taskqueue로 넘기는 동작 실행\"}],[\"$\",\"td\",null,{\"children\":\"5,000ms를 기다리면 ()=\u003econsole.log(4)를 taskqueue로 넘기는 동작 실행\"}],[\"$\",\"td\",null,{\"children\":\"5,000ms를 기다리면 ()=\u003econsole.log(4)를 taskqueue로 넘기는 동작 실행\"}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"출력\"}],[\"$\",\"td\",null,{\"children\":\"1, 3, 4 '전', 5, 6\"}],[\"$\",\"td\",null,{\"children\":\"4 \\\"다음\\\", a, 7\"}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{\"children\":\"2\"}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{}],[\"$\",\"td\",null,{\"children\":\"4\"}]]}]]}]]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Macrotask\"}],\" \u003e \",[\"$\",\"code\",null,{\"children\":\"Microtask\"}],\" \u003e \",[\"$\",\"code\",null,{\"children\":\"requestAnimationFrame\"}],\" \u003e \",[\"$\",\"code\",null,{\"children\":\"브라우저 렌더링\"}],\" 순서로 렌더링이 진행되기 때문에 위의 코드 실행 중간에 이벤트가 발생해서 \",[\"$\",\"code\",null,{\"children\":\"Macrotask\"}],\"가 하나 생기게 되면 해당 \",[\"$\",\"code\",null,{\"children\":\"Macrotask\"}],\"에 관련된 브라우저 렌더링이 일어나고 위의 코드로 복귀하게 될 수 있다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":64,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FF5582A6\"},\"children\":\"마무리\"}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"기존에는 비동기 코드가 Microtask Queue와 이벤트 루프를 활용해서 돌아간다는 정도만 알고 있었다면, 이제는 브라우저 렌더링 흐름과 함께 이해하면서\\n\",[\"$\",\"strong\",null,{\"children\":\"비동기 방식이 왜 필요한지\"}],\"를 더 정확히 알 수 있었다.\",[\"$\",\"br\",null,{}],\"\\n\",\"기본기를 탄탄하게 다져 보자는 생각으로 시작한 글이기에, 촘촘하게 배우려고 노력했고, 파편화된 지식을 모을 좋은 기회가 되었다.\",[\"$\",\"br\",null,{}],\"\\n\",[\"$\",\"strong\",null,{\"children\":\"이 기술이 왜 필요한지에\"}],\" 집중하면서부터는 좀 더 다양한 시각으로 볼 수 있게 된 것 같다.\",[\"$\",\"br\",null,{}],\"\\n\",\"이제 더 나아가 보자.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":65,\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FF5582A6\"},\"children\":\"참고 문헌\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://wikibook.co.kr/react-deep-dive/\",\"children\":\"https://wikibook.co.kr/react-deep-dive/\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://ko.javascript.info/async\",\"children\":\"https://ko.javascript.info/async\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://product.kyobobook.co.kr/detail/S000001766397\",\"children\":\"https://product.kyobobook.co.kr/detail/S000001766397\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://inpa.tistory.com/entry/%F0%9F%8C%90-requestAnimationFrame-%EA%B0%80%EC%9D%B4%EB%93%9C\",\"children\":\"https://inpa.tistory.com/entry/%F0%9F%8C%90-requestAnimationFrame-%EA%B0%80%EC%9D%B4%EB%93%9C\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.youtube.com/watch?v=8aGhZQkoFbQ\",\"children\":\"https://www.youtube.com/watch?v=8aGhZQkoFbQ\"}]}],\"\\n\"]}]]}]]}]]}]\n"])</script></body></html>