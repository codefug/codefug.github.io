<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="https://codefug.github.io/_next/static/media/518331124efecf5c-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/images/logos/next-cookie.png"/><link rel="preload" as="image" href="/images/2024-07-21/Pasted%20image%2020240722113132.png"/><link rel="preload" as="image" href="/images/2024-07-21/Pasted%20image%2020240722120938.png"/><link rel="preload" as="image" href="/images/2024-07-21/Pasted%20image%2020240722121441.png"/><link rel="preload" as="image" href="/images/2024-07-21/Pasted%20image%2020240722121816.png"/><link rel="preload" as="image" href="/images/2024-07-21/Pasted%20image%2020240722121647.png"/><link rel="preload" as="image" href="/images/2024-07-21/Pasted%20image%2020240722125032.png"/><link rel="preload" as="image" href="/images/2024-07-21/Pasted%20image%2020240722124750.png"/><link rel="preload" as="image" href="/images/2024-07-21/Pasted%20image%2020240722125217.png"/><link rel="preload" as="image" href="/images/2024-07-21/Pasted%20image%2020240722130714.png"/><link rel="stylesheet" href="https://codefug.github.io/_next/static/css/c04e84a4e442b7aa.css" data-precedence="next"/><link rel="stylesheet" href="https://codefug.github.io/_next/static/css/7b1838e6bdc2260c.css" data-precedence="next"/><link rel="stylesheet" href="https://codefug.github.io/_next/static/css/fc37ac2b1a278e8c.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="https://codefug.github.io/_next/static/chunks/webpack-cb9a9adc3ea1ef6e.js"/><script src="https://codefug.github.io/_next/static/chunks/96e220d1-2531cf7c679f7c43.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/770-52cce3cb203b2422.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/main-app-9f1a6571a5a98ceb.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/299-20a67a2580c87e66.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/635-8456b2984470c35f.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/70-d82343500dd0d9ac.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/448-33e6d0825603c686.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/layout-2ef854914d2ef86c.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/not-found-8b0af7c225bbe321.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/posts/%5Bid%5D/layout-6a37c5d18e0b4ffc.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/posts/%5Bid%5D/page-d9f0a2d13d9ca4de.js" async=""></script><script src="https://codefug.github.io/_next/static/chunks/app/global-error-e65e17ac78cfa06a.js" async=""></script><link rel="preload" as="image" href="/images/2024-07-21/Pasted%20image%2020240701225259.png"/><meta name="next-size-adjust" content=""/><title>Codefug Blog</title><meta name="description" content="project experiences and development notes"/><meta property="og:title" content="Codefug Blog"/><meta property="og:description" content="project experiences and development notes"/><meta property="og:url" content="https://codefug-blog.vercel.app"/><meta property="og:image" content="http://localhost:3000/images/main-logo.png"/><meta property="og:image:alt" content="Codefug Blog"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Codefug Blog"/><meta name="twitter:description" content="project experiences and development notes"/><meta name="twitter:image" content="http://localhost:3000/images/main-logo.png"/><meta name="twitter:image:alt" content="Codefug Blog"/><link rel="icon" href="/icon.ico?f00882ffa3186f37" type="image/x-icon" sizes="16x16"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="https://codefug.github.io/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_7ee20e antialiased"><script>((e,t,r,n,i,o,a,s)=>{let l=document.documentElement,u=["light","dark"];function c(t){var r;(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,n=r&&o?i.map(e=>o[e]||e):i;r?(l.classList.remove(...n),l.classList.add(o&&o[t]?o[t]:t)):l.setAttribute(e,t)}),r=t,s&&u.includes(r)&&(l.style.colorScheme=r)}if(n)c(n);else try{let e=localStorage.getItem(t)||r,n=a&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;c(n)}catch(e){}})("class","theme","system",null,["light","dark"],null,true,true)</script><div style="--sidebar-width:16rem;--sidebar-width-icon:3rem" class="group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar"><div class="group peer hidden text-sidebar-foreground md:block" data-state="collapsed" data-collapsible="offcanvas" data-variant="sidebar" data-side="left"><div class="relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear group-data-[collapsible=offcanvas]:w-0 group-data-[side=right]:rotate-180 group-data-[collapsible=icon]:w-[--sidebar-width-icon]"></div><div class="fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)] group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l"><div data-sidebar="sidebar" class="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"><div dir="ltr" class="relative overflow-hidden h-full w-full overflow-y-auto" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit]" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div data-sidebar="content" class="flex min-h-0 flex-1 flex-col overflow-auto group-data-[collapsible=icon]:overflow-hidden group relative gap-0"><div class="absolute h-[150px] w-full bg-primary"></div><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><div data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 mb-2 mt-4 flex justify-center px-4 text-sm font-bold text-gray-400 group-hover:text-white">Codefug</div><div data-sidebar="group-content" class="w-full text-sm flex min-h-full flex-col items-center px-2"><span class="relative flex shrink-0 overflow-hidden rounded-full h-40 w-40"><span class="flex h-full w-full items-center justify-center rounded-full bg-muted group-hover:text-black group-hover:dark:text-white">이승현</span></span><h1 class="mt-4 text-center text-lg font-bold text-gray-400 group-hover:text-black dark:text-gray-500 group-hover:dark:text-white">이승현</h1><p class="text-sm text-gray-400 group-hover:text-black dark:text-gray-500 group-hover:dark:text-white">Web Frontend Developer</p></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R2r6db»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">javascript<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R2r6db»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R4r6db»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">kkom-kkom<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R4r6db»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R6r6db»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">gheuppay<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R6r6db»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«R8r6db»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">reactdeepdive<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«R8r6db»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«Rar6db»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">react<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«Rar6db»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«Rcr6db»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">web<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«Rcr6db»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«Rer6db»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">nextjs<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«Rer6db»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«Rgr6db»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">typescript<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«Rgr6db»" hidden=""></div></div></div><div data-state="closed" class="group/collapsible"><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><button type="button" aria-controls="radix-«Rir6db»" aria-expanded="false" data-state="closed" data-sidebar="group-label" class="h-8 shrink-0 items-center rounded-md px-2 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 flex justify-center text-sm font-bold text-gray-400 hover:bg-accent hover:text-black hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white">fandomk<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down ml-auto transition-transform group-data-[state=open]/collapsible:rotate-180"><path d="m6 9 6 6 6-6"></path></svg></button><div data-state="closed" id="radix-«Rir6db»" hidden=""></div></div></div><div data-sidebar="group" class="relative flex w-full min-w-0 flex-col p-2"><div data-sidebar="group-content" class="w-full text-sm"><ul data-sidebar="menu" class="flex w-full min-w-0 flex-col gap-1"><li data-sidebar="menu-item" class="group/menu-item relative"><a class="text-gray-400 hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-none ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground h-8 text-sm" href="https://www.figma.com/proto/KSWARGDkXi9Wt8ARq2uGCa/leeseounghyun-resume?node-id=401-2&amp;node-type=canvas&amp;t=z2H9bL74afXrrgPS-1&amp;scaling=min-zoom&amp;content-scaling=fixed&amp;page-id=0%3A1" target="_blank" data-sidebar="menu-button" data-size="default" data-active="false">Portfolio</a></li><li data-sidebar="menu-item" class="group/menu-item relative"><a class="text-gray-400 hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-none ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground h-8 text-sm" data-sidebar="menu-button" data-size="default" data-active="false" href="/about">About</a></li><li data-sidebar="menu-item" class="group/menu-item relative"><a class="text-gray-400 hover:underline hover:drop-shadow-lg group-hover:text-black hover:dark:text-white group-hover:dark:text-white peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left outline-none ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&amp;&gt;span:last-child]:truncate [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:shrink-0 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground h-8 text-sm" data-sidebar="menu-button" data-size="default" data-active="false" href="/search">Search</a></li></ul></div></div></div><div data-sidebar="footer" class="flex flex-col gap-2 p-2"></div></div></div></div></div></div></div><style>
:root {
  --bprogress-color: #1f1d80;
  --bprogress-height: 4px;
  --bprogress-spinner-size: 18px;
  --bprogress-spinner-animation-duration: 400ms;
  --bprogress-spinner-border-size: 2px;
  --bprogress-box-shadow: 0 0 10px #1f1d80, 0 0 5px #1f1d80;
  --bprogress-z-index: 99999;
  --bprogress-spinner-top: 15px;
  --bprogress-spinner-bottom: auto;
  --bprogress-spinner-right: 15px;
  --bprogress-spinner-left: auto;
}

.bprogress {
  width: 0;
  height: 0;
  pointer-events: none;
  z-index: var(--bprogress-z-index);
}

.bprogress .bar {
  background: var(--bprogress-color);
  position: fixed;
  z-index: var(--bprogress-z-index);
  top: 0;
  left: 0;
  width: 100%;
  height: var(--bprogress-height);
}

/* Fancy blur effect */
.bprogress .peg {
  display: block;
  position: absolute;
  right: 0;
  width: 100px;
  height: 100%;
  box-shadow: var(--bprogress-box-shadow);
  opacity: 1.0;
  transform: rotate(3deg) translate(0px, -4px);
}

/* Remove these to get rid of the spinner */
.bprogress .spinner {
  display: block;
  position: fixed;
  z-index: var(--bprogress-z-index);
  top: var(--bprogress-spinner-top);
  bottom: var(--bprogress-spinner-bottom);
  right: var(--bprogress-spinner-right);
  left: var(--bprogress-spinner-left);
}

.bprogress .spinner-icon {
  width: var(--bprogress-spinner-size);
  height: var(--bprogress-spinner-size);
  box-sizing: border-box;
  border: solid var(--bprogress-spinner-border-size) transparent;
  border-top-color: var(--bprogress-color);
  border-left-color: var(--bprogress-color);
  border-radius: 50%;
  -webkit-animation: bprogress-spinner var(--bprogress-spinner-animation-duration) linear infinite;
  animation: bprogress-spinner var(--bprogress-spinner-animation-duration) linear infinite;
}

.bprogress-custom-parent {
  overflow: hidden;
  position: relative;
}

.bprogress-custom-parent .bprogress .spinner,
.bprogress-custom-parent .bprogress .bar {
  position: absolute;
}

.bprogress .indeterminate {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--bprogress-height);
  overflow: hidden;
}

.bprogress .indeterminate .inc,
.bprogress .indeterminate .dec {
  position: absolute;
  top: 0;
  height: 100%;
  background-color: var(--bprogress-color);
}

.bprogress .indeterminate .inc {
  animation: bprogress-indeterminate-increase 2s infinite;
}

.bprogress .indeterminate .dec {
  animation: bprogress-indeterminate-decrease 2s 0.5s infinite;
}

@-webkit-keyframes bprogress-spinner {
  0%   { -webkit-transform: rotate(0deg); transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); transform: rotate(360deg); }
}

@keyframes bprogress-spinner {
  0%   { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes bprogress-indeterminate-increase {
  from { left: -5%; width: 5%; }
  to { left: 130%; width: 100%; }
}

@keyframes bprogress-indeterminate-decrease {
  from { left: -80%; width: 80%; }
  to { left: 110%; width: 10%; }
}
</style><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><main class="flex min-h-screen flex-col transition-[width] duration-200 ease-linear w-full"><header class="sticky left-0 right-0 top-0 z-30 transform bg-background transition-transform duration-300 translate-y-0"><div class="flex items-center justify-between gap-6 py-4"><section class="flex items-center gap-4"><div class="ml-2"><button class="flex h-7 w-7 items-center justify-center rounded-md hover:bg-accent hover:text-black hover:dark:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-panel-left-open"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"></path><path d="m14 9 3 3-3 3"></path></svg></button></div><a class="flex flex-shrink-0 items-center gap-2 hover:opacity-95 hover:drop-shadow-lg" href="/"><img alt="logo" loading="lazy" width="28" height="28" decoding="async" data-nimg="1" style="color:transparent" src="/images/main-logo.png"/><div class="hidden whitespace-nowrap text-lg font-bold text-black dark:text-white md:block">Codefug Blog</div></a></section><section class="flex items-center gap-4 text-sm font-semibold md:text-base"><nav class="flex items-center gap-4 text-sm font-semibold md:text-base"><a href="https://www.figma.com/proto/KSWARGDkXi9Wt8ARq2uGCa/leeseounghyun-resume?node-id=401-2&amp;node-type=canvas&amp;t=z2H9bL74afXrrgPS-1&amp;scaling=min-zoom&amp;content-scaling=fixed&amp;page-id=0%3A1" target="_blank" class="text-gray-400 hover:text-black hover:underline hover:drop-shadow-lg dark:hover:text-white">Portfolio</a><a class="text-gray-400 hover:text-black hover:underline hover:drop-shadow-lg dark:hover:text-white" href="/about">About</a><a class="text-gray-400 hover:text-black hover:underline hover:drop-shadow-lg dark:hover:text-white" href="/search"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search h-5 w-5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg></a></nav><button type="button" role="switch" aria-checked="false" data-state="unchecked" value="on" class="peer inline-flex h-7 w-16 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input"><span data-state="unchecked" class="pointer-events-none block h-6 w-6 rounded-full bg-theme-icon bg-center shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-[2.25rem] data-[state=unchecked]:translate-x-0 data-[state=checked]:bg-moon data-[state=unchecked]:bg-sun"></span></button><input type="checkbox" aria-hidden="true" style="transform:translateX(-100%);position:absolute;pointer-events:none;opacity:0;margin:0" tabindex="-1" value="on"/></section></div><div class="h-2 origin-left bg-primary" style="transform:scaleX(0)"></div></header><div class="mx-auto w-full max-w-[1400px] flex-1 px-4"><!--$--><div class="prose mx-auto overflow-auto dark:prose-invert"><section><header class="mb-8"><div class="relative mb-6 h-[300px] w-full overflow-hidden rounded-xl sm:h-[400px] md:h-[450px]"><img alt="(급페이 프로젝트) 카드 렌더링을 최적화하여 UX를 향상시키기 위한 머나먼 여정" decoding="async" data-nimg="fill" class="object-cover object-center transition-transform duration-500 hover:scale-105" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="/images/logos/next-cookie.png"/><div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/70"></div><div class="absolute left-4 top-4 flex flex-wrap gap-2 sm:left-6 sm:top-6"><div class="inline-flex items-center rounded-md border px-2.5 py-0.5 transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-white/90 text-xs font-medium text-gray-800 hover:bg-white sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag mr-1 h-3 w-3"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z"></path><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"></circle></svg> <!-- -->gheuppay</div></div></div><div class="mb-6 space-y-4"><h1 class="mb-0 text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-50 sm:text-4xl md:text-5xl">(급페이 프로젝트) 카드 렌더링을 최적화하여 UX를 향상시키기 위한 머나먼 여정</h1><div class="flex items-center justify-end gap-4 text-sm text-gray-600 dark:text-gray-400"><div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days mr-2 h-4 w-4"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path><path d="M8 14h.01"></path><path d="M12 14h.01"></path><path d="M16 14h.01"></path><path d="M8 18h.01"></path><path d="M12 18h.01"></path><path d="M16 18h.01"></path></svg><time dateTime="2024-07-21">2024-07-21</time></div></div><p class="text-lg leading-relaxed text-gray-600 dark:text-gray-300 md:text-xl">server component 설계를 이용한 suspense 적극 활용, 이를 위해서 next cookie를 사용하면서 겪은 문제들을 적은 글입니다.</p></div><div class="border-b border-gray-200 dark:border-gray-800"></div></header><section class="lg:flex lg:items-baseline"><button class="fixed right-0 top-1/2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left h-6 w-6 text-muted-foreground lg:size-8"><path d="m15 18-6-6 6-6"></path></svg></button><div class="fixed right-0 top-24 hidden w-[300px]"><div class="rounded-lg border bg-card p-4 shadow-sm"><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x absolute right-4 top-4 h-5 w-5 cursor-pointer text-muted-foreground"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button><h4 class="mb-3 mt-0 text-sm font-medium text-foreground">목차</h4><nav class="max-h-[60vh] space-y-0.5 overflow-auto pr-2"><a class="block py-1.5 transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-2 text-base font-medium" href="/posts/2024-07-21#0설계">설계</a><a class="block py-1.5 text-sm transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-4" href="/posts/2024-07-21#1서버 컴포넌트 설계">서버 컴포넌트 설계</a><a class="block py-1.5 text-sm transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-4" href="/posts/2024-07-21#2Next Cookie를 이용한 설계">Next Cookie를 이용한 설계</a><a class="block py-1.5 text-sm transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-6" href="/posts/2024-07-21#3Next Cookie까지 오게된 과정 (고민들)">Next Cookie까지 오게된 과정 (고민들)</a><a class="block py-1.5 transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-2 text-base font-medium" href="/posts/2024-07-21#4페이지 구현">페이지 구현</a><a class="block py-1.5 text-sm transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-4" href="/posts/2024-07-21#5전체 페이지 구조 설계">전체 페이지 구조 설계</a><a class="block py-1.5 text-sm transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-4" href="/posts/2024-07-21#6메인 카드 설계">메인 카드 설계</a><a class="block py-1.5 text-sm transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-4" href="/posts/2024-07-21#7최근 본 공고 설계">최근 본 공고 설계</a><a class="block py-1.5 text-sm transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-6" href="/posts/2024-07-21#8트러블 슈팅">트러블 슈팅</a><a class="block py-1.5 transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-8 text-xs" href="/posts/2024-07-21#9핸들러에 비동기 함수를 넣어선 안된다.">핸들러에 비동기 함수를 넣어선 안된다.</a><a class="block py-1.5 transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-10 text-xs" href="/posts/2024-07-21#10해결 방법">해결 방법</a><a class="block py-1.5 transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-8 text-xs" href="/posts/2024-07-21#11쿠키에 저장하는 건 한계가 있다.">쿠키에 저장하는 건 한계가 있다.</a><a class="block py-1.5 transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-10 text-xs" href="/posts/2024-07-21#12해결 방법">해결 방법</a><a class="block py-1.5 transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 border-transparent text-muted-foreground hover:text-foreground/90 pl-2 text-base font-medium" href="/posts/2024-07-21#13reference">reference</a></nav></div></div><section class="max-w-full"><h1 id="0설계"><mark style="background:#FF5582A6">설계</mark></h1>
<p><img src="/images/2024-07-21/Pasted%20image%2020240722113132.png" alt=""/></p>
<p>위의 시안을 분석해보고 Next.js 식으로 최대한 서버 컴포넌트를 이용하려면 다음과 같이 분기를 나눠서 생각해보면 다음과 같습니다.</p>
<ol>
<li>위쪽의 메인이 되는 카드 : 초기 페이지 렌더링 시 서버에서 받아오고 suspense로 기다리는 시간 보완. (server component)<!-- -->
<ol>
<li>신청하기 버튼의 경우 로그인 상태에 따라서 여러가지 분기가 나뉘어지게 설계. (이벤트 핸들러가 들어가기 때문에 client component)</li>
</ol>
</li>
<li>최근에 본 공고 파트 : 앞에서 데이터가 들어오면 뒤의 데이터는 없어져야 하니 <code>queue</code> 자료구조로 설계 (server component)</li>
</ol>
<p><img src="/images/2024-07-21/Pasted%20image%2020240722120938.png" alt=""/></p>
<p>(red : server component, blue: client component)</p>
<h2 id="1서버 컴포넌트 설계"><mark style="background:#FFB86CA6">서버 컴포넌트 설계</mark></h2>
<p>서버 컴포넌트를 설계하기 위해선 페이지 단위에서 일단 서버 컴포넌트여야 합니다. 최상단의 컴포넌트가 클라이언트 컴포넌트일 경우 서버 컴포넌트를 사용할 수 없게 되기 때문입니다.</p>
<blockquote>
<p>RCC (React Client Component) 는 서버 컴포넌트를 import할 수 없습니다. 서버 환경이 브라우저에 존재하지 않기 때문입니다.</p>
</blockquote>
<p>서버 컴포넌트를 사용할 경우 Next.js 에서는 각각의 컴포넌트를 따로 loading할 수 있는 streaming 방식을 사용합니다.</p>
<p><img src="/images/2024-07-21/Pasted%20image%2020240722121441.png" alt=""/></p>
<p>컴포넌트 별로 분할해서 loading state를 처리하는 방법은 리액트의 <code>Suspense</code>를 사용하는 것입니다. next에서 확장시킨 <code>Suspense</code>로 서버 컴포넌트를 감싸면 서버 컴포넌트가 렌더링 되기 전까지 <code>fallback</code> 안에 있는 컴포넌트가 해당 서버 컴포넌트를 대신합니다.</p>
<p><img src="/images/2024-07-21/Pasted%20image%2020240722121816.png" alt=""/></p>
<blockquote>
<p>TTFB : 첫 바이트까지의 시간
FCP : 최초 컨텐츠가 페인팅되기까지의 시간
TTI : 사용자가 인터렉션을 할 수 있게 되는 시간</p>
</blockquote>
<p>위 사진은 streaming 이전의 방식입니다. 모든 컴포넌트가 렌더링이 되야 페이지가 로딩되기 때문에 TTFB, FCP, TTI 가 순차적으로 보여질 수 밖에 없었습니다.</p>
<p>로딩 화면이 모두 끝나고 페이지에 진입할 수 있도록 강제하는 것은 UX적으로 안 좋을 수 밖에 없습니다.</p>
<p>예를 들어 네이버에 웹툰을 보러 들어갔는데 웹툰 페이지 진입 버튼 하나를 누르기 위해서 스포츠, 연예, 뉴스 모든 컨텐츠가 사용가능한 상태가 되기까지 기다리는 것은 페이지 성능이 좋아서 빨리 로딩되더라도 더 최적화할 여지가 있는 것입니다.</p>
<p>Next는 이를 streaming으로 해결했습니다.</p>
<p><img src="/images/2024-07-21/Pasted%20image%2020240722121647.png" alt=""/></p>
<p>각각의 컴포넌트는 각각의 파트를 가집니다. 데이터를 받고 HTML을 렌더링하고 하이드레이션하는 과정들을 각각 가짐으로써 TTFB, FCP, TTI를 모두 당기게 되어 페이지 성능 최적화를 이끌게 됩니다.</p>
<blockquote>
<p>급페이 프로젝트에서는 이를 최대한 활용하며 개발을 나아갔습니다.</p>
</blockquote>
<h2 id="2Next Cookie를 이용한 설계"><mark style="background:#FFB86CA6">Next Cookie를 이용한 설계</mark></h2>
<p>React에서는 다음과 같이 통신이 진행됩니다.</p>
<p><img src="/images/2024-07-21/Pasted%20image%2020240722125032.png" alt=""/></p>
<p>프론트엔드 서버가 존재하는 Next.js에서는 간단하게 다음과 같이 통신이 진행됩니다.</p>
<p><img src="/images/2024-07-21/Pasted%20image%2020240722124750.png" alt=""/></p>
<p>브라우저 &gt; 프론트엔드 서버(node.js 환경) &gt; 백엔드 서버 식이죠. 위처럼 움직이기 때문에 SSR이나 SSG, ISG 등등이 가능하게 된 것입니다.</p>
<p>서버 컴포넌트는 프론트엔드 &quot;서버&quot; 컴포넌트를 말하는데요. 데이터를 분할해서 브라우저로 보낼 수 있는 streaming이 가능한 이유도 이것 때문입니다.</p>
<p><img src="/images/2024-07-21/Pasted%20image%2020240722125217.png" alt=""/></p>
<p>Suspense를 이용하면 위 사진처럼 fallback을 먼저 보내고 프론트엔드 서버에서 서버 컴포넌트 렌더링을 끝내면 브라우저에 컴포넌트를 보내고 fallback을 치우는 식이죠.</p>
<p>이번 작업에서 최근 본 공고에 이를 활용하고자 했는데요. 문제는 서버 컴포넌트 렌더링을 끝내고 Suspense를 받기 위해서는 서버 컴포넌트 내부의 것들이 서버 관련이어야 한다는 것입니다.</p>
<blockquote>
<p>서버 컴포넌트 : 클라이언트 관련된 것들을 사용할 수 없습니다. Web API, document, web storage 등등에 접근할 수 없고 상태,훅등을 사용할 수 없습니다. 대신 db, 내부 서비스, 파일 시스템 등 서버에만 있는 데이터는 async, await으로 접근할 수 있습니다.</p>
</blockquote>
<p>로컬 스토리지나 세션 스토리지 같은 web storage를 사용해서 최근 본 공고를 구현할 수는 있었으나 web storage라서 서버 컴포넌트 안에서는 쓸 수 없었고 그럼 Suspense를 활용할 수 없게 됩니다.</p>
<p>이를 위해 찾게 된 것이 Next Cookie였습니다.</p>
<p>기존 React에서는 쿠키를 document.cookie를 이용해서 접근이 가능했습니다. (httpOnly가 아닐 경우에만) (<a href="https://ko.javascript.info/cookie">https://ko.javascript.info/cookie</a>)</p>
<p>쿠키는 통신에 담기기 때문에 다음의 사진대로 움직이게 되죠</p>
<p><img src="/images/2024-07-21/Pasted%20image%2020240722125032.png" alt=""/></p>
<p>Next 에서의 쿠키 조작은 프론트엔드 서버에서 가능합니다. <a href="https://nextjs.org/docs/app/api-reference/functions/cookies">https://nextjs.org/docs/app/api-reference/functions/cookies</a></p>
<p><img src="/images/2024-07-21/Pasted%20image%2020240722130714.png" alt=""/></p>
<p>브라우저와 백엔드 서버 사이에서 쿠키를 CRUD할 수 있고 이는 프론트엔드 서버에서 실행되기에 서버 컴포넌트 안에서도 사용가능한 것이었습니다.</p>
<p>이를 기반으로 함수를 만들어주고 분기를 나누게 되었습니다.
<a href="https://nextjs.org/docs/app/api-reference/functions/cookies">https://nextjs.org/docs/app/api-reference/functions/cookies</a></p>
<p>Suspense 사용을 위한 서버 컴포넌트 설계를 위해 쿠키를 활용했다 라는 것을 알아두고 자세한 이야기는 최근 본 공고 설계 부분에서 다루도록 하겠습니다.</p>
<h3 id="3Next Cookie까지 오게된 과정 (고민들)"><mark style="background:#FFF3A3A6">Next Cookie까지 오게된 과정 (고민들)</mark></h3>
<p>사실 처음에는 로그인 상태나 최근 본 공고는 전역 상태 관리로 처리하려고 했습니다.</p>
<p>전역 상태라는 것은 해당 route에서 고정됩니다. route change가 일어나면 저장이 되지 않습니다.</p>
<p>zustand에서 persist라는 미들웨어가 존재해서 route change에서도 로컬 스토리지를 활용해 데이터를 저장해 놓았기 때문인데요.</p>
<p>이를 사용하기 위한 많은 시행 착오가 있었습니다.</p>
<p>정말 수많은 레퍼런스도 찾아보았고 클라이언트와 서버 둘다 실행되는 zustand를 Next에서 사용하기 위해서 hydrate를 진행하지 않다가 rehydrate를 클라이언트 단에서 하는 등의 방식도 찾게 되었습니다.</p>
<pre><code class="hljs language-tsx"><span class="hljs-string">&quot;use client&quot;</span>;

<span class="hljs-keyword">import</span> useUserStore <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/stores/create-store&quot;</span>;
<span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;

<span class="hljs-comment">// mount 시 rehydrate를 실행합니다.</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Hydration</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    useUserStore.<span class="hljs-property">persist</span>.<span class="hljs-title function_">rehydrate</span>();
  }, []);

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Hydration</span>;
</code></pre>
<p>소위 온몸 비틀기를 사용한 것인데요.</p>
<p>전역 &quot;상태&quot; 에 집중해보았습니다. zustand 개발자분은 깃허브 이슈에서 서버에는 &quot;상태&quot;가 존재하지 않다는 사실을 알면 이해가 편할꺼라고 이야기를 자주했습니다. 거기에 팀원이 사실 로컬 스토리지가 있는데 전역 상태와의 차이가 없는 것 같다고 말씀 해주셨습니다. 더구나 주스탄드 역시 rehydrate를 클라이언트 단에서 사용하고 로컬 스토리지를 활용하기 때문에 클라이언트 컴포넌트에서밖에 사용할 수 없었죠.</p>
<p>저도 선뜻 대답할 수 없었고 &quot;상태&quot;라는 것에 집중해보았습니다.</p>
<p>지금 저장하고 있는 상태가 한 라우트에서 렌더링의 변화가 이루어져야 하는 것인가? 아니면 전역 데이터로써 한번 가져오고 바꿀 수만 있으면 되는 것인가 에 집중해보았습니다.</p>
<p>브라우저에서 관리되어야할 데이터는 &quot;상태&quot; 보단 &quot;공고에 대한 정보, 로그인 여부 같은 단순 데이터&quot; 라는 사실을 알게 되었고 zustand는 급페이 프로젝트에서 삭제하게 되고 이 과정 속에서 서버에서도 활용이 가능한 Next cookie를 만나게 됩니다.</p>
<blockquote>
<p>이 문제들을 해결하는 과정에서 기술은 어디까지나 도구 라는 생각을 강하게 갖게 되었습니다. 전역 상태 관리 라는 것의 의미를 많이 고민하고 설계를 진행했더라면 zustand라는 도구를 사용하지 않았을 것입니다.</p>
</blockquote>
<h1 id="4페이지 구현"><mark style="background:#FF5582A6">페이지 구현</mark></h1>
<p>이제 구현에 대해서 본격적으로 코드와 함께 찾아보겠습니다. 코드를 작성한 이유와 그와 관련된 트러블 이슈를 이야기해보겠습니다.</p>
<h2 id="5전체 페이지 구조 설계"><mark style="background:#FFB86CA6">전체 페이지 구조 설계</mark></h2>
<pre><code class="hljs language-tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">page</span>(<span class="hljs-params">{ params }: <span class="hljs-title class_">PageProps</span></span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;base-container&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">NoticeDetailCardSkeleton</span> /&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">NoticeDetailCard</span> <span class="hljs-attr">shopId</span>=<span class="hljs-string">{params.shop_id}</span> <span class="hljs-attr">noticeId</span>=<span class="hljs-string">{params.notice_id}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;my-12&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-l py-8 font-bold md:text-2xl&quot;</span>&gt;</span>최근에 본 공고<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;grid grid-cols-2 gap-4 lg:grid-cols-3&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>
            <span class="hljs-attr">fallback</span>=<span class="hljs-string">{[1,</span> <span class="hljs-attr">2</span>, <span class="hljs-attr">3</span>, <span class="hljs-attr">4</span>, <span class="hljs-attr">5</span>, <span class="hljs-attr">6</span>]<span class="hljs-attr">.map</span>((<span class="hljs-attr">value</span>) =&gt;</span> (
              <span class="hljs-tag">&lt;<span class="hljs-name">NoticeCardSkeleton</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{value}</span> /&gt;</span>
            ))}
          &gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">RecentNotices</span>
              <span class="hljs-attr">shopId</span>=<span class="hljs-string">{params.shop_id}</span>
              <span class="hljs-attr">noticeId</span>=<span class="hljs-string">{params.notice_id}</span>
            /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>페이지 전체 구조입니다.</p>
<p>메인 카드와 최근 본 공고의 스켈레톤을 제작하고 이를 Suspense의 fallback으로 만듬으로써 서버 컴포넌트들이 렌더링 되기 전에 스켈레톤을 볼 수 있도록 하였습니다. ui 컴포넌트에 가까우니 빠르게 넘어가겠습니다.</p>
<h2 id="6메인 카드 설계"><mark style="background:#FFB86CA6">메인 카드 설계</mark></h2>
<pre><code class="hljs language-tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">NoticeDetailCard</span>(<span class="hljs-params">{
  shopId,
  noticeId,
}: <span class="hljs-title class_">NoticeDetailCardProps</span></span>) {
  <span class="hljs-keyword">const</span> noticeDetail = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getShopNoticeDetail</span>(shopId, noticeId);
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">type</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&quot;type&quot;</span>);
  <span class="hljs-keyword">const</span> address = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&quot;address&quot;</span>);
  <span class="hljs-keyword">const</span> userId = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&quot;userId&quot;</span>);

  <span class="hljs-keyword">const</span> hourlyWage = <span class="hljs-title function_">calculateWagePercentage</span>(noticeDetail.<span class="hljs-property">item</span>.<span class="hljs-property">hourlyPay</span>);
  <span class="hljs-keyword">const</span> date = <span class="hljs-title function_">dateFormat</span>(noticeDetail.<span class="hljs-property">item</span>.<span class="hljs-property">startsAt</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-attr">isLater</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-title function_">compareWorkingDateDiffFromNow</span>(
    noticeDetail.<span class="hljs-property">item</span>.<span class="hljs-property">startsAt</span>,
    noticeDetail.<span class="hljs-property">item</span>.<span class="hljs-property">workhour</span>,
  );
  <span class="hljs-keyword">const</span> userApplication =
    <span class="hljs-keyword">typeof</span> userId === <span class="hljs-string">&quot;string&quot;</span> &amp;&amp; <span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;employee&quot;</span>
      ? <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUsersUserIdApplications</span>(userId)
      : <span class="hljs-literal">null</span>;
<span class="hljs-comment">//...</span>
</code></pre>
<p>shopId와 noticeId를 param에서 꺼내며 사용되는 NoticeDetailCard 입니다. 쿠키를 활용해서 사용자의 정보를 받아 올 수 있으며 이를 통해 렌더링을 진행했습니다.</p>
<p>이 정보를 통해서 서버 컴포넌트를 만들 때부터 신청하기 버튼의 분기 처리가 가능합니다.</p>
<pre><code class="hljs language-tsx"><span class="hljs-string">&quot;use client&quot;</span>
<span class="hljs-comment">//...</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RegisterButton</span>(<span class="hljs-params">{
  address,
  userApplication,
  shopId,
  noticeId,
}: <span class="hljs-title class_">RegisterButtonProps</span></span>) {
  <span class="hljs-keyword">if</span> (userApplication === <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">LinkButton</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">{</span>&quot;/<span class="hljs-attr">login</span>&quot;}&gt;</span>
        신청하기
      <span class="hljs-tag">&lt;/<span class="hljs-name">LinkButton</span>&gt;</span></span>
    );
  }

  <span class="hljs-keyword">const</span> isRegister = userApplication.<span class="hljs-property">items</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">obj</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> (
      obj.<span class="hljs-property">item</span>.<span class="hljs-property">notice</span>.<span class="hljs-property">item</span>.<span class="hljs-property">id</span> === noticeId &amp;&amp; obj.<span class="hljs-property">item</span>.<span class="hljs-property">status</span> === <span class="hljs-string">&quot;pending&quot;</span>
    );
  });

  <span class="hljs-keyword">const</span> isRejected = userApplication.<span class="hljs-property">items</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">obj</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> (
      obj.<span class="hljs-property">item</span>.<span class="hljs-property">notice</span>.<span class="hljs-property">item</span>.<span class="hljs-property">id</span> === noticeId &amp;&amp; obj.<span class="hljs-property">item</span>.<span class="hljs-property">status</span> === <span class="hljs-string">&quot;rejected&quot;</span>
    );
  });
  <span class="hljs-comment">//...</span>
</code></pre>
<p>위처럼 쿠키가 활용된 데이터를 props으로 내려줌으로써 클라이언트 컴포넌트인 신청하기 버튼이 모달 기능, Link 등등 다양한 기능 확장을 가질 수 있게 되었습니다.</p>
<h2 id="7최근 본 공고 설계"><mark style="background:#FFB86CA6">최근 본 공고 설계</mark></h2>
<p>이번 글 쓰기의 목적이자 제일 공을 많이 들였던 파트입니다.</p>
<p>우선 공고를 저장하는 로직은 <code>큐</code> 자료구조여야 합니다. 저장하는 함수에서 이를 갖고 있다면 사용하는 사람은 인수를 보내기만 하면 되겠죠. cookie와 관련되어 있기에 구체적인 구현은 숨기고 드러나는 부분은 함수 하나로 클린하게 만들기 위해 노력했습니다.</p>
<pre><code class="hljs language-tsx"><span class="hljs-string">&quot;use server&quot;</span>;
<span class="hljs-comment">//...</span>
<span class="hljs-comment">// notice를 가져옵니다.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getNotices = <span class="hljs-title function_">async</span> (): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">NoticeIds</span>[]&gt; =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">currentNotice</span>: <span class="hljs-title class_">NoticeIds</span>[] = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(
    (<span class="hljs-keyword">await</span> <span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&quot;notices&quot;</span>)) || <span class="hljs-string">&quot;[]&quot;</span>,
  );
  <span class="hljs-keyword">return</span> currentNotice;
};

<span class="hljs-comment">// notice를 파싱해주는 내부 함수</span>
<span class="hljs-keyword">const</span> setNotices = <span class="hljs-title function_">async</span> (<span class="hljs-attr">noticesIdList</span>: <span class="hljs-title class_">NoticeIds</span>[]): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">setCookie</span>(<span class="hljs-string">&quot;notices&quot;</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(noticesIdList));
};

<span class="hljs-comment">// notice를 큐 자료구조를 활용하여 저장하는 로직</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">postNotice</span>(<span class="hljs-params">
  <span class="hljs-attr">notice</span>: <span class="hljs-title class_">GetNotices</span>[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;item&quot;</span>],
</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">currentNotice</span>: <span class="hljs-title class_">NoticeIds</span>[] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getNotices</span>();
  <span class="hljs-keyword">const</span> newNoticeId = { <span class="hljs-attr">id</span>: notice.<span class="hljs-property">id</span>, <span class="hljs-attr">shopId</span>: notice.<span class="hljs-property">shop</span>.<span class="hljs-property">item</span>.<span class="hljs-property">id</span> };

  <span class="hljs-comment">// 중복 확인</span>
  <span class="hljs-keyword">const</span> isDuplicated = currentNotice.<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> n.<span class="hljs-property">id</span> === notice.<span class="hljs-property">id</span>);
  <span class="hljs-keyword">if</span> (isDuplicated) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">setNotices</span>([
      newNoticeId,
      ...currentNotice.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> n.<span class="hljs-property">id</span> !== notice.<span class="hljs-property">id</span>),
    ]);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentNotice.<span class="hljs-property">length</span> &gt;= <span class="hljs-number">7</span>) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">setNotices</span>([newNoticeId, ...currentNotice.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>)]);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">setNotices</span>([newNoticeId, ...currentNotice]);
  }
}
</code></pre>
<p>데이터를 저장하는 로직을 위처럼 구성해놓아 notice를 가져올 때는 getNotices() 저장할때는 postNotice(데이터) 형식으로 단순화시켰습니다.</p>
<p>자동으로 중복처리, 데이터 관리를 해주기에 추후 작업이 빨라지게 되었습니다.</p>
<pre><code class="hljs language-tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RecentNotices</span>(<span class="hljs-params">{
  shopId,
  noticeId,
}: <span class="hljs-title class_">ReCentNoticesProps</span></span>) {
  <span class="hljs-keyword">const</span> notices = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getNotices</span>();
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">PostNoticesEffect</span> <span class="hljs-attr">shopId</span>=<span class="hljs-string">{shopId}</span> <span class="hljs-attr">noticeId</span>=<span class="hljs-string">{noticeId}</span> /&gt;</span>
      {notices &amp;&amp;
        notices.length &gt; 1 &amp;&amp;
        notices.map(async (notice) =&gt; {
          if (notice.id === noticeId) return null; // early return
          const cardContents = await fetchNotices(notice);
          return (
            <span class="hljs-tag">&lt;<span class="hljs-name">LinkButton</span>
              <span class="hljs-attr">noticeId</span>=<span class="hljs-string">{cardContents.id}</span>
              <span class="hljs-attr">shopId</span>=<span class="hljs-string">{cardContents.shop.item.id}</span>
              <span class="hljs-attr">key</span>=<span class="hljs-string">{cardContents.id}</span>
            &gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">NoticeCard</span>
                <span class="hljs-attr">address1</span>=<span class="hljs-string">{cardContents.shop.item.address1}</span>
                <span class="hljs-attr">closed</span>=<span class="hljs-string">{cardContents.closed}</span>
                <span class="hljs-attr">hourlyPay</span>=<span class="hljs-string">{cardContents.hourlyPay}</span>
                <span class="hljs-attr">noticeId</span>=<span class="hljs-string">{cardContents.id}</span>
                <span class="hljs-attr">imageUrl</span>=<span class="hljs-string">{cardContents.shop.item.imageUrl}</span>
                <span class="hljs-attr">name</span>=<span class="hljs-string">{cardContents.shop.item.name}</span>
                <span class="hljs-attr">startsAt</span>=<span class="hljs-string">{cardContents.startsAt}</span>
                <span class="hljs-attr">workhour</span>=<span class="hljs-string">{cardContents.workhour}</span>
              /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">LinkButton</span>&gt;</span>
          );
        })}
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>보시면 PostNoticeEffect 라는 부분이 있는데요. 이는 UseEffect로 데이터를 저장해주기 위함입니다.</p>
<p>이렇게 사용하는 이유는 다음의 과정으로 렌더링이 진행되기 때문입니다.</p>
<ol>
<li>페이지에 진입한다.</li>
<li>최근 본 공고가 렌더링된다.</li>
<li>진입이 되었기에 쿠키에서 현재 보는 공고도 추가시킨다.</li>
<li>쿠키 변경으로 인해서 최근 본 공고가 리렌더링 (변경 된다.)</li>
</ol>
<p>이는 서버 컴포넌트 렌더링 이후에 한번 더 데이터가 바뀌는 모습을 보여주게 되었고 이를 문제로 여겼습니다.</p>
<pre><code class="hljs language-tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PostNoticesEffect</span>(<span class="hljs-params">{
  shopId,
  noticeId,
}: {
  shopId: <span class="hljs-built_in">string</span>;
  noticeId: <span class="hljs-built_in">string</span>;
}</span>) {
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getShopNoticeDetail</span>(shopId, noticeId);
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">postNotice</span>(data.<span class="hljs-property">item</span>);
    };
    <span class="hljs-title function_">fetchData</span>();
  }, []);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span><span class="hljs-tag">&lt;/&gt;</span></span>;
}
</code></pre>
<p>위의 코드를 삽입해서 클라이언트 렌더링 시에 postNotice를 실행시켜서 데이터를 쿠키에 담게 하였고 쿠키가 바뀌게 되면서 발생하는 리렌더링 시</p>
<pre><code class="hljs language-tsx"><span class="hljs-keyword">if</span> (notice.<span class="hljs-property">id</span> === noticeId) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// early return</span>
</code></pre>
<p>early return으로 현재 보는 공고는 차단하여 사용자는 렌더링된 것을 느끼지 못하게 하였습니다.</p>
<p>이로써 서버 컴포넌트이기에 굉장히 빠르게 렌더링 되면서 suspense로 인한 스켈레톤 표현까지 할 수 있게 되었습니다.</p>
<div><iframe title="vimeo-988246692" src="https://player.vimeo.com/video/988246692" width="640" height="360" allow="autoplay; fullscreen" allowFullScreen=""></iframe></div>
<h3 id="8트러블 슈팅"><mark style="background:#FFF3A3A6">트러블 슈팅</mark></h3>
<h4 id="9핸들러에 비동기 함수를 넣어선 안된다."><mark style="background:#BBFABBA6">핸들러에 비동기 함수를 넣어선 안된다.</mark></h4>
<p>공고 카드를 광클하면 멈추는 오류를 발견했습니다.</p>
<pre><code class="hljs language-tsx"><span class="hljs-comment">//...</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">NoticeCard</span>(<span class="hljs-params">{
  hourlyPay,
  startsAt,
  workhour,
  noticeId,
  shopId,
  imageUrl,
  name,
  address1,
  content,
  closed,
}: <span class="hljs-title class_">NoticeCardProps</span></span>) {
  <span class="hljs-keyword">const</span> hourlyWage = <span class="hljs-title function_">calculateWagePercentage</span>(hourlyPay);
  <span class="hljs-keyword">const</span> date = <span class="hljs-title function_">dateFormat</span>(startsAt);
  <span class="hljs-keyword">const</span> <span class="hljs-attr">isLater</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-title function_">compareWorkingDateDiffFromNow</span>(startsAt, workhour);
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">if</span> (content) {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">postNoticeAction</span>(content);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">redirectAction</span>(<span class="hljs-string">`/admin/notice-detail/<span class="hljs-subst">${shopId}</span>/<span class="hljs-subst">${noticeId}</span>`</span>);
    }
  };
<span class="hljs-comment">//...</span>
</code></pre>
<p>content로 분기처리를 해서 이벤트를 전달하는데 여기서 문제가 발생한 줄 알았으나</p>
<p>현재 post의 경우 cookie로 관리되고 있는데 이 cookie를 set하는 함수가 버튼의 이벤트 핸들러에 있어서 setter함수를 비동기적으로 계속 누르면</p>
<p>서버에 과부하가 걸려서 페이지가 멈추게 되었던 것입니다.</p>
<p>이벤트 핸들러 광클 &gt; cookie를 저장하는 비동기 함수 계속 실행 &gt; 특정 시점에 content가 없어지는 현상 &gt; redirectAction() 함수로 인해 middleware에서 처리(content가 없으면 사장님 페이지로 이동되지만 사장님이 아니기에 list page로 강제 이동)</p>
<h5 id="10해결 방법"><mark style="background:#ABF7F7A6">해결 방법</mark></h5>
<p>간단하게 페이지에 접근하면서 저장하는 방식으로 변경했습니다. 짧게 보이긴 하지만 그 알아내는 과정이 조금 고통스러웠어요. 코드를 잘 작성하는 것에 대해 더 고민을 해야되겠다고 생각했습니다.</p>
<h4 id="11쿠키에 저장하는 건 한계가 있다."><mark style="background:#BBFABBA6">쿠키에 저장하는 건 한계가 있다.</mark></h4>
<p>현재는 공고 카드의 id를 저장하고 있지만 기존에는 공고 데이터 자체를 쿠키에 넣는 식으로 사용했었습니다.</p>
<p>하지만 도중 객체가 3개 이상 저장되지 않는 문제가 있었고 쿠키 만능 주의로 개발하던 저는 쿠키의 데이터가 4MB까지 였다는 사실을 기억해내게 됩니다.</p>
<p><img src="/images/2024-07-21/Pasted%20image%2020240701225259.png" alt=""/></p>
<p>cookie size가 3327 정도가 객체 3개가 담겨있을 때였고 확인을 하니 단위는 Byte 즉 4096Byte 까지가 용량인 쿠키가 더 받아들일 수 없었던 것입니다.</p>
<h5 id="12해결 방법"><mark style="background:#ABF7F7A6">해결 방법</mark></h5>
<p>고민을 하다가 id를 저장해놓고 꺼내오는 쪽에서 해당 id를 활용하여 최신 데이터를 받아오는 로직으로 변경해서 문제를 해결하였습니다.</p>
<pre><code class="hljs language-tsx"><span class="hljs-comment">//...</span>
 notices.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> &amp;&amp;
        notices.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">map</span>(<span class="hljs-title function_">async</span> (notice, <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>) =&gt; {
          <span class="hljs-keyword">const</span> newCardContents = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchNotices</span>(notice);
<span class="hljs-comment">//...</span>
</code></pre>
<p>이제 id만 쿠키에 저장하기 때문에 통신에 들여지는 데이터 양을 줄일 수 있었고 필요한 데이터들을 알맞게 저장할 수 있었습니다.</p>
<p>전체 코드에서 볼 수 있었던 이 부분은 이 문제를 해결하기 위해 작성된 코드입니다.</p>
<h1 id="reference">reference</h1>
<p><a href="https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming">https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming</a></p>
<p><a href="https://nextjs.org/docs/app/api-reference/functions/cookies">https://nextjs.org/docs/app/api-reference/functions/cookies</a></p>
<p><a href="https://ko.javascript.info/cookie">https://ko.javascript.info/cookie</a></p>
<blockquote>
<p>급페이 프로젝트 중 고민했던 방식, 부딪히게 된 문제, 그것의 해결과정을 담은 글입니다!</p>
<p>잘못된 내용이 있다면 말씀 부탁드립니다. 감사합니다.</p>
</blockquote></section></section></section><!--$--><!--/$--><!--$--><!--/$--><section></section></div><!--/$--></div><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-arrow-up fixed bottom-5 right-5 h-8 w-8 opacity-50 hover:cursor-pointer hover:opacity-100"><circle cx="12" cy="12" r="10"></circle><path d="m16 12-4-4-4 4"></path><path d="M12 16V8"></path></svg><footer class="mt-6 border-t bg-background py-6"><div class="container mx-auto px-4"><div class="flex flex-col items-center justify-center gap-4"><div class="flex items-center justify-center gap-4"><div class="flex space-x-4"><a target="_blank" rel="noopener noreferrer" class="text-muted-foreground transition-colors hover:text-foreground" href="mailto:robot9917@gmail.com"><img alt="Email" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="transition-transform hover:scale-110" style="color:transparent" src="/icons/email.svg"/><span class="sr-only">GitHub</span></a></div><div class="flex space-x-4"><a target="_blank" rel="noopener noreferrer" class="text-muted-foreground transition-colors hover:text-foreground" href="https://github.com/codefug"><img alt="GitHub" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="transition-transform hover:scale-110" style="color:transparent" src="/icons/github.svg"/><span class="sr-only">GitHub</span></a></div></div><p class="text-sm text-muted-foreground">© <!-- -->2025<!-- --> CodeFug Blog</p></div></div></footer></main></div><script src="https://codefug.github.io/_next/static/chunks/webpack-cb9a9adc3ea1ef6e.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[9229,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"448\",\"static/chunks/448-33e6d0825603c686.js\",\"177\",\"static/chunks/app/layout-2ef854914d2ef86c.js\"],\"default\"]\n3:I[2943,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"448\",\"static/chunks/448-33e6d0825603c686.js\",\"177\",\"static/chunks/app/layout-2ef854914d2ef86c.js\"],\"SidebarProvider\"]\n4:I[6226,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"448\",\"static/chunks/448-33e6d0825603c686.js\",\"177\",\"static/chunks/app/layout-2ef854914d2ef86c.js\"],\"default\"]\n5:I[323,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"448\",\"static/chunks/448-33e6d0825603c686.js\",\"177\",\"static/chunks/app/layout-2ef854914d2ef86c.js\"],\"default\"]\n6:I[831,[],\"\"]\n7:I[8307,[],\"\"]\n8:I[70,[\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"345\",\"static/chunks/app/not-found-8b0af7c225bbe321.js\"],\"\"]\n9:I[8092,[\"507\",\"static/chunks/app/posts/%5Bid%5D/layout-6a37c5d18e0b4ffc.js\"],\"default\"]\nb:I[9757,[],\"MetadataBoundary\"]\nd:I[9757,[],\"OutletBoundary\"]\n10:I[8475,[],\"AsyncMetadataOutlet\"]\n12:I[4299,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-d9f0a2d13d9ca4de.js\"],\"Image\"]\n13:I[9757,[],\"ViewportBoundary\"]\n15:I[7882,[\"219\",\"static/chunks/app/global-error-e65e17ac78cfa06a.js\"],\"default\"]\n:HL[\"https://codefug.github.io/_next/static/media/518331124efecf5c-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"https://codefug.github.io/_next/static/css/c04e84a4e442b7aa.css\",\"style\"]\n:HL[\"https://codefug.github.io/_next/static/css/7b1838e6bdc2260c.css\",\"style\"]\n:HL[\"https://codefug.github.io/_next/st"])</script><script>self.__next_f.push([1,"atic/css/fc37ac2b1a278e8c.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"i2Z9BdVC54Rl_HuteXR1t\",\"p\":\"https://codefug.github.io\",\"c\":[\"\",\"posts\",\"2024-07-21\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"2024-07-21\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://codefug.github.io/_next/static/css/c04e84a4e442b7aa.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"https://codefug.github.io/_next/static/css/7b1838e6bdc2260c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__className_7ee20e antialiased\",\"children\":[\"$\",\"$L2\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$L3\",null,{\"defaultOpen\":false,\"children\":[[\"$\",\"$L4\",null,{\"totalFrontMatterList\":[{\"id\":\"2024-11-10\",\"title\":\"Asynchronous JavaScript\",\"excerpt\":\"microtask queue, macrotask queue, call stack, web api와 관련된 비동기 동작 방식, 비동기 관련 역사와 비동기 코드의 다양한 활용법들을 알아보자.\",\"date\":\"2024-11-10\",\"categories\":[\"javascript\"],\"header\":{\"teaser\":\"/images/logos/JS.svg\"}},{\"id\":\"2024-09-14-4\",\"title\":\"(꼼꼼 프로젝트) streaming 방식의 tanstack query\",\"excerpt\":\"infinite scroll, optimistic update 그리고 streaming 방식이 결합된 쿼리 처리 ( useSuspenseQuery, useSuspenseInfiniteQuery )\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/tanstackQuery.png\"}},{\"id\":\"2024-09-14-3\",\"title\":\"(꼼꼼 프로젝트) 클라이언트와 서버 둘다 호환되는 fetch 구현\",\"excerpt\":\"서버 액션을 활용한 refresh token rotation, 커링 함수를 이용한 리팩토링\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/fetch.png\"}},{\"id\":\"2024-09-14-2\",\"title\":\"(꼼꼼 프로젝트) startTransition, progress bar 구현에 대한 고민\",\"excerpt\":\"progress bar 로직 연구하기(startTransition), next-nprogress-bar\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/nprogress.png\"}},{\"id\":\"2024-09-14-1\",\"title\":\"(꼼꼼 프로젝트) toss slash 분석, zustand와 연결된 커스텀 overlay 훅 구현\",\"excerpt\":\"stacking context, compound pattern, 전역 상태를 활용한다는 것의 의미, 토스 개발자 실력 흡수하기\",\"date\":\"2024-09-14\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/toss.png\"}},{\"id\":\"2024-09-11\",\"title\":\"(꼼꼼 프로젝트) 공통 버튼 컴포넌트의 종류를 쉽게 관리하고 누구나 쉽게 확인할 수 있게 하는 방법\",\"excerpt\":\"tailwind로 조건부 처리를 간편하게 하는 방법, 비개발자도 스타일을 쉽게 확인할 수 있도록 storybook 연동\",\"date\":\"2024-09-11\",\"categories\":[\"kkom-kkom\"],\"header\":{\"teaser\":\"/images/logos/storybook.png\"}},{\"id\":\"2024-07-22-2\",\"title\":\"(급페이 프로젝트) 개발환경에만 집중하기 위한 여정\",\"excerpt\":\"접근 제한을 위한 미들웨어 처리, vercel CLI을 이용한 organization 무료 자동 배포, 프리뷰\",\"date\":\"2024-07-22\",\"categories\":[\"gheuppay\"],\"header\":{\"teaser\":\"/images/logos/vercel.png\"}},{\"id\":\"2024-07-22-1\",\"title\":\"(급페이 프로젝트) 알림창 무한 스크롤을 위한 여정 (mock fetching을 위한 MSW 도입기)\",\"excerpt\":\"msw를 활용해서 프론트엔드 개발이 다 되어있지 않은 상태에서도 무한 스크롤 구현을 확인할 수 있게 되었습니다.\",\"date\":\"2024-07-22\",\"categories\":[\"gheuppay\"],\"header\":{\"teaser\":\"/images/logos/msw.png\"}},{\"id\":\"2024-07-21\",\"title\":\"(급페이 프로젝트) 카드 렌더링을 최적화하여 UX를 향상시키기 위한 머나먼 여정\",\"excerpt\":\"server component 설계를 이용한 suspense 적극 활용, 이를 위해서 next cookie를 사용하면서 겪은 문제들을 적은 글입니다.\",\"date\":\"2024-07-21\",\"categories\":[\"gheuppay\"],\"header\":{\"teaser\":\"/images/logos/next-cookie.png\"}},{\"id\":\"2024-06-18\",\"title\":\"React Testing\",\"excerpt\":\"React Testing Library, Vitest, Jest\",\"date\":\"2024-06-18\",\"categories\":[\"reactdeepdive\"],\"header\":{\"teaser\":\"/images/logos/reactdeepdive.jpg\"}},{\"id\":\"2024-06-17\",\"title\":\"로그인 구현 (zustand, zod + react-hook-form, RTR)\",\"excerpt\":\"zustand를 이용한 로그인 상태 전역 관리, zod를 이용한 간단한 스키마 전개, react-hook-form을 이용한 간단한 validation, axios를 이용한 간단한 api 요청 처리\",\"date\":\"2024-06-17\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/zod.png\"}},{\"id\":\"2024-06-15\",\"title\":\"Dev tool\",\"excerpt\":\"리액트 과거, 현재, 미래\",\"date\":\"2024-06-15\",\"categories\":[\"web\"],\"header\":{\"teaser\":\"/images/logos/reactdeepdive.jpg\"}},{\"id\":\"2024-06-14\",\"title\":\"마이그레이션 중 발생한 Vite 환경 변수 처리\",\"excerpt\":\"Vite_ENV\",\"date\":\"2024-06-14\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/react.png\"}},{\"id\":\"2024-06-10\",\"title\":\"React Debugging\",\"excerpt\":\"react-dev-tools 정리, 실습\",\"date\":\"2024-06-10\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/react.png\"}},{\"id\":\"2024-06-08\",\"title\":\"자잘한 Next.js 트러블 슈팅들\",\"excerpt\":\"react-responsive를 사용하지 못하는 상황, dotenv 사용시 문제 발생\",\"date\":\"2024-06-08\",\"categories\":[\"nextjs\"],\"header\":{\"teaser\":\"/images/logos/Nextjs.png\"}},{\"id\":\"2024-05-31\",\"title\":\"Next는 왜 쓸까\",\"excerpt\":\"CSR SSG SSR\",\"date\":\"2024-05-31\",\"categories\":[\"nextjs\"],\"header\":{\"teaser\":\"/images/logos/Nextjs.png\"}},{\"id\":\"2024-05-23\",\"title\":\"리액트는 왜 쓸까\",\"excerpt\":\"리액트 과거, 현재, 미래\",\"date\":\"2024-05-23\",\"categories\":[\"react\"],\"header\":{\"teaser\":\"/images/logos/reactdeepdive.jpg\"}},{\"id\":\"2024-05-22\",\"title\":\"TS는 왜 쓸까 (위대한 TS)\",\"excerpt\":\"JS를 완벽하게 하기 위한 여정\",\"date\":\"2024-05-22\",\"categories\":[\"typescript\"],\"header\":{\"teaser\":\"/images/logos/TS.png\"}},{\"id\":\"2024-05-20\",\"title\":\"Fandom-k 프로젝트 회고3\",\"excerpt\":\"Github Actions, 최종 결과\",\"date\":\"2024-05-20\",\"categories\":[\"fandomk\"],\"header\":{\"teaser\":\"/images/logos/githubActions.png\"}},{\"id\":\"2024-05-19\",\"title\":\"Fandom-k 프로젝트 회고2\",\"excerpt\":\"fetch, scroll to Top, infinite scroll 라이브러리 제거\",\"date\":\"2024-05-19\",\"categories\":[\"fandomk\"],\"header\":{\"teaser\":\"/images/logos/fetch.png\"}},{\"id\":\"2024-05-18\",\"title\":\"Fandom-k 프로젝트 회고1\",\"excerpt\":\"팀 프로젝트 세팅, infinite scroll, skeleton\",\"date\":\"2024-05-18\",\"categories\":[\"fandomk\"],\"header\":{\"teaser\":\"/images/logos/infinite-scroll.png\"}}]}],[\"$\",\"$L5\",null,{\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h2\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":\"잘못된 페이지에요!\"}],[\"$\",\"$L8\",null,{\"href\":\"/\",\"children\":\"홈으로 돌아가기\"}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]}]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"2024-07-21\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://codefug.github.io/_next/static/css/fc37ac2b1a278e8c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"div\",null,{\"className\":\"prose mx-auto overflow-auto dark:prose-invert\",\"children\":[[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"$L9\",null,{}]]}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$La\",[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],null,[\"$\",\"$Ld\",null,{\"children\":[\"$Le\",\"$Lf\",[\"$\",\"$L10\",null,{\"promise\":\"$@11\"}]]}]]}],{},null,false]},null,false]},null,false]},[[\"$\",\"div\",\"l\",{\"className\":\"flex h-full items-center justify-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"scale-[1.15] animate-pulse transition-transform\",\"children\":[\"$\",\"$L12\",null,{\"src\":\"/images/main-logo.png\",\"alt\":\"로딩 중...\",\"width\":120,\"height\":120,\"className\":\"drop-shadow-lg\"}]}],[\"$\",\"p\",null,{\"className\":\"mt-6 animate-pulse text-lg font-bold text-gray-600\",\"children\":\"Codefug Blog\"}]]}]}],[],[]],false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"yDZLfzPF3hPk7LLop_e4O\",{\"children\":[[\"$\",\"$L13\",null,{\"children\":\"$L14\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$15\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"16:\"$Sreact.suspense\"\n17:I[8475,[],\"AsyncMetadata\"]\nc:[\"$\",\"$16\",null,{\"fallback\":null,\"children\":[\"$\",\"$L17\",null,{\"promise\":\"$@18\"}]}]\n"])</script><script>self.__next_f.push([1,"f:null\n"])</script><script>self.__next_f.push([1,"14:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\ne:null\n"])</script><script>self.__next_f.push([1,"18:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Codefug Blog\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"project experiences and development notes\"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"Codefug Blog\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"project experiences and development notes\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:url\",\"content\":\"https://codefug-blog.vercel.app\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:image\",\"content\":\"http://localhost:3000/images/main-logo.png\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:image:alt\",\"content\":\"Codefug Blog\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:title\",\"content\":\"Codefug Blog\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:description\",\"content\":\"project experiences and development notes\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:image\",\"content\":\"http://localhost:3000/images/main-logo.png\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:image:alt\",\"content\":\"Codefug Blog\"}],[\"$\",\"link\",\"13\",{\"rel\":\"icon\",\"href\":\"/icon.ico?f00882ffa3186f37\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]],\"error\":null,\"digest\":\"$undefined\"}\n11:{\"metadata\":\"$18:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"a:[\"$\",\"section\",null,{\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"relative mb-6 h-[300px] w-full overflow-hidden rounded-xl sm:h-[400px] md:h-[450px]\",\"children\":[[\"$\",\"$L12\",null,{\"src\":\"/images/logos/next-cookie.png\",\"alt\":\"(급페이 프로젝트) 카드 렌더링을 최적화하여 UX를 향상시키기 위한 머나먼 여정\",\"fill\":true,\"sizes\":\"(max-width: 768px) 100vw, 1200px\",\"priority\":true,\"className\":\"object-cover object-center transition-transform duration-500 hover:scale-105\"}],[\"$\",\"div\",null,{\"className\":\"absolute inset-0 bg-gradient-to-b from-transparent to-black/70\"}],[\"$\",\"div\",null,{\"className\":\"absolute left-4 top-4 flex flex-wrap gap-2 sm:left-6 sm:top-6\",\"children\":[[\"$\",\"div\",\"gheuppay\",{\"className\":\"inline-flex items-center rounded-md border px-2.5 py-0.5 transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-white/90 text-xs font-medium text-gray-800 hover:bg-white sm:text-sm\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-tag mr-1 h-3 w-3\",\"children\":[[\"$\",\"path\",\"vktsd0\",{\"d\":\"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z\"}],[\"$\",\"circle\",\"kqv944\",{\"cx\":\"7.5\",\"cy\":\"7.5\",\"r\":\".5\",\"fill\":\"currentColor\"}],\"$undefined\"]}],\" \",\"gheuppay\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mb-6 space-y-4\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-0 text-3xl font-bold tracking-tight text-gray-900 dark:text-gray-50 sm:text-4xl md:text-5xl\",\"children\":\"(급페이 프로젝트) 카드 렌더링을 최적화하여 UX를 향상시키기 위한 머나먼 여정\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center justify-end gap-4 text-sm text-gray-600 dark:text-gray-400\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar-days mr-2 h-4 w-4\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],[\"$\",\"path\",\"6423bh\",{\"d\":\"M8 14h.01\"}],[\"$\",\"path\",\"1etili\",{\"d\":\"M12 14h.01\"}],[\"$\",\"path\",\"1gbofw\",{\"d\":\"M16 14h.01\"}],[\"$\",\"path\",\"lrp35t\",{\"d\":\"M8 18h.01\"}],[\"$\",\"path\",\"mhygvu\",{\"d\":\"M12 18h.01\"}],[\"$\",\"path\",\"kzsmim\",{\"d\":\"M16 18h.01\"}],\"$undefined\"]}],[\"$\",\"time\",null,{\"dateTime\":\"2024-07-21\",\"children\":\"2024-07-21\"}]]}]}],[\"$\",\"p\",null,{\"className\":\"text-lg leading-relaxed text-gray-600 dark:text-gray-300 md:text-xl\",\"children\":\"server component 설계를 이용한 suspense 적극 활용, 이를 위해서 next cookie를 사용하면서 겪은 문제들을 적은 글입니다.\"}]]}],[\"$\",\"div\",null,{\"className\":\"border-b border-gray-200 dark:border-gray-800\"}]]}],[\"$\",\"section\",null,{\"className\":\"lg:flex lg:items-baseline\",\"children\":[\"$L19\",[\"$\",\"section\",null,{\"className\":\"max-w-full\",\"children\":[[\"$\",\"h1\",null,{\"id\":\"0설계\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FF5582A6\"},\"children\":\"설계\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-07-21/Pasted%20image%2020240722113132.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위의 시안을 분석해보고 Next.js 식으로 최대한 서버 컴포넌트를 이용하려면 다음과 같이 분기를 나눠서 생각해보면 다음과 같습니다.\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"위쪽의 메인이 되는 카드 : 초기 페이지 렌더링 시 서버에서 받아오고 suspense로 기다리는 시간 보완. (server component)\",\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"신청하기 버튼의 경우 로그인 상태에 따라서 여러가지 분기가 나뉘어지게 설계. (이벤트 핸들러가 들어가기 때문에 client component)\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"최근에 본 공고 파트 : 앞에서 데이터가 들어오면 뒤의 데이터는 없어져야 하니 \",[\"$\",\"code\",null,{\"children\":\"queue\"}],\" 자료구조로 설계 (server component)\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-07-21/Pasted%20image%2020240722120938.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"(red : server component, blue: client component)\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"1서버 컴포넌트 설계\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"서버 컴포넌트 설계\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"서버 컴포넌트를 설계하기 위해선 페이지 단위에서 일단 서버 컴포넌트여야 합니다. 최상단의 컴포넌트가 클라이언트 컴포넌트일 경우 서버 컴포넌트를 사용할 수 없게 되기 때문입니다.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"RCC (React Client Component) 는 서버 컴포넌트를 import할 수 없습니다. 서버 환경이 브라우저에 존재하지 않기 때문입니다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"서버 컴포넌트를 사용할 경우 Next.js 에서는 각각의 컴포넌트를 따로 loading할 수 있는 streaming 방식을 사용합니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-07-21/Pasted%20image%2020240722121441.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"컴포넌트 별로 분할해서 loading state를 처리하는 방법은 리액트의 \",[\"$\",\"code\",null,{\"children\":\"Suspense\"}],\"를 사용하는 것입니다. next에서 확장시킨 \",[\"$\",\"code\",null,{\"children\":\"Suspense\"}],\"로 서버 컴포넌트를 감싸면 서버 컴포넌트가 렌더링 되기 전까지 \",[\"$\",\"code\",null,{\"children\":\"fallback\"}],\" 안에 있는 컴포넌트가 해당 서버 컴포넌트를 대신합니다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-07-21/Pasted%20image%2020240722121816.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"TTFB : 첫 바이트까지의 시간\\nFCP : 최초 컨텐츠가 페인팅되기까지의 시간\\nTTI : 사용자가 인터렉션을 할 수 있게 되는 시간\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위 사진은 streaming 이전의 방식입니다. 모든 컴포넌트가 렌더링이 되야 페이지가 로딩되기 때문에 TTFB, FCP, TTI 가 순차적으로 보여질 수 밖에 없었습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"로딩 화면이 모두 끝나고 페이지에 진입할 수 있도록 강제하는 것은 UX적으로 안 좋을 수 밖에 없습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"예를 들어 네이버에 웹툰을 보러 들어갔는데 웹툰 페이지 진입 버튼 하나를 누르기 위해서 스포츠, 연예, 뉴스 모든 컨텐츠가 사용가능한 상태가 되기까지 기다리는 것은 페이지 성능이 좋아서 빨리 로딩되더라도 더 최적화할 여지가 있는 것입니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Next는 이를 streaming으로 해결했습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-07-21/Pasted%20image%2020240722121647.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"각각의 컴포넌트는 각각의 파트를 가집니다. 데이터를 받고 HTML을 렌더링하고 하이드레이션하는 과정들을 각각 가짐으로써 TTFB, FCP, TTI를 모두 당기게 되어 페이지 성능 최적화를 이끌게 됩니다.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"급페이 프로젝트에서는 이를 최대한 활용하며 개발을 나아갔습니다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"2Next Cookie를 이용한 설계\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"Next Cookie를 이용한 설계\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"React에서는 다음과 같이 통신이 진행됩니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-07-21/Pasted%20image%2020240722125032.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"프론트엔드 서버가 존재하는 Next.js에서는 간단하게 다음과 같이 통신이 진행됩니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-07-21/Pasted%20image%2020240722124750.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"브라우저 \u003e 프론트엔드 서버(node.js 환경) \u003e 백엔드 서버 식이죠. 위처럼 움직이기 때문에 SSR이나 SSG, ISG 등등이 가능하게 된 것입니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"서버 컴포넌트는 프론트엔드 \\\"서버\\\" 컴포넌트를 말하는데요. 데이터를 분할해서 브라우저로 보낼 수 있는 streaming이 가능한 이유도 이것 때문입니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-07-21/Pasted%20image%2020240722125217.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Suspense를 이용하면 위 사진처럼 fallback을 먼저 보내고 프론트엔드 서버에서 서버 컴포넌트 렌더링을 끝내면 브라우저에 컴포넌트를 보내고 fallback을 치우는 식이죠.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이번 작업에서 최근 본 공고에 이를 활용하고자 했는데요. 문제는 서버 컴포넌트 렌더링을 끝내고 Suspense를 받기 위해서는 서버 컴포넌트 내부의 것들이 서버 관련이어야 한다는 것입니다.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"서버 컴포넌트 : 클라이언트 관련된 것들을 사용할 수 없습니다. Web API, document, web storage 등등에 접근할 수 없고 상태,훅등을 사용할 수 없습니다. 대신 db, 내부 서비스, 파일 시스템 등 서버에만 있는 데이터는 async, await으로 접근할 수 있습니다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"로컬 스토리지나 세션 스토리지 같은 web storage를 사용해서 최근 본 공고를 구현할 수는 있었으나 web storage라서 서버 컴포넌트 안에서는 쓸 수 없었고 그럼 Suspense를 활용할 수 없게 됩니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이를 위해 찾게 된 것이 Next Cookie였습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"기존 React에서는 쿠키를 document.cookie를 이용해서 접근이 가능했습니다. (httpOnly가 아닐 경우에만) (\",[\"$\",\"a\",null,{\"href\":\"https://ko.javascript.info/cookie\",\"children\":\"https://ko.javascript.info/cookie\"}],\")\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"쿠키는 통신에 담기기 때문에 다음의 사진대로 움직이게 되죠\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-07-21/Pasted%20image%2020240722125032.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Next 에서의 쿠키 조작은 프론트엔드 서버에서 가능합니다. \",[\"$\",\"a\",null,{\"href\":\"https://nextjs.org/docs/app/api-reference/functions/cookies\",\"children\":\"https://nextjs.org/docs/app/api-reference/functions/cookies\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-07-21/Pasted%20image%2020240722130714.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"브라우저와 백엔드 서버 사이에서 쿠키를 CRUD할 수 있고 이는 프론트엔드 서버에서 실행되기에 서버 컴포넌트 안에서도 사용가능한 것이었습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이를 기반으로 함수를 만들어주고 분기를 나누게 되었습니다.\\n\",[\"$\",\"a\",null,{\"href\":\"https://nextjs.org/docs/app/api-reference/functions/cookies\",\"children\":\"https://nextjs.org/docs/app/api-reference/functions/cookies\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Suspense 사용을 위한 서버 컴포넌트 설계를 위해 쿠키를 활용했다 라는 것을 알아두고 자세한 이야기는 최근 본 공고 설계 부분에서 다루도록 하겠습니다.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"3Next Cookie까지 오게된 과정 (고민들)\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"Next Cookie까지 오게된 과정 (고민들)\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"사실 처음에는 로그인 상태나 최근 본 공고는 전역 상태 관리로 처리하려고 했습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"전역 상태라는 것은 해당 route에서 고정됩니다. route change가 일어나면 저장이 되지 않습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"zustand에서 persist라는 미들웨어가 존재해서 route change에서도 로컬 스토리지를 활용해 데이터를 저장해 놓았기 때문인데요.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이를 사용하기 위한 많은 시행 착오가 있었습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"정말 수많은 레퍼런스도 찾아보았고 클라이언트와 서버 둘다 실행되는 zustand를 Next에서 사용하기 위해서 hydrate를 진행하지 않다가 rehydrate를 클라이언트 단에서 하는 등의 방식도 찾게 되었습니다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-tsx\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"use client\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" useUserStore \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"@/stores/create-store\\\"\"}],\";\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { useEffect } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"react\\\"\"}],\";\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// mount 시 rehydrate를 실행합니다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"Hydration\"}],\" = (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") =\u003e {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"useEffect\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n    useUserStore.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"persist\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"rehydrate\"}],\"();\\n  }, []);\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"null\"}],\";\\n};\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"default\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Hydration\"}],\";\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"소위 온몸 비틀기를 사용한 것인데요.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"전역 \\\"상태\\\" 에 집중해보았습니다. zustand 개발자분은 깃허브 이슈에서 서버에는 \\\"상태\\\"가 존재하지 않다는 사실을 알면 이해가 편할꺼라고 이야기를 자주했습니다. 거기에 팀원이 사실 로컬 스토리지가 있는데 전역 상태와의 차이가 없는 것 같다고 말씀 해주셨습니다. 더구나 주스탄드 역시 rehydrate를 클라이언트 단에서 사용하고 로컬 스토리지를 활용하기 때문에 클라이언트 컴포넌트에서밖에 사용할 수 없었죠.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"저도 선뜻 대답할 수 없었고 \\\"상태\\\"라는 것에 집중해보았습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"지금 저장하고 있는 상태가 한 라우트에서 렌더링의 변화가 이루어져야 하는 것인가? 아니면 전역 데이터로써 한번 가져오고 바꿀 수만 있으면 되는 것인가 에 집중해보았습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"브라우저에서 관리되어야할 데이터는 \\\"상태\\\" 보단 \\\"공고에 대한 정보, 로그인 여부 같은 단순 데이터\\\" 라는 사실을 알게 되었고 zustand는 급페이 프로젝트에서 삭제하게 되고 이 과정 속에서 서버에서도 활용이 가능한 Next cookie를 만나게 됩니다.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"이 문제들을 해결하는 과정에서 기술은 어디까지나 도구 라는 생각을 강하게 갖게 되었습니다. 전역 상태 관리 라는 것의 의미를 많이 고민하고 설계를 진행했더라면 zustand라는 도구를 사용하지 않았을 것입니다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"4페이지 구현\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FF5582A6\"},\"children\":\"페이지 구현\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이제 구현에 대해서 본격적으로 코드와 함께 찾아보겠습니다. 코드를 작성한 이유와 그와 관련된 트러블 이슈를 이야기해보겠습니다.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"5전체 페이지 구조 설계\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"전체 페이지 구조 설계\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-tsx\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"default\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"page\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"{ params }: \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"PageProps\"}]]}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" (\\n    \",[\"$\",\"span\",null,{\"className\":\"xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"div\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"className\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"base-container\\\"\"}],\"\u003e\"]}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"Suspense\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"fallback\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{\"}],\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"NoticeDetailCardSkeleton\"}],\" /\u003e\"]}],\"}\u003e\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"NoticeDetailCard\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"shopId\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{params.shop_id}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"noticeId\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{params.notice_id}\"}],\" /\u003e\"]}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"Suspense\"}],\"\u003e\"]}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"div\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"className\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"my-12\\\"\"}],\"\u003e\"]}],\"\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"h2\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"className\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"text-l py-8 font-bold md:text-2xl\\\"\"}],\"\u003e\"]}],\"최근에 본 공고\",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"h2\"}],\"\u003e\"]}],\"\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"div\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"className\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"grid grid-cols-2 gap-4 lg:grid-cols-3\\\"\"}],\"\u003e\"]}],\"\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"Suspense\"}],\"\\n            \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"fallback\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{[1,\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"2\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"3\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"4\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"5\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"6\"}],\"]\",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\".map\"}],\"((\",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"value\"}],\") =\u003e\"]}],\" (\\n              \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"NoticeCardSkeleton\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"key\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{value}\"}],\" /\u003e\"]}],\"\\n            ))}\\n          \u003e\\n            \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"RecentNotices\"}],\"\\n              \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"shopId\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{params.shop_id}\"}],\"\\n              \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"noticeId\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{params.notice_id}\"}],\"\\n            /\u003e\"]}],\"\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"Suspense\"}],\"\u003e\"]}],\"\\n        \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"div\"}],\"\u003e\"]}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"div\"}],\"\u003e\"]}],\"\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"div\"}],\"\u003e\"]}]]}],\"\\n  );\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"페이지 전체 구조입니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"메인 카드와 최근 본 공고의 스켈레톤을 제작하고 이를 Suspense의 fallback으로 만듬으로써 서버 컴포넌트들이 렌더링 되기 전에 스켈레톤을 볼 수 있도록 하였습니다. ui 컴포넌트에 가까우니 빠르게 넘어가겠습니다.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"6메인 카드 설계\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"메인 카드 설계\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-tsx\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"default\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"NoticeDetailCard\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"{\\n  shopId,\\n  noticeId,\\n}: \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NoticeDetailCardProps\"}]]}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" noticeDetail = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getShopNoticeDetail\"}],\"(shopId, noticeId);\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"type\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getCookie\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"type\\\"\"}],\");\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" address = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getCookie\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"address\\\"\"}],\");\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" userId = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getCookie\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"userId\\\"\"}],\");\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" hourlyWage = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"calculateWagePercentage\"}],\"(noticeDetail.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"hourlyPay\"}],\");\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" date = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"dateFormat\"}],\"(noticeDetail.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"startsAt\"}],\");\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"isLater\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"boolean\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"compareWorkingDateDiffFromNow\"}],\"(\\n    noticeDetail.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"startsAt\"}],\",\\n    noticeDetail.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"workhour\"}],\",\\n  );\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" userApplication =\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"typeof\"}],\" userId === \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"string\\\"\"}],\" \u0026\u0026 \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"type\"}],\" === \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"employee\\\"\"}],\"\\n      ? \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getUsersUserIdApplications\"}],\"(userId)\\n      : \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"null\"}],\";\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"//...\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"shopId와 noticeId를 param에서 꺼내며 사용되는 NoticeDetailCard 입니다. 쿠키를 활용해서 사용자의 정보를 받아 올 수 있으며 이를 통해 렌더링을 진행했습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이 정보를 통해서 서버 컴포넌트를 만들 때부터 신청하기 버튼의 분기 처리가 가능합니다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-tsx\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"use client\\\"\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"//...\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"default\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"RegisterButton\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"{\\n  address,\\n  userApplication,\\n  shopId,\\n  noticeId,\\n}: \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"RegisterButtonProps\"}]]}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (userApplication === \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"null\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" (\\n      \",[\"$\",\"span\",null,{\"className\":\"xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"LinkButton\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"className\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"href\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{\"}],\"\\\"/\",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"login\"}],\"\\\"}\u003e\"]}],\"\\n        신청하기\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"LinkButton\"}],\"\u003e\"]}]]}],\"\\n    );\\n  }\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" isRegister = userApplication.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"items\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"some\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"obj\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" (\\n      obj.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"notice\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"id\"}],\" === noticeId \u0026\u0026 obj.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"status\"}],\" === \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"pending\\\"\"}],\"\\n    );\\n  });\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" isRejected = userApplication.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"items\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"some\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"obj\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" (\\n      obj.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"notice\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"id\"}],\" === noticeId \u0026\u0026 obj.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"status\"}],\" === \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"rejected\\\"\"}],\"\\n    );\\n  });\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"//...\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위처럼 쿠키가 활용된 데이터를 props으로 내려줌으로써 클라이언트 컴포넌트인 신청하기 버튼이 모달 기능, Link 등등 다양한 기능 확장을 가질 수 있게 되었습니다.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"7최근 본 공고 설계\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFB86CA6\"},\"children\":\"최근 본 공고 설계\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이번 글 쓰기의 목적이자 제일 공을 많이 들였던 파트입니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"우선 공고를 저장하는 로직은 \",[\"$\",\"code\",null,{\"children\":\"큐\"}],\" 자료구조여야 합니다. 저장하는 함수에서 이를 갖고 있다면 사용하는 사람은 인수를 보내기만 하면 되겠죠. cookie와 관련되어 있기에 구체적인 구현은 숨기고 드러나는 부분은 함수 하나로 클린하게 만들기 위해 노력했습니다.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-tsx\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"use server\\\"\"}],\";\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"//...\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// notice를 가져옵니다.\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" getNotices = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"async\"}],\" (): \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NoticeIds\"}],\"[]\u003e =\u003e {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"currentNotice\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NoticeIds\"}],\"[] = \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"JSON\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"parse\"}],\"(\\n    (\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getCookie\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"notices\\\"\"}],\")) || \",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"[]\\\"\"}],\",\\n  );\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" currentNotice;\\n};\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// notice를 파싱해주는 내부 함수\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" setNotices = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"async\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"noticesIdList\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NoticeIds\"}],\"[]): \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"void\"}],\"\u003e =\u003e {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"setCookie\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"notices\\\"\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"JSON\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"stringify\"}],\"(noticesIdList));\\n};\\n\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// notice를 큐 자료구조를 활용하여 저장하는 로직\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"postNotice\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"notice\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"GetNotices\"}],\"[\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"items\\\"\"}],\"][\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\"][\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"\\\"item\\\"\"}],\"],\\n\"]}],\"): \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"void\"}],\"\u003e {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"currentNotice\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NoticeIds\"}],\"[] = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getNotices\"}],\"();\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" newNoticeId = { \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"id\"}],\": notice.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"id\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"shopId\"}],\": notice.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"shop\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\".\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"id\"}],\" };\\n\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// 중복 확인\"}],\"\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" isDuplicated = currentNotice.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"some\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"n\"}],\") =\u003e\"]}],\" n.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"id\"}],\" === notice.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"id\"}],\");\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (isDuplicated) {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"setNotices\"}],\"([\\n      newNoticeId,\\n      ...currentNotice.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"filter\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":\"n\"}],\") =\u003e\"]}],\" n.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"id\"}],\" !== notice.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"id\"}],\"),\\n    ]);\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (currentNotice.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"length\"}],\" \u003e= \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"7\"}],\") {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"setNotices\"}],\"([newNoticeId, ...currentNotice.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"slice\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"0\"}],\", \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"6\"}],\")]);\\n  } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"setNotices\"}],\"([newNoticeId, ...currentNotice]);\\n  }\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"데이터를 저장하는 로직을 위처럼 구성해놓아 notice를 가져올 때는 getNotices() 저장할때는 postNotice(데이터) 형식으로 단순화시켰습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"자동으로 중복처리, 데이터 관리를 해주기에 추후 작업이 빨라지게 되었습니다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-tsx\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"default\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"RecentNotices\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"{\\n  shopId,\\n  noticeId,\\n}: \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"ReCentNoticesProps\"}]]}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" notices = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getNotices\"}],\"();\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" (\\n    \",[\"$\",\"span\",null,{\"className\":\"xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":\"\u003c\u003e\"}],\"\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"PostNoticesEffect\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"shopId\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{shopId}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"noticeId\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{noticeId}\"}],\" /\u003e\"]}],\"\\n      {notices \u0026\u0026\\n        notices.length \u003e 1 \u0026\u0026\\n        notices.map(async (notice) =\u003e {\\n          if (notice.id === noticeId) return null; // early return\\n          const cardContents = await fetchNotices(notice);\\n          return (\\n            \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"LinkButton\"}],\"\\n              \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"noticeId\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{cardContents.id}\"}],\"\\n              \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"shopId\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{cardContents.shop.item.id}\"}],\"\\n              \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"key\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{cardContents.id}\"}],\"\\n            \u003e\"]}],\"\\n              \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"NoticeCard\"}],\"\\n                \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"address1\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{cardContents.shop.item.address1}\"}],\"\\n                \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"closed\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{cardContents.closed}\"}],\"\\n                \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"hourlyPay\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{cardContents.hourlyPay}\"}],\"\\n                \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"noticeId\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{cardContents.id}\"}],\"\\n                \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"imageUrl\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{cardContents.shop.item.imageUrl}\"}],\"\\n                \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"name\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{cardContents.shop.item.name}\"}],\"\\n                \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"startsAt\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{cardContents.startsAt}\"}],\"\\n                \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"workhour\"}],\"=\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":\"{cardContents.workhour}\"}],\"\\n              /\u003e\"]}],\"\\n            \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",null,{\"className\":\"hljs-name\",\"children\":\"LinkButton\"}],\"\u003e\"]}],\"\\n          );\\n        })}\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":\"\u003c/\u003e\"}]]}],\"\\n  );\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"보시면 PostNoticeEffect 라는 부분이 있는데요. 이는 UseEffect로 데이터를 저장해주기 위함입니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이렇게 사용하는 이유는 다음의 과정으로 렌더링이 진행되기 때문입니다.\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"페이지에 진입한다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"최근 본 공고가 렌더링된다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"진입이 되었기에 쿠키에서 현재 보는 공고도 추가시킨다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"쿠키 변경으로 인해서 최근 본 공고가 리렌더링 (변경 된다.)\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이는 서버 컴포넌트 렌더링 이후에 한번 더 데이터가 바뀌는 모습을 보여주게 되었고 이를 문제로 여겼습니다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-tsx\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"PostNoticesEffect\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"{\\n  shopId,\\n  noticeId,\\n}: {\\n  shopId: \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"string\"}],\";\\n  noticeId: \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"string\"}],\";\\n}\"]}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"useEffect\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetchData\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") =\u003e {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" data = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"getShopNoticeDetail\"}],\"(shopId, noticeId);\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"postNotice\"}],\"(data.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"item\"}],\");\\n    };\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetchData\"}],\"();\\n  }, []);\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":\"\u003c\u003e\"}],[\"$\",\"span\",null,{\"className\":\"hljs-tag\",\"children\":\"\u003c/\u003e\"}]]}],\";\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"위의 코드를 삽입해서 클라이언트 렌더링 시에 postNotice를 실행시켜서 데이터를 쿠키에 담게 하였고 쿠키가 바뀌게 되면서 발생하는 리렌더링 시\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-tsx\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (notice.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"id\"}],\" === noticeId) \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-literal\",\"children\":\"null\"}],\"; \",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"// early return\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"early return으로 현재 보는 공고는 차단하여 사용자는 렌더링된 것을 느끼지 못하게 하였습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이로써 서버 컴포넌트이기에 굉장히 빠르게 렌더링 되면서 suspense로 인한 스켈레톤 표현까지 할 수 있게 되었습니다.\"}],\"\\n\",[\"$\",\"div\",null,{\"children\":[\"$\",\"iframe\",null,{\"title\":\"vimeo-988246692\",\"src\":\"https://player.vimeo.com/video/988246692\",\"width\":\"640\",\"height\":\"360\",\"allow\":\"autoplay; fullscreen\",\"allowFullScreen\":true}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"8트러블 슈팅\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#FFF3A3A6\"},\"children\":\"트러블 슈팅\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"9핸들러에 비동기 함수를 넣어선 안된다.\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"핸들러에 비동기 함수를 넣어선 안된다.\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"공고 카드를 광클하면 멈추는 오류를 발견했습니다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-tsx\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"//...\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"default\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"NoticeCard\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-params\",\"children\":[\"{\\n  hourlyPay,\\n  startsAt,\\n  workhour,\\n  noticeId,\\n  shopId,\\n  imageUrl,\\n  name,\\n  address1,\\n  content,\\n  closed,\\n}: \",[\"$\",\"span\",null,{\"className\":\"hljs-title class_\",\"children\":\"NoticeCardProps\"}]]}],\") {\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" hourlyWage = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"calculateWagePercentage\"}],\"(hourlyPay);\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" date = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"dateFormat\"}],\"(startsAt);\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"isLater\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"boolean\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"compareWorkingDateDiffFromNow\"}],\"(startsAt, workhour);\\n  \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"handleClick\"}],\" = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" (\",[\"$\",\"span\",null,{\"className\":\"hljs-params\"}],\") =\u003e {\\n    \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (content) {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"postNoticeAction\"}],\"(content);\\n    } \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"else\"}],\" {\\n      \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"redirectAction\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-string\",\"children\":[\"`/admin/notice-detail/\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${shopId}\"}],\"/\",[\"$\",\"span\",null,{\"className\":\"hljs-subst\",\"children\":\"$${noticeId}\"}],\"`\"]}],\");\\n    }\\n  };\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"//...\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"content로 분기처리를 해서 이벤트를 전달하는데 여기서 문제가 발생한 줄 알았으나\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"현재 post의 경우 cookie로 관리되고 있는데 이 cookie를 set하는 함수가 버튼의 이벤트 핸들러에 있어서 setter함수를 비동기적으로 계속 누르면\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"서버에 과부하가 걸려서 페이지가 멈추게 되었던 것입니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이벤트 핸들러 광클 \u003e cookie를 저장하는 비동기 함수 계속 실행 \u003e 특정 시점에 content가 없어지는 현상 \u003e redirectAction() 함수로 인해 middleware에서 처리(content가 없으면 사장님 페이지로 이동되지만 사장님이 아니기에 list page로 강제 이동)\"}],\"\\n\",[\"$\",\"h5\",null,{\"id\":\"10해결 방법\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#ABF7F7A6\"},\"children\":\"해결 방법\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"간단하게 페이지에 접근하면서 저장하는 방식으로 변경했습니다. 짧게 보이긴 하지만 그 알아내는 과정이 조금 고통스러웠어요. 코드를 잘 작성하는 것에 대해 더 고민을 해야되겠다고 생각했습니다.\"}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"11쿠키에 저장하는 건 한계가 있다.\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#BBFABBA6\"},\"children\":\"쿠키에 저장하는 건 한계가 있다.\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"현재는 공고 카드의 id를 저장하고 있지만 기존에는 공고 데이터 자체를 쿠키에 넣는 식으로 사용했었습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"하지만 도중 객체가 3개 이상 저장되지 않는 문제가 있었고 쿠키 만능 주의로 개발하던 저는 쿠키의 데이터가 4MB까지 였다는 사실을 기억해내게 됩니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/2024-07-21/Pasted%20image%2020240701225259.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"cookie size가 3327 정도가 객체 3개가 담겨있을 때였고 확인을 하니 단위는 Byte 즉 4096Byte 까지가 용량인 쿠키가 더 받아들일 수 없었던 것입니다.\"}],\"\\n\",[\"$\",\"h5\",null,{\"id\":\"12해결 방법\",\"children\":[\"$\",\"mark\",null,{\"style\":{\"background\":\"#ABF7F7A6\"},\"children\":\"해결 방법\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"고민을 하다가 id를 저장해놓고 꺼내오는 쪽에서 해당 id를 활용하여 최신 데이터를 받아오는 로직으로 변경해서 문제를 해결하였습니다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"hljs language-tsx\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"//...\"}],\"\\n notices.\",[\"$\",\"span\",null,{\"className\":\"hljs-property\",\"children\":\"length\"}],\" \u003e \",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\" \u0026\u0026\\n        notices.\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"slice\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-number\",\"children\":\"1\"}],\").\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"map\"}],\"(\",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"async\"}],\" (notice, \",[\"$\",\"span\",null,{\"className\":\"hljs-attr\",\"children\":\"index\"}],\": \",[\"$\",\"span\",null,{\"className\":\"hljs-built_in\",\"children\":\"number\"}],\") =\u003e {\\n          \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" newCardContents = \",[\"$\",\"span\",null,{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",null,{\"className\":\"hljs-title function_\",\"children\":\"fetchNotices\"}],\"(notice);\\n\",[\"$\",\"span\",null,{\"className\":\"hljs-comment\",\"children\":\"//...\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이제 id만 쿠키에 저장하기 때문에 통신에 들여지는 데이터 양을 줄일 수 있었고 필요한 데이터들을 알맞게 저장할 수 있었습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"전체 코드에서 볼 수 있었던 이 부분은 이 문제를 해결하기 위해 작성된 코드입니다.\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"reference\",\"children\":\"reference\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming\",\"children\":\"https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://nextjs.org/docs/app/api-reference/functions/cookies\",\"children\":\"https://nextjs.org/docs/app/api-reference/functions/cookies\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://ko.javascript.info/cookie\",\"children\":\"https://ko.javascript.info/cookie\"}]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"급페이 프로젝트 중 고민했던 방식, 부딪히게 된 문제, 그것의 해결과정을 담은 글입니다!\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"잘못된 내용이 있다면 말씀 부탁드립니다. 감사합니다.\"}],\"\\n\"]}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1a:I[9114,[\"299\",\"static/chunks/299-20a67a2580c87e66.js\",\"635\",\"static/chunks/635-8456b2984470c35f.js\",\"70\",\"static/chunks/70-d82343500dd0d9ac.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-d9f0a2d13d9ca4de.js\"],\"default\"]\n19:[\"$\",\"$L1a\",null,{\"headings\":[{\"text\":\"설계\",\"level\":1,\"id\":\"0설계\"},{\"text\":\"서버 컴포넌트 설계\",\"level\":2,\"id\":\"1서버 컴포넌트 설계\"},{\"text\":\"Next Cookie를 이용한 설계\",\"level\":2,\"id\":\"2Next Cookie를 이용한 설계\"},{\"text\":\"Next Cookie까지 오게된 과정 (고민들)\",\"level\":3,\"id\":\"3Next Cookie까지 오게된 과정 (고민들)\"},{\"text\":\"페이지 구현\",\"level\":1,\"id\":\"4페이지 구현\"},{\"text\":\"전체 페이지 구조 설계\",\"level\":2,\"id\":\"5전체 페이지 구조 설계\"},{\"text\":\"메인 카드 설계\",\"level\":2,\"id\":\"6메인 카드 설계\"},{\"text\":\"최근 본 공고 설계\",\"level\":2,\"id\":\"7최근 본 공고 설계\"},{\"text\":\"트러블 슈팅\",\"level\":3,\"id\":\"8트러블 슈팅\"},{\"text\":\"핸들러에 비동기 함수를 넣어선 안된다.\",\"level\":4,\"id\":\"9핸들러에 비동기 함수를 넣어선 안된다.\"},{\"text\":\"해결 방법\",\"level\":5,\"id\":\"10해결 방법\"},{\"text\":\"쿠키에 저장하는 건 한계가 있다.\",\"level\":4,\"id\":\"11쿠키에 저장하는 건 한계가 있다.\"},{\"text\":\"해결 방법\",\"level\":5,\"id\":\"12해결 방법\"},{\"text\":\"reference\",\"level\":1,\"id\":\"13reference\"}]}]\n"])</script></body></html>