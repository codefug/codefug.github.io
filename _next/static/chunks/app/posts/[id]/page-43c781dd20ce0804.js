(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[880],{34:(s,e,n)=>{"use strict";n.d(e,{default:()=>m});var a=n(9700),l=n(5661);let c=(0,n(7800).A)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var r=n(7471),i=n(3144),t=n.n(i),h=n(2557),j=n(5323),d=n(1464),o=n(1946);let p=(0,l.F)("block py-1.5 text-sm transition-all duration-200 ease-in-out border-l-2 hover:border-primary/70 no-underline",{variants:{isActive:{true:"border-primary font-medium text-primary opacity-100 dark:text-white text-foreground/90",false:"border-transparent text-muted-foreground hover:text-foreground/90"},level:{1:"pl-4",2:"pl-8",3:"pl-12",4:"pl-16",5:"pl-20",6:"pl-24"}},defaultVariants:{isActive:!1,level:1}});function m(){let s=(0,d.useRef)(null),[e,n]=(0,d.useState)(!1),l=(0,h.usePathname)(),i=(0,j.c)("common"),m=function(){let[s,e]=(0,d.useState)([]);return(0,d.useEffect)(()=>{var s;e(Array.from((null==(s=document.querySelector(".prose"))?void 0:s.querySelectorAll("h1, h2, h3, h4, h5, h6"))||[]).splice(1).map(s=>{let e=parseInt(s.tagName[1],10);return{text:s.textContent||"",level:e,id:s.id||"-1"}}))},[]),s}(),{activeId:x}=(()=>{let[s,e]=(0,d.useState)(null);return(0,d.useEffect)(()=>{let s=Array.from(document.querySelectorAll("h1, h2, h3, h4, h5, h6")),n=()=>{let n=Math.ceil(window.scrollY);for(let a=s.length-1;a>=0;a-=1){let l=s[a];if(n>=l.offsetTop){e(l.id);break}}};return window.addEventListener("scroll",n,{passive:!0}),n(),()=>{window.removeEventListener("scroll",n)}},[]),{activeId:s}})(),N=(0,d.useCallback)(()=>{n(!0)},[]),u=(0,d.useCallback)(()=>{n(!1)},[]);return((0,d.useEffect)(()=>{let e=e=>{!s.current||s.current.contains(e.target)||u(e)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[s,u]),m.length)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"fixed top-1/2 right-0",onClick:N,"aria-label":i("aria.tableOfContents.open"),"aria-expanded":e,"aria-controls":"table-of-contents",children:(0,a.jsx)(c,{className:"h-6 w-6 text-muted-foreground lg:size-8"})}),(0,a.jsx)("div",{ref:s,className:(0,o.cn)("fixed top-[68px] right-0 hidden w-[300px]",e&&"block"),children:(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-4 shadow-sm",children:[(0,a.jsx)("button",{onClick:u,"aria-label":i("aria.tableOfContents.close"),className:"absolute top-4 right-4",children:(0,a.jsx)(r.A,{className:"h-5 w-5 cursor-pointer text-muted-foreground"})}),(0,a.jsx)("h4",{className:"mt-0 mb-3 font-medium text-foreground text-sm",children:i("tableOfContents")}),(0,a.jsx)("nav",{className:"h-[calc(100vh-164px)] space-y-0.5 overflow-auto pr-2","aria-label":i("aria.tableOfContents.navigation"),id:"table-of-contents",children:m.map(s=>(0,a.jsx)(t(),{href:"".concat(l,"#").concat(s.id),className:p({level:s.level,isActive:x===s.id}),"aria-current":x===s.id?"page":void 0,children:s.text},s.id))})]})})]}):null}},1946:(s,e,n)=>{"use strict";n.d(e,{cn:()=>c});var a=n(5797);let l=(0,n(9744).zu)({extend:{classGroups:{"bg-color":["bg-quote-blue","bg-quote-green","bg-quote-yellow","bg-quote-orange","bg-quote-red","bg-quote-purple","bg-quote-gray","bg-quote-sky-blue"]}}});function c(){for(var s=arguments.length,e=Array(s),n=0;n<s;n++)e[n]=arguments[n];return l((0,a.$)(e))}},2557:(s,e,n)=>{"use strict";var a=n(7993);n.o(a,"usePathname")&&n.d(e,{usePathname:function(){return a.usePathname}})},2821:(s,e,n)=>{"use strict";n.d(e,{PostContent:()=>ng});var a={};n.r(a),n.d(a,{default:()=>sM});var l={};n.r(l),n.d(l,{default:()=>sO});var c={};n.r(c),n.d(c,{default:()=>sD});var r={};n.r(r),n.d(r,{default:()=>sF});var i={};n.r(i),n.d(i,{default:()=>sz});var t={};n.r(t),n.d(t,{default:()=>sW});var h={};n.r(h),n.d(h,{default:()=>sJ});var j={};n.r(j),n.d(j,{default:()=>sQ});var d={};n.r(d),n.d(d,{default:()=>sY});var o={};n.r(o),n.d(o,{default:()=>sX});var p={};n.r(p),n.d(p,{default:()=>s0});var m={};n.r(m),n.d(m,{default:()=>s1});var x={};n.r(x),n.d(x,{default:()=>s5});var N={};n.r(N),n.d(N,{default:()=>s6});var u={};n.r(u),n.d(u,{default:()=>s9});var g={};n.r(g),n.d(g,{default:()=>ee});var f={};n.r(f),n.d(f,{default:()=>ea});var y={};n.r(y),n.d(y,{default:()=>ec});var w={};n.r(w),n.d(w,{default:()=>ei});var k={};n.r(k),n.d(k,{default:()=>eh});var b={};n.r(b),n.d(b,{default:()=>ed});var _={};n.r(_),n.d(_,{default:()=>ep});var v={};n.r(v),n.d(v,{default:()=>ex});var P={};n.r(P),n.d(P,{default:()=>eu});var T={};n.r(T),n.d(T,{default:()=>ef});var S={};n.r(S),n.d(S,{default:()=>ew});var I={};n.r(I),n.d(I,{default:()=>e_});var C={};n.r(C),n.d(C,{default:()=>eP});var A={};n.r(A),n.d(A,{default:()=>eS});var R={};n.r(R),n.d(R,{default:()=>eC});var E={};n.r(E),n.d(E,{default:()=>eR});var M={};n.r(M),n.d(M,{default:()=>eM});var q={};n.r(q),n.d(q,{default:()=>eO});var O={};n.r(O),n.d(O,{default:()=>eD});var L={};n.r(L),n.d(L,{default:()=>eF});var D={};n.r(D),n.d(D,{default:()=>ez});var B={};n.r(B),n.d(B,{default:()=>eW});var F={};n.r(F),n.d(F,{default:()=>eJ});var U={};n.r(U),n.d(U,{default:()=>eQ});var z={};n.r(z),n.d(z,{default:()=>eY});var H={};n.r(H),n.d(H,{default:()=>eX});var W={};n.r(W),n.d(W,{default:()=>e0});var V={};n.r(V),n.d(V,{default:()=>e1});var J={};n.r(J),n.d(J,{default:()=>e5});var G={};n.r(G),n.d(G,{default:()=>e6});var Q={};n.r(Q),n.d(Q,{default:()=>e8});var $={};n.r($),n.d($,{default:()=>ns});var Y={};n.r(Y),n.d(Y,{default:()=>nn});var K={};n.r(K),n.d(K,{default:()=>nl});var X={};n.r(X),n.d(X,{default:()=>nr});var Z={};n.r(Z),n.d(Z,{default:()=>nt});var ss={};n.r(ss),n.d(ss,{default:()=>nj});var se={};n.r(se),n.d(se,{default:()=>no});var sn={};n.r(sn),n.d(sn,{default:()=>nm});var sa=n(9700),sl=n(6087),sc=n(1464),sr=n(7800);let si=(0,sr.A)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),st=(0,sr.A)("NotepadText",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"16",height:"18",x:"4",y:"4",rx:"2",key:"1u9h20"}],["path",{d:"M8 10h6",key:"3oa6kw"}],["path",{d:"M8 14h8",key:"1fgep2"}],["path",{d:"M8 18h5",key:"17enja"}]]),sh=(0,sr.A)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),sj=(0,sr.A)("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),sd=(0,sr.A)("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),so=(0,sr.A)("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]),sp=(0,sr.A)("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),sm=(0,sr.A)("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]),sx=(0,sr.A)("BookCheck",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"m9 9.5 2 2 4-4",key:"1dth82"}]]),sN=(0,sr.A)("MessageCircleQuestion",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),su=(0,sr.A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),sg=(0,sr.A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),sf=(0,sr.A)("Angry",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["path",{d:"M7.5 8 10 9",key:"olxxln"}],["path",{d:"m14 9 2.5-1",key:"1j6cij"}],["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}]]),sy=(0,sr.A)("ServerCrash",[["path",{d:"M6 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2",key:"4b9dqc"}],["path",{d:"M6 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2",key:"22nnkd"}],["path",{d:"M6 6h.01",key:"1utrut"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m13 6-4 6h6l-4 6",key:"14hqih"}]]),sw=(0,sr.A)("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]),sk=(0,sr.A)("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),sb=(0,sr.A)("Quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]),s_={note:"blue",NOTE:"blue",abstract:"gray",ABSTRACT:"gray",summary:"gray",SUMMARY:"gray",tldr:"gray",TLDR:"gray",info:"yellow",INFO:"yellow",todo:"green",TODO:"green",tip:"yellow",TIP:"yellow",hint:"red",HINT:"red",important:"yellow",IMPORTANT:"yellow",success:"green",SUCCESS:"green",check:"green",CHECK:"green",done:"green",DONE:"green",question:"sky-blue",QUESTION:"sky-blue",help:"sky-blue",HELP:"sky-blue",faq:"sky-blue",FAQ:"sky-blue",warning:"orange",WARNING:"orange",caution:"orange",CAUTION:"orange",attention:"orange",ATTENTION:"orange",failure:"red",FAILURE:"red",fail:"red",FAIL:"red",missing:"red",MISSING:"red",danger:"red",DANGER:"red",error:"red",ERROR:"red",bug:"red",BUG:"red",example:"purple",EXAMPLE:"purple",quote:"gray",QUOTE:"gray",cite:"gray",CITE:"gray"},sv={note:(0,sa.jsx)(si,{}),NOTE:(0,sa.jsx)(si,{}),abstract:(0,sa.jsx)(st,{}),ABSTRACT:(0,sa.jsx)(st,{}),summary:(0,sa.jsx)(st,{}),SUMMARY:(0,sa.jsx)(st,{}),tldr:(0,sa.jsx)(st,{}),TLDR:(0,sa.jsx)(st,{}),info:(0,sa.jsx)(sh,{}),INFO:(0,sa.jsx)(sh,{}),todo:(0,sa.jsx)(sj,{}),TODO:(0,sa.jsx)(sj,{}),tip:(0,sa.jsx)(sd,{}),TIP:(0,sa.jsx)(sd,{}),hint:(0,sa.jsx)(so,{}),HINT:(0,sa.jsx)(so,{}),important:(0,sa.jsx)(sp,{}),IMPORTANT:(0,sa.jsx)(sp,{}),success:(0,sa.jsx)(sm,{}),SUCCESS:(0,sa.jsx)(sm,{}),check:(0,sa.jsx)(sx,{}),CHECK:(0,sa.jsx)(sx,{}),done:(0,sa.jsx)(sx,{}),DONE:(0,sa.jsx)(sx,{}),question:(0,sa.jsx)(sN,{}),QUESTION:(0,sa.jsx)(sN,{}),help:(0,sa.jsx)(sN,{}),HELP:(0,sa.jsx)(sN,{}),faq:(0,sa.jsx)(sN,{}),FAQ:(0,sa.jsx)(sN,{}),warning:(0,sa.jsx)(su,{}),WARNING:(0,sa.jsx)(su,{}),caution:(0,sa.jsx)(su,{}),CAUTION:(0,sa.jsx)(su,{}),attention:(0,sa.jsx)(su,{}),ATTENTION:(0,sa.jsx)(su,{}),failure:(0,sa.jsx)(sg,{}),FAILURE:(0,sa.jsx)(sg,{}),fail:(0,sa.jsx)(sg,{}),FAIL:(0,sa.jsx)(sg,{}),missing:(0,sa.jsx)(sg,{}),MISSING:(0,sa.jsx)(sg,{}),danger:(0,sa.jsx)(sf,{}),DANGER:(0,sa.jsx)(sf,{}),error:(0,sa.jsx)(sy,{}),ERROR:(0,sa.jsx)(sy,{}),bug:(0,sa.jsx)(sw,{}),BUG:(0,sa.jsx)(sw,{}),example:(0,sa.jsx)(sk,{}),EXAMPLE:(0,sa.jsx)(sk,{}),quote:(0,sa.jsx)(sb,{}),QUOTE:(0,sa.jsx)(sb,{}),cite:(0,sa.jsx)(sb,{}),CITE:(0,sa.jsx)(sb,{})};var sP=n(5661);let sT=(0,sP.F)("",{variants:{type:{blue:"bg-quote-blue border-blue-500",green:"bg-quote-green border-green-500",yellow:"bg-quote-yellow border-yellow-500",orange:"bg-quote-orange  border-orange-500",red:"bg-quote-red border-red-500",purple:"bg-quote-purple border-purple-500",gray:"bg-quote-gray border-gray-500","sky-blue":"bg-quote-sky-blue border-blue-200"}}}),sS=(0,sP.F)("",{variants:{type:{blue:"text-blue-500",green:"text-green-500",yellow:"text-yellow-500",orange:"text-orange-500",red:"text-red-500",purple:"text-purple-500",gray:"text-gray-500","sky-blue":"text-blue-500"}}});var sI=n(1946);function sC(s){let{type:e,title:n,content:a}=s,l=a.map(s=>"string"==typeof s?"\n":s.props.children);return null!==e&&(l[1]=l[1].slice(l[1].indexOf("] ")+1)),(0,sa.jsxs)("blockquote",{className:(0,sI.cn)(sT({type:e?s_[e]:"gray"}),"rounded-xl border-y border-y-gray-400 border-r border-r-gray-400 border-opacity-30 p-4 not-italic"),children:[(0,sa.jsxs)("div",{className:(0,sI.cn)(sS({type:e&&s_[e]}),"flex items-center gap-1 font-bold text-lg md:text-2xl"),children:[null!==e&&sv[e],(0,sa.jsx)("div",{children:n})]}),(0,sa.jsx)("section",{className:"font-semibold text-black text-sm md:text-base",children:a.map(s=>s)})]})}function sA(s){let{props:e,level:n,headingIndex:a}=s;return(0,sc.createElement)("h".concat(n),{id:a(),className:function(s){switch(s){case 1:return"hltr-red";case 2:return"hltr-orange";case 3:return"hltr-yellow";case 4:return"hltr-green";case 5:return"hltr-cyan";case 6:return"hltr-blue";default:return"hltr-purple"}}(n),...e})}function sR(s){let e,n=(e=-1,function(){return e+=1});return{h1:s=>(0,sa.jsx)(sA,{props:s,level:1,headingIndex:n}),h2:s=>(0,sa.jsx)(sA,{props:s,level:2,headingIndex:n}),h3:s=>(0,sa.jsx)(sA,{props:s,level:3,headingIndex:n}),h4:s=>(0,sa.jsx)(sA,{props:s,level:4,headingIndex:n}),h5:s=>(0,sa.jsx)(sA,{props:s,level:5,headingIndex:n}),h6:s=>(0,sa.jsx)(sA,{props:s,level:6,headingIndex:n}),blockquote:s=>{let{children:e}=s,{type:n,title:a,content:l}=function(s){if(!("string"==typeof s[1].props.children&&s[1].props.children.startsWith("[!")))return{type:null,title:"",content:s};let e=s[1].props.children.slice(2,s[1].props.children.indexOf("] ")),n=s[1].props.children,a=n.indexOf("] "),l=-1!==a?n.slice(a+2):e;return{type:e,title:l,content:s.slice(2)}}(e);return null===n?(0,sc.createElement)("blockquote",s):(0,sa.jsx)(sC,{type:n,title:a,content:l})},...s}}function sE(s){let e={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"Team Project Setup"}),"\n",(0,sa.jsx)(e.h3,{children:"Role"}),"\n",(0,sa.jsx)(e.p,{children:"Common component development: simple UI components like infinite scroll and Button"}),"\n",(0,sa.jsx)(e.p,{children:"List page widget development: Skeleton related to voting lists"}),"\n",(0,sa.jsx)(e.p,{children:"CI/CD: Implemented logic to automatically deploy by responding to PR events through Netlify and GitHub Actions"}),"\n",(0,sa.jsx)(e.h3,{children:"Tasks by Period"}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-18/plan.png",alt:"plan"}),"\n",(0,sa.jsx)(e.h3,{children:"Folder Structure"}),"\n",(0,sa.jsx)(e.p,{children:"The FSD structure we previously used requires all team members to understand it perfectly to be effective, so after discussions with the team, we modified it slightly for use."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"\uD83D\uDCE6src\n    ├── \uD83D\uDCC2main.jsx\n    ├── \uD83D\uDCC2main.scss\n    ├── \uD83D\uDCC2app/\n    │   ├── \uD83D\uDCDCindex.js\n    │   ├── \uD83D\uDCDCindex.scss\n    │   └── \uD83D\uDCC2pages/\n    │       ├── \uD83D\uDCC2MyPage/\n    │       │   ├── \uD83D\uDCDCindex.jsx\n    │       │   └── \uD83D\uDCC2widgets/\n    │       │       ├── \uD83D\uDCC2<이름>/\n    │       │       │   ├── \uD83D\uDCDCindex.jsx\n    │       │       │   └── \uD83D\uDCDCindex.scss\n    │       │       └── ...\n    │       ├── \uD83D\uDCC2ListPage/\n    │       │   ├── \uD83D\uDCDCindex.jsx\n    │       │   └── \uD83D\uDCC2widgets/\n    │       │       ├── \uD83D\uDCC2<이름>/\n    │       │       │   ├── \uD83D\uDCDCindex.jsx\n    │       │       │   └── \uD83D\uDCDCindex.scss\n    │       │       └── ...\n    │       └── \uD83D\uDCC2LandingPage/\n    │           ├── \uD83D\uDCDCindex.jsx\n    │           └── \uD83D\uDCC2widgets/\n    │               ├── \uD83D\uDCC2<이름>/\n    │               │   ├── \uD83D\uDCDCindex.jsx\n    │               │   └── \uD83D\uDCDCindex.scss\n    │               └── ...\n    └── \uD83D\uDCC2common/\n        ├── \uD83D\uDCC2api/\n        │   └── \uD83D\uDCDCindex.js\n        ├── \uD83D\uDCC2assets/\n        │   ├── \uD83D\uDCC2icons/\n        │   │   ├── \uD83D\uDCDC<이름.jsx>\n        │   │   └── ...\n        │   └── \uD83D\uDCC2images/\n        │       ├── \uD83D\uDCDC<이름.png>\n        │       ├── \uD83D\uDCDC<이름.jpg>\n        │       └── ...\n        ├── \uD83D\uDCC2hooks/\n        │   ├── \uD83D\uDCDC<이름.js>\n        │   └── ...\n        ├── \uD83D\uDCC2models/\n        │   ├── \uD83D\uDCDC<이름.js>\n        │   └── ...\n        ├── \uD83D\uDCC2utilities/\n        │   ├── \uD83D\uDCDC<이름.js>\n        │   └── ...\n        └── \uD83D\uDCC2widgets/\n            ├── \uD83D\uDCC2<이름>/\n            │   ├── \uD83D\uDCDCindex.jsx\n            │   └── \uD83D\uDCDCindex.scss\n            └── ...\n"})}),"\n",(0,sa.jsx)("br",{}),"\n",(0,sa.jsx)(e.h2,{children:"Feature Implementation for UX Enhancement"}),"\n",(0,sa.jsx)(e.h3,{children:"infinite scroll"}),"\n",(0,sa.jsx)(e.h4,{children:"Concept"}),"\n",(0,sa.jsx)(e.p,{children:"This is a technique that improves UX by using the Intersection Observer API, which detects when an element appears within a frame, to request a fetch when scrolling down and the element becomes visible."}),"\n",(0,sa.jsx)(e.p,{children:"If we send all data-related fetch requests at the beginning to construct the screen, it takes unnecessary time and slows down rendering itself, so this is an essential feature for pages like list pages that need to receive a lot of data."}),"\n",(0,sa.jsx)(e.h4,{children:"useInView"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," rootRef = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRef"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { ref, inView, entry } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInView"}),"({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"threshold"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"root"}),": rootRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),",\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (inView) ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setMoreItems"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevMoreItems"}),") =>"]})," prevMoreItems + ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),");\n}, [inView]);\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n  ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ChartList"})," $",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"numbers"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{numberOfItem}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{rootRef}"}),">"]}),"\n    {status.isLoading ? (\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"로딩화면",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n    ) : (\n      ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n        {sortedItems?.map((item, index) => (\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"IdolChartCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item.id}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"item"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"index"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{index}"})," />"]}),"\n        ))}\n        {noMoreItem && (\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"RefreshSection"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{ref}"}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"{inView}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"RefreshImg"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"src"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{refresh}"})," />"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"RefreshSection"}),">"]}),"\n        )}\n      ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n    )}\n  </",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ChartList"}),">\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"The useInView library first marks an element selected with rootRef as the root (the element that serves as the frame's reference) by putting it in the root option, then"}),"\n",(0,sa.jsx)(e.p,{children:"specifies the visible ratio (the ratio visible within the frame) with threshold."}),"\n",(0,sa.jsx)(e.p,{children:"When the ref of useInView is visible from the root by the threshold amount, inView becomes true, otherwise it becomes false."}),"\n",(0,sa.jsx)(e.h4,{children:"Implementing infinite scroll by connecting with fetch"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInfiniteScroll"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"fetchFunction, options"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," rootRef = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRef"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [items, setItems] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"([]);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [cursor, setCursor] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [status, wrappedFunction] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useGetData"}),"(fetchFunction);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { ref, inView } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInView"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"threshold"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"root"}),": rootRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),",\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"executeRefresh"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { idols, nextCursor } = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wrappedFunction"}),"({\n      ...options,\n      cursor,\n    });\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!idols) ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCursor"}),"(nextCursor);\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setItems"}),"([...items, ...idols]);\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (inView && cursor !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," && cursor !== ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"executeRefresh"}),"();\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (items.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"executeRefresh"}),"();\n    }\n  }, [inView]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { items, ref, status, rootRef };\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Data is fetched in batches of 10 based on the cursor. Since ref and rootRef are passed as props, when using infinite scroll, you only need to specify ref and rootRef, making it usable without knowing the useInView logic."}),"\n",(0,sa.jsx)(e.p,{children:"Data is managed internally through state by detecting inView with useEffect."}),"\n",(0,sa.jsx)(e.h4,{children:"Trouble Shooting"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"1. Problem where clicking a child element in a specific part didn't click the parent element due to Event Bubbling"})}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-18/image-1.png",alt:"event bubbling"}),"\n",(0,sa.jsx)(e.p,{children:"To capture the target where the event first occurred, we solved it by using the currentTarget Event Property."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"2. Web browser zoom issue when using Intersection Observer"})}),"\n",(0,sa.jsx)(e.p,{children:"When the browser is zoomed, the threshold is set differently from the screen, so the Intersection Observer only works when set to 100%."}),"\n",(0,sa.jsx)("s",{children:"I screamed when I found out the cause."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"3. Problem where inView was processed twice"})}),"\n",(0,sa.jsx)(e.p,{children:"If you put inView itself in the deps of useEffect and use it, inView will be processed twice."}),"\n",(0,sa.jsx)(e.p,{children:"It works both when inView goes from true > false and when it goes from false > true."}),"\n",(0,sa.jsx)(e.p,{children:"Thinking about infinite scroll, inView is true when visible and false when loading the next data, so it's natural for it to work twice."}),"\n",(0,sa.jsx)(e.p,{children:"To solve this, you can add a condition like if (inView) inside useEffect so it only works once."}),"\n",(0,sa.jsx)(e.h4,{children:"Result"}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-18/fandom-k-infinite-scroll.gif",alt:"fandom-k infinite scroll"}),"\n",(0,sa.jsx)(e.h3,{children:"skeleton"}),"\n",(0,sa.jsx)(e.h4,{children:"Concept"}),"\n",(0,sa.jsx)(e.p,{children:"This is a UX enhancement method commonly seen on YouTube's home screen, where the outline of the screen is drawn first before data is loaded to prevent user drop-off."}),"\n",(0,sa.jsx)(e.p,{children:"List pages receive a lot of data through infinite scroll, and handling this with a simple loading icon would not provide good UX."}),"\n",(0,sa.jsx)(e.h4,{children:"Implementation"}),"\n",(0,sa.jsx)(e.p,{children:"Using styled-components' css allows you to inherit the css file itself as css."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// css"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { css } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"styled-components"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { skeleton } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./keyframes"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," css`",(0,sa.jsxs)(e.span,{className:"css",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"background-color"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"#363636"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"position"}),": relative;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"overflow"}),": hidden;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"z-index"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n  &",(0,sa.jsx)(e.span,{className:"hljs-selector-pseudo",children:":after"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"content"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'" "'}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"display"}),": block;\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"position"}),": absolute;\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"left"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"right"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"height"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100%"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"background-repeat"}),": no-repeat;\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"background-image"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"linear-gradient"}),"(\n      ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"90deg"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"rgba"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),") ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"20%"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"rgba"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"144"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"144"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"144"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),") ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"50%"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"rgba"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),") ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"80%"}),"\n    );\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"transform"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"translateX"}),"(-",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100%"}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"animation-name"}),": "]}),(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${skeleton}"}),(0,sa.jsxs)(e.span,{className:"css",children:[";\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"animation-duration"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1.5s"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"animation-iteration-count"}),": infinite;\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"animation-timing-function"}),": ease-in-out;\n    ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"animation-direction"}),": normal;\n  }\n`"]}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// keyframe"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," skeleton = keyframes",(0,sa.jsx)(e.span,{className:"hljs-string",children:"`\n  100% {\n    transform: translateX(100%);\n  }\n`"}),";\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Write the basic css for the skeleton as shown in the code above."}),"\n",(0,sa.jsx)(e.p,{children:"Using styled-components' keyframes, we created an animation, attached it to css, and created a linear-gradient that repeats infinitely for 1.5 seconds through options."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SkeletonNameBlock"})," = styled.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"div"}),(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`\n  width: 120px;\n  height: 15px;\n  border-radius: 10px;\n  ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${skeletonStyle}"}),";\n`"]}),";\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Put this animation on elements similar to the elements where data goes in, and connect it with infinite scroll so that skeleton images are shown instead while data is being fetched."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"MonthChartList"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ gender, isactive }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { items, ref, status, rootRef } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInfiniteScroll"}),"(getCharts, {\n    gender,\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ChartList"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{rootRef}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"display:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isactive"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"true"}),' ? "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"grid"}),'" ',(0,sa.jsx)(e.span,{className:"hljs-attr",children:":"}),' "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"none"}),'" }}\n    >']}),'\n      {" "}\n      {items?.map((item, index) => (\n        ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"IdolChartCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item.id}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"item"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"index"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{index}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{ref}"})," />"]}),'\n      ))}\n      {" "}\n      {status.isLoading &&\n        Array.from(Array(10)).map((_, index) => (\n          ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"IdolChartCardSkeleton"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{index}"})," />"]}),'\n        ))}\n      {" "}\n    ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ChartList"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Result"}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-18/fandom-k-skeleton.gif",alt:"fandom-k skeleton"}),"\n",(0,sa.jsx)(e.h4,{children:"Trouble Shooting"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Problem where className wasn't applied because it wasn't directly inserted (styled component)"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"For a styled component to be applied, the HTMLElement must have a className directly."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Heading"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children, className }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HeadingContainer"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{className}"}),">"]}),"{children}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HeadingContainer"}),">"]})]}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"In this state, since HeadingContainer's className is already created by the styled component, the className received as a prop doesn't go down to that component, so the styling applied to it also doesn't get applied."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Heading"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children, className }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{className}"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HeadingContainer"}),">"]}),"{children}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HeadingContainer"}),">"]}),'{" "}\n    ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"You need an Element that receives className like this for the styling to be applied as is."}),"\n",(0,sa.jsxs)("details",{children:[(0,sa.jsx)("summary",{children:"Terminal, git-related issues"}),(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Terminal"})}),(0,sa.jsx)("br",{}),(0,sa.jsx)(e.p,{children:"The way to use WSL in vscode is to mark it as remote."}),(0,sa.jsx)("br",{}),(0,sa.jsx)(e.p,{children:"It's implemented to be controlled through a button in the bottom left."}),(0,sa.jsx)("br",{}),(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Git"})}),(0,sa.jsx)("br",{}),(0,sa.jsx)(e.p,{children:"Using git squash merge allows you to receive the commit content as a single commit."}),(0,sa.jsx)("br",{}),(0,sa.jsx)(e.p,{children:"After that, you need to delete the existing feature branch and create a new feature."}),(0,sa.jsx)("br",{})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"These are experiences from working on the Codeit project."}),"\n",(0,sa.jsx)(e.p,{children:"If you request that there are problematic parts, I will delete them."}),"\n",(0,sa.jsx)(e.p,{children:"Thank you."}),"\n"]})]})}function sM(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(sE,{...s})}):sE(s)}function sq(s){let e={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"팀 프로젝트 세팅"}),"\n",(0,sa.jsx)(e.h3,{children:"역할"}),"\n",(0,sa.jsx)(e.p,{children:"공통 컴포넌트 제작: infinite scroll, Button 같은 간단한 UI"}),"\n",(0,sa.jsx)(e.p,{children:"목록 페이지 widget 제작: 투표 리스트 관련 Skeleton,"}),"\n",(0,sa.jsx)(e.p,{children:"CICD : Netlify와 GithubAction을 통해서 PR event에 반응하여 자동 배포하는 로직 구현"}),"\n",(0,sa.jsx)(e.h3,{children:"기간별 업무"}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-18/plan.png",alt:"plan"}),"\n",(0,sa.jsx)(e.h3,{children:"폴더 구조"}),"\n",(0,sa.jsx)(e.p,{children:"기존에 사용하던 FSD 구조는 다른 팀원들도 완벽하게 알아야만 효과적인 구조이기 때문에 팀원들과의 회의 끝에 조금 변형되어 사용되었습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"\uD83D\uDCE6src\n    ├── \uD83D\uDCC2main.jsx\n    ├── \uD83D\uDCC2main.scss\n    ├── \uD83D\uDCC2app/\n    │   ├── \uD83D\uDCDCindex.js\n    │   ├── \uD83D\uDCDCindex.scss\n    │   └── \uD83D\uDCC2pages/\n    │       ├── \uD83D\uDCC2MyPage/\n    │       │   ├── \uD83D\uDCDCindex.jsx\n    │       │   └── \uD83D\uDCC2widgets/\n    │       │       ├── \uD83D\uDCC2<이름>/\n    │       │       │   ├── \uD83D\uDCDCindex.jsx\n    │       │       │   └── \uD83D\uDCDCindex.scss\n    │       │       └── ...\n    │       ├── \uD83D\uDCC2ListPage/\n    │       │   ├── \uD83D\uDCDCindex.jsx\n    │       │   └── \uD83D\uDCC2widgets/\n    │       │       ├── \uD83D\uDCC2<이름>/\n    │       │       │   ├── \uD83D\uDCDCindex.jsx\n    │       │       │   └── \uD83D\uDCDCindex.scss\n    │       │       └── ...\n    │       └── \uD83D\uDCC2LandingPage/\n    │           ├── \uD83D\uDCDCindex.jsx\n    │           └── \uD83D\uDCC2widgets/\n    │               ├── \uD83D\uDCC2<이름>/\n    │               │   ├── \uD83D\uDCDCindex.jsx\n    │               │   └── \uD83D\uDCDCindex.scss\n    │               └── ...\n    └── \uD83D\uDCC2common/\n        ├── \uD83D\uDCC2api/\n        │   └── \uD83D\uDCDCindex.js\n        ├── \uD83D\uDCC2assets/\n        │   ├── \uD83D\uDCC2icons/\n        │   │   ├── \uD83D\uDCDC<이름.jsx>\n        │   │   └── ...\n        │   └── \uD83D\uDCC2images/\n        │       ├── \uD83D\uDCDC<이름.png>\n        │       ├── \uD83D\uDCDC<이름.jpg>\n        │       └── ...\n        ├── \uD83D\uDCC2hooks/\n        │   ├── \uD83D\uDCDC<이름.js>\n        │   └── ...\n        ├── \uD83D\uDCC2models/\n        │   ├── \uD83D\uDCDC<이름.js>\n        │   └── ...\n        ├── \uD83D\uDCC2utilities/\n        │   ├── \uD83D\uDCDC<이름.js>\n        │   └── ...\n        └── \uD83D\uDCC2widgets/\n            ├── \uD83D\uDCC2<이름>/\n            │   ├── \uD83D\uDCDCindex.jsx\n            │   └── \uD83D\uDCDCindex.scss\n            └── ...\n"})}),"\n",(0,sa.jsx)("br",{}),"\n",(0,sa.jsx)(e.h2,{children:"UX 향상을 위한 기능 구현"}),"\n",(0,sa.jsx)(e.h3,{children:"infinite scroll"}),"\n",(0,sa.jsx)(e.h4,{children:"개념"}),"\n",(0,sa.jsx)(e.p,{children:"interception observer API라는 요소가 프레임 안에 보여지는 것을 감지하는 API를 이용해서 스크롤이 내려가서 요소가 보이면 그때 fetch를 요청하여 UX를 향상하는 기술입니다."}),"\n",(0,sa.jsx)(e.p,{children:"처음에 데이터 관련 fetch 요청을 전부 보내서 화면을 구성하게 되면 불필요한 시간을 보내게 되서 렌더링 자체가 느려지기 때문에 목록 페이지 같은 많은 데이터를 받아야 하는 페이지에서는 꼭 필요한 기능입니다."}),"\n",(0,sa.jsx)(e.h4,{children:"useInView"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," rootRef = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRef"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { ref, inView, entry } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInView"}),"({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"threshold"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"root"}),": rootRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),",\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (inView) ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setMoreItems"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevMoreItems"}),") =>"]})," prevMoreItems + ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),");\n}, [inView]);\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n  ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ChartList"})," $",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"numbers"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{numberOfItem}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{rootRef}"}),">"]}),"\n    {status.isLoading ? (\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"로딩화면",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n    ) : (\n      ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n        {sortedItems?.map((item, index) => (\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"IdolChartCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item.id}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"item"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"index"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{index}"})," />"]}),"\n        ))}\n        {noMoreItem && (\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"RefreshSection"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{ref}"}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"{inView}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"RefreshImg"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"src"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{refresh}"})," />"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"RefreshSection"}),">"]}),"\n        )}\n      ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n    )}\n  </",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ChartList"}),">\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"useInView 라이브러리는 먼저 rootRef로 찍힌 element를 root(프레임의 기준이 되는 요소) 옵션에 넣어서 root임을 표시한 후"}),"\n",(0,sa.jsx)(e.p,{children:"threshold로 보여지는 비율(프레임 내에서 보여지는 비율)을 지정합니다."}),"\n",(0,sa.jsx)(e.p,{children:"useInView의 ref가 threshold만큼 root에서 보여지면 inView가 true로 변하고 아니면 false로 변합니다."}),"\n",(0,sa.jsx)(e.h4,{children:"fetch와 연결하여 infinite scroll 구현"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInfiniteScroll"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"fetchFunction, options"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," rootRef = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRef"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [items, setItems] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"([]);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [cursor, setCursor] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [status, wrappedFunction] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useGetData"}),"(fetchFunction);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { ref, inView } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInView"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"threshold"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"root"}),": rootRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),",\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"executeRefresh"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { idols, nextCursor } = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wrappedFunction"}),"({\n      ...options,\n      cursor,\n    });\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!idols) ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCursor"}),"(nextCursor);\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setItems"}),"([...items, ...idols]);\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (inView && cursor !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," && cursor !== ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"executeRefresh"}),"();\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (items.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"executeRefresh"}),"();\n    }\n  }, [inView]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { items, ref, status, rootRef };\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"cursor를 기반으로 10개씩 데이터를 받아오게 되어 있습니다. ref, rootRef를 prop으로 내렸기 때문에 infinitescroll을 사용할 때 ref, rootRef만 지정하면 useInview의 로직을 몰라도 사용할 수 있게 만들었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"useEffect로 inView를 감지하여 내부적으로 state를 통해 데이터가 관리됩니다."}),"\n",(0,sa.jsx)(e.h4,{children:"Trouble Shooting"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"1. Event Bubbling으로 인해서 특정 부분 자식요소 클릭시 부모 요소를 클릭하지 않았던 문제"})}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-18/image-1.png",alt:"event bubbling"}),"\n",(0,sa.jsx)(e.p,{children:"Event가 요소가 처음 발생한 target을 찍으려면 currentTarget이라는 Event Property를 사용해서 해결하였습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"2. interception observer 사용시 웹 브라우저 확대 문제"})}),"\n",(0,sa.jsx)(e.p,{children:"브라우저 확대시 threshold가 화면과 다르게 설정되기 때문에 100%로 맞춰놓고 해야 interception observer가 작동합니다."}),"\n",(0,sa.jsx)("s",{children:"원인을 알았을 때 소리질렀다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"3. inView가 두번 처리되던 문제"})}),"\n",(0,sa.jsx)(e.p,{children:"inView 자체를 useEffect의 deps에 넣고 사용하면 inView가 두번 처리되게 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"inView가 true > false일 때도 작동하고 false > true일 때도 작동하게 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"infinite scroll을 생각해보면 inView가 보일때 true, 다음 데이터를 로딩할 때 false이기 때문에 두번 작동하는게 당연합니다."}),"\n",(0,sa.jsx)(e.p,{children:"이를 해결하기 위해서는 if (inView)같은 조건을 useEffect 내에 달아서 한번만 작동되게 바꾸면 됩니다."}),"\n",(0,sa.jsx)(e.h4,{children:"결과"}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-18/fandom-k-infinite-scroll.gif",alt:"fandom-k infinite scroll"}),"\n",(0,sa.jsx)(e.h3,{children:"skeleton"}),"\n",(0,sa.jsx)(e.h4,{children:"개념"}),"\n",(0,sa.jsx)(e.p,{children:"유튜브 홈화면에서 흔하게 볼 수 있는 UX를 향상하는 방법인데 데이터가 불러오기 전에 화면의 윤곽을 먼저 그려줘서 사용자의 이탈을 막는 기능입니다."}),"\n",(0,sa.jsx)(e.p,{children:"목록 페이지에는 infinite scroll로 받아오는 데이터가 많은데 이때 이를 단순한 로딩 아이콘으로 처리하면 UX가 좋지 않을 것입니다."}),"\n",(0,sa.jsx)(e.h4,{children:"구현"}),"\n",(0,sa.jsx)(e.p,{children:"styled-components의 css를 쓰면 css 파일 자체를 css그 자체로 상속할 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// css"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { css } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"styled-components"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { skeleton } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./keyframes"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," css`",(0,sa.jsxs)(e.span,{className:"css",children:["\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"background-color"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"#363636"}),";\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"position"}),": relative;\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"overflow"}),": hidden;\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"z-index"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n\xa0 &",(0,sa.jsx)(e.span,{className:"hljs-selector-pseudo",children:":after"})," {\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"content"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'" "'}),";\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"display"}),": block;\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"position"}),": absolute;\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"left"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"right"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"height"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100%"}),";\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"background-repeat"}),": no-repeat;\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"background-image"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"linear-gradient"}),"(\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"90deg"}),",\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"rgba"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),") ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"20%"}),",\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"rgba"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"144"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"144"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"144"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),") ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"50%"}),",\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"rgba"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"54"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),") ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"80%"}),"\n\xa0 \xa0 );\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"transform"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"translateX"}),"(-",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100%"}),");\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"animation-name"}),": "]}),(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${skeleton}"}),(0,sa.jsxs)(e.span,{className:"css",children:[";\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"animation-duration"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1.5s"}),";\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"animation-iteration-count"}),": infinite;\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"animation-timing-function"}),": ease-in-out;\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"animation-direction"}),": normal;\n\xa0 }\n`"]}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// keyframe"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," skeleton = keyframes",(0,sa.jsx)(e.span,{className:"hljs-string",children:"`\n\xa0 100% {\n\xa0 \xa0 transform: translateX(100%);\n\xa0 }\n`"}),";\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위 코드처럼 스켈레톤에 기본 css를 작성합니다."}),"\n",(0,sa.jsx)(e.p,{children:"styled-components의 keyframes을 사용해서 애니메이션을 제작한 후에 이를 css에 붙힌 후 옵션을 통해 1.5초 무한으로 반복되는 linear-gradient를 만들었습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SkeletonNameBlock"})," = styled.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"div"}),(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`\n\xa0 width: 120px;\n\xa0 height: 15px;\n\xa0 border-radius: 10px;\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${skeletonStyle}"}),";\n`"]}),";\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"데이터가 들어가는 요소와 비슷한 요소에 해당 애니메이션을 넣어주고 이를 infinite scroll과 연결하여 데이터를 받아오는 동안에는 스켈레톤 이미지가 대신 보이도록 구현해줍니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"MonthChartList"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ gender, isactive }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { items, ref, status, rootRef } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInfiniteScroll"}),"(getCharts, {\n    gender,\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ChartList"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{rootRef}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"display:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isactive"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"true"}),' ? "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"grid"}),'" ',(0,sa.jsx)(e.span,{className:"hljs-attr",children:":"}),' "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"none"}),'" }}\n    >']}),'\n      \xa0 \xa0 \xa0{" "}\n      {items?.map((item, index) => (\n        ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"IdolChartCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item.id}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"item"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"index"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{index}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{ref}"})," />"]}),'\n      ))}\n      \xa0 \xa0 \xa0{" "}\n      {status.isLoading &&\n        Array.from(Array(10)).map((_, index) => (\n          ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"IdolChartCardSkeleton"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{index}"})," />"]}),'\n        ))}\n      \xa0 \xa0{" "}\n    ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ChartList"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"결과"}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-18/fandom-k-skeleton.gif",alt:"fandom-k skeleton"}),"\n",(0,sa.jsx)(e.h4,{children:"Trouble Shooting"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"(styled component) className이 직접 들어가지 않아서 적용되지 않았던 문제"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"styled component가 적용되기 위해서는 해당 HTMLElement에 직접 className이 있어야 합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Heading"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children, className }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HeadingContainer"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{className}"}),">"]}),"{children}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HeadingContainer"}),">"]})]}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이 상태면 HeadingContainer에 className은 styled componenet가 이미 만들었기 때문에 prop으로 받은 className이 해당 component로 내려가지 않아서 그것에 적용된 스타일링도 적용되지 않게 됩니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Heading"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children, className }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{className}"}),">"]}),"\n      \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HeadingContainer"}),">"]}),"{children}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HeadingContainer"}),">"]}),'\xa0 \xa0{" "}\n    ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이런식으로 className을 전달 받는 하나의 Element가 있어야 스타일링이 그대로 적용되게 됩니다."}),"\n",(0,sa.jsxs)("details",{children:[(0,sa.jsx)("summary",{children:"터미널, git관련 문제"}),(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Terminal"})}),(0,sa.jsx)("br",{}),(0,sa.jsx)(e.p,{children:"WSL을 vscode에서 사용하는 방식은 remote로 찍는 것입니다."}),(0,sa.jsx)("br",{}),(0,sa.jsx)(e.p,{children:"왼쪽 아래에 버튼을 통해서 컨트롤하게 구현되어 있습니다."}),(0,sa.jsx)("br",{}),(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Git"})}),(0,sa.jsx)("br",{}),(0,sa.jsx)(e.p,{children:"git squash merge를 이용하면 commit의 내용을 한 커밋으로 받을 수 있습니다."}),(0,sa.jsx)("br",{}),(0,sa.jsx)(e.p,{children:"이후 기존의 feature 브랜치는 삭제하고 새로운 feature를 생성해야합니다."}),(0,sa.jsx)("br",{})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"코드잇 프로젝트 진행 중에 겪은 경험들입니다."}),"\n",(0,sa.jsx)(e.p,{children:"문제가 되는 부분이 있다고 요청 주시면 삭제하겠습니다."}),"\n",(0,sa.jsx)(e.p,{children:"감사합니다."}),"\n"]})]})}function sO(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(sq,{...s})}):sq(s)}function sL(s){let e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"fetch"}),"\n",(0,sa.jsx)(e.h3,{children:"POST Request for Voting"}),"\n",(0,sa.jsx)(e.p,{children:"Asynchronous call of setState"}),"\n",(0,sa.jsxs)(e.p,{children:["setState is called asynchronously (the setState call is asynchronous, but setState itself is a synchronous function. ",(0,sa.jsx)(e.a,{href:"https://velog.io/@jay/setStateisnotasync",children:"https://velog.io/@jay/setStateisnotasync"}),"). When passing state to fetch, the previous state may be passed. This can be solved using useEffect."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [id, setId] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," idolId = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleClick"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"e"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!idolId) ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCredit"}),"(credit - ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wrappedFunction"}),"(idolId);\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (id !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),") {\n    idolId = id;\n  }\n}, [id]);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"wrappedFunction contains fetch. If you pass the state id directly to fetch, the id may be passed before setId changes are confirmed, causing the logic to break."}),"\n",(0,sa.jsx)(e.p,{children:"When id changes, update the variable and use the updated variable in the handler to get the state after asynchronous processing is complete."}),"\n",(0,sa.jsx)(e.p,{children:"React uses batching to send virtual DOM changes all at once. If you send fetch before batching is complete, an error may occur."}),"\n",(0,sa.jsx)(e.p,{children:"By using useEffect to update idolId based on id, you can send fetch requests with the updated Id."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"When sending POST in fetch, the Content-Type in the header must match the Type of the data actually being sent."})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postVotes"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"Id"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"URL"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${BASE_URL}"}),"/votes`"]}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"URL"}),", {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"method"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"POST"'}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mode"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"cors"'}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"headers"}),": { ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Content-Type"'}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"application/json"'})," },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"body"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"idolId"}),": +",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Id"})," }),\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n}\n"]})}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-19/requestheader.png",alt:"requestHeader"}),"\n",(0,sa.jsx)(e.h3,{children:"Trouble Shooting"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Infinite loop with setter and state"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"When handling network requests, if you put a setter function in the same scope as the function that defines state, an infinite loop may occur. The process of the setter changing state and re-rendering repeats."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [status, setStatus] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLoading"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"errorMessage"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n});\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wrappedFunction"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"...args"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"try"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setStatus"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevStatus"}),") =>"]})," ({\n      ...prevStatus,\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLoading"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"errorMessage"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n    }));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"funcAsync"}),"(...args);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"catch"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setStatus"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevStatus"}),") =>"]})," ({\n      ...prevStatus,\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"errorMessage"}),": error,\n    }));\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"finally"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setStatus"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevStatus"}),") =>"]})," ({\n      ...prevStatus,\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLoading"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n    }));\n  }\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"If you handle fetch where state changes, it will keep fetching and cause errors. Use useEffect to call fetch only based on deps."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetchData"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wrappedFunction"}),"({ gender });\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(data);\n  };\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetchData"}),"();\n}, [gender]);\n"]})}),"\n",(0,sa.jsxs)(e.ol,{start:"2",children:["\n",(0,sa.jsx)(e.li,{children:"Duplicate fetch due to useEffect"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"useEffect executes cleanup > setup > cleanup logic on every render. In development environment, it runs 2 more times."}),"\n",(0,sa.jsx)(e.p,{children:"I put fetch in a useEffect with inView deps and also in another place, which resulted in 8 fetch requests: 4 basic fetches plus the intersection observer API on the first screen also working."}),"\n",(0,sa.jsx)(e.p,{children:"useEffect runs on the first render even if it has deps. If you use different deps for the same logic, you should combine them into one useEffect."}),"\n",(0,sa.jsx)(e.h2,{children:"scroll to Top"}),"\n",(0,sa.jsx)(e.p,{children:"When navigating pages, a router is used, but since the router's default behavior blocks the browser's default behavior, it's difficult to handle scroll position."}),"\n",(0,sa.jsx)(e.p,{children:"React has SPA characteristics, so pages don't change directly and only parts of the page are changed with JS. Maintaining scroll position is a characteristic of SPAs."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ScrollToTop.js"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useLocation } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react-router-dom"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"ScrollToTop"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"props"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { pathname } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useLocation"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"scrollTo"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n  }, [pathname]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"{props.children}",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This can be solved with the above code."}),"\n",(0,sa.jsx)(e.p,{children:"After getting the current location with the useLocation hook, use useEffect to move the scroll to the top using window.scrollTo when the current location changes."}),"\n",(0,sa.jsx)(e.h2,{children:"Removing useInview"}),"\n",(0,sa.jsx)(e.p,{children:"We decided to implement infinite scroll using pure Intersection Observer API without a library."}),"\n",(0,sa.jsx)(e.p,{children:"I implemented the previously used useInView using the Intersection Observer API."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect, useRef, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCustomInView"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"option"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [inView, setInView] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ref = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRef"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," observer = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"IntersectionObserver"}),"(\n      ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"[{ isIntersecting }]"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setInView"}),"(isIntersecting);\n      },\n      { ...option },\n    );\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (ref.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"})," && ref.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"instanceof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Element"}),") {\n      observer.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"observe"}),"(ref.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),");\n    }\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (observer) observer.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"disconnect"}),"();\n    };\n  }, [option]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ref, inView };\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Since it returns ref and inView just like useInview, you can migrate by simply changing useInView to useCustomInView in existing code."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!note] Other Implementation Knowledge"}),"\n",(0,sa.jsx)(e.p,{children:"You can easily customize svg type images using svg components. Use the svgr site to convert svg to components and import them with export."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"These are experiences from working on the Codeit project."}),"\n",(0,sa.jsx)(e.p,{children:"If you request that there are problematic parts, I will delete them."}),"\n",(0,sa.jsx)(e.p,{children:"Thank you."}),"\n"]})]})}function sD(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(sL,{...s})}):sL(s)}function sB(s){let e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"fetch"}),"\n",(0,sa.jsx)(e.h3,{children:"투표를 하기 위한 POST 요청"}),"\n",(0,sa.jsx)(e.p,{children:"setState의 비동기 호출"}),"\n",(0,sa.jsxs)(e.p,{children:["setState는 비동기로 호출됩니다(setState 호출이 비동기이며, setState 자체는 동기 함수입니다. ",(0,sa.jsx)(e.a,{href:"https://velog.io/@jay/setStateisnotasync",children:"https://velog.io/@jay/setStateisnotasync"})," ). fetch에 state를 전달할 때 이전 state가 들어가는 경우가 발생할 수 있습니다. useEffect를 사용하여 해결할 수 있습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [id, setId] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," idolId = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleClick"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"e"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!idolId) ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCredit"}),"(credit - ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wrappedFunction"}),"(idolId);\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (id !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),") {\n    idolId = id;\n  }\n}, [id]);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"wrappedFunction에 fetch가 들어가 있습니다. fetch에 state인 id를 그대로 전달하게 되면 setId가 바뀐지 확인할 수 없는 상태에서 id가 전달되어 로직이 꼬일 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"id가 바뀌면 변수를 업데이트하고, handler에서 업데이트된 변수를 사용하는 방식으로 비동기 처리가 완료된 state를 얻을 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"리액트는 가상돔의 변경사항을 한번에 보내는 batching을 사용합니다. batching이 완료되기 전에 fetch를 보내면 에러가 발생할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"useEffect로 id에 따라 idolId를 갱신하는 방식으로 처리하면 업데이트된 Id로 fetch 요청을 보낼 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"fetch에서 POST를 보낼 때 header에 존재하는 Content-Type은 실제 보내는 데이터의 Type과 일치해야 한다."})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postVotes"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"Id"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"URL"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${BASE_URL}"}),"/votes`"]}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"URL"}),", {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"method"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"POST"'}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mode"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"cors"'}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"headers"}),": { ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Content-Type"'}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"application/json"'})," },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"body"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"idolId"}),": +",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Id"})," }),\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n}\n"]})}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-19/requestheader.png",alt:"requestHeader"}),"\n",(0,sa.jsx)(e.h3,{children:"Trouble Shooting"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"setter와 state 무한 루프"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"네트워크 처리를 할 때 state를 정의하는 함수에 setter 함수를 같은 스코프에 넣으면 무한 루프가 발생할 수 있습니다. setter가 state를 변경하고 다시 렌더링되는 과정이 반복됩니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [status, setStatus] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLoading"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"errorMessage"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n});\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wrappedFunction"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"...args"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"try"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setStatus"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevStatus"}),") =>"]})," ({\n      ...prevStatus,\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLoading"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"errorMessage"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n    }));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"funcAsync"}),"(...args);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"catch"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setStatus"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevStatus"}),") =>"]})," ({\n      ...prevStatus,\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"errorMessage"}),": error,\n    }));\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"finally"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setStatus"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevStatus"}),") =>"]})," ({\n      ...prevStatus,\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLoading"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n    }));\n  }\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"state가 변경되는 곳에 fetch 처리를 하면 계속 fetch를 하게 되어 오류가 발생합니다. useEffect를 이용해서 deps에 따라서만 fetch를 호출하도록 처리합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetchData"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wrappedFunction"}),"({ gender });\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(data);\n  };\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetchData"}),"();\n}, [gender]);\n"]})}),"\n",(0,sa.jsxs)(e.ol,{start:"2",children:["\n",(0,sa.jsx)(e.li,{children:"useEffect로 인한 fetch 중복"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"useEffect는 렌더링마다 cleanup > setup > cleanup 로직을 실행합니다. development 환경에서는 2번 더 실행됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"inView deps를 가진 useEffect에 fetch를 넣고 다른 곳에서도 넣었더니 기본 4번 fetch에 첫 화면의 intersection observer api도 작동하여 fetch를 8번 보냈습니다."}),"\n",(0,sa.jsx)(e.p,{children:"useEffect는 deps가 있어도 첫 렌더링 때 실행됩니다. 같은 로직에 다른 deps를 사용하는 경우 하나의 useEffect로 합쳐서 사용해야 합니다."}),"\n",(0,sa.jsx)(e.h2,{children:"scroll to Top"}),"\n",(0,sa.jsx)(e.p,{children:"페이지 이동 시 router를 사용하게 되는데, router의 기본 동작이 브라우저의 기본 동작을 막기 때문에 스크롤 위치를 처리하기 어렵습니다."}),"\n",(0,sa.jsx)(e.p,{children:"React는 SPA 특성을 가지고 있어 페이지가 직접 바뀌지 않고 JS로 페이지의 일부만 변경됩니다. 스크롤 위치가 그대로 유지되는 것은 SPA의 특성입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ScrollToTop.js"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useLocation } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react-router-dom"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"ScrollToTop"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"props"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { pathname } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useLocation"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"scrollTo"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n  }, [pathname]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"{props.children}",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위 코드로 해결할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"useLocation 훅으로 현재 위치를 가져온 후, useEffect로 현재 위치가 변경되면 window.scrollTo를 사용하여 스크롤을 상단으로 이동시킵니다."}),"\n",(0,sa.jsx)(e.h2,{children:"useInview 제거"}),"\n",(0,sa.jsx)(e.p,{children:"라이브러리 없이 순수 intersection observer API를 사용해서 infinite scroll을 구현하기로 했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"기존에 사용하던 useInView를 intersection observer API로 구현했습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect, useRef, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCustomInView"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"option"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [inView, setInView] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ref = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRef"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," observer = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"IntersectionObserver"}),"(\n      ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"[{ isIntersecting }]"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setInView"}),"(isIntersecting);\n      },\n      { ...option },\n    );\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (ref.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"})," && ref.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"instanceof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Element"}),") {\n      observer.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"observe"}),"(ref.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),");\n    }\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (observer) observer.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"disconnect"}),"();\n    };\n  }, [option]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ref, inView };\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"useInview와 똑같이 ref와 inView를 반환하기 때문에 기존 코드에서 useInView를 useCustomInView로 바꾸는 것만으로 마이그레이션할 수 있습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!note] 기타 구현 지식"}),"\n",(0,sa.jsx)(e.p,{children:"svg component를 사용해서 svg 타입 이미지를 쉽게 커스터마이징 할 수 있다. svgr\n사이트를 통해서 svg를 컴포넌트로 변환하고 export로 받아오면 된다."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"코드잇 프로젝트 진행 중에 겪은 경험들입니다."}),"\n",(0,sa.jsx)(e.p,{children:"문제가 되는 부분이 있다고 요청 주시면 삭제하겠습니다."}),"\n",(0,sa.jsx)(e.p,{children:"감사합니다."}),"\n"]})]})}function sF(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(sB,{...s})}):sB(s)}function sU(s){let e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"CI/CD"}),"\n",(0,sa.jsx)(e.p,{children:"After completing basic feature development, we prepared for deployment.\nCI/CD was not in the schedule, but we judged that automatic deployment through GitHub Actions would be efficient.\nAfter discussing with team members, we learned the basics of GitHub Actions and applied it to the project."}),"\n",(0,sa.jsx)(e.h3,{children:"Concept"}),"\n",(0,sa.jsx)(e.p,{children:"GitHub Actions consists of two components."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.strong,{children:"Trigger"})," is a condition that triggers work, and ",(0,sa.jsx)(e.strong,{children:"Jobs"})," are tasks that run when triggered."]}),"\n",(0,sa.jsx)(e.p,{children:"Triggers use Events associated with GitHub.\nVarious events such as push, pr, issue, workflow-dispatch can be handled, and can be limited to specific conditions (e.g., only works when a pr is opened)."}),"\n",(0,sa.jsx)(e.p,{children:"Jobs have a hierarchical structure of job > step, and the final action unit is called an Action. Actions can be provided by GitHub or shared from GitHub Marketplace."}),"\n",(0,sa.jsx)(e.p,{children:"We defined the conditions needed for the project."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Run when PR is merged to Main"}),"\n",(0,sa.jsx)(e.li,{children:"Deploy app by connecting with Netlify"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"For condition 1, we set constraints to only work when a PR is closed and merged on the Main branch."}),"\n",(0,sa.jsx)(e.p,{children:"For condition 2, we needed a Netlify deployment action and an action to install node on ubuntu and install dependencies."}),"\n",(0,sa.jsx)(e.p,{children:"We implemented the code as follows."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-yaml",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"build"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"and"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"deploy"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"to"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Netlify"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"on:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pull_request:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"types:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"closed"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"jobs:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"build:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"if:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"github.event.pull_request.merged"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"=="})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"runs-on:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"ubuntu-latest"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"steps:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"checkout"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/checkout@v4"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"setup-nod"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/setup-node@v3"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Cache"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Node.js"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"modules"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/cache@v3"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"with:"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"path:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"~/.npm"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"runner.os"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}-node-${{hashFiles('**/package-lock.json')}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"restore-keys:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"|\n            ${{ runner.os }}-node-\n"}),"      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Install"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"dependencies,"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"build"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"|\n          npm ci\n          npm run build\n"}),"      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Deploy"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"to"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Netlify"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"nwtgck/actions-netlify@v3.0"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"with:"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"publish-dir:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./dist"'}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"production-branch:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"main"'}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"github-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.GITHUB_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"deploy-message:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Deploy from GitHub Actions"'}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"enable-pull-request-comment:"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"enable-commit-comment:"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overwrites-pull-request-comment:"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"env:"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"NETLIFY_AUTH_TOKEN:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.NETLIFY_AUTH_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"NETLIFY_SITE_ID:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.NETLIFY_SITE_ID"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"timeout-minutes:"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"We improved performance on re-execution by applying cache. We completed the setup by getting tokens from Netlify and registering GITHUB_TOKEN in GitHub Secrets."}),"\n",(0,sa.jsx)(e.h3,{children:"Trouble shooting"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"npm error itself"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"An npm error occurred during deployment."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://github.com/npm/cli/issues/4828",children:"https://github.com/npm/cli/issues/4828"})}),"\n",(0,sa.jsx)(e.p,{children:"We resolved it by deleting package.lock.json and node_modules and reinstalling as suggested in the issue."}),"\n",(0,sa.jsx)(e.h2,{children:"Result"}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-20/githubActionResult.png",alt:"githubActionResult"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"These are experiences from working on the Codeit project."}),"\n",(0,sa.jsx)(e.p,{children:"If you request that there are problematic parts, I will delete them."}),"\n",(0,sa.jsx)(e.p,{children:"Thank you."}),"\n"]})]})}function sz(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(sU,{...s})}):sU(s)}function sH(s){let e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"CICD"}),"\n",(0,sa.jsx)(e.p,{children:"기본 기능 개발이 끝나고 배포를 준비했습니다.\nCICD는 일정에 없던 업무였지만, Github Action을 통한 자동 배포가 효율적일 것으로 판단했습니다.\n팀원들과 논의 후 Github Action 기본을 학습하고 프로젝트에 적용했습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"개념"}),"\n",(0,sa.jsx)(e.p,{children:"Github Action은 두 가지 구성으로 이루어져 있습니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.strong,{children:"Trigger"}),"는 작업을 촉발시키는 조건이고, ",(0,sa.jsx)(e.strong,{children:"Jobs"}),"는 촉발되었을 때 실행되는 작업입니다."]}),"\n",(0,sa.jsx)(e.p,{children:"Trigger는 GitHub와 연관된 Event를 사용합니다.\npush, pr, issue, workflow-dispatch 등 다양한 Event를 다룰 수 있으며, 특정 조건으로 제한할 수 있습니다(예: pr을 열었을 때만 동작)."}),"\n",(0,sa.jsx)(e.p,{children:"Jobs는 job > step으로 이어지는 하위 구조를 가지며, 최종 동작 단위를 Action이라고 부릅니다. Action은 GitHub에서 제공하거나 GitHub Marketplace에서 공유되는 것을 사용할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"프로젝트에 필요한 조건을 정의했습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"PR을 Main으로 merge할 때 실행"}),"\n",(0,sa.jsx)(e.li,{children:"Netlify와 연결하여 앱 배포"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"1번 조건을 위해 Main branch에서 PR이 닫히고 merge되었을 때만 동작하도록 제약을 설정했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"2번 조건을 위해 Netlify 배포 action과 ubuntu에 node를 설치하고 dependency를 설치하는 action이 필요했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"다음과 같이 코드를 구현했습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-yaml",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"build"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"and"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"deploy"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"to"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Netlify"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"on:"}),"\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pull_request:"}),"\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"types:"}),"\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"closed"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"jobs:"}),"\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"build:"}),"\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"if:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"github.event.pull_request.merged"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"=="})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),"\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"runs-on:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"ubuntu-latest"}),"\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"steps:"}),"\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"checkout"}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/checkout@v4"}),"\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"setup-nod"}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/setup-node@v3"}),"\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Cache"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Node.js"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"modules"}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/cache@v3"}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"with:"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"path:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"~/.npm"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"runner.os"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}-node-${{hashFiles('**/package-lock.json')}}"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"restore-keys:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"|"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"runner.os"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}-node-"}),"\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Install"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"dependencies,"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"build"}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"|"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"npm"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"ci"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"npm"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"run"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"build"}),"\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Deploy"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"to"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Netlify"}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"nwtgck/actions-netlify@v3.0"}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"with:"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"publish-dir:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./dist"'}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"production-branch:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"main"'}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"github-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.GITHUB_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"deploy-message:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Deploy from GitHub Actions"'}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"enable-pull-request-comment:"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"enable-commit-comment:"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overwrites-pull-request-comment:"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"env:"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"NETLIFY_AUTH_TOKEN:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.NETLIFY_AUTH_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"NETLIFY_SITE_ID:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.NETLIFY_SITE_ID"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"timeout-minutes:"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"cache를 적용하여 재실행 시 성능을 개선했습니다. Netlify에서 토큰을 가져오고 GITHUB_TOKEN을 GitHub Secret에 등록하여 설정을 완료했습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"Trouble shooting"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"npm 자체 에러"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"배포 중 npm 에러가 발생했습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://github.com/npm/cli/issues/4828",children:"https://github.com/npm/cli/issues/4828"})}),"\n",(0,sa.jsx)(e.p,{children:"issue에서 제안한 대로 package.lock.json과 node_modules를 삭제하고 재설치하여 해결했습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"결과"}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-20/githubActionResult.png",alt:"githubActionResult"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"코드잇 프로젝트 진행 중에 겪은 경험들입니다."}),"\n",(0,sa.jsx)(e.p,{children:"문제가 되는 부분이 있다고 요청 주시면 삭제하겠습니다."}),"\n",(0,sa.jsx)(e.p,{children:"감사합니다."}),"\n"]})]})}function sW(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(sH,{...s})}):sH(s)}function sV(s){let e={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"Why Use TypeScript"}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript is used more than JavaScript in frontend environments."}),"\n",(0,sa.jsx)(e.p,{children:"Beyond simply using it, we need to understand the problems TypeScript solves."}),"\n",(0,sa.jsx)(e.h2,{children:"Characteristics of JavaScript"}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript is highly flexible but problematic in terms of maintainability."}),"\n",(0,sa.jsx)(e.h3,{children:"1. Common Variable Declaration Methods in JavaScript"}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{children:"Variable Declaration Method"}),(0,sa.jsx)(e.th,{children:"Scope Range"}),(0,sa.jsx)(e.th,{children:"Reassignment Possible"}),(0,sa.jsx)(e.th,{children:"Hoisting"}),(0,sa.jsx)(e.th,{children:"Duplicate Declaration Possible"})]})}),(0,sa.jsxs)(e.tbody,{children:[(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"var"}),(0,sa.jsx)(e.td,{children:"Function"}),(0,sa.jsx)(e.td,{children:"Yes"}),(0,sa.jsx)(e.td,{children:"o"}),(0,sa.jsx)(e.td,{children:"Yes"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"let"}),(0,sa.jsx)(e.td,{children:"Block"}),(0,sa.jsx)(e.td,{children:"Yes"}),(0,sa.jsx)(e.td,{children:"x (ReferenceError)"}),(0,sa.jsx)(e.td,{children:"No (Syntax Error)"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"const"}),(0,sa.jsx)(e.td,{children:"Block"}),(0,sa.jsx)(e.td,{children:"No"}),(0,sa.jsx)(e.td,{children:"x (ReferenceError)"}),(0,sa.jsx)(e.td,{children:"No (Syntax Error)"})]})]})]}),"\n",(0,sa.jsx)(e.p,{children:"var is often seen in old code or code converted with Babel."}),"\n",(0,sa.jsx)(e.p,{children:"In JavaScript, variable types can freely change from int to float, string, etc. during code execution."}),"\n",(0,sa.jsx)(e.p,{children:"Static type languages (C, Java, Kotlin, C#, etc.) specify types first and throw errors when assigning different types."}),"\n",(0,sa.jsx)(e.p,{children:"In small projects, JavaScript's freedom can be convenient."}),"\n",(0,sa.jsx)(e.p,{children:"However, as code scales and expansion or modification becomes necessary, the strictness of static types is needed."}),"\n",(0,sa.jsx)(e.h3,{children:"2. Overly Free Syntax"}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript introduced arrow functions to improve the this problem."}),"\n",(0,sa.jsx)(e.p,{children:"Arrow functions are not function declarations, so they prevent hoisting."}),"\n",(0,sa.jsx)(e.p,{children:"Despite such improvements, JavaScript's excessive freedom is a disadvantage in terms of stability."}),"\n",(0,sa.jsx)(e.h3,{children:"3. Ambiguous Distinction Between undefined and null"}),"\n",(0,sa.jsxs)(e.p,{children:["The JavaScript engine automatically sets variables without assigned data to ",(0,sa.jsx)(e.code,{children:"undefined"}),"."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"null"})," is an empty value explicitly specified by the developer, and ",(0,sa.jsx)(e.code,{children:"undefined"})," is an empty value automatically set by the engine."]}),"\n",(0,sa.jsxs)(e.p,{children:["However, even if a developer explicitly sets ",(0,sa.jsx)(e.code,{children:"undefined"}),", no error occurs."]}),"\n",(0,sa.jsx)(e.p,{children:"It may be convenient at the time of writing, but debugging becomes difficult during maintenance."}),"\n",(0,sa.jsx)(e.p,{children:"If we could check the code before execution, it wouldn't be a problem."}),"\n",(0,sa.jsx)(e.p,{children:"The core issue is that JavaScript allows excessive freedom while lacking inspection mechanisms."}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript emerged to solve this problem."}),"\n",(0,sa.jsx)(e.h2,{children:"The Emergence of TypeScript"}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript adds and checks static types while using JavaScript syntax as is."}),"\n",(0,sa.jsx)(e.h2,{children:"How TypeScript Works"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"TS > Convert with tsc (compiler) > JS > Execute JS (node environment)"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"tsc has two roles."}),"\n",(0,sa.jsx)(e.p,{children:"The first is converting TypeScript to JavaScript."}),"\n",(0,sa.jsx)(e.p,{children:"The second is checking types."}),"\n",(0,sa.jsx)(e.p,{children:"Even if type checking fails, it still converts to JavaScript."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!note] Reference"}),"\n",(0,sa.jsx)(e.p,{children:"There are runtimes like Deno and Bun that can directly execute TypeScript, but they haven't been popularized yet."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Actual Advantages of TypeScript"}),"\n",(0,sa.jsx)(e.h3,{children:"Type Specification for Data Received from API"}),"\n",(0,sa.jsx)(e.p,{children:"Backends using static type languages have clear types for response data."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"totalCount"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"list"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"updatedAt"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"createdAt"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"likeCount"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"writer"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"nickname"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"닉네임"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"id"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"image"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"string"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"content"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 내용입니다."'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"title"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 제목입니다."'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"id"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"In JavaScript, even if you declare an object with const, internal property changes are possible."}),"\n",(0,sa.jsx)(e.p,{children:"Type changes are also free."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"totalCount"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"list"}),": [\n    {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeCount"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"writer"}),": {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nickname"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"닉네임"'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"image"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"string"'}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"content"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 내용입니다."'}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 제목입니다."'}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n    },\n  ],\n};\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"수정이지롱"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Type changed from number to string '수정이지롱'"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"If the code is short, you can avoid such mistakes, but as the code grows, human errors occur."}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript prevents this problem by specifying types."}),"\n",(0,sa.jsx)(e.p,{children:"Define the type of data received from fetch in advance."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"content"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"image"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeCount"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"writer"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nickname"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  };\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"article"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeCount"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"writer"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nickname"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"닉네임"'}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"image"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"string"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"content"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 내용입니다."'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 제목입니다."'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n};\n\narticle.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"수정이지롱"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Type 'string' is not assignable to type 'number'."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript shows an error that id is of type number but a string was assigned."}),"\n",(0,sa.jsx)(e.h3,{children:"Syntax Error Explanation"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [images, setImages] = useState<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),"[]>([]);\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleFileSelect"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (fileRef?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"files"})," == ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newFile = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"from"}),"(fileRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"files"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"file"}),") =>"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"URL"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createObjectURL"}),"(file),\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setImages"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevImages"}),") =>"]})," [...prevImages, newFile]);\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:'The above code references input type="file" with useRef to receive files.'}),"\n",(0,sa.jsx)(e.p,{children:"URL.createObjectURL(file) converts FakePath to an actual URL."}),"\n",(0,sa.jsx)(e.p,{children:"Shows a preview with the converted URL."}),"\n",(0,sa.jsx)(e.p,{children:"setImages puts prevImages and new files with the spread operator."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"The problem is that newFile also needs to be spread."})}),"\n",(0,sa.jsx)(e.p,{children:"In a JavaScript environment, it would have passed without error."}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript shows clear errors."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["Argument of type '(prevImages: string[]) => (string | string[])[]' is not assignable to parameter of type ",(0,sa.jsx)(e.code,{children:"'SetStateAction<string[]>'"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:"Type '(prevImages: string[]) => (string | string[])[]' is not assignable to type '(prevState: string[])=> string[]'."}),"\n",(0,sa.jsx)(e.p,{children:"Type '(string | string[])[]' is not assignable to type 'string[]'."}),"\n",(0,sa.jsx)(e.p,{children:"Type 'string | string[]' is not assignable to type 'string'."}),"\n",(0,sa.jsx)(e.p,{children:"Type 'string[]' is not assignable to type 'string'."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"The error message is long but the content is simple."}),"\n",(0,sa.jsxs)(e.p,{children:["A (string | string[])[] type was put in, but it doesn't match ",(0,sa.jsx)(e.code,{children:"setStateAction<string[]>"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:"You can see that the (string[])[] part is wrong."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleFileSelect"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (fileRef?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"files"})," == ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newFile = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"from"}),"(fileRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"files"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"v"}),") =>"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"URL"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createObjectURL"}),"(v),\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setImages"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevImages"}),") =>"]})," [...prevImages, ...newFile]);\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"You can solve it by modifying it as above."}),"\n",(0,sa.jsx)(e.p,{children:"I learned that grammatical freedom is not always good when using TypeScript."}),"\n",(0,sa.jsx)(e.p,{children:"Type specification, interface inheritance, Key type settings, etc. take time in the beginning."}),"\n",(0,sa.jsx)(e.p,{children:"However, once types are specified, human errors can be prevented in advance."}),"\n",(0,sa.jsx)(e.p,{children:"The JavaScript ecosystem has largely overcome the disadvantages of script languages through TypeScript."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"If there is incorrect information or content to add, please let me know in the comments."}),"\n",(0,sa.jsx)(e.p,{children:"Thank you."}),"\n"]})]})}function sJ(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(sV,{...s})}):sV(s)}function sG(s){let e={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"TypeScript를 사용하는 이유"}),"\n",(0,sa.jsx)(e.p,{children:"프론트엔드 환경에서 TypeScript는 JavaScript보다 더 많이 사용됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"단순히 사용하는 것을 넘어 TypeScript가 해결하는 문제를 이해해야 합니다."}),"\n",(0,sa.jsx)(e.h2,{children:"JavaScript의 특징"}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript는 유연성이 높지만 유지보수 측면에서 문제가 됩니다."}),"\n",(0,sa.jsx)(e.h3,{children:"1. JavaScript에서 자주 쓰는 변수 선언 방법"}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{children:"변수 선언 방법"}),(0,sa.jsx)(e.th,{children:"스코프 범위"}),(0,sa.jsx)(e.th,{children:"재할당 가능 여부"}),(0,sa.jsx)(e.th,{children:"hoisting 여부"}),(0,sa.jsx)(e.th,{children:"중복 선언 가능 여부"})]})}),(0,sa.jsxs)(e.tbody,{children:[(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"var"}),(0,sa.jsx)(e.td,{children:"함수 스코프"}),(0,sa.jsx)(e.td,{children:"가능"}),(0,sa.jsx)(e.td,{children:"o"}),(0,sa.jsx)(e.td,{children:"가능"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"let"}),(0,sa.jsx)(e.td,{children:"블록 스코프"}),(0,sa.jsx)(e.td,{children:"가능"}),(0,sa.jsx)(e.td,{children:"x (ReferenceError)"}),(0,sa.jsx)(e.td,{children:"불가능 (Syntax Error)"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"const"}),(0,sa.jsx)(e.td,{children:"블록 스코프"}),(0,sa.jsx)(e.td,{children:"불가능"}),(0,sa.jsx)(e.td,{children:"x (ReferenceError)"}),(0,sa.jsx)(e.td,{children:"불가능 (Syntax Error)"})]})]})]}),"\n",(0,sa.jsx)(e.p,{children:"var는 예전 코드나 바벨로 변환된 코드에서 자주 보입니다."}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript에서는 코드 실행 중 변수 타입이 int에서 float, string 등으로 자유롭게 변할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"정적 타입 언어(C, Java, Kotlin, C# 등)는 타입을 먼저 지정하고 다른 타입 할당 시 오류를 냅니다."}),"\n",(0,sa.jsx)(e.p,{children:"작은 프로젝트에서는 JavaScript의 자유로움이 편할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"하지만 코드 규모가 커지고 확장이나 수정이 필요해지면 정적 타입의 엄격함이 필요합니다."}),"\n",(0,sa.jsx)(e.h3,{children:"2. 필요 이상으로 자유로운 문법"}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript는 this 문제를 개선하기 위해 화살표 함수를 도입했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"화살표 함수는 함수 선언문이 아니므로 호이스팅을 방지합니다."}),"\n",(0,sa.jsx)(e.p,{children:"이런 개선에도 불구하고 JavaScript의 과도한 자유로움은 안정성 측면에서 단점입니다."}),"\n",(0,sa.jsx)(e.h3,{children:"3. undefined와 null의 모호한 구분"}),"\n",(0,sa.jsxs)(e.p,{children:["JavaScript 엔진은 데이터가 할당되지 않은 변수를 ",(0,sa.jsx)(e.code,{children:"undefined"}),"로 자동 설정합니다."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"null"}),"은 개발자가 명시하는 빈 값이고, ",(0,sa.jsx)(e.code,{children:"undefined"}),"는 엔진이 자동으로 설정하는 빈 값입니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["하지만 개발자가 ",(0,sa.jsx)(e.code,{children:"undefined"}),"를 명시해도 오류가 발생하지 않습니다."]}),"\n",(0,sa.jsx)(e.p,{children:"작성 시점에는 편할 수 있지만 유지보수 시 디버깅이 어려워집니다."}),"\n",(0,sa.jsx)(e.p,{children:"실행 전에 코드를 검사할 수 있다면 문제가 되지 않습니다."}),"\n",(0,sa.jsx)(e.p,{children:"핵심 문제는 JavaScript가 과도한 자유로움을 허용하면서도 검사 장치가 부족하다는 점입니다."}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript는 이 문제를 해결하기 위해 등장했습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"TypeScript의 등장"}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript는 JavaScript 문법을 그대로 사용하면서 정적 타입을 추가하고 검사합니다."}),"\n",(0,sa.jsx)(e.h2,{children:"TypeScript 작동 방식"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"TS > tsc (컴파일러)로 변환 > JS > JS 실행 (node 환경)"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"tsc는 두 가지 역할을 합니다."}),"\n",(0,sa.jsx)(e.p,{children:"첫 번째는 TypeScript를 JavaScript로 변환하는 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"두 번째는 타입을 검사하는 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"타입 검사를 통과하지 못해도 JavaScript로 변환은 됩니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!note] 참고"}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript를 직접 실행할 수 있는 Deno, Bun 같은 런타임도 있지만 아직 대중화되지 않았습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"TypeScript의 실제 장점"}),"\n",(0,sa.jsx)(e.h3,{children:"API에서 받은 데이터의 타입 지정"}),"\n",(0,sa.jsx)(e.p,{children:"정적 타입 언어를 사용하는 백엔드는 응답 데이터의 타입이 명확합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"totalCount"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"list"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"updatedAt"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"createdAt"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"likeCount"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"writer"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"nickname"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"닉네임"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"id"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"image"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"string"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"content"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 내용입니다."'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"title"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 제목입니다."'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"id"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript에서는 const로 객체를 선언해도 내부 프로퍼티 변경이 가능합니다."}),"\n",(0,sa.jsx)(e.p,{children:"타입 변경도 자유롭게 됩니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"totalCount"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"list"}),": [\n    {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeCount"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"writer"}),": {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nickname"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"닉네임"'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"image"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"string"'}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"content"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 내용입니다."'}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 제목입니다."'}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n    },\n  ],\n};\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"수정이지롱"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// '수정이지롱'으로 number에서 string으로 자료형 변경"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"코드가 짧으면 이런 실수를 피할 수 있지만 코드가 길어지면 휴먼 에러가 발생합니다."}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript는 타입을 지정하여 이 문제를 방지합니다."}),"\n",(0,sa.jsx)(e.p,{children:"fetch로 받아온 데이터의 타입을 미리 정의합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"content"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"image"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeCount"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"writer"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nickname"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  };\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"article"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2024-06-05T04:30:04.759Z"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeCount"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"writer"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nickname"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"닉네임"'}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"image"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"string"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"content"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 내용입니다."'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"게시글 제목입니다."'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n};\n\narticle.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"수정이지롱"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Type 'string' is not assignable to type 'number'."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript는 id가 number 타입인데 string을 할당했다는 에러를 표시합니다."}),"\n",(0,sa.jsx)(e.h3,{children:"문법 오류 설명"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [images, setImages] = useState<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),"[]>([]);\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleFileSelect"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (fileRef?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"files"})," == ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newFile = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"from"}),"(fileRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"files"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"file"}),") =>"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"URL"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createObjectURL"}),"(file),\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setImages"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevImages"}),") =>"]})," [...prevImages, newFile]);\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:'위 코드는 input type="file"을 useRef로 참조하여 파일을 받습니다.'}),"\n",(0,sa.jsx)(e.p,{children:"URL.createObjectURL(file)로 FakePath를 실제 URL로 변환합니다."}),"\n",(0,sa.jsx)(e.p,{children:"변환된 URL로 미리보기를 보여줍니다."}),"\n",(0,sa.jsx)(e.p,{children:"setImages에는 spread 연산자로 prevImages와 새로운 파일을 넣습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"문제점은 newFile도 spread로 분해해야 한다는 점입니다."})}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript 환경이었다면 오류 없이 넘어갔을 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript는 명확한 오류를 보여줍니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["Argument of type '(prevImages: string[]) => (string | string[])[]' is not assignable to parameter of type ",(0,sa.jsx)(e.code,{children:"'SetStateAction<string[]>'"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:"Type '(prevImages: string[]) => (string | string[])[]' is not assignable to type '(prevState: string[])=> string[]'."}),"\n",(0,sa.jsx)(e.p,{children:"Type '(string | string[])[]' is not assignable to type 'string[]'."}),"\n",(0,sa.jsx)(e.p,{children:"Type 'string | string[]' is not assignable to type 'string'."}),"\n",(0,sa.jsx)(e.p,{children:"Type 'string[]' is not assignable to type 'string'."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"오류 메시지가 길지만 내용은 간단합니다."}),"\n",(0,sa.jsxs)(e.p,{children:["(string | string[])[] 타입을 넣었지만 ",(0,sa.jsx)(e.code,{children:"setStateAction<string[]>"}),"와 맞지 않습니다."]}),"\n",(0,sa.jsx)(e.p,{children:"(string[])[] 부분이 잘못되었음을 알 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleFileSelect"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (fileRef?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"files"})," == ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newFile = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"from"}),"(fileRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"files"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"v"}),") =>"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"URL"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createObjectURL"}),"(v),\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setImages"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prevImages"}),") =>"]})," [...prevImages, ...newFile]);\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위와 같이 수정하면 해결할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"TypeScript를 사용하면서 문법적 자유로움이 항상 좋은 것은 아님을 알았습니다."}),"\n",(0,sa.jsx)(e.p,{children:"타입 지정, 인터페이스 상속, Key 타입 설정 등은 초반에 시간이 걸립니다."}),"\n",(0,sa.jsx)(e.p,{children:"하지만 한번 타입을 지정하면 휴먼 에러를 미리 방지할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript 생태계는 TypeScript를 통해 스크립트 언어의 단점을 상당 부분 극복했습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"잘못된 정보가 있거나 추가할 내용이 있다면 댓글로 알려주세요."}),"\n",(0,sa.jsx)(e.p,{children:"감사합니다."}),"\n"]})]})}function sQ(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(sG,{...s})}):sG(s)}function s$(s){let e={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)("img",{src:"/images/2024-05-23/Pastedimage20240523085413.png",className:"full"}),"\n",(0,sa.jsx)(e.p,{children:"The above chart is the ranking of the most used web technologies provided by Stack Overflow in 2023."}),"\n",(0,sa.jsx)(e.p,{children:"React was adopted as the e-government framework standard and remains the most popular framework in 2024."}),"\n",(0,sa.jsx)(e.h2,{children:"Reasons Developers Prefer React"}),"\n",(0,sa.jsx)(e.h3,{children:"1. Explicit State Changes"}),"\n",(0,sa.jsx)(e.p,{children:"React only supports one-way binding."}),"\n",(0,sa.jsx)(e.p,{children:"Data flows in one direction only. (Angular supports two-way binding.)"}),"\n",(0,sa.jsx)(e.p,{children:"As scale increases, one-way binding, which makes it easier to track state changes, is advantageous."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:["	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"App"})," {\n		",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [name, setName] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"''"}),")\n	",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// The reason name changes is only when setName is called, so if name changes, you only need to look at the setName logic."}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"onChange"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"e"}),"){\n			",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setName"}),"(e.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"target"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"value"}),")\n		}\n\n		",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{name}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onChange"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{onChange}/"}),">"]})}),"\n	}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"2. JSX (JavaScript XML)"}),"\n",(0,sa.jsx)(e.p,{children:"This is React-specific syntax that combines HTML with JavaScript syntax."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:["{\n  condition ? ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"Renders only when condition is true.",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]})]})," : ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"3. Low Learning Curve"}),"\n",(0,sa.jsx)(e.p,{children:"The syntax is concise, making it good for beginners. (Performance optimization is difficult.)"}),"\n",(0,sa.jsx)(e.h3,{children:"4. Strong Community and Meta Support"}),"\n",(0,sa.jsx)(e.p,{children:"React started as a UI library and was designed to allow free expansion of the rest."}),"\n",(0,sa.jsx)(e.p,{children:"The community grew and various libraries were created."}),"\n",(0,sa.jsx)(e.p,{children:"Since Meta is the main sponsor, continuous development is guaranteed."}),"\n",(0,sa.jsx)(e.h2,{children:"History of React"}),"\n",(0,sa.jsx)(e.h3,{children:"2010 React Release"}),"\n",(0,sa.jsx)(e.p,{children:"At the time in 2010, the web development method was to generate HTML on the server and provide it to the client."}),"\n",(0,sa.jsx)(e.p,{children:"The server dynamically generated content, and the browser downloaded and rendered it."}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript only played a supplementary role like form handling."}),"\n",(0,sa.jsx)(e.h4,{children:"Browser Role Expansion"}),"\n",(0,sa.jsx)(e.p,{children:"Browsers began to support various features such as jQuery, local storage, WebSocket, Canvas, SVG, Geolocation, etc."}),"\n",(0,sa.jsx)(e.p,{children:"As DOM interaction and client data loading features like Ajax were added, JavaScript became complex."}),"\n",(0,sa.jsx)(e.p,{children:"Frameworks like AngularJS and Backbone.js emerged."}),"\n",(0,sa.jsx)(e.p,{children:"These are systematized with MVVM (Model-View-ViewModel) and MVC (Model-View-Controller) patterns."}),"\n",(0,sa.jsx)(e.h4,{children:"Facebook's Challenge"}),"\n",(0,sa.jsx)(e.p,{children:"Facebook achieved great success and needed to reduce browser burden."}),"\n",(0,sa.jsx)(e.p,{children:"The challenge was to reduce JavaScript bundle size to reduce download, parsing, and execution burden."}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-23/Pastedimage20240523104931.png",className:"full"}),"\n",(0,sa.jsx)(e.p,{children:"The above is a Facebook page from 2011."}),"\n",(0,sa.jsx)(e.p,{children:"Many features are included on one page."}),"\n",(0,sa.jsx)(e.p,{children:"Receiving the entire page from the server every time data changes would be a huge burden on the browser."}),"\n",(0,sa.jsx)(e.p,{children:"With many elements that change data in real-time, refreshing the entire page would have had the worst UX."}),"\n",(0,sa.jsx)(e.h5,{children:"Spartan Project"}),"\n",(0,sa.jsx)(e.p,{children:"It was promoted to create a Facebook for Safari (web) in response to Apple's app regulations."}),"\n",(0,sa.jsx)(e.p,{children:"HTML5-based hybrid apps could not replace native apps with the technology at the time."}),"\n",(0,sa.jsx)(e.p,{children:"The original purpose failed, but it is being revived in forms like Flutter and React Native."}),"\n",(0,sa.jsx)(e.h5,{children:"Emergence of BoltJS"}),"\n",(0,sa.jsx)(e.p,{children:"It was created by Facebook but was not used in practice."}),"\n",(0,sa.jsx)(e.p,{children:"It developed into a new version oriented toward functional programming, becoming the origin of React."}),"\n",(0,sa.jsx)(e.p,{children:"It developed into a one-way method where the view changes when the model changes."}),"\n",(0,sa.jsx)(e.p,{children:"It proposed a method of discarding the previous DOM and newly rendering when the view changes."}),"\n",(0,sa.jsx)(e.p,{children:"The React project started with this proposal."}),"\n",(0,sa.jsx)(e.h4,{children:"React Release"}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-23/Pastedimage20240523110538.png",className:"full"}),"\n",(0,sa.jsxs)(e.p,{children:["Creating the ",(0,sa.jsx)(e.code,{children:"UFI"})," above was React's first project."]}),"\n",(0,sa.jsx)(e.p,{children:"Various features such as share, like, and comments were needed."}),"\n",(0,sa.jsx)(e.p,{children:"JSX and the Flux pattern emerged here."}),"\n",(0,sa.jsx)(e.p,{children:"After acquiring Instagram, the Instagram web version was also made with React."}),"\n",(0,sa.jsx)(e.p,{children:"It was released as open source at JSConf US."}),"\n",(0,sa.jsx)(e.h4,{children:"Skeptical Views"}),"\n",(0,sa.jsx)(e.p,{children:"There were negative opinions about JSX syntax where HTML and JavaScript are mixed."}),"\n",(0,sa.jsx)(e.p,{children:"The logic was that it violated the separation of concerns principle."}),"\n",(0,sa.jsx)(e.p,{children:"However, this was a misunderstanding since React separates concerns based on components."}),"\n",(0,sa.jsx)(e.h4,{children:"Companies' Choices"}),"\n",(0,sa.jsx)(e.p,{children:"The performance benefits of component-based reuse and partial rendering became known."}),"\n",(0,sa.jsx)(e.p,{children:"A community was created and libraries for state management, routers, server-side rendering, etc. were made."}),"\n",(0,sa.jsx)(e.p,{children:"Yahoo! Mail, Netflix, etc. chose React."}),"\n",(0,sa.jsx)(e.p,{children:"Netflix confirmed the advantages through testing before renovating the site with React."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"JavaScript code size reduction: Instead of controllers, UI could be implemented declaratively based on state."}),"\n",(0,sa.jsx)(e.li,{children:"Gentle learning curve: Similar to JavaScript and HTML syntax."}),"\n",(0,sa.jsx)(e.li,{children:"Fast feature addition: Feature addition and builds were faster than existing Java-based apps."}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"Various Libraries"}),"\n",(0,sa.jsx)(e.p,{children:"Since React does not aim to be a web development framework, it is used with various libraries."}),"\n",(0,sa.jsx)(e.p,{children:"State Management: Redux, Zustand, Recoil, Jotai"}),"\n",(0,sa.jsx)(e.p,{children:"SSR: Next.js, Remix, Hydrogen"}),"\n",(0,sa.jsx)(e.p,{children:"Animation: Framer Motion, react-spring, React Move"}),"\n",(0,sa.jsx)(e.p,{children:"Charts: Recharts, visx, nivo"}),"\n",(0,sa.jsx)(e.p,{children:"Forms: React Hook Form, Formik, React Final Form"}),"\n",(0,sa.jsx)(e.h4,{children:"Direction of React"}),"\n",(0,sa.jsx)(e.p,{children:"Utilizing React on the server is the current development direction."}),"\n",(0,sa.jsx)(e.p,{children:"Server components have emerged, and simple APIs can now be created in Next.js."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"If there is incorrect content, please let me know in the comments. Thank you."}),"\n"]})]})}function sY(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(s$,{...s})}):s$(s)}function sK(s){let e={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)("img",{src:"/images/2024-05-23/Pastedimage20240523085413.png",className:"full"}),"\n",(0,sa.jsx)(e.p,{children:"위 차트는 2023년 Stack Overflow에서 제공한 가장 많이 사용되는 웹 기술 순위입니다."}),"\n",(0,sa.jsx)(e.p,{children:"React는 전자정부 프레임워크 표준으로 채택되었으며 2024년에도 가장 인기 있는 프레임워크입니다."}),"\n",(0,sa.jsx)(e.h2,{children:"개발자들이 리액트를 선호하는 이유들"}),"\n",(0,sa.jsx)(e.h3,{children:"1. 명시적 상태 변경"}),"\n",(0,sa.jsx)(e.p,{children:"React는 단방향 바인딩만 지원합니다."}),"\n",(0,sa.jsx)(e.p,{children:"데이터가 한쪽으로만 흐릅니다. (Angular는 양방향 바인딩을 지원합니다.)"}),"\n",(0,sa.jsx)(e.p,{children:"규모가 커질수록 상태 변화를 추적하기 쉬운 단방향 바인딩이 유리합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:["	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"App"})," {\n		",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [name, setName] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"''"}),")\n	",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// name이 변경되는 이유는 setName이 호출될 때 뿐이기 때문에 name이 바뀌면 setName 로직만 들여다 보면 된다."}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"onChange"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"e"}),"){\n			",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setName"}),"(e.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"target"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"value"}),")\n		}\n\n		",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{name}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onChange"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{onChange}/"}),">"]})}),"\n	}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"2. JSX (JavaScript XML)"}),"\n",(0,sa.jsx)(e.p,{children:"HTML에 JavaScript 문법을 결합한 React 전용 문법입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:["{\n  condition ? ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"condition이 true일때만 렌더링.",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]})]})," : ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"3. 낮은 러닝 커브"}),"\n",(0,sa.jsx)(e.p,{children:"문법이 간결하여 입문하기 좋습니다. (성능 최적화는 어려운 편입니다.)"}),"\n",(0,sa.jsx)(e.h3,{children:"4. 강력한 커뮤니티와 Meta의 지원"}),"\n",(0,sa.jsx)(e.p,{children:"React는 UI 라이브러리로 시작하여 나머지 부분을 자유롭게 확장할 수 있도록 설계되었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"커뮤니티가 성장하여 다양한 라이브러리가 만들어졌습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Meta가 메인 스폰서이므로 지속적인 발전이 보장됩니다."}),"\n",(0,sa.jsx)(e.h2,{children:"리액트의 역사"}),"\n",(0,sa.jsx)(e.h3,{children:"2010 React 출시"}),"\n",(0,sa.jsx)(e.p,{children:"2010년 당시 웹 개발 방식은 서버에서 HTML을 생성하여 클라이언트에 제공하는 것이었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"서버에서 콘텐츠를 동적으로 생성하고, 브라우저는 다운로드하여 렌더링했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript는 form 처리 같은 부수적인 역할만 했습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"브라우저 역할 확대"}),"\n",(0,sa.jsx)(e.p,{children:"브라우저가 jQuery, 로컬 스토리지, WebSocket, Canvas, SVG, Geolocation 등 다양한 기능을 지원하기 시작했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"DOM 인터랙션과 Ajax 같은 클라이언트 데이터 로딩 기능이 추가되면서 JavaScript가 복잡해졌습니다."}),"\n",(0,sa.jsx)(e.p,{children:"AngularJS나 Backbone.js 같은 프레임워크가 등장했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"이들은 MVVM(Model-View-ViewModel)과 MVC(Model-View-Controller) 패턴으로 체계화되어 있습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"Facebook의 과제"}),"\n",(0,sa.jsx)(e.p,{children:"Facebook은 큰 성공을 거두면서 브라우저 부담을 줄여야 했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript 번들 크기를 줄여 다운로드, 파싱, 실행 부담을 줄이는 것이 과제였습니다."}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-23/Pastedimage20240523104931.png",className:"full"}),"\n",(0,sa.jsx)(e.p,{children:"위는 2011년 Facebook 페이지입니다."}),"\n",(0,sa.jsx)(e.p,{children:"한 페이지에 많은 기능이 들어가 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"데이터가 바뀔 때마다 서버에서 페이지 전체를 받아오면 브라우저에 큰 부담이 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"실시간으로 데이터가 바뀌는 요소가 많아 전체 페이지를 새로고침하는 방식은 UX가 최악이었을 것입니다."}),"\n",(0,sa.jsx)(e.h5,{children:"Spartan 프로젝트"}),"\n",(0,sa.jsx)(e.p,{children:"Apple의 앱 규제에 반발하여 Safari(웹)용 Facebook을 만들기 위해 추진되었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"HTML5 기반 하이브리드 앱은 당시 기술력으로 네이티브 앱을 대체할 수 없었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"본래 취지는 실패했지만 Flutter나 React Native 형태로 다시 부활하고 있습니다."}),"\n",(0,sa.jsx)(e.h5,{children:"BoltJS의 등장"}),"\n",(0,sa.jsx)(e.p,{children:"Facebook에서 만들었지만 실무에서 사용되지 않았습니다."}),"\n",(0,sa.jsx)(e.p,{children:"함수형을 지향하는 새로운 버전으로 발전하여 React의 시초가 되었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"모델이 변경되면 뷰를 변경하는 단방향 방식으로 발전했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"뷰가 변경될 때 이전 DOM을 버리고 새롭게 렌더링하는 방식을 제안했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"이 제안으로 React 프로젝트가 시작되었습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"React 출시"}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-23/Pastedimage20240523110538.png",className:"full"}),"\n",(0,sa.jsxs)(e.p,{children:["위의 ",(0,sa.jsx)(e.code,{children:"UFI"})," 를 만드는 것이 React의 첫 프로젝트였습니다."]}),"\n",(0,sa.jsx)(e.p,{children:"공유, 좋아요, 댓글 등 여러 기능이 필요했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"JSX와 Flux 패턴이 여기서 등장했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Instagram 인수 후 Instagram 웹 버전도 React로 만들었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"JSConf US에서 오픈소스로 공개되었습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"회의적인 시각"}),"\n",(0,sa.jsx)(e.p,{children:"HTML과 JavaScript가 섞이는 JSX 구문에 부정적인 의견이 있었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"관심사 분리 원칙을 위배한다는 논리였습니다."}),"\n",(0,sa.jsx)(e.p,{children:"하지만 React는 컴포넌트 기반으로 관심사를 분리하므로 오해였습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"기업들의 선택"}),"\n",(0,sa.jsx)(e.p,{children:"컴포넌트 기반 재사용과 부분 렌더링의 성능 이점이 알려졌습니다."}),"\n",(0,sa.jsx)(e.p,{children:"커뮤니티가 생성되고 상태 관리, 라우터, 서버 사이드 렌더링 등 라이브러리가 만들어졌습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Yahoo! 메일, Netflix 등이 React를 선택했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Netflix는 React로 사이트를 리뉴얼하기 전 테스트를 통해 장점을 확인했습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"JavaScript 코드 크기 감소: 컨트롤러 대신 선언적으로 상태에 따른 UI를 구현할 수 있었습니다."}),"\n",(0,sa.jsx)(e.li,{children:"완만한 러닝 커브: JavaScript와 HTML 문법과 유사합니다."}),"\n",(0,sa.jsx)(e.li,{children:"빠른 기능 추가: 기존 Java 기반 앱보다 기능 추가와 빌드가 빨랐습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"다양한 라이브러리"}),"\n",(0,sa.jsx)(e.p,{children:"React는 웹 개발 프레임워크를 지향하지 않으므로 다양한 라이브러리와 함께 사용됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"상태 관리: Redux, Zustand, Recoil, Jotai"}),"\n",(0,sa.jsx)(e.p,{children:"SSR: Next.js, Remix, Hydrogen"}),"\n",(0,sa.jsx)(e.p,{children:"애니메이션: Framer Motion, react-spring, React Move"}),"\n",(0,sa.jsx)(e.p,{children:"차트: Recharts, visx, nivo"}),"\n",(0,sa.jsx)(e.p,{children:"폼: React Hook Form, Formik, React Final Form"}),"\n",(0,sa.jsx)(e.h4,{children:"React의 방향"}),"\n",(0,sa.jsx)(e.p,{children:"서버에서 React를 활용하는 것이 현재 개발 방향입니다."}),"\n",(0,sa.jsx)(e.p,{children:"서버 컴포넌트가 등장했고 간단한 API는 Next.js에서 만들 수 있게 되었습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"잘못된 내용이 있다면 댓글로 알려주세요. 감사합니다."}),"\n"]})]})}function sX(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(sK,{...s})}):sK(s)}function sZ(s){let e={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"React is a Library"}),"\n",(0,sa.jsx)(e.p,{children:"The React official documentation has the following statement."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"The library for web and native user interfaces"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"React is a library for web and UI, not a framework."}),"\n",(0,sa.jsx)(e.h3,{children:"Difference Between Library and Framework"}),"\n",(0,sa.jsx)(e.p,{children:"Library: Performs specific, well-defined series of tasks. When you call a method, you gain control."}),"\n",(0,sa.jsx)(e.p,{children:"Framework: The application fills in the skeleton to define the work content. The framework calls us."}),"\n",(0,sa.jsx)(e.p,{children:"React has complex internal logic such as optimizing re-rendering using React Fiber Architecture."}),"\n",(0,sa.jsx)(e.p,{children:"But ultimately, it's a library to help with UI."}),"\n",(0,sa.jsx)(e.p,{children:"It has high freedom, allowing various packages to be used to add features like routing."}),"\n",(0,sa.jsx)(e.p,{children:"However, as web technology becomes complex, a standardized framework was needed."}),"\n",(0,sa.jsx)(e.p,{children:"Next.js, a framework utilizing React, emerged to meet this demand."}),"\n",(0,sa.jsx)(e.h2,{children:"Next.js"}),"\n",(0,sa.jsx)(e.p,{children:"The Next.js official documentation has the following statement."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"The React Frame Work for the Web"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"It has various features such as metadata insertion using next/head, routing using app router and pages router, lazy loading of Image components, etc."}),"\n",(0,sa.jsx)(e.p,{children:"The biggest characteristic of Next.js is its rendering method."}),"\n",(0,sa.jsx)(e.h3,{children:"SSR"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Server-Side-Rendering"})}),"\n",(0,sa.jsx)(e.p,{children:"Generates HTML pages on the server for every request."}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-31/Pasted%20image%2020240530181448.png",className:"full",alt:"ssr image"}),"\n",(0,sa.jsxs)(e.p,{children:["It is implemented with the ",(0,sa.jsx)(e.code,{children:"getServerSideProps"})," function in Next.js."]}),"\n",(0,sa.jsx)(e.p,{children:"The function runs on the server for every request."}),"\n",(0,sa.jsx)(e.p,{children:"The process of applying the remaining JavaScript on the client is called hydration."}),"\n",(0,sa.jsx)(e.p,{children:"It's useful when pre-rendering frequently updated data."}),"\n",(0,sa.jsx)(e.h4,{children:"Advantages"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"Initial Screen Loading"})," - Faster initial screen loading than CSR, which sends empty HTML first and fills content with JavaScript."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"SEO"})," - Content is included in the first rendering HTML, which is advantageous for SEO."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"Reduced Device Burden"})," - Since pre-rendered HTML is received, there's no burden even on low-spec devices."]}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"Limitations"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"Server Overload"})," - Since HTML content is generated on the server, server overload may occur."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"Full Page Reload"})," - When interactions requiring server processing occur, the entire page reloads."]}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"Example"}),"\n",(0,sa.jsx)(e.h3,{children:"SSG"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Static Site Generation"})}),"\n",(0,sa.jsx)(e.p,{children:"The server generates HTML at build time and reuses it for all requests."}),"\n",(0,sa.jsx)(e.p,{children:"If data is not fetched, Next.js automatically uses the SSG method."}),"\n",(0,sa.jsx)(e.p,{children:"The Next.js official documentation presents two usage scenarios."}),"\n",(0,sa.jsx)(e.h4,{children:"When content depends on external data (getStaticProps)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Blog"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ posts }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Render posts..."}),"\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// This function gets called at build time"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getStaticProps"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Call an external API endpoint to get posts"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://.../posts"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," posts = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," res.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// By returning { props: { posts } }, the Blog component"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// will receive `posts` as a prop at build time"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"props"}),": {\n      posts,\n    },\n  };\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Fetch data inside getStaticProps and pass it as posts prop at build time."}),"\n",(0,sa.jsx)(e.h4,{children:"When paths depend on external data (getStaticPaths, getStaticProps)"}),"\n",(0,sa.jsx)(e.p,{children:"This is the case using Next.js Dynamic Routes."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// This function gets called at build time"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getStaticPaths"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Call an external API endpoint to get posts"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://.../posts"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," posts = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," res.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get the paths we want to pre-render based on posts"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," paths = posts.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"post"}),") =>"]})," ({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"params"}),": { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": post.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," },\n  }));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// We'll pre-render only these paths at build time."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// { fallback: false } means other routes should 404."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { paths, ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"})," };\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["When Dynamic Routes are configured in the form of ",(0,sa.jsx)(e.code,{children:"pages/posts/[id].js"}),", fetch all data that will go into id."]}),"\n",(0,sa.jsx)(e.p,{children:"It's stored in params in key-value format."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Post"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ post }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Render post..."}),"\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getStaticPaths"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// This also gets called at build time"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getStaticProps"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ params }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// params contains the post `id`."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If the route is like /posts/1, then params.id is 1"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://.../posts/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${params.id}"}),"`"]}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," post = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," res.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Pass post data to the page via props"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"props"}),": { post } };\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["Data becomes an argument of ",(0,sa.jsx)(e.code,{children:"getStaticProps"})," and is used for static page optimization."]}),"\n",(0,sa.jsx)(e.p,{children:"getStaticProps runs on the server, so CORS issues don't occur."}),"\n",(0,sa.jsx)(e.h4,{children:"Example"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," getStaticProps = (",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (context) => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," likeRes = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${BASE_URL}"}),"/articles?pageSize=3&&orderBy=like`"]}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeData"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ArticleData"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," likeRes.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," likeList = likeData.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"list"})," ?? [];\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"props"}),": { likeList } };\n}) ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"satisfies"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetStaticProps"}),"<{\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeList"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"}),"[] | [];\n}>;\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This is part of the code used in the project."}),"\n",(0,sa.jsx)(e.p,{children:"It was a task to display 3 Best posts on the screen."}),"\n",(0,sa.jsx)(e.p,{children:"Since there was no need to dynamically change data, we optimized rendering using SSG."}),"\n",(0,sa.jsx)(e.h3,{children:"ISR"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Incremental Static Regeneration"})}),"\n",(0,sa.jsx)(e.p,{children:"This is a method of generating or updating static pages even after the site is built."}),"\n",(0,sa.jsx)(e.p,{children:"You can use static generation per page without needing to rebuild the entire site."}),"\n",(0,sa.jsxs)(e.p,{children:["You can use it by adding revalidate props to ",(0,sa.jsx)(e.code,{children:"getStaticProps"}),"."]}),"\n",(0,sa.jsx)(e.h2,{children:"Reference"}),"\n",(0,sa.jsx)("a",{href:"https://react.dev/",children:"React Official Documentation"}),"\n",(0,sa.jsx)("a",{href:"https://www.geeksforgeeks.org/software-framework-vs-library/",children:(0,sa.jsx)(e.p,{children:"geeksforgeeks"})}),"\n",(0,sa.jsx)("a",{href:"https://nextjs.org/",children:"Next Official Documentation"}),"\n",(0,sa.jsx)(e.p,{children:"Modern React Deep dive - 김용찬"}),"\n",(0,sa.jsx)(e.p,{children:"Next.js 웹사이트 만들기 - 코드잇"}),"\n",(0,sa.jsx)("a",{href:"https://www.devlane.com/blog/what-is-server-side-rendering-in-next-js-pros-and-cons",children:(0,sa.jsx)(e.p,{children:"Devlane Blog"})}),"\n",(0,sa.jsx)("a",{href:"https://dev.to/haszankauna/understanding-server-side-rendering-ssr-vs-client-side-rendering-csr-8gi#:~:text=Cons%20of%20SSR%3A,trigger%20a%20full%20page%20reload.",children:(0,sa.jsx)(e.p,{children:"haszankauna Post"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"If there is incorrect content, please let me know in the comments. Thank you."}),"\n"]})]})}function s0(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(sZ,{...s})}):sZ(s)}function s2(s){let e={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"React는 라이브러리입니다"}),"\n",(0,sa.jsx)(e.p,{children:"React 공식 문서에는 다음과 같은 문장이 있습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"The library for web and native user interfaces"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"React는 웹과 UI를 위한 라이브러리이지 프레임워크가 아닙니다."}),"\n",(0,sa.jsx)(e.h3,{children:"Library와 Framework의 차이"}),"\n",(0,sa.jsx)(e.p,{children:"Library : 구체적이고 잘 정의된 일련의 작업 수행, 메서드를 호출하면 제어권을 갖게 된다."}),"\n",(0,sa.jsx)(e.p,{children:"Framework : 애플리케이션이 스켈레톤을 채워 작업 내용을 정의, 프레임워크가 우리를 호출한다."}),"\n",(0,sa.jsx)(e.p,{children:"React Fiber Architecture를 이용해 리렌더링을 최적화하는 등 복잡한 내부 로직을 가지고 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"하지만 결국 UI를 돕기 위한 라이브러리입니다."}),"\n",(0,sa.jsx)(e.p,{children:"자유도가 높아 다양한 패키지를 사용해 라우팅 같은 기능을 추가할 수 있었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"하지만 복잡해지는 웹 기술에서는 정형화된 프레임워크가 필요했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"이런 요구에 맞춰 React를 활용한 프레임워크 Next.js가 등장했습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"Next.js"}),"\n",(0,sa.jsx)(e.p,{children:"Next.js 공식 문서에는 다음 문구가 있습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"The React Frame Work for the Web"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"next/head를 이용한 메타데이터 삽입, app router와 pages router를 이용한 라우팅, Image 컴포넌트의 lazy loading 등 다양한 기능이 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Next.js의 가장 큰 특징은 렌더링 방식입니다."}),"\n",(0,sa.jsx)(e.h3,{children:"SSR"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Server-Side-Rendering"})}),"\n",(0,sa.jsx)(e.p,{children:"모든 요청마다 서버에서 HTML 페이지를 생성합니다."}),"\n",(0,sa.jsx)("img",{src:"/images/2024-05-31/Pasted%20image%2020240530181448.png",className:"full",alt:"ssr image"}),"\n",(0,sa.jsxs)(e.p,{children:["Next.js에서 ",(0,sa.jsx)(e.code,{children:"getServerSideProps"})," 함수로 구현됩니다."]}),"\n",(0,sa.jsx)(e.p,{children:"모든 요청마다 서버에서 해당 함수가 실행됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"클라이언트에서 나머지 JavaScript를 적용하는 과정을 hydration이라고 합니다."}),"\n",(0,sa.jsx)(e.p,{children:"자주 업데이트되는 데이터를 pre-render할 때 유용합니다."}),"\n",(0,sa.jsx)(e.h4,{children:"장점"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"초기 화면 로딩"})," - 빈 HTML을 먼저 보내고 JavaScript로 컨텐츠를 채우는 CSR보다 초기 화면 로딩이 빠릅니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"SEO"})," - 첫 렌더링 HTML에 컨텐츠가 포함되어 SEO에 유리합니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"장치 부담 감소"})," - pre-rendering된 HTML을 받으므로 저사양 장치에서도 부담이 없습니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"한계"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"서버 과부하"})," - 서버에서 HTML 컨텐츠를 생성하므로 서버 과부하가 발생할 수 있습니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"전체 페이지 리로딩"})," - 서버 처리가 필요한 상호작용이 발생하면 전체 페이지가 리로딩됩니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"예시"}),"\n",(0,sa.jsx)(e.h3,{children:"SSG"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Static Site Generation"})}),"\n",(0,sa.jsx)(e.p,{children:"빌드 시간에 서버가 HTML을 생성하고 모든 요청에서 재사용합니다."}),"\n",(0,sa.jsx)(e.p,{children:"데이터를 fetching하지 않으면 Next.js는 자동으로 SSG 방식을 사용합니다."}),"\n",(0,sa.jsx)(e.p,{children:"Next.js 공식 문서는 두 가지 사용 상황을 제시합니다."}),"\n",(0,sa.jsx)(e.h4,{children:"content가 외부 데이터에 의존하는 경우 ( getStaticProps )"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Blog"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ posts }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Render posts..."}),"\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// This function gets called at build time"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getStaticProps"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Call an external API endpoint to get posts"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://.../posts"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," posts = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," res.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// By returning { props: { posts } }, the Blog component"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// will receive `posts` as a prop at build time"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"props"}),": {\n      posts,\n    },\n  };\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"getStaticProps 안에서 fetch로 데이터를 가져와 빌드 타임에 posts prop으로 전달합니다."}),"\n",(0,sa.jsx)(e.h4,{children:"paths가 외부 데이터에 의존하는 경우 (getStaticPaths, getStaticProps)"}),"\n",(0,sa.jsx)(e.p,{children:"Next.js의 Dynamic Routes를 이용한 경우입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// This function gets called at build time"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getStaticPaths"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Call an external API endpoint to get posts"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://.../posts"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," posts = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," res.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get the paths we want to pre-render based on posts"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," paths = posts.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"post"}),") =>"]})," ({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"params"}),": { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": post.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," },\n  }));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// We'll pre-render only these paths at build time."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// { fallback: false } means other routes should 404."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { paths, ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"})," };\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"pages/posts/[id].js"})," 형태로 Dynamic Routes를 구성한 경우 fetch로 id에 들어갈 전체 데이터를 가져옵니다."]}),"\n",(0,sa.jsx)(e.p,{children:"params에 key-value 형태로 저장됩니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Post"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ post }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Render post..."}),"\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getStaticPaths"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// This also gets called at build time"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getStaticProps"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ params }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// params contains the post `id`."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If the route is like /posts/1, then params.id is 1"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://.../posts/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${params.id}"}),"`"]}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," post = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," res.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Pass post data to the page via props"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"props"}),": { post } };\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["데이터는 ",(0,sa.jsx)(e.code,{children:"getStaticProps"}),"의 인자가 되어 정적 페이지 최적화에 사용됩니다."]}),"\n",(0,sa.jsx)(e.p,{children:"getStaticProps는 서버에서 실행되므로 CORS 문제가 발생하지 않습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"예시"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," getStaticProps = (",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (context) => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," likeRes = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${BASE_URL}"}),"/articles?pageSize=3&&orderBy=like`"]}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeData"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ArticleData"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," likeRes.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," likeList = likeData.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"list"})," ?? [];\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"props"}),": { likeList } };\n}) ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"satisfies"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetStaticProps"}),"<{\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeList"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Article"}),"[] | [];\n}>;\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"프로젝트에서 사용했던 코드의 일부입니다."}),"\n",(0,sa.jsx)(e.p,{children:"Best 게시물 3개를 화면에 표시하는 작업이었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"데이터를 유동적으로 변경할 필요가 없어 SSG를 사용하여 렌더링을 최적화했습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"ISR"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Incremental Static Regeneration"})}),"\n",(0,sa.jsx)(e.p,{children:"사이트 구축 후에도 정적 페이지를 생성하거나 업데이트하는 방식입니다."}),"\n",(0,sa.jsx)(e.p,{children:"전체 사이트를 재구축할 필요 없이 페이지별로 정적 생성을 사용할 수 있습니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"getStaticProps"}),"에 revalidate props를 추가하면 사용할 수 있습니다."]}),"\n",(0,sa.jsx)(e.h2,{children:"Reference"}),"\n",(0,sa.jsx)("a",{href:"https://react.dev/",children:"React 공식문서"}),"\n",(0,sa.jsx)("a",{href:"https://www.geeksforgeeks.org/software-framework-vs-library/",children:(0,sa.jsx)(e.p,{children:"geeksforgeeks"})}),"\n",(0,sa.jsx)("a",{href:"https://nextjs.org/",children:"Next 공식문서"}),"\n",(0,sa.jsx)(e.p,{children:"Modern React Deep dive - 김용찬"}),"\n",(0,sa.jsx)(e.p,{children:"Next.js 웹사이트 만들기 - 코드잇"}),"\n",(0,sa.jsx)("a",{href:"https://www.devlane.com/blog/what-is-server-side-rendering-in-next-js-pros-and-cons",children:(0,sa.jsx)(e.p,{children:"Devlane Blog"})}),"\n",(0,sa.jsx)("a",{href:"https://dev.to/haszankauna/understanding-server-side-rendering-ssr-vs-client-side-rendering-csr-8gi#:~:text=Cons%20of%20SSR%3A,trigger%20a%20full%20page%20reload.",children:(0,sa.jsx)(e.p,{children:"haszankauna Post"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"잘못된 내용이 있다면 댓글로 알려주세요. 감사합니다."}),"\n"]})]})}function s1(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(s2,{...s})}):s2(s)}function s4(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"Experience Understanding Library Internals"}),"\n",(0,sa.jsx)(e.h2,{children:"Importance of Convenience and Understanding"}),"\n",(0,sa.jsx)(e.p,{children:"Just because libraries are made for developer convenience doesn't mean you don't need to understand their internal operations."}),"\n",(0,sa.jsx)(e.p,{children:"I've done work like directly implementing infinite scroll with Intersection Observer API, but the importance didn't hit me."}),"\n",(0,sa.jsx)(e.p,{children:"While learning Next.js, I realized that understanding library internals is essential."}),"\n",(0,sa.jsx)(e.h2,{children:"Background"}),"\n",(0,sa.jsx)(e.p,{children:"I tried to load data responsively using JavaScript."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"npm install react-responsive --save"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"I created a custom hook using react-responsive."}),"\n",(0,sa.jsxs)(e.p,{children:["I tried to make it easy to use by separating it into ",(0,sa.jsx)(e.code,{children:"{isMobile, isTablet, isDesktop}"})," format."]}),"\n",(0,sa.jsx)(e.p,{children:"An error occurred."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"Error: Hydration failed because the initial UI does not match what was rendered on the server."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"I encountered a hydration error common in Next.js."}),"\n",(0,sa.jsx)(e.h2,{children:"Resolution Process"}),"\n",(0,sa.jsx)(e.h3,{children:"Cause"}),"\n",(0,sa.jsx)(e.p,{children:"In SSR, the server sends HTML first when a user requests."}),"\n",(0,sa.jsx)(e.p,{children:"Interactive parts are excluded, and then interactivity is added with JavaScript bundles."}),"\n",(0,sa.jsx)(e.p,{children:"This process is called hydration, meaning to pour water."}),"\n",(0,sa.jsx)(e.p,{children:'The error means "the HTML generated on the server differs from the UI generated on the client."'}),"\n",(0,sa.jsx)(e.p,{children:"react-responsive uses window-related APIs internally to check size."}),"\n",(0,sa.jsx)(e.p,{children:"The server in a Node.js environment doesn't understand window APIs, so it generates initial HTML."}),"\n",(0,sa.jsx)(e.p,{children:"Afterward, the JavaScript bundle understands window APIs and generates different UI."}),"\n",(0,sa.jsx)(e.p,{children:"I decided to create a responsive custom hook myself, considering performance optimization."}),"\n",(0,sa.jsx)(e.h3,{children:"Solution"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { debounce } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./debounce"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useScreenDetector"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [screen, setScreen] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleWindowSizeChange"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerWidth"})," <= ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"744"}),")\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n      }));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerWidth"})," > ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1200"}),")\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n      }));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n      }));\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"resize"'}),", handleWindowSizeChange);\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"removeEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"resize"'}),", handleWindowSizeChange);\n    };\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," screen;\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"I wanted to maintain receiving it as an object."}),"\n",(0,sa.jsx)(e.p,{children:"I implemented it by making the object itself a state and checking innerWidth."}),"\n",(0,sa.jsx)(e.h4,{children:"Refactoring"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"debounce"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["func: () => ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"void"}),", wait: number"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"timeoutId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReturnType"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),">;\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"clearTimeout"}),"(timeoutId);\n    timeoutId = ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(func, wait);\n  };\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"I applied debounce to reduce overload from resize events."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { debounce } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./debounce"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useScreenDetector"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [screen, setScreen] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleWindowSizeChange"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerWidth"})," <= ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"744"}),")\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n      }));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerWidth"})," > ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1200"}),")\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n      }));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n      }));\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"resize"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"debounce"}),"(handleWindowSizeChange, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),"));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"removeEventListener"}),"(\n        ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"resize"'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"debounce"}),"(handleWindowSizeChange, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),"),\n      );\n    };\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," screen;\n};\n"]})}),"\n",(0,sa.jsx)(e.h2,{children:"Reflection"}),"\n",(0,sa.jsx)(e.p,{children:"I learned through experience that you shouldn't blindly trust libraries."}),"\n",(0,sa.jsx)(e.p,{children:"It was a good opportunity to study SSR in depth."}),"\n",(0,sa.jsx)(e.p,{children:"I should become a developer who can solve problems in various ways."}),"\n",(0,sa.jsx)(e.h1,{children:"Differences in Environment Variable Files"}),"\n",(0,sa.jsx)(e.h2,{children:"dotenv in JavaScript Environment"}),"\n",(0,sa.jsx)(e.p,{children:"In the JavaScript world, the dotenv library is often used to store environment variables."}),"\n",(0,sa.jsx)(e.p,{children:"dotenv is an environment variable used in Node.js environments."}),"\n",(0,sa.jsx)(e.p,{children:"The problem is that it cannot be used in browsers."}),"\n",(0,sa.jsx)(e.p,{children:"For example"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCommentWithId"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"cursor"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"try"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n      ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.BASE_URL}"}),"/articles/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${id}"}),"/comments?limit=10",(0,sa.jsxs)(e.span,{className:"hljs-subst",children:["${cursor !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," ? ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`&&cursor=",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${cursor}"}),"`"]})," : ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'""'}),"}"]}),"`"]}),",\n    );\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Comments"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," res.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," data;\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"catch"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"();\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"The above code works during SSR but can cause problems when CSR in the browser after rendering."}),"\n",(0,sa.jsx)(e.p,{children:"Next.js has separated environment variables."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/pages/building-your-application/configuring/environment-variables#bundling-environment-variables-for-the-browser",children:"https://nextjs.org/docs/pages/building-your-application/configuring/environment-variables#bundling-environment-variables-for-the-browser"})}),"\n",(0,sa.jsx)(e.p,{children:"Environment variables starting with NEXT_PUBLIC_ are included in the JavaScript bundle at build time."}),"\n",(0,sa.jsx)(e.p,{children:"They become accessible in the browser."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:["(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," () => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.NEXT_PUBLIC_BASE_URL}"}),"/articles/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${router.query.id}"}),"/comments?limit=10",(0,sa.jsxs)(e.span,{className:"hljs-subst",children:["${cursor !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," ? ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`&&cursor=",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${cursor}"}),"`"]})," : ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'""'}),"}"]}),"`"]}),",\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"comments"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Comments"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCommentList"}),"(comments.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"list"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCursor"}),"(comments.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextCursor"}),");\n})();\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!note] Added 2025-04-21"}),"\n",(0,sa.jsx)(e.p,{children:"If you specify NEXT_PUBLIC, the variable is included in the build file."}),"\n",(0,sa.jsx)(e.p,{children:"Important environment variables should not use NEXT_PUBLIC."}),"\n",(0,sa.jsx)(e.p,{children:"You can solve this by using the frontend server's environment variables."}),"\n",(0,sa.jsx)(e.p,{children:"process.env.~ is a server environment variable."}),"\n",(0,sa.jsx)(e.p,{children:"Functions used on the server side such as server components, server-side rendering (getServerSideProps), route handlers, etc. can access this environment variable."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"If there are any deficiencies, please let me know in the comments. Thank you."}),"\n"]})]})}function s5(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(s4,{...s})}):s4(s)}function s3(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"라이브러리 내부를 이해하는 경험"}),"\n",(0,sa.jsx)(e.h2,{children:"편의성과 이해의 중요성"}),"\n",(0,sa.jsx)(e.p,{children:"라이브러리가 개발자의 편의를 위해 만들어졌다고 해서 내부 동작을 이해하지 않아도 되는 것은 아닙니다."}),"\n",(0,sa.jsx)(e.p,{children:"인피니티 스크롤을 Intersection Observer API로 직접 구현해보는 등의 작업을 했지만 중요성이 와닿지 않았습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Next.js를 학습하면서 라이브러리 내부 이해가 필수임을 깨달았습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"배경"}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript를 이용해 반응형으로 데이터를 불러오려고 했습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"npm install react-responsive --save"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"react-responsive를 활용해서 사용자 지정 훅을 만들었습니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"{isMobile, isTablet, isDesktop}"})," 형식으로 분리하여 사용하기 쉽게 만들려고 했습니다."]}),"\n",(0,sa.jsx)(e.p,{children:"오류가 발생했습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"Error: Hydration failed because the initial UI does not match what was rendered on the server."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Next.js에서 자주 만나는 hydration 에러를 마주했습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"해결 과정"}),"\n",(0,sa.jsx)(e.h3,{children:"원인"}),"\n",(0,sa.jsx)(e.p,{children:"SSR 방식에서는 사용자 요청 시 서버에서 HTML을 먼저 전송합니다."}),"\n",(0,sa.jsx)(e.p,{children:"인터랙션 부분은 제외되고 이후 JavaScript 번들로 인터랙션을 추가합니다."}),"\n",(0,sa.jsx)(e.p,{children:"이 과정을 물을 뿌린다는 의미로 hydration이라고 합니다."}),"\n",(0,sa.jsx)(e.p,{children:'에러는 "서버에서 생성한 HTML과 클라이언트에서 생성한 UI가 다르다"는 의미입니다.'}),"\n",(0,sa.jsx)(e.p,{children:"react-responsive 내부에서 size를 확인하기 위해 window 관련 API를 사용했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Node.js 환경의 서버는 window API를 이해하지 못해 초기 HTML을 생성합니다."}),"\n",(0,sa.jsx)(e.p,{children:"이후 JavaScript 번들은 window API를 이해하여 다른 UI를 생성했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"성능 최적화까지 고려한 반응형 커스텀 훅을 직접 만들기로 했습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"해결"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { debounce } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./debounce"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useScreenDetector"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [screen, setScreen] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleWindowSizeChange"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerWidth"})," <= ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"744"}),")\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n      }));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerWidth"})," > ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1200"}),")\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n      }));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n      }));\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"resize"'}),", handleWindowSizeChange);\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"removeEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"resize"'}),", handleWindowSizeChange);\n    };\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," screen;\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"객체 방식으로 리턴받는 것을 유지하고 싶었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"객체 자체를 state로 만들어 innerWidth를 검사하는 방식으로 구현했습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"리팩토링"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"debounce"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["func: () => ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"void"}),", wait: number"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"timeoutId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReturnType"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),">;\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"clearTimeout"}),"(timeoutId);\n    timeoutId = ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(func, wait);\n  };\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"디바운스를 적용하여 resize 이벤트의 과부하를 줄였습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { debounce } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./debounce"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useScreenDetector"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [screen, setScreen] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleWindowSizeChange"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerWidth"})," <= ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"744"}),")\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n      }));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerWidth"})," > ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1200"}),")\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n      }));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setScreen"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"prev"}),") =>"]})," ({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isMobile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isTablet"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isDesktop"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n      }));\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"resize"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"debounce"}),"(handleWindowSizeChange, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),"));\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"removeEventListener"}),"(\n        ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"resize"'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"debounce"}),"(handleWindowSizeChange, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),"),\n      );\n    };\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," screen;\n};\n"]})}),"\n",(0,sa.jsx)(e.h2,{children:"느낀 점"}),"\n",(0,sa.jsx)(e.p,{children:"라이브러리를 맹신하면 안 된다는 것을 경험으로 배웠습니다."}),"\n",(0,sa.jsx)(e.p,{children:"SSR 방식을 깊이 공부하는 좋은 기회가 되었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"다양한 방식으로 문제를 해결할 수 있는 개발자가 되어야겠습니다."}),"\n",(0,sa.jsx)(e.h1,{children:"환경 변수 파일의 차이"}),"\n",(0,sa.jsx)(e.h2,{children:"JavaScript 환경에서 dotenv"}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript 진영에서는 dotenv 라이브러리로 환경 변수를 저장하는 경우가 많습니다."}),"\n",(0,sa.jsx)(e.p,{children:"dotenv는 Node.js 환경에서 사용하는 환경 변수입니다."}),"\n",(0,sa.jsx)(e.p,{children:"문제는 브라우저에서는 사용할 수 없다는 점입니다."}),"\n",(0,sa.jsx)(e.p,{children:"예를 들면"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCommentWithId"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"cursor"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"try"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n      ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.BASE_URL}"}),"/articles/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${id}"}),"/comments?limit=10",(0,sa.jsxs)(e.span,{className:"hljs-subst",children:["${cursor !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," ? ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`&&cursor=",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${cursor}"}),"`"]})," : ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'""'}),"}"]}),"`"]}),",\n    );\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Comments"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," res.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," data;\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"catch"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"();\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위 코드는 SSR 시에는 동작하지만 렌더링 이후 브라우저에서 CSR할 때 문제가 발생할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Next.js에서는 환경 변수를 분리했습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/pages/building-your-application/configuring/environment-variables#bundling-environment-variables-for-the-browser",children:"https://nextjs.org/docs/pages/building-your-application/configuring/environment-variables#bundling-environment-variables-for-the-browser"})}),"\n",(0,sa.jsx)(e.p,{children:"NEXT_PUBLIC_으로 시작하는 환경 변수를 사용하면 빌드 타임에 JavaScript 번들에 포함됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"브라우저에서 접근할 수 있게 됩니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:["(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," () => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.NEXT_PUBLIC_BASE_URL}"}),"/articles/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${router.query.id}"}),"/comments?limit=10",(0,sa.jsxs)(e.span,{className:"hljs-subst",children:["${cursor !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," ? ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`&&cursor=",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${cursor}"}),"`"]})," : ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'""'}),"}"]}),"`"]}),",\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"comments"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Comments"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCommentList"}),"(comments.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"list"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCursor"}),"(comments.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextCursor"}),");\n})();\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!note] 2025-04-21 추가"}),"\n",(0,sa.jsx)(e.p,{children:"NEXT_PUBLIC으로 지정하면 빌드 파일 내부에 해당 변수가 포함됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"중요한 환경 변수는 NEXT_PUBLIC으로 사용하면 안 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"프론트엔드 서버의 환경 변수를 사용하면 해결할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"process.env.~는 서버 환경 변수입니다."}),"\n",(0,sa.jsx)(e.p,{children:"서버 컴포넌트, 서버 사이드 렌더링(getServerSideProps), 라우트 핸들러 등 서버 단에서 사용되는 함수들은 해당 환경 변수에 접근할 수 있습니다."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"부족한 부분이 있다면 댓글로 알려주세요. 감사합니다."}),"\n"]})]})}function s6(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(s3,{...s})}):s3(s)}let s7=s=>{let{id:e,width:n="640",height:a="360"}=s;return(0,sa.jsx)("div",{children:(0,sa.jsx)("iframe",{title:"vimeo-".concat(e),src:"https://player.vimeo.com/video/".concat(e),width:n,height:a,allow:"autoplay; fullscreen",allowFullScreen:!0})})};function s8(s){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"React Development Tools"}),"\n",(0,sa.jsx)(e.p,{children:"react-dev-tools"}),"\n",(0,sa.jsx)(e.p,{children:"Development tools for React apps created by the React team."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610161243.png",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"Usage"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610161637.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"When you download React Developer Tools, two tabs are added."}),"\n",(0,sa.jsx)(e.p,{children:"Component and Profiler."}),"\n",(0,sa.jsx)(e.h3,{children:"Component"}),"\n",(0,sa.jsx)(e.p,{children:"The Component tab allows you to check the component tree of React apps."}),"\n",(0,sa.jsx)(e.p,{children:"You can check various information such as props, hooks, etc."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610161514.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Like developer tools, you can check component information when hovering."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610161856.png",alt:""})}),"\n",(0,sa.jsx)(e.h4,{children:"Component Tree"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610162302.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"React apps are structured as trees."}),"\n",(0,sa.jsx)(e.p,{children:"You can check the tree in React Developer Tools."}),"\n",(0,sa.jsx)(e.p,{children:"Anonymous nodes represent anonymous components."}),"\n",(0,sa.jsx)(e.p,{children:"Components created with function declarations or function expressions display the function name."}),"\n",(0,sa.jsx)(e.p,{children:"Otherwise, the following logic is followed."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["default export is treated as ",(0,sa.jsx)(e.code,{children:"_default"}),". (Based on 16.8, inferred as arbitrary value from 16.9)"]}),"\n",(0,sa.jsx)(e.li,{children:"Anonymous components wrapped in memo are treated as anonymous."}),"\n",(0,sa.jsx)(e.li,{children:"Higher-order components cannot infer names. (Based on 16.8, inferred as arbitrary value from 16.9)"}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["From 16.9, some improvements were made, but since values like ",(0,sa.jsx)(e.code,{children:"_c5"})," are arbitrary, it's better to use named functions."]}),"\n",(0,sa.jsx)(e.p,{children:"You can also apply displayName."}),"\n",(0,sa.jsx)(e.p,{children:"This is especially useful for higher-order components. You can set displayName dynamically."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"withHigherOrderComponent"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"WrappedComponent"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"WithHigherOrderComponent"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"extends"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_ inherited__",children:"React.Component"})," {}\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"WithHigherOrderComponent"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"dissplayName"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`WithHigherOrderComponent(",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${getDisplayName(WrappedComponent)}"}),")`"]}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"WithHigherOrderComponent"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getDisplayName"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"WrappedddComponent"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"WrappedComponent"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"displayName"})," || ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"WrappedComponent"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"name"})," || ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Component"'}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"You can return the wrapped component's displayName, name, or 'Component' and set it in the higher-order component."}),"\n",(0,sa.jsx)(e.p,{children:"You can distinguish between wrapped components and higher-order components, which is convenient in development mode."}),"\n",(0,sa.jsx)(e.p,{children:"Compression tools like terser can randomize component names."}),"\n",(0,sa.jsx)(e.p,{children:"Component.displayName can be deleted by build tools, so it's best to use it only in development mode."}),"\n",(0,sa.jsx)(e.h4,{children:"Component Name and Props"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610164323.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"When you select a component, it shows detailed information about that component."}),"\n",(0,sa.jsx)(e.h5,{children:"Component Name and Key"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610164615.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"This is a part implemented with mapping for components."}),"\n",(0,sa.jsx)(e.p,{children:"The key value is displayed."}),"\n",(0,sa.jsx)(e.p,{children:"In React, key values are not passed as props and are only used for comparison in the Fiber tree."}),"\n",(0,sa.jsx)(e.p,{children:"However, they are displayed in developer tools."}),"\n",(0,sa.jsx)(e.p,{children:"You can check the Anonymous component name and the key value of each part."}),"\n",(0,sa.jsx)(e.p,{children:"Anonymous is red because it wasn't rendered in strict mode."}),"\n",(0,sa.jsx)(e.h5,{children:"Component Tools"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610164952.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"There are three icons on the right side of the props section."}),"\n",(0,sa.jsx)(e.h6,{children:"Inspect the matching DOM element"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610165421.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Checks how the component was rendered in the DOM element."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610165908.png",alt:""})}),"\n",(0,sa.jsx)(e.h6,{children:"Log this component data to the console"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610165510.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Outputs the component's information to the console window."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610170039.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can see the component's props, hooks, and nodes."}),"\n",(0,sa.jsx)(e.h6,{children:"View source for this element"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610165548.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can check the component's source code."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610170606.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Source code built in production mode is maximally compressed."}),"\n",(0,sa.jsxs)(e.p,{children:["Pressing the ",(0,sa.jsx)(e.code,{children:"{}"})," button displays it in a readable format."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610170629.png",alt:""})}),"\n",(0,sa.jsx)(e.h5,{children:"Component Props"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610200919.png",alt:""})}),"\n",(0,sa.jsx)(e.h6,{children:"Copy value to clipboard"}),"\n",(0,sa.jsx)(e.p,{children:"Copies the value of props to the clipboard."}),"\n",(0,sa.jsx)(e.h6,{children:"Store as global variable"}),"\n",(0,sa.jsxs)(e.p,{children:["Stores the information in ",(0,sa.jsx)(e.code,{children:"window.$r"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610201128.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"The copied content is stored in an arbitrary variable name ($reactTemp0) and can be used in the console."}),"\n",(0,sa.jsx)(e.h6,{children:"Go to definition"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610201250.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"If the value is a function, there's a Go to definition that moves to the source code."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610201359.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Moves to the function's source code."}),"\n",(0,sa.jsx)(e.h5,{children:"Component Hooks"}),"\n",(0,sa.jsx)(e.p,{children:"You can check information about hooks in use."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610201925.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"There are State, Reducer, Context, Memo, Callback, Ref, id, LayoutEffect, Effect, etc."}),"\n",(0,sa.jsx)(e.p,{children:"Functions passed to hooks should be written as named functions."}),"\n",(0,sa.jsxs)(e.p,{children:["Anonymous functions are displayed as ",(0,sa.jsx)(e.code,{children:"f() {}"}),", and named functions are displayed as ",(0,sa.jsx)(e.code,{children:"f name() {}"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:"Using named functions allows for more accurate checking."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610202656.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Expressing named functions in code looks like this."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {}); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// xxx"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffection"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"functionName"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {}); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ooo"}),"\n"]})}),"\n",(0,sa.jsx)(e.h5,{children:"Component Rendered By"}),"\n",(0,sa.jsxs)(e.p,{children:["In production, it only displays as ",(0,sa.jsx)(e.code,{children:"react-dom"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:"In development, you can see detailed information."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610204025.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can see that it was rendered in the order: react-dom > hydrateRoot > App > BoardsPage."}),"\n",(0,sa.jsx)(e.h3,{children:"Profiler"}),"\n",(0,sa.jsx)(e.p,{children:"A tool to check the process of React rendering."}),"\n",(0,sa.jsx)(e.p,{children:"You can check which components were rendered, how many times it happened, and which operations took a long time."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610204442.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can check rendering time and the reason each part was updated."}),"\n",(0,sa.jsx)(e.h4,{children:"Settings"}),"\n",(0,sa.jsx)(e.h5,{children:"General"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610204708.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:'Enabling "Highlight updates when components render" in the settings window will show highlight indicators when rendering.'}),"\n",(0,sa.jsx)(s7,{id:"955968361"}),"\n",(0,sa.jsx)(e.h5,{children:"Debugging"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610205103.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"In React strict mode, rendering is done twice in development to check for pure components."}),"\n",(0,sa.jsx)(e.p,{children:'Enabling the "Hide logs during second render in Strict Mode" option hides the second rendering log.'}),"\n",(0,sa.jsx)(e.h5,{children:"Profiler"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610205318.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:'"Record why each component rendered while profiling" records the rendering reason for each component on every render.'}),"\n",(0,sa.jsx)(e.h4,{children:"Profiling"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610205813.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"I'll explain the icons in order from left to right."}),"\n",(0,sa.jsx)(e.h5,{children:"Usage"}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Start Profiling"})}),"\n",(0,sa.jsx)(e.p,{children:"Profiling starts."}),"\n",(0,sa.jsx)(e.p,{children:"Pressing it again ends profiling."}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Reload and Start profiling"})}),"\n",(0,sa.jsx)(e.p,{children:"The web page refreshes and profiling starts simultaneously."}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Stop Profiling"})}),"\n",(0,sa.jsx)(e.p,{children:"Deletes all current content."}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Load profile"})}),"\n",(0,sa.jsx)(e.p,{children:"Loads profiling results."}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Save profile"})}),"\n",(0,sa.jsx)(e.p,{children:"Downloads profiling results as a JSON file."}),"\n",(0,sa.jsx)(s7,{id:"955968403"}),"\n",(0,sa.jsx)(e.p,{children:"This is the profiling screen using Reload and Start profiling."}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Flamegraph"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610210623.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Shows what work happened per render commit."}),"\n",(0,sa.jsx)(e.p,{children:"You can check the React component tree structure."}),"\n",(0,sa.jsx)(e.p,{children:"The wider it is, the longer the rendering time."}),"\n",(0,sa.jsx)(e.p,{children:"The widest one is the root component."}),"\n",(0,sa.jsx)(e.p,{children:"Green indicates fast rendering, yellow indicates slow rendering, and gray indicates components that were not rendered."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610214552.png",alt:""}),"\n",(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610211527.png",alt:""})]}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Ranked"})}),"\n",(0,sa.jsx)(e.p,{children:"Sorts by rendering time, longest first."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610212134.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610212117.png",alt:""})}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Timeline"})}),"\n",(0,sa.jsx)(e.p,{children:"Checks what happened in components over time. (React 18+)"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610212643.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can check what was rendered when in time units and how much idle time there was."}),"\n",(0,sa.jsx)(e.h5,{children:"Actual Application"}),"\n",(0,sa.jsx)(e.p,{children:"Let's debug through profiling with practice."}),"\n",(0,sa.jsx)(s7,{id:"955968438"}),"\n",(0,sa.jsx)(e.p,{children:"When uploading one image to show a preview, the addboard component is rendered."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610214837.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"I'll check the rendering cause in the Component tab."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610215256.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"It shows it's because of a change in 14 State."}),"\n",(0,sa.jsx)(e.p,{children:"I check 14 State in the Component tab."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610215205.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Looking at the code, I can see that 14 State is preview."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Addboard"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n    register,\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"formState"}),": { errors, isDirty, isValid },\n    handleSubmit,\n  } = useForm<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"IFormInput"}),">();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SubmitHandler"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"IFormInput"}),"> = ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"d"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postArticle"}),"({ ...d, ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"image"}),": preview });\n  };\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { isDesktop } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useScreenDetector"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [preview, setPreview] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'""'}),");\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"The parent state preview changed, causing the parent component to re-render, and then the child component also re-rendered."}),"\n",(0,sa.jsx)(e.p,{children:"To solve this, the child component should change preview and then pass it to the parent component."}),"\n",(0,sa.jsx)(e.p,{children:"However, passing data from child to parent goes against unidirectional data flow."}),"\n",(0,sa.jsx)(e.p,{children:"I ended debugging at the point of understanding the logic."}),"\n",(0,sa.jsx)(e.h2,{children:"Source"}),"\n",(0,sa.jsx)("a",{href:"https://wikibook.co.kr/react-deep-dive",children:(0,sa.jsx)(e.p,{children:"React Deep Dive. 김용찬, chapter 6"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"If there are any incorrect contents, please let me know in the comments. Thank you."}),"\n"]})]})}function s9(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(s8,{...s})}):s8(s)}function es(s){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"리액트 개발 도구"}),"\n",(0,sa.jsx)(e.p,{children:"react-dev-tools"}),"\n",(0,sa.jsx)(e.p,{children:"React 팀이 만든 React 앱 개발 도구입니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610161243.png",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"활용"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610161637.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"React 개발자 도구를 다운로드하면 두 가지 탭이 추가됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"Component와 Profiler입니다."}),"\n",(0,sa.jsx)(e.h3,{children:"컴포넌트"}),"\n",(0,sa.jsx)(e.p,{children:"Component 탭에서는 React 앱의 컴포넌트 트리를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"props, hooks 등 다양한 정보를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610161514.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"개발자 도구처럼 Hover 시 해당 컴포넌트의 정보를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610161856.png",alt:""})}),"\n",(0,sa.jsx)(e.h4,{children:"컴포넌트 트리"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610162302.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"React 앱은 트리 구조로 되어 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"React 개발자 도구에서 트리를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Anonymous 노드는 익명 컴포넌트를 의미합니다."}),"\n",(0,sa.jsx)(e.p,{children:"함수 선언식이나 함수 표현식으로 생성한 컴포넌트는 함수명을 표시합니다."}),"\n",(0,sa.jsx)(e.p,{children:"그렇지 않은 경우 다음 로직을 따릅니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["default export는 ",(0,sa.jsx)(e.code,{children:"_default"}),"로 처리됩니다. (16.8 기준, 16.9부터는 임의의 값으로 추론)"]}),"\n",(0,sa.jsx)(e.li,{children:"memo로 감싼 익명 컴포넌트는 익명으로 처리됩니다."}),"\n",(0,sa.jsx)(e.li,{children:"고차 컴포넌트는 명칭을 추론하지 못합니다. (16.8 기준, 16.9부터는 임의의 값으로 추론)"}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["16.9부터 일부 개선되었지만 ",(0,sa.jsx)(e.code,{children:"_c5"})," 같은 임의의 값이므로 기명 함수를 사용하는 것이 좋습니다."]}),"\n",(0,sa.jsx)(e.p,{children:"displayName을 적용하는 방법도 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"고차 컴포넌트에 특히 유용합니다. displayName을 동적으로 설정할 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"withHigherOrderComponent"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"WrappedComponent"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"WithHigherOrderComponent"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"extends"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_ inherited__",children:"React.Component"})," {}\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"WithHigherOrderComponent"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"dissplayName"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`WithHigherOrderComponent(",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${getDisplayName(WrappedComponent)}"}),")`"]}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"WithHigherOrderComponent"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getDisplayName"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"WrappedddComponent"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"WrappedComponent"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"displayName"})," || ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"WrappedComponent"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"name"})," || ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Component"'}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"래핑된 컴포넌트의 displayName, name, 또는 'Component'를 반환하여 고차 컴포넌트에 설정할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"래핑된 컴포넌트와 고차 컴포넌트를 구분할 수 있어 개발 모드에서 편리합니다."}),"\n",(0,sa.jsx)(e.p,{children:"terser 같은 압축 도구가 컴포넌트명을 난수화할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Component.displayName은 빌드 도구가 삭제할 수 있으므로 개발 모드에서만 사용하는 것이 좋습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"컴포넌트명과 props"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610164323.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"컴포넌트를 선택하면 해당 컴포넌트의 자세한 정보를 보여줍니다."}),"\n",(0,sa.jsx)(e.h5,{children:"컴포넌트명과 key"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610164615.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"컴포넌트들을 mapping으로 구현한 부분입니다."}),"\n",(0,sa.jsx)(e.p,{children:"key 값이 표시되어 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"React에서 key 값은 props로 전달되지 않으며 Fiber 트리에서 비교용으로만 사용됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"하지만 개발자 도구에는 표시됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"Anonymous 컴포넌트명과 각 부분의 key 값을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Anonymous가 빨간색인 이유는 strict mode로 렌더링되지 않았기 때문입니다."}),"\n",(0,sa.jsx)(e.h5,{children:"컴포넌트 도구"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610164952.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"props 부분 오른쪽에 세 개의 아이콘이 있습니다."}),"\n",(0,sa.jsx)(e.h6,{children:"Inspect the matching DOM element"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610165421.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"해당 컴포넌트가 DOM element에서 어떻게 렌더링되었는지 확인합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610165908.png",alt:""})}),"\n",(0,sa.jsx)(e.h6,{children:"Log this component data to the console"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610165510.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"콘솔 창에 해당 컴포넌트의 정보를 출력합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610170039.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"해당 컴포넌트의 props, hooks, nodes를 볼 수 있습니다."}),"\n",(0,sa.jsx)(e.h6,{children:"View source for this element"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610165548.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"해당 컴포넌트의 소스코드를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610170606.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"프로덕션 모드에서 빌드된 소스코드는 최대로 압축되어 있습니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"{}"})," 버튼을 누르면 읽기 쉬운 형태로 표시됩니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610170629.png",alt:""})}),"\n",(0,sa.jsx)(e.h5,{children:"컴포넌트 props"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610200919.png",alt:""})}),"\n",(0,sa.jsx)(e.h6,{children:"Copy value to clipboard"}),"\n",(0,sa.jsx)(e.p,{children:"props의 값을 클립보드에 복사한다."}),"\n",(0,sa.jsx)(e.h6,{children:"Store as global variable"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"window.$r"}),"에 해당 정보를 저장합니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610201128.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"복사한 내용을 임의의 변수명($reactTemp0)에 저장하여 콘솔에서 사용할 수 있습니다."}),"\n",(0,sa.jsx)(e.h6,{children:"Go to definition"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610201250.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"값이 함수인 경우 소스코드로 이동하는 Go to definition이 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610201359.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"해당 함수의 소스코드로 이동합니다."}),"\n",(0,sa.jsx)(e.h5,{children:"컴포넌트 hooks"}),"\n",(0,sa.jsx)(e.p,{children:"사용 중인 훅 정보를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610201925.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"State, Reducer, Context, Memo, Callback, Ref, id, LayoutEffect, Effect 등이 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"훅에 넘겨주는 함수는 기명 함수로 작성해야 합니다."}),"\n",(0,sa.jsxs)(e.p,{children:["익명 함수는 ",(0,sa.jsx)(e.code,{children:"f() {}"}),"로 표시되고, 기명 함수는 ",(0,sa.jsx)(e.code,{children:"f 이름() {}"}),"로 표시됩니다."]}),"\n",(0,sa.jsx)(e.p,{children:"기명 함수를 사용하면 더 정확하게 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610202656.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"코드로 기명함수를 표현하면 다음과 같다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {}); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// xxx"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffection"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," 함수이름() {}); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ooo"}),"\n"]})}),"\n",(0,sa.jsx)(e.h5,{children:"컴포넌트를 렌더링한 주체 (rendered by)"}),"\n",(0,sa.jsxs)(e.p,{children:["프로덕션에서는 ",(0,sa.jsx)(e.code,{children:"react-dom"}),"으로만 표시됩니다."]}),"\n",(0,sa.jsx)(e.p,{children:"개발 환경에서는 자세한 정보를 볼 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610204025.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"react-dom > hydrateRoot > App > BoardsPage 순서로 렌더링되었음을 알 수 있습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"Profiler"}),"\n",(0,sa.jsx)(e.p,{children:"React가 렌더링하는 과정을 확인하기 위한 도구입니다."}),"\n",(0,sa.jsx)(e.p,{children:"어떤 컴포넌트가 렌더링되었는지, 몇 차례 일어났는지, 어떤 작업이 오래 걸렸는지 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610204442.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"렌더링 소요 시간과 각 부분이 업데이트된 이유를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"설정"}),"\n",(0,sa.jsx)(e.h5,{children:"General"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610204708.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:'설정 창에서 "Highlight updates when components render"를 활성화하면 렌더링 시 하이라이트 표시가 됩니다.'}),"\n",(0,sa.jsx)(s7,{id:"955968361"}),"\n",(0,sa.jsx)(e.h5,{children:"Debugging"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610205103.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"React 엄격 모드에서는 순수 컴포넌트 확인을 위해 개발 환경에서 렌더링을 두 번 합니다."}),"\n",(0,sa.jsx)(e.p,{children:'"Hide logs during second render in Strict Mode" 옵션을 활성화하면 두 번째 렌더링 로그를 숨깁니다.'}),"\n",(0,sa.jsx)(e.h5,{children:"Profiler"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610205318.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:'"Record why each component rendered while profiling"으로 각 렌더링마다 컴포넌트의 렌더링 이유를 기록합니다.'}),"\n",(0,sa.jsx)(e.h4,{children:"프로파일링"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610205813.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"왼쪽부터 순서대로 아이콘을 설명하겠습니다."}),"\n",(0,sa.jsx)(e.h5,{children:"활용"}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Start Profiling"})}),"\n",(0,sa.jsx)(e.p,{children:"프로파일링이 시작됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"한 번 더 누르면 프로파일링이 종료됩니다."}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Reload and Start profiling"})}),"\n",(0,sa.jsx)(e.p,{children:"웹 페이지가 새로고침되면서 동시에 프로파일링이 시작됩니다."}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Stop Profiling"})}),"\n",(0,sa.jsx)(e.p,{children:"현재 내용을 모두 삭제합니다."}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Load profile"})}),"\n",(0,sa.jsx)(e.p,{children:"프로파일링 결과를 불러옵니다."}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Save profile"})}),"\n",(0,sa.jsx)(e.p,{children:"프로파일링 결과를 JSON 파일로 다운로드합니다."}),"\n",(0,sa.jsx)(s7,{id:"955968403"}),"\n",(0,sa.jsx)(e.p,{children:"Reload and Start profiling을 이용한 프로파일링 화면입니다."}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Flamegraph"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610210623.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"렌더 커밋별로 어떤 작업이 일어났는지 보여줍니다."}),"\n",(0,sa.jsx)(e.p,{children:"React 컴포넌트 트리 구조를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"너비가 넓을수록 렌더링 시간이 오래 걸렸습니다."}),"\n",(0,sa.jsx)(e.p,{children:"가장 넓은 것은 루트 컴포넌트입니다."}),"\n",(0,sa.jsxs)(e.p,{children:["초록색은 빠른 렌더링, 노란색은 느린 렌더링, 회색은 렌더링되지 않은 컴포넌트입니다.\n",(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610214552.png",alt:""}),"\n",(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610211527.png",alt:""})]}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Ranked"})}),"\n",(0,sa.jsx)(e.p,{children:"렌더링 시간이 오래 걸린 순서대로 정렬합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610212134.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610212117.png",alt:""})}),"\n",(0,sa.jsx)(e.h6,{children:(0,sa.jsx)(e.code,{children:"Timeline"})}),"\n",(0,sa.jsx)(e.p,{children:"시간에 따라 컴포넌트에서 일어난 일을 확인합니다. (React 18 이상)"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610212643.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"시간 단위로 무엇이 언제 렌더링되었는지, 유휴 시간이 얼마인지 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.h5,{children:"실제 적용"}),"\n",(0,sa.jsx)(e.p,{children:"실습을 통해 프로파일링으로 디버깅을 해보겠습니다."}),"\n",(0,sa.jsx)(s7,{id:"955968438"}),"\n",(0,sa.jsx)(e.p,{children:"이미지를 하나 업로드하여 미리보기를 보여줄 때 addboard 컴포넌트가 렌더링됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610214837.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"컴포넌트 탭에서 렌더링 원인을 확인하겠습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610215256.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"14 State의 변경 때문이라고 표시됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"Component 탭에서 14 State를 확인합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-10/Pasted%20image%2020240610215205.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"코드를 보면 14 State가 preview임을 알 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Addboard"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n\xa0 \xa0 register,\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"formState"}),": { errors, isDirty, isValid },\n\xa0 \xa0 handleSubmit,\n\xa0 } = useForm<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"IFormInput"}),">();\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SubmitHandler"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"IFormInput"}),"> = ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"d"}),") =>"]})," {\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postArticle"}),"({ ...d, ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"image"}),": preview });\n\xa0 };\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { isDesktop } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useScreenDetector"}),"();\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [preview, setPreview] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'""'}),");\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"부모 state인 preview가 변경되어 부모 컴포넌트가 리렌더링되고, 이어서 자식 컴포넌트도 리렌더링됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"해결하려면 자식 컴포넌트에서 preview를 변경한 후 부모 컴포넌트로 전달해야 합니다."}),"\n",(0,sa.jsx)(e.p,{children:"하지만 자식에서 부모로 데이터를 전달하는 것은 단방향 데이터 흐름에 반합니다."}),"\n",(0,sa.jsx)(e.p,{children:"로직을 이해하는 선에서 디버깅을 종료했습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"출처"}),"\n",(0,sa.jsx)("a",{href:"https://wikibook.co.kr/react-deep-dive",children:(0,sa.jsx)(e.p,{children:"React Deep Dive. 김용찬, chapter 6"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"잘못된 내용이 있다면 댓글로 알려주세요. 감사합니다."}),"\n"]})]})}function ee(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(es,{...s})}):es(s)}function en(s){let e={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"Resolution Process"}),"\n",(0,sa.jsx)(e.p,{children:"A problem occurred while migrating a page made with JS(React) to TS."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-14/image-1.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"The layout structure was the same, but data could not be retrieved. The data request part seemed to be the problem, so I checked with developer tools."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-14/image-2.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"The URL contained undefined. It seemed to be a problem caused by values not being entered into variables."}),"\n",(0,sa.jsx)(e.p,{children:"I determined it was an environment variable issue."}),"\n",(0,sa.jsx)(e.p,{children:"I was working on environment variables along with the TS migration, and it seemed the problem occurred in this part."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-env",children:'BASE_URL="address"\n'})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// constants.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," = process.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"env"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"BASE_URL"}),";\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This is the existing env file and the ts file that uses it."}),"\n",(0,sa.jsx)(e.p,{children:"process.env is an object that stores environment variables in the Node.js runtime environment. This is the way Express uses it, so it's incorrect access in a Vite environment."}),"\n",(0,sa.jsx)(e.p,{children:"Next.js distinguishes between client and server environment variables with NEXT_PUBLIC_. I thought Vite might have a similar distinction, so I checked the official documentation."}),"\n",(0,sa.jsx)("a",{href:"https://ko.vitejs.dev/guide/env-and-mode",children:"Vite Official Documentation"}),"\n",(0,sa.jsx)(e.p,{children:"Vite uses environment variables starting with VITE_. Some variable names are reserved by default."}),"\n",(0,sa.jsx)(e.p,{children:"BASE_URL is a reserved variable in Vite that represents the base URL within the app. I changed it to URL to avoid conflicts."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-env",children:'VITE_URL = "address"\n'})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"meta"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"env"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"VITE_URL"}),";\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"vite build brings variables to dist."}),"\n",(0,sa.jsx)(e.p,{children:"Environment variables starting with VITE_ are always included during bundling. Sensitive information like database passwords should not be included."}),"\n",(0,sa.jsx)(e.h3,{children:"Result"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-14/image.png",alt:""})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"This happened while migrating from JS to TS!"}),"\n",(0,sa.jsx)(e.p,{children:"If there are any incorrect contents, please let me know. Thank you."}),"\n"]})]})}function ea(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(en,{...s})}):en(s)}function el(s){let e={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h2,{children:"해결 과정"}),"\n",(0,sa.jsx)(e.p,{children:"JS(React)로 만들었던 페이지를 TS로 마이그레이션하는 중에 문제가 발생했습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-14/image-1.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"레이아웃 구성은 동일하나 데이터만 가져오지 못했습니다. 데이터 요청 부분이 문제로 보여 개발자 도구로 확인했습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-14/image-2.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"url에 undefined가 포함되어 있었습니다. 변수에 값이 들어가지 않아서 발생한 문제로 보였습니다."}),"\n",(0,sa.jsx)(e.p,{children:"환경 변수 문제로 판단했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"TS 마이그레이션과 함께 환경 변수 작업을 진행했는데, 이 부분에서 문제가 발생한 것으로 보였습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-env",children:'BASE_URL="주소"\n'})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// constants.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," = process.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"env"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"BASE_URL"}),";\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"기존 env 파일과 이를 사용하는 ts 파일입니다."}),"\n",(0,sa.jsx)(e.p,{children:"process.env는 Node.js 런타임 환경에서 환경 변수를 저장하는 객체입니다. Express에서 사용하는 방식이므로 Vite 환경에서는 잘못된 접근입니다."}),"\n",(0,sa.jsx)(e.p,{children:"Next.js에서는 NEXT_PUBLIC_으로 클라이언트와 서버의 환경 변수를 구분합니다. Vite도 유사한 구분법이 있을 것으로 판단하여 공식문서를 확인했습니다."}),"\n",(0,sa.jsx)("a",{href:"https://ko.vitejs.dev/guide/env-and-mode",children:"Vite 공식문서"}),"\n",(0,sa.jsx)(e.p,{children:"Vite에서는 VITE_로 시작하는 환경 변수를 사용합니다. 일부 변수명은 기본으로 예약되어 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"BASE_URL은 Vite에서 앱 내의 베이스 URL을 표시하는 예약된 변수입니다. 충돌을 피하기 위해 URL로 변경했습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-env",children:'VITE_URL = "주소"\n'})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"meta"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"env"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"VITE_URL"}),";\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"vite build로 변수를 dist로 가져옵니다."}),"\n",(0,sa.jsx)(e.p,{children:"VITE_로 시작하는 환경 변수는 번들링 시 무조건 포함됩니다. 데이터베이스 비밀번호 같은 민감한 정보는 넣으면 안 됩니다."}),"\n",(0,sa.jsx)(e.h3,{children:"결과"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-14/image.png",alt:""})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"JS에서 TS로 마이그레이션 하는 중에 생긴 일입니다!"}),"\n",(0,sa.jsx)(e.p,{children:"잘못된 내용이 있다면 말씀 부탁드립니다. 감사합니다."}),"\n"]})]})}function ec(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(el,{...s})}):el(s)}function er(s){let e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"Bugs and debugging issues that occur in applications can also happen outside of React."}),"\n",(0,sa.jsx)(e.p,{children:"To debug React's external environment such as JavaScript memory, network, source, actual HTML and CSS, browser developer tools are needed."}),"\n",(0,sa.jsx)(e.h1,{children:"Chrome Dev Tool"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615101247.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"As shown in the picture above, dev tool shows various information about the page."}),"\n",(0,sa.jsx)(e.p,{children:"It's recommended to use developer tools in incognito mode."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615101714.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"This is because extensions can store global variables. In incognito mode"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615101851.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"If there are no extensions available in incognito mode, global variables stored by extensions don't exist."}),"\n",(0,sa.jsx)(e.h2,{children:"Element"}),"\n",(0,sa.jsx)(e.p,{children:"You can check information such as HTML, CSS, etc. that make up the current webpage."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615102351.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Element Screen"}),"\n",(0,sa.jsx)(e.p,{children:"Represents the HTML that makes up the current webpage."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615102820.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can add, delete, or modify elements and track code that causes changes using breakpoints."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615103356.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615103504.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can see that php was used in that part and what code is related to it."}),"\n",(0,sa.jsx)(e.h3,{children:"Element Information"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615104728.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Styles: Check style information related to elements"}),"\n",(0,sa.jsx)(e.p,{children:"Computed: You can check CSS applied result values such as padding, border, margin, etc. Check what the final result is."}),"\n",(0,sa.jsx)(e.p,{children:"Layout: Check CSS grid or layout-related information."}),"\n",(0,sa.jsx)(e.p,{children:"Event listeners: Check event listeners. If you uncheck Ancestor, you can only see events assigned to that element."}),"\n",(0,sa.jsx)(e.p,{children:"DOM Breakpoints: A tab that tells you if there are breakpoints."}),"\n",(0,sa.jsx)(e.p,{children:"Properties: Displays all attribute values that the element has. The difference from js's .attributes is that it shows all attribute values, not just specified attributes."}),"\n",(0,sa.jsx)(e.p,{children:"Accessibility: Values used by screen readers, etc. for people with disabilities and the elderly who have difficulty using the web."}),"\n",(0,sa.jsx)(e.h2,{children:"Source"}),"\n",(0,sa.jsx)(e.p,{children:"You can check all files executed or referenced to load the web application.\nYou can check various file information such as JS, CSS, HTML, Font, etc."}),"\n",(0,sa.jsx)(e.h3,{children:"Check Files Generated on the Page"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615105916.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"This is what it looks like when you press developer tools > ctrl+p on the inflearn site.\nWhen you enter a file, you can check the actual code content."}),"\n",(0,sa.jsx)(e.p,{children:"In production mode, files are compressed, making them difficult to check, but in development mode, you can also check React code."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615111323.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can set breakpoints like in actual code and debug."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615111411.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Check Code Content"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615112247.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"On the right side of Source, there's information like above."}),"\n",(0,sa.jsx)(e.p,{children:"Watch: A menu where you declare variables you want to watch and check information about those variables."}),"\n",(0,sa.jsx)(e.p,{children:"Breakpoints: Check breakpoints added on the current website. You can check all breakpoints added in the Source tab."}),"\n",(0,sa.jsx)(e.p,{children:"Scope: Check local scope, closure, global scope, etc."}),"\n",(0,sa.jsx)(e.p,{children:"Call Stack: Check the call stack of the current breakpoint."}),"\n",(0,sa.jsx)(e.p,{children:"Global Listeners: List of listeners added to the global scope."}),"\n",(0,sa.jsx)(e.p,{children:"XHR/fetch Breakpoints, DOM Breakpoints, Event Listener Breakpoints"}),"\n",(0,sa.jsx)(e.p,{children:"CSP Violation Breakpoints: Check various types of breakpoints."}),"\n",(0,sa.jsx)(e.h2,{children:"Network"}),"\n",(0,sa.jsx)(e.p,{children:"All network-related operations that occur from the moment you access the page are recorded.\nAll information communicating with external data is included."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615113622.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"On the 3rd line, you can create tags like Fetch/XHR, Doc, etc. to filter the types of network requests."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615113806.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can also check the status of specific networks."}),"\n",(0,sa.jsx)(e.p,{children:"When running in developer mode, hot reloading happens through web sockets."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615120838.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"At the bottom, you can check the number of requests that occurred during the page load period and the size of downloaded resources."}),"\n",(0,sa.jsx)(e.p,{children:"For mobile, you need to pay mobile network costs proportional to resource size and it affects speed, so you need to optimize the count and size."}),"\n",(0,sa.jsxs)(e.p,{children:["You can compress resources using ",(0,sa.jsx)(e.code,{children:"gzip"})," or ",(0,sa.jsx)(e.code,{children:"brotli"}),", or optimize images."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615121057.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Click the settings in the top left and click Screenshots to check webpage loading according to network request flow."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615121335.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"It takes screenshots of the webpage over time and shows them."}),"\n",(0,sa.jsx)(e.h3,{children:"Things to Check in Network"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Are there unnecessary or duplicate requests?"}),"\n",(0,sa.jsx)(e.li,{children:"Is the resource size needed to compose the webpage too large?"}),"\n",(0,sa.jsx)(e.li,{children:"Is the speed of loading resources appropriate?"}),"\n",(0,sa.jsx)(e.li,{children:"Are there resources that take too long?"}),"\n",(0,sa.jsx)(e.li,{children:"Are resources downloaded in the correct priority so the webpage is created naturally?"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Memory"}),"\n",(0,sa.jsx)(e.p,{children:"Check memory-related information. It's a tool to check memory leaks, slowdowns, and webpage freezing that occur in applications."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615122034.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Similar to React-dev-tool, you need to go through profiling to see the desired information."}),"\n",(0,sa.jsx)(e.p,{children:"From top to bottom, the profiling types are as follows."}),"\n",(0,sa.jsx)(e.p,{children:"Heap snapshot: You can take a snapshot of the memory situation like taking a picture."}),"\n",(0,sa.jsx)(e.p,{children:"Allocation instrumentation of timeline: You can see memory changes over time. Check memory changes during the loading process and memory change processes when interacting."}),"\n",(0,sa.jsx)(e.p,{children:"Allocation sampling: Check JavaScript functions occupying memory space."}),"\n",(0,sa.jsx)(e.h3,{children:"Select JavaScript VM instance"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615122625.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can select the JS VM environment you're debugging and check how much JavaScript heap the page actually occupies."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615122833.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"This is Google's example. The size changes in real-time according to JS execution, and since it burdens the browser by this size, it's worth noting."}),"\n",(0,sa.jsx)(e.h3,{children:"Heap snapshot"}),"\n",(0,sa.jsx)(e.p,{children:"A memory profiling tool to check the current page's memory state."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"DUMMY_LIST"})," = []\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleClick"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n		",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"from"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"length"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10_000_000"})," }).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"forEach"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"_,idx"}),")=>"]}),"\n			",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"DUMMY_LIST"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"random"}),"()*idx);\n		)\n	}\n	",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"'complete'"}),");\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleClick}"}),">"]}),"BUG",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]})]}),"\n}",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//Component that pushes ten million random values to an array outside the component"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124114.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Memory state before pressing."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124158.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Memory state after pressing. You can see that an enormous size has been added to the array on the third line."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124324.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"When you click Objects allocated between snapshot 1 and snapshot 2"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124451.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Only the intersection of the two appears. If you open the array's toggle, you can check the objects inside."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124752.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"If you specify it as a global object like above, you can also check what values are inside."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124939.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"It's stored in window's temp1. The difference between shallow size and Retained Size is whether reference values are included."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Y"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"j"})," = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),";\n}\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"X"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"x"})," = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"y"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Y"}),"();\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleClick"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    instances.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"X"}),"());\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleClick}"}),">"]}),"+",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]})]}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"At this time, X has Shallow Size, Retained Size of 52, 100, and Y has 48, 48."}),"\n",(0,sa.jsx)(e.p,{children:"X references Y, but since Y only has variables, only X includes reference values, so Retained Size is 100."}),"\n",(0,sa.jsx)(e.p,{children:"If memory leaks are suspected, it's good to find objects with large differences between Retained Size and Shallow Size. (They reference multiple objects, so there's a high risk of leaks)"}),"\n",(0,sa.jsx)(e.p,{children:"This time, let's check through debugging whether useCallback is being reassigned."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Component"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ number }: { number: number }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," callbackHandleClick = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(number);\n  }, [number]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"noCallbackHandleClick"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(number);\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{callbackHandleClick}"}),">"]}),"call",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{noCallbackHandleClick}"}),">"]}),"no",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [toggle, setToggle] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n	",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n	",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{()"}),"=>"]}),"{setToggle(()=>!toggle)}}>재렌더링",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]}),"\n	",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Component"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"number"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{5}"})," />"]}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),")\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"The number props passed down is fixed, but as the parent component App re-renders, the child component Component also re-renders. Let's check that callbackHandleClick using useCallback is not re-invoked."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615163357.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Comparing snapshots before and after looks like above. You can see that callbackHandleClick() doesn't exist and only noCallbakHandleClick() exists."}),"\n",(0,sa.jsx)(e.p,{children:"The () @163297 below is an anonymous function. (setToggle's callback)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setToggle"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toggle"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," !toggle;\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"If written as a named function, it looks like this."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615164016.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Allocation instrumentation on timeline"}),"\n",(0,sa.jsx)(e.p,{children:"Records memory changes over time."}),"\n",(0,sa.jsx)(e.p,{children:"You can set a section and check what objects had changes."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615164419.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["You can also specify it as a global variable.\n",(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615164611.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615164544.png",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"Allocation sampling"}),"\n",(0,sa.jsx)(e.p,{children:"Check memory occupation that occurs over time, and you can analyze it by JS execution stack, and this analysis is done by function unit."}),"\n",(0,sa.jsx)(e.p,{children:"Let's look at the following code as an example."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"DUMMY"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"<string> = [];\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [toggle, setToggle] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n  ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{()"})," =>"]})," {\n            Array.from({ length: 3000 }).forEach(function addDummy() {\n              DUMMY.push(Math.random().toString());\n            });\n            setToggle(function toggle(prev) {\n              return !prev;\n            });\n          }}\n        >\n  )\n"]})]})}),"\n",(0,sa.jsx)(e.p,{children:"When you press the button, 3000 pieces of data go into DUMMY after going through random().toString()."}),"\n",(0,sa.jsx)(e.p,{children:"If you run sampling, you can see that toString occupies the most."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615165927.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can also access source code through the file path on the far right."}),"\n",(0,sa.jsx)(e.h2,{children:"Debugging Next.js Environment"}),"\n",(0,sa.jsx)(e.p,{children:"Client-side memory leaks differ by device and their impact only affects that device, but server-side memory leaks burden the server itself and affect all services."}),"\n",(0,sa.jsx)(e.p,{children:"You can also debug the server side with dev tools."}),"\n",(0,sa.jsx)(e.h3,{children:"Next.js Debug Mode"}),"\n",(0,sa.jsx)(e.h4,{children:"Running Debug Mode"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// package.json"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"scripts"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"dev"'})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," NODE_OPTIONS='--inspect' next dev ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npm run dev\n\nVarious things appear\n\nThen a web socket address appears\n"})}),"\n",(0,sa.jsx)(e.h5,{children:"Windows is Different"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/pages/building-your-application/configuring/debugging",children:"https://nextjs.org/docs/pages/building-your-application/configuring/debugging"})}),"\n",(0,sa.jsxs)(e.p,{children:["After installing cross-env\n",(0,sa.jsx)(e.a,{href:"https://www.npmjs.com/package/cross-env",children:"https://www.npmjs.com/package/cross-env"})]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"scripts"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"dev"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"\"cross-env NODE_OPTIONS='--inspect' next dev\""})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"You need to do this to run it."}),"\n",(0,sa.jsx)(e.h4,{children:"Opening Developer Tools"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615171833.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"When you go to chrome://inspect, a screen like above appears."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615173042.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Click Open dedicated DevTools for Node."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615173118.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Now you can debug using that VM instance (node server environment)."}),"\n",(0,sa.jsx)(e.p,{children:"Let's set up a virtual scenario and generate traffic to the server to check."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"ab"})," is a web server performance testing tool, an open-source tool that can benchmark HTTP server performance."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:'ab -k -c 50 -n 10000 "http://127.0.0.1:3000/"\n'})}),"\n",(0,sa.jsx)(e.h5,{children:"Installing ab for Windows"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://stackoverflow.com/questions/49893994/apachebench-installation-on-windows-10",children:"https://stackoverflow.com/questions/49893994/apachebench-installation-on-windows-10"})}),"\n",(0,sa.jsx)(e.p,{children:"With the above command, you can send 50 requests 10,000 times to that URL."}),"\n",(0,sa.jsx)(e.p,{children:"If you debug the server side the same way, you can see that memory increases."}),"\n",(0,sa.jsx)(e.p,{children:"If memory leaks in SSR, it keeps accumulating on the server and causes overload, so it must be implemented as a pure function."})]})}function ei(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(er,{...s})}):er(s)}function et(s){let e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"애플리케이션에서 발생하는 버그와 디버깅 이슈는 리액트 밖에서 일어날 때도 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"자바스크립트 메모리, 네트워크, 소스, 실제 HTML 및 CSS 등 리액트 외부 환경을 디버깅하려면 브라우저 개발자 도구가 필요합니다."}),"\n",(0,sa.jsx)(e.h1,{children:"Chrome Dev Tool"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615101247.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"위 사진처럼 dev tool은 해당 페이지의 다양한 정보를 보여줍니다."}),"\n",(0,sa.jsx)(e.p,{children:"개발자 도구는 시크릿 모드로 사용하는 것을 권장합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615101714.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"확장 프로그램이 전역 변수를 저장할 수 있기 때문입니다. 시크릿 모드에서는"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615101851.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"시크릿 모드에서 사용 가능한 확장 프로그램이 없다면 확장 프로그램이 저장하는 전역 변수가 존재하지 않습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"Element"}),"\n",(0,sa.jsx)(e.p,{children:"현재 웹페이지를 구성하는 HTML, CSS 등의 정보를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615102351.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Element 화면"}),"\n",(0,sa.jsx)(e.p,{children:"현재 웹페이지를 구성하는 HTML을 나타냅니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615102820.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"요소를 추가하거나 삭제, 수정할 수 있고 중단점을 이용해서 변화를 일으킨 코드를 추적할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615103356.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615103504.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"해당 부분에서 php를 사용했고 이와 관련된 코드가 무엇인지 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"Element 정보"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615104728.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Styles: 요소와 관련된 스타일 정보 확인"}),"\n",(0,sa.jsx)(e.p,{children:"Computed: 패딩, 보더, 마진 등 CSS 적용 결과값을 확인할 수 있습니다. 최종적으로 어떤 결과물인지 확인합니다."}),"\n",(0,sa.jsx)(e.p,{children:"Layout: CSS 그리드나 레이아웃 관련 정보를 확인합니다."}),"\n",(0,sa.jsx)(e.p,{children:"Event listeners: 이벤트 리스너들을 확인합니다. Ancestor를 해제하면 해당 요소에 지정된 이벤트만 볼 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"DOM Breakpoints: 중단점이 있는지 알려주는 탭입니다."}),"\n",(0,sa.jsx)(e.p,{children:"Properties: 해당 요소가 가진 모든 속성값을 표시합니다. js의 .attributes와의 차이는 지정된 속성뿐만 아니라 모든 속성값이 나온다는 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"Accessibility: 웹 이용에 어려움을 겪는 장애인, 노약자를 위한 스크린 리더기 등이 활용하는 값입니다."}),"\n",(0,sa.jsx)(e.h2,{children:"Source"}),"\n",(0,sa.jsx)(e.p,{children:"웹 애플리케이션을 불러오기 위해 실행하거나 참조된 모든 파일을 확인할 수 있습니다.\nJS, CSS, HTML, Font 등 여러 파일 정보를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"해당 페이지에서 생성된 파일 확인"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615105916.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"inflearn 사이트에서 개발자 도구 > ctrl+p를 누른 모습입니다.\n파일에 들어가면 실제 코드 내용을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"프로덕션 모드에서는 파일이 압축되어 있어 확인하기 어렵지만 개발 모드에서는 리액트 코드도 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615111323.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"실제 코드처럼 중단점을 찍은 후 디버깅할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615111411.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"코드 내용 확인"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615112247.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Source의 오른쪽에는 위와 같은 정보가 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Watch: 감시하고 싶은 변수를 선언하고, 해당 변수의 정보를 확인할 수 있는 메뉴입니다."}),"\n",(0,sa.jsx)(e.p,{children:"Breakpoints: 현재 웹사이트에서 추가한 중단점을 확인합니다. 소스 탭에서 추가한 모든 중단점을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Scope: 로컬 스코프, 클로저, 전역 스코프 등을 확인합니다."}),"\n",(0,sa.jsx)(e.p,{children:"Call Stack: 현재 중단점의 콜스택을 확인합니다."}),"\n",(0,sa.jsx)(e.p,{children:"Global Listeners: 전역 스코프에 추가된 리스너 목록입니다."}),"\n",(0,sa.jsx)(e.p,{children:"XHR/fetch Breakpoints, DOM Breakpoints, Event Listener Breakpoints"}),"\n",(0,sa.jsx)(e.p,{children:"CSP Violation Breakpoints: 다양한 종류의 중단점을 확인합니다."}),"\n",(0,sa.jsx)(e.h2,{children:"Network"}),"\n",(0,sa.jsx)(e.p,{children:"해당 페이지에 접속하는 순간부터 발생하는 모든 네트워크 관련 작동이 기록됩니다.\n외부 데이터와 통신하는 정보가 모두 들어가 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615113622.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"3번째 줄에 Fetch/XHR, Doc 등으로 태그를 만들어서 네트워크 요청의 종류를 필터링할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615113806.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"특정 네트워크의 상태를 확인할 수도 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"개발자 모드로 실행되면 웹 소켓을 통해 핫 리로딩됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615120838.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"하단에는 페이지를 불러오는 기간 동안 발생한 request의 건수, 다운로드한 리소스의 크기를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"모바일의 경우 리소스의 크기만큼 모바일 네트워크 비용을 지불해야 하고 속도에도 영향을 미치기 때문에 건수와 크기를 최적화할 필요가 있습니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"gzip"}),"이나 ",(0,sa.jsx)(e.code,{children:"brotli"}),"를 활용해서 리소스를 압축하거나 이미지 최적화를 할 수 있습니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615121057.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"왼쪽 위 설정을 누르고 Screenshots를 누르면 웹페이지 로딩을 네트워크 요청 흐름에 따라 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615121335.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"시간별로 웹페이지를 스크린샷처럼 찍어서 보여줍니다."}),"\n",(0,sa.jsx)(e.h3,{children:"Network에서 확인해야 하는 것"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"불필요한 요청 또는 중복되는 요청이 없는가?"}),"\n",(0,sa.jsx)(e.li,{children:"웹페이지 구성에 필요한 리소스 크기가 너무 크지 않은가?"}),"\n",(0,sa.jsx)(e.li,{children:"리소스를 불러오는 속도는 적절한가?"}),"\n",(0,sa.jsx)(e.li,{children:"너무 속도가 오래 걸리는 리소스는 없는가?"}),"\n",(0,sa.jsx)(e.li,{children:"리소스가 올바른 우선순위로 다운로드 되어 웹페이지가 자연스럽게 만들어지는가?"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Memory"}),"\n",(0,sa.jsx)(e.p,{children:"메모리 관련 정보를 확인합니다. 애플리케이션에서 발생하는 메모리 누수, 속도 저하, 웹페이지 프리징 현상을 확인할 수 있는 도구입니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615122034.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"React-dev-tool과 비슷하게 프로파일링 작업을 거쳐야 원하는 정보를 볼 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"위에서부터 다음과 같은 프로파일링 종류입니다."}),"\n",(0,sa.jsx)(e.p,{children:"Heap snapshot: 메모리 상황을 사진 찍듯이 촬영할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Allocation instrumentation of timeline: 시간의 흐름에 따라 메모리의 변화를 볼 수 있습니다. 로딩 과정의 메모리 변화, 상호작용했을 때 메모리의 변화 과정을 확인합니다."}),"\n",(0,sa.jsx)(e.p,{children:"Allocation sampling: 메모리 공간을 차지하고 있는 자바스크립트 함수를 확인합니다."}),"\n",(0,sa.jsx)(e.h3,{children:"Select JavaScript VM instance"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615122625.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"디버깅하고 있는 JS VM 환경을 선택해서 실제 해당 페이지가 자바스크립트 힙을 얼마나 점유하고 있는지 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615122833.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Google의 예시입니다. JS 실행에 따라 실시간으로 크기가 변하며 이 크기만큼 브라우저에 부담을 주기 때문에 눈여겨 볼만합니다."}),"\n",(0,sa.jsx)(e.h3,{children:"Heap snapshot"}),"\n",(0,sa.jsx)(e.p,{children:"현재 페이지의 메모리 상태를 확인할 수 있는 메모리 프로파일 도구입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"DUMMY_LIST"})," = []\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleClick"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n		",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"from"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"length"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10_000_000"})," }).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"forEach"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"_,idx"}),")=>"]}),"\n			",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"DUMMY_LIST"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"random"}),"()*idx);\n		)\n	}\n	",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"'complete'"}),");\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleClick}"}),">"]}),"BUG",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]})]}),"\n}",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//컴포넌트 외부에 있는 배열에 천만 개의 랜덤한 값을 push하는 컴포넌트"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124114.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"누르기 전 메모리 모습입니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124158.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"누른 후의 메모리 모습입니다. 세 번째 줄 array에 엄청난 크기가 들어간 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124324.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Objects allocated between snapshot 1 and snapshot 2를 누르면"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124451.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"둘의 교집합만 나옵니다. array의 토글을 열면 그 안의 객체들을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124752.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"위처럼 전역 객체로 지정하면 어떤 값이 들어있는지도 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615124939.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"window의 temp1에 저장됩니다. shallow size와 Retained Size는 참조값을 포함하느냐 아니냐의 차이입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Y"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"j"})," = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),";\n}\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"X"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"x"})," = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"y"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Y"}),"();\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleClick"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    instances.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"X"}),"());\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleClick}"}),">"]}),"+",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]})]}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이때 X는 52 100, Y는 48 48의 Shallow Size, Retained Size를 갖습니다."}),"\n",(0,sa.jsx)(e.p,{children:"X는 Y를 참조하고 있으나 Y는 변수만 갖고 있기 때문에 X만 참조 값을 포함해서 Retained Size가 100입니다."}),"\n",(0,sa.jsx)(e.p,{children:"메모리 누수가 의심될 경우 Retained Size와 Shallow Size의 차이가 큰 객체를 찾는 것이 좋습니다. (다수의 객체를 참조하고 있어 누수 위험이 높습니다)"}),"\n",(0,sa.jsx)(e.p,{children:"이번엔 useCallback으로 재할당되는지 여부를 디버깅으로 확인해보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Component"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ number }: { number: number }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," callbackHandleClick = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(number);\n  }, [number]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"noCallbackHandleClick"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(number);\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{callbackHandleClick}"}),">"]}),"call",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{noCallbackHandleClick}"}),">"]}),"no",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [toggle, setToggle] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n	",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n	",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{()"}),"=>"]}),"{setToggle(()=>!toggle)}}>재렌더링",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]}),"\n	",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Component"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"number"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{5}"})," />"]}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),")\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"내려주는 number props는 고정이지만 부모 컴포넌트인 App이 재렌더링됨에 따라 자식 컴포넌트인 Component도 재렌더링됩니다. 이때 useCallback을 사용한 callbackHandleClick은 재호출되지 않는 것을 확인해보겠습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615163357.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"이전과 이후의 snap shot을 비교해보면 위와 같습니다. callbackHandleClick()은 없고 noCallbakHandleClick()만 존재하는 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"아래 () @163297은 익명 함수입니다. (setToggle의 콜백)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setToggle"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toggle"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," !toggle;\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"기명 함수로 작성하면 다음과 같이 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615164016.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Allocation instrumentation on timeline"}),"\n",(0,sa.jsx)(e.p,{children:"시간의 흐름에 따라 메모리 변화를 기록합니다."}),"\n",(0,sa.jsx)(e.p,{children:"구간을 정해서 어떤 변화가 있었는지 그 객체를 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615164419.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["전역 변수로 지정도 할 수 있습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615164611.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615164544.png",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"Allocation sampling"}),"\n",(0,sa.jsx)(e.p,{children:"시간의 흐름에 따라 발생하는 메모리 점유를 확인하는데 JS 실행 스택별로 분석할 수 있고 이 분석을 함수 단위로 합니다."}),"\n",(0,sa.jsx)(e.p,{children:"다음 코드를 예시로 살펴보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"DUMMY"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"<string> = [];\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [toggle, setToggle] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n  ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{()"})," =>"]})," {\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 Array.from({ length: 3000 }).forEach(function addDummy() {\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 DUMMY.push(Math.random().toString());\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 });\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 setToggle(function toggle(prev) {\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 return !prev;\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 });\n\xa0 \xa0 \xa0 \xa0 \xa0 }}\n\xa0 \xa0 \xa0 \xa0 >\n  )\n"]})]})}),"\n",(0,sa.jsx)(e.p,{children:"버튼을 누르면 DUMMY에 3000개의 데이터가 random().toString()을 거쳐서 들어갑니다."}),"\n",(0,sa.jsx)(e.p,{children:"sampling을 돌리면 toString이 가장 많이 차지한 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615165927.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"맨 오른쪽 파일 경로로 소스코드에 접근할 수도 있습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"Next.js 환경 디버깅하기"}),"\n",(0,sa.jsx)(e.p,{children:"클라이언트 사이드의 메모리 누수는 디바이스에 따라 다르고 그 영향은 해당 디바이스에만 닿지만 서버 사이드의 메모리 누수는 서버 자체에 부담을 줘서 모든 서비스에 영향을 줍니다."}),"\n",(0,sa.jsx)(e.p,{children:"dev tool로 서버단도 디버깅이 가능합니다."}),"\n",(0,sa.jsx)(e.h3,{children:"Next.js 디버그 모드"}),"\n",(0,sa.jsx)(e.h4,{children:"디버그 모드 실행"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// package.json"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"scripts"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"dev"'})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," NODE_OPTIONS='--inspect' next dev ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npm run dev\n\n여러가지 나오고\n\n이후 web socket 주소가 나옴\n"})}),"\n",(0,sa.jsx)(e.h5,{children:"window의 경우는 다름"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/pages/building-your-application/configuring/debugging",children:"https://nextjs.org/docs/pages/building-your-application/configuring/debugging"})}),"\n",(0,sa.jsxs)(e.p,{children:["cross-env를 설치한 후에\n",(0,sa.jsx)(e.a,{href:"https://www.npmjs.com/package/cross-env",children:"https://www.npmjs.com/package/cross-env"})]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"scripts"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"dev"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"\"cross-env NODE_OPTIONS='--inspect' next dev\""})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이렇게 해야 실행됩니다."}),"\n",(0,sa.jsx)(e.h4,{children:"개발자 도구 열기"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615171833.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"chrome://inspect로 이동하면 위와 같은 화면이 나옵니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615173042.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Open dedicated DevTools for Node를 클릭합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-15/Pasted%20image%2020240615173118.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"이제 해당 VM 인스턴스 (node 서버 환경)를 활용해서 디버깅할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"가상 시나리오를 세워서 서버에 트래픽을 발생시켜 확인해보겠습니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"ab"}),"는 웹서버 성능 검사 도구로 HTTP 서버의 성능을 벤치마킹할 수 있는 오픈소스 도구입니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:'ab -k -c 50 -n 10000 "http://127.0.0.1:3000/"\n'})}),"\n",(0,sa.jsx)(e.h5,{children:"윈도우용 ab 설치"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://stackoverflow.com/questions/49893994/apachebench-installation-on-windows-10",children:"https://stackoverflow.com/questions/49893994/apachebench-installation-on-windows-10"})}),"\n",(0,sa.jsx)(e.p,{children:"위 커맨드로 해당 url을 향해 50개의 요청을 10,000회 보낼 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"똑같이 서버단도 디버깅하면 메모리가 증가하는 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"SSR에서 메모리가 누수되면 서버에서 계속 쌓여서 과부하가 오기 때문에 순수함수로 구현해야 합니다."})]})}function eh(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(et,{...s})}):et(s)}function ej(s){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"Login"}),"\n",(0,sa.jsx)(e.h2,{children:"Login State Management"}),"\n",(0,sa.jsx)(e.p,{children:"The biggest difference between state management and the existing Context API is that the Context API only injects state, which can cause unnecessary re-renders and poor performance. Using a state management library has the advantage of allowing components to use global state without causing re-renders."}),"\n",(0,sa.jsx)(e.h3,{children:"Login State Management Using Existing Context (Global)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"}),", { createContext, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"User"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AuthContext"})," = createContext<{\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"User"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"logout"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n}>({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," {},\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"logout"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {},\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"AuthProvider"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children }: { children: React.ReactNode }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [user, setUser] = useState<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"User"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"login"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"localStorage"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setItem"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),", accessToken);\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"cookie"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`accessToken=",(0,sa.jsxs)(e.span,{className:"hljs-subst",children:["${",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"localStorage"}),".getItem(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),")}"]}),"`"]}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setUser"}),"({ accessToken });\n  };\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"logout"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setUser"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AuthContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"logout"})," }}>"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AuthContext.Provider"}),">"]})]}),"\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useAuth"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useContext"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AuthContext"}),");\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["This is a method of implementing login using Context.\nHowever, as mentioned before, using ",(0,sa.jsx)(e.code,{children:"useContext"})," is for injection to eliminate props drilling, which can cause unnecessary re-renders and poor performance.\nThis time, let's apply Zustand, one of the global state management libraries, simply."]}),"\n",(0,sa.jsx)(e.h3,{children:"zustand"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image.png",alt:"alt text"})}),"\n",(0,sa.jsx)(e.p,{children:"A small, fast, and scalable state management library.\nIt has a hook-based API and follows conventions similar to Flux (similar logic to Redux)."}),"\n",(0,sa.jsx)(e.h4,{children:"Actual Application"}),"\n",(0,sa.jsxs)(e.p,{children:["Since login state is information that must be maintained even when routes change, we use the ",(0,sa.jsx)(e.code,{children:"persist"})," middleware to store it in localStorage."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Cookies"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"js-cookie"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { create, ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"StateCreator"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zustand"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { persist } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zustand/middleware"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"User"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"UserState"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"User"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"refreshToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"logout"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"useStoreSlice"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"StateCreator"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"UserState"}),"> = ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"set"}),") =>"]})," ({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": { accessToken } }));\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"logout"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," })),\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," persistedUserStore = persist<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"UserState"}),">(useStoreSlice, {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"user"'}),",\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," useUserStore = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"create"}),"(persistedUserStore);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Now you can import this store in any component where you want to use it."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Validate format before sending network request"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"LoginPage"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," login = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useUserStore"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"state"}),") =>"]})," state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"login"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," navigate = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useNavigate"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n    register,\n    handleSubmit,\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"formState"}),": { errors },\n  } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useForm"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"resolver"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"zodResolver"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignInSchema"}),") });\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["In the code above, you can import the entire store with ",(0,sa.jsx)(e.code,{children:"useUserStore()"}),", but this can cause re-renders of all components connected to the store, so it's better to avoid this."]}),"\n",(0,sa.jsx)(e.p,{children:"Try to import them one by one as shown above."}),"\n",(0,sa.jsx)(e.p,{children:"Now the function that stores in localStorage, tracks it as state, and changes components accordingly is complete."}),"\n",(0,sa.jsx)(e.p,{children:"Next, let's think about refresh tokens."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"A refresh token is another token used to obtain an access token. It has a longer expiration time than an access token.\nUsually stored in session storage (disappears when the browser closes), localStorage (exists until expiration time if same Origin), or cookies (used in network communication. Can be used conveniently with libraries like js-cookies).\nTo manage access tokens and refresh tokens separately, we stored the refresh token in cookies and the access token in localStorage. (Storing in cookies is more secure due to HTTPS.)"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"RTR"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"RTR was not used in the end, but if you want to see the process I analyzed myself, please take a look, otherwise you can skip to React-hook-form!"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240614123700.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Usually refresh and access are stored in localStorage and cookies. By default, access has 30 minutes to 1 hour, and refresh token has 2 weeks."}),"\n",(0,sa.jsx)(e.p,{children:"Replacing the Access Token with a Refresh Token when it expires"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240614123857.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Client auth request > Auth0 verifies and sends verification code > Request access token using verification code > Auth0 gives access token, refresh token > When access token expires > Request access token from Auth0 using refresh token > Auth0 gives new access token and new refresh token."}),"\n",(0,sa.jsxs)(e.p,{children:["Since it keeps refreshing, it can protect against ",(0,sa.jsx)(e.strong,{children:"replay attacks"})," where access tokens are requested using already used tokens."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.strong,{children:"Replay Attack"}),"\nAn attack where an attacker intercepts a previously sent message and resends it to obtain the same credentials as the original message"]}),"\n",(0,sa.jsx)(e.h4,{children:"RTR Implementation"}),"\n",(0,sa.jsx)(e.h5,{children:"Example Analysis"}),"\n",(0,sa.jsx)(e.p,{children:"The following is an example from the referenced document."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-typescript",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"refreshTokenRotation"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create accessToken"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"expirationTime"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create expirationTime"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"getAccessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," () => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," refreshToken = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getRefreshToken"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get refreshToken using getRefreshToken"}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!accessToken || expirationTime < ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getTime"}),"()) {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If accessToken doesn't exist or expirationTime is less than now (expired)"}),"\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," axios\n          .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"post"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/api/refresh"'}),", {\n            refreshToken,\n          })\n          ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Refresh request, with token"}),"\n          .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"res"}),") =>"]})," {\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Store information with received response"}),"\n            accessToken = res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"}),";\n            expirationTime = res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"expirationTime"}),";\n            ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setRefreshToken"}),"(res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"refreshToken"}),");\n          })\n          .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If it fails, express that login has expired"}),"\n            accessToken = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n            expirationTime = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n            ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"로그인이 만료 되었습니다."'}),");\n          });\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," accessToken;\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"setAccessToken"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"at"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"et"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})]}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Set access token"}),"\n      accessToken = at;\n      expirationTime = et;\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteTokens"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Initialize and delete refresh token"}),"\n      accessToken = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n      expirationTime = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteRefreshToken"}),"();\n    },\n  };\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"After analysis was complete, I connected it to the actual code and applied it."}),"\n",(0,sa.jsx)(e.h5,{children:"Applied Code"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// shared/util/RTR.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { authInstance } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../api/axios"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { deleteRefreshToken, getRefreshToken, setRefreshToken } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./token"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InternalAxiosRequestConfig"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"axios"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Refresh Token Rotation"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"refreshTokenRotation"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create accessToken"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"expirationTime"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create expirationTime"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setAccessToken"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"at"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"et"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})]}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Set access token"}),"\n    accessToken = at;\n    expirationTime = et;\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteTokens"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Initialize and delete refresh token"}),"\n    accessToken = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    expirationTime = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteRefreshToken"}),"();\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"moveHome"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"location"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"href"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/"'}),";\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isExpired"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," now = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getTime"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (expirationTime ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"as"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),") < now;\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getNewTokens"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," refreshToken = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getRefreshToken"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get refreshToken using getRefreshToken"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," authInstance\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"post"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/auth/refresh-token"'}),", {\n        refreshToken,\n      })\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Refresh request, with token"}),"\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"res"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Store information with received response"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": { accessToken, expirationTime, refreshToken },\n        } = res;\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setAccessToken"}),"(accessToken, expirationTime);\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setRefreshToken"}),"(refreshToken);\n      })\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If it fails, express that login has expired"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteTokens"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"로그인이 만료 되었습니다."'}),");\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"moveHome"}),"();\n      });\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"setAuthHeader"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"config"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InternalAxiosRequestConfig"}),",\n    "]}),"): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InternalAxiosRequestConfig"}),"> {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!accessToken || ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isExpired"}),"()) {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getNewTokens"}),"();\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (config !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"})," && config.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"})," !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),") {\n        config.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"Authorization"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${accessToken}"}),"`"]}),";\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"axios config에 문제 발생"'}),");\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," config;\n    },\n  };\n};\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," axios ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"axios"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../constants/constants"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { refreshTokenRotation } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../util/RTR"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," instance = axios.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"create"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"baseURL"}),": ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," });\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," authInstance = axios.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"create"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"baseURL"}),": ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," });\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { setAuthHeader } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"refreshTokenRotation"}),"();\nauthInstance.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"interceptors"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"request"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"use"}),"(setAuthHeader);\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// RTR applied to interceptor"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," { authInstance, instance };\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Now the axios instance used for network requests requiring authorization is complete. It automatically checks the accessToken and re-adjusts using the refreshToken if it doesn't exist."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useStore } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/app/store"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { postSignIn } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/shared/api/api"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { zodResolver } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@hookform/resolvers/zod"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"FieldValues"}),", useForm } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react-hook-form"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Link"}),", useNavigate } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react-router-dom"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { z } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zod"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create schema"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," schema = z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"object"}),"({\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Specify form element validation"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"email"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"잘못된 이메일 형식입니다"'})," }), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Specify string to put in error.[name].message"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"비밀번호를 8자 이상 입력해주세요"'})," }),\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Validate format before sending network request"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"LoginPage"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { login } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useStore"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," navigate = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useNavigate"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n    register,\n    handleSubmit,\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"formState"}),": { errors },\n  } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useForm"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"resolver"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"zodResolver"}),"(schema) });\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Specify resolver to use zod in react-hook-form"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Cannot use async itself."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"onSubmit"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"d"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"FieldValues"})]}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Receive FieldValues from handleSubmit and process login."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Login processing ends with network request > storing accessToken in zustand store"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// The login itself is designed so that it contains logic to store the value in localStorage and cookie and change state, so you only need to send the value to login."}),"\n    (",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," () => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postSignIn"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),": d.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"email"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),": d.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"password"}),",\n      });\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!data) ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"login"}),"(data.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Move to root route when login is complete"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"navigate"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/"'}),");\n    })();\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      {/* Send event handler as submit event */}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleSubmit(onSubmit)}"}),">"]}),"\n        {/* Specify email using register */}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),'")} />']}),"\n        {/* Find element with email in zod and extract message (error) inside it */}\n        {errors.email?.message && ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{color:"}),'"',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"red"}),'"}}>']}),"errors.email?.message as string}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"}),">"]}),"}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),'")} />']}),"\n        {errors.password?.message && (\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{color:"}),'"',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"red"}),'"}}>']}),"{errors.password?.message as string}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"}),">"]}),"\n        )}\n        {/* Submit form event */}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"submit"'})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"to"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/signup"'}),">"]}),"회원가입",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),">"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"However, the above process requires communication with the backend. Logic is needed to send both refresh token and access token when a refresh token is received, and furthermore, when accessing simultaneously from two browsers (web, mobile), if one device receives a refresh token, the other device's refresh token becomes stale and logs out."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)("s",{children:"After countless struggles"})," I learned how login is generally handled\nand decided to apply all the technologies I learned in the process."]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"react-hook-form"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721171036.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Form validation is always a remaining task."}),"\n",(0,sa.jsx)(e.p,{children:'When I first encountered forms, I thought "Can\'t I just put state in each input?", but this causes unnecessary re-renders.'}),"\n",(0,sa.jsx)(e.p,{children:"The process of preventing this by making everything an uncontrolled component to reduce re-renders and applying validation is repetitive and painful."}),"\n",(0,sa.jsx)(e.p,{children:"Can't we automate all processes? A library was born."}),"\n",(0,sa.jsx)(e.p,{children:'The official documentation also shows it simply with a "just try it" feeling rather than explanation. The following is the code from "get started".'}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useForm, ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SubmitHandler"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react-hook-form"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Inputs"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"example"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exampleRequired"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n    register,\n    handleSubmit,\n    watch,\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"formState"}),": { errors },\n  } = useForm<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Inputs"}),">();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SubmitHandler"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Inputs"}),"> = ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(data);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"watch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"example"'}),")); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// watch input value by passing the name of it"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'/* "handleSubmit" will validate your inputs before invoking "onSubmit" */'}),"\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleSubmit(onSubmit)}"}),">"]}),'\n      {/* register your input into the hook by invoking the "register" function */}\n      ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultValue"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"test"'})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"example"}),'")} />']}),"\n\n      {/* include validation with required or other standard HTML validation rules */}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exampleRequired"}),'", { ',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"required:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"true"})," })} />"]}),"\n      {/* errors will return when field validation fails  */}\n      {errors.exampleRequired && ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"span"}),">"]}),"This field is required",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"span"}),">"]}),"}\n\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"submit"'})," />"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Just by looking at the code above and following it, simple validation is actually complete."}),"\n",(0,sa.jsx)(e.p,{children:"However, there are shortcomings. The process of writing validation in the config that goes into register is also tedious."}),"\n",(0,sa.jsx)(e.p,{children:"Also, I want various options to be included, and I want to separate these schemas to improve readability."}),"\n",(0,sa.jsx)(e.p,{children:"These processes are also tedious. A schema library was born."}),"\n",(0,sa.jsx)(e.h2,{children:"react-hook-form zod resolver"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721171054.png",alt:""})}),"\n",(0,sa.jsx)("s",{children:(0,sa.jsx)(e.p,{children:"This is why I wrote this article. I felt like a cool developer. What kind of name is zod?"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"TypeScript-first schema validation with static type inference"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"That is, it's for static type inference."}),"\n",(0,sa.jsx)(e.p,{children:'This also has a "just try it" feeling.'}),"\n",(0,sa.jsx)(e.p,{children:"So I tried it."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { z } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zod"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignUpSchema"})," = z\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"object"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nickname"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"이름을 2자 이상 입력해주세요"'})," }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"email"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"잘못된 이메일 형식입니다"'})," }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),": z\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"()\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"비밀번호를 8자 이상 입력해주세요"'})," }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"passwordConfirmation"}),": z\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"()\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"비밀번호를 8자 이상 입력해주세요"'})," }),\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"superRefine"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ passwordConfirmation, password }, ctx"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (passwordConfirmation !== password) {\n      ctx.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addIssue"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"code"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"custom"'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"비밀번호가 일치해야 합니다."'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"path"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"passwordConfirmation"'}),"],\n      });\n    }\n  });\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignUpType"})," = z.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"infer"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignUpSchema"}),">;\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This is a schema related to sign-up. As you can see, I separated the file to separate the schema and the react-hook-form that uses that schema."}),"\n",(0,sa.jsx)(e.p,{children:"Code readability also increases, and maintainability increases because you only need to change the schema."}),"\n",(0,sa.jsx)(e.p,{children:"Since the purpose is login, let's implement login-related schema and react-hook-form processing."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { z } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zod"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignInSchema"})," = z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"object"}),"({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"email"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"잘못된 이메일 형식입니다"'})," }),\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"비밀번호를 8자 이상 입력해주세요"'})," }),\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignInInput"})," = z.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"infer"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignInSchema"}),">;\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"First, it's a string and I applied basic email validation. Originally, there was a method called noneEmpty for required handling, but it was deprecated and can now be handled with min."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"LoginPage"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," login = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useUserStore"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"state"}),") =>"]})," state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"login"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," navigate = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useNavigate"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n    register,\n    handleSubmit,\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"formState"}),": { errors },\n  } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useForm"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"resolver"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"zodResolver"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignInSchema"}),") });\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleSubmit(onSubmit)}"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),'")} />']}),"\n          {errors.email?.message && (\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color:"}),' "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"red"}),'" }}>']}),"{errors.email?.message as string}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"}),">"]}),"\n          )}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),'")} ',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"password"'})," />"]}),"\n          {errors.password?.message && (\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color:"}),' "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"red"}),'" }}>']}),"{errors.password?.message as string}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"}),">"]}),"\n          )}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"submit"'})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"to"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/signup"'}),">"]}),"회원가입",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),">"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Apply the schema by putting it in a function called zodResolver as shown in the code above."}),"\n",(0,sa.jsx)(e.p,{children:"Is it done now?"}),"\n",(0,sa.jsx)(e.p,{children:"No. Since RTR failed, I have to embark on another refresh token journey!"}),"\n",(0,sa.jsx)(e.p,{children:"Existing API requests used axios to simply handle headers or basic settings."}),"\n",(0,sa.jsx)(e.p,{children:"Since refresh tokens are really a basic web concept, I thought axios might have created something to handle it, so I read the documentation thoroughly."}),"\n",(0,sa.jsx)(e.p,{children:"And I found interceptors."}),"\n",(0,sa.jsx)(e.h2,{children:"axios interceptor"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721171000.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add a request interceptor"}),"\naxios.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"interceptors"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"request"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"use"}),"(\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"config"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Do something before request is sent"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," config;\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Do something with request error"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(error);\n  },\n);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add a response interceptor"}),"\naxios.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"interceptors"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"response"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"use"}),"(\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Any status code that lie within the range of 2xx cause this function to trigger"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Do something with response data"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," response;\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Any status codes that falls outside the range of 2xx cause this function to trigger"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Do something with response error"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(error);\n  },\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This is code from the official documentation. It's really simple, but there are many things to interpret, such as performing operations by passing config and throwing errors to operations with Promise.reject(error)."}),"\n",(0,sa.jsx)(e.p,{children:"As always, I decided to try it first."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useUserStore } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/app/store"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../constants/constants"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," axios, {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AxiosError"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateAxiosDefaults"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InternalAxiosRequestConfig"}),",\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"axios"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { postAuthRefreshToken } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./api"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Set retry confirmation property"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomAxiosRequestConfig"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"extends"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InternalAxiosRequestConfig"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"_retry"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"boolean"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Basic settings"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"baseConfig"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateAxiosDefaults"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"baseURL"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${BASE_URL}"}),"`"]}),",\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Instance without interceptors that exposes cookies and doesn't need authentication"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," instanceWithoutInterceptors = axios.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"create"}),"(baseConfig);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Instance that needs authentication"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," instance = axios.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"create"}),"(baseConfig);\n\ninstance.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"interceptors"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"request"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"use"}),"(\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Execute before request"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"config"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get token"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," accessToken = useUserStore.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getState"}),"().",(0,sa.jsx)(e.span,{className:"hljs-property",children:"user"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"}),";\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add token to header"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (accessToken) {\n      config.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"Authorization"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${accessToken}"}),"`"]}),";\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Return config"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," config;\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Execute when request error occurs"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(error);\n  },\n);\n\ninstance.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"interceptors"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"response"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"use"}),"(\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Execute when response succeeds"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," response;\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Execute when response error occurs"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"error"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AxiosError"})]}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get error information"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"originalRequest"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomAxiosRequestConfig"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"})," = error.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"config"}),";\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Retry when token expires"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (\n      error.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"response"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"401"})," &&\n      originalRequest &&\n      !originalRequest.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"_retry"}),"\n    ) {\n      originalRequest.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"_retry"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),";\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"try"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Reissue token"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postAuthRefreshToken"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Update token"}),"\n        useUserStore.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setState"}),"({\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": response.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"})," },\n        });\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add token to header"}),"\n        originalRequest.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"Authorization"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${response.accessToken}"}),"`"]}),";\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Retry"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"instance"}),"(originalRequest);\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"catch"})," (error) {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When token has expired"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"instanceof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AxiosError"})," && error.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"response"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"403"}),") {\n          ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Logout"}),"\n          useUserStore.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getState"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"logout"}),"();\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n        }\n      }\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(error);\n  },\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"First, not all instances need authentication. There is data that can be accessed without an accessToken, so we separate them. (instanceWithoutInterceptors)"}),"\n",(0,sa.jsx)(e.p,{children:"We need to branch into two types."}),"\n",(0,sa.jsx)(e.h3,{children:"Before Request"}),"\n",(0,sa.jsx)(e.p,{children:"Since we're storing accessToken with zustand, we retrieve it and put the token in Authorization."}),"\n",(0,sa.jsx)(e.h3,{children:"After Request"}),"\n",(0,sa.jsx)(e.p,{children:"The successful case is the same, but when it fails, we need to get an accessToken using a refresh token."}),"\n",(0,sa.jsx)(e.p,{children:"It's usually expressed as 401 (Unauthorization Error), and since our API is the same, we handle it accordingly."}),"\n",(0,sa.jsx)(e.p,{children:"After that, you can put the instance itself in the return to retry."}),"\n",(0,sa.jsxs)(e.p,{children:["This way, due to ",(0,sa.jsx)(e.code,{children:"_retry"}),", it only refreshes the access token using the refresh token once, retries the request, and if not, it goes to Promise.reject and finishes."]}),"\n",(0,sa.jsx)(e.h2,{children:"Result"}),"\n",(0,sa.jsx)(e.p,{children:"You can confirm that the accessToken goes into localStorage at the same time as login"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721173745.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can confirm that refreshToken is properly in cookies."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721173806.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"When the accessToken expires, it appears in the network tab as follows."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721174651.png",alt:""})}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Request requiring authentication fails."}),"\n",(0,sa.jsx)(e.li,{children:"Send refresh-token request. Update access token."}),"\n",(0,sa.jsx)(e.li,{children:"Send request requiring authentication again."}),"\n",(0,sa.jsx)(e.li,{children:"Send authentication based on request requiring authentication."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Afterword"}),"\n",(0,sa.jsx)(e.p,{children:"I learned about login, a small but huge feature."}),"\n",(0,sa.jsx)(e.p,{children:"There are still remaining tasks like auto-login or processing components like headers that detect this and re-render,"}),"\n",(0,sa.jsx)(e.p,{children:"but I think this is the core part of authentication-related aspects. (OAuth or OIDC remain)"}),"\n",(0,sa.jsx)(e.p,{children:"I was able to confirm the rich frontend environment where various libraries fill parts that would be very difficult to implement in vanilla."}),"\n",(0,sa.jsx)(e.p,{children:"I think this is the part where you shouldn't hesitate when learning libraries. Let's approach it with the mindset that it's just a tool."}),"\n",(0,sa.jsx)(e.h2,{children:"Reference"}),"\n",(0,sa.jsx)("a",{href:"https://docs.pmnd.rs/zustand/getting-started/introduction",children:(0,sa.jsx)(e.p,{children:"zustand official documentation"})}),"\n",(0,sa.jsx)("a",{href:"https://react-hook-form.com/",children:"react-hook-form official documentation"}),"\n",(0,sa.jsx)("a",{href:"https://zod.dev/",children:"zod official documentation"}),"\n",(0,sa.jsx)("a",{href:"https://github.com/react-hook-form/resolvers?tab=readme-ov-file#zod",children:(0,sa.jsx)(e.p,{children:"react-hook-form/zod resolver"})}),"\n",(0,sa.jsx)("a",{href:"https://axios-http.com/docs/interceptors",children:"axios interceptors"}),"\n",(0,sa.jsx)("a",{href:"https://github.com/colinhacks/zod/discussions",children:"zod discussion"}),"\n",(0,sa.jsx)("a",{href:"https://velog.io/@chchaeun/%EC%9D%B8%EC%A6%9D%EA%B3%BC",children:(0,sa.jsx)(e.p,{children:"개발새발.log"})}),"\n",(0,sa.jsx)("a",{href:"https://medium.com/@kirankumal714/implementing-refresh-token-in-react-using-axios-zustand-and-react-query-a5dbac2944b6",children:(0,sa.jsx)(e.p,{children:"Kiran Kumal Medium"})}),"\n",(0,sa.jsx)("a",{href:"https://auth0.com/docs/secure/tokens/refresh-tokens/refresh-token-rotation#maintain-user-sessions-in-spas",children:(0,sa.jsx)(e.p,{children:"auth0 by Okta"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"This is material for personal learning!"}),"\n",(0,sa.jsx)(e.p,{children:"If there are any incorrect contents, please let me know. Thank you."}),"\n"]})]})}function ed(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(ej,{...s})}):ej(s)}function eo(s){let e={blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"로그인"}),"\n",(0,sa.jsx)(e.h2,{children:"로그인 상태관리"}),"\n",(0,sa.jsx)(e.p,{children:"상태 관리와 기존 context api의 가장 큰 차이점은 context api는 상태를 주입하는 것뿐이기 때문에 불필요한 리렌더링이 발생할 수 있어 성능이 좋지 않습니다. 상태 관리 라이브러리를 사용하면 리렌더링이 발생하지 않고 컴포넌트에게 전역 상태를 사용할 수 있다는 장점이 있습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"기존 context를 이용한 로그인 상태 관리 (전역)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"}),", { createContext, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"User"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AuthContext"})," = createContext<{\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"User"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"logout"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n}>({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," {},\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"logout"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {},\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"AuthProvider"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children }: { children: React.ReactNode }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [user, setUser] = useState<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"User"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"login"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"localStorage"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setItem"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),", accessToken);\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"cookie"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`accessToken=",(0,sa.jsxs)(e.span,{className:"hljs-subst",children:["${",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"localStorage"}),".getItem(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),")}"]}),"`"]}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setUser"}),"({ accessToken });\n  };\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"logout"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setUser"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AuthContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"logout"})," }}>"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AuthContext.Provider"}),">"]})]}),"\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useAuth"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useContext"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AuthContext"}),");\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"기존 로그인을 Context를 이용해서 구현한 방법입니다.\n하지만 이전에 이야기한 것처럼 useContext를 활용한 방식은 props drilling을 없애기 위해 주입하는 것이라 불필요한 리렌더링이 발생하여 성능이 좋지 않을 수 있습니다.\n이번에 전역 상태 관리 라이브러리 중 하나인 zustand를 간단하게 적용해보겠습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"zustand"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image.png",alt:"alt text"})}),"\n",(0,sa.jsx)(e.p,{children:"사이즈가 작고 빠르고 확장성 있는 상태 관리 라이브러리입니다.\nhook에 기반한 API를 가졌으며 flux와 비슷한 컨벤션을 가지고 있습니다. (redux와 유사한 로직)"}),"\n",(0,sa.jsx)(e.h4,{children:"실제 적용"}),"\n",(0,sa.jsx)(e.p,{children:"로그인 상태는 라우트가 바뀌어도 갖고 있어야 하는 정보이므로 persist라는 미들웨어를 사용해서 로컬스토리지에 저장합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Cookies"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"js-cookie"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { create, ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"StateCreator"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zustand"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { persist } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zustand/middleware"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"User"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"UserState"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"User"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"refreshToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"logout"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"useStoreSlice"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"StateCreator"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"UserState"}),"> = ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"set"}),") =>"]})," ({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": { accessToken } }));\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"logout"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," })),\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," persistedUserStore = persist<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"UserState"}),">(useStoreSlice, {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"user"'}),",\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," useUserStore = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"create"}),"(persistedUserStore);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이제 사용하고 싶은 컴포넌트에서 해당 store를 가져오면 됩니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 네트워크 요청을 보내기 전에 형식 검사"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"LoginPage"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," login = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useUserStore"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"state"}),") =>"]})," state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"login"}),");\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," navigate = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useNavigate"}),"();\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n\xa0 \xa0 register,\n\xa0 \xa0 handleSubmit,\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"formState"}),": { errors },\n\xa0 } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useForm"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"resolver"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"zodResolver"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignInSchema"}),") });\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위의 코드에서 useUserStore()로 한 스토어를 통째로 가져올 수 있는데 이는 스토어와 연결된 모든 컴포넌트들을 리렌더링시킬 수 있기 때문에 지양하는 것이 좋다."}),"\n",(0,sa.jsx)(e.p,{children:"되도록이면 위처럼 하나씩 가져오자."}),"\n",(0,sa.jsx)(e.p,{children:"이제 로컬스토리지에 담고 상태로 추적하며 이로 인해 컴포넌트가 바뀌는 함수는 처리가 완료되었다."}),"\n",(0,sa.jsx)(e.p,{children:"다음은 refresh Token에 대해 고민해보겠습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"refresh Token이란 access Token을 받기 위한 또 하나의 토큰입니다. access Token보다 expire time이 깁니다.\n보통 세션 스토리지 (브라우저 닫히면 없어짐), 로컬 스토리지 (같은 Origin일 경우 expire time까지 있음), 쿠키 (네트워크 통신에서 사용합니다. js-Cookies 같은 라이브러리로 편리하게 사용할 수 있습니다.)\n에 저장해둡니다.\naccess Token과 refresh Token을 분리해서 관리하기 위해 refresh Token은 쿠키에, access Token은 로컬 스토리지에 저장했습니다. (쿠키에 저장하는 것이 HTTPS로 인해 더 보안성이 좋습니다.)"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"RTR"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"RTR은 결국 쓰지 않았습니다 그래도 스스로 분석해낸 과정을 보고 싶으시면 봐주시고 아니면 React-hook-form 으로 넘어가 주시면 됩니다!"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240614123700.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"보통 refresh와 access는 로컬스토리지, 쿠키에 저장합니다. 기본값으로 access는 30분~1시간, refresh token은 2주의 시간을 가집니다."}),"\n",(0,sa.jsx)(e.p,{children:"Access Token이 만료되면 Refresh Token과 함께 교체해주는 것"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240614123857.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"클라에서 auth 요청 > Auth0에서 검증 후 검증 코드를 보내줌 > 검증 코드를 이용해서 access Token 요청 > Auth0가 access Token, refresh Token 줌 > 이후 access Token 만기시 > refresh Token으로 Auth0에 access Token 요청 > Auth0가 새로운 access Token와 새로운 refresh Token을 줌."}),"\n",(0,sa.jsxs)(e.p,{children:["계속 갱신하기 때문에 이미 사용된 토큰으로 access Token을 요청하는 ",(0,sa.jsx)(e.strong,{children:"replay attack"}),"로부터 보호할 수 있습니다."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.strong,{children:"Replay Attack"}),(0,sa.jsx)(e.br,{}),"\n","공격자가 원본 메시지와 같은 자격증명을 얻기 위해 이전에 보내진 메시지를 가로채서 다시 보내는 것"]}),"\n",(0,sa.jsx)(e.h4,{children:"RTR 구현"}),"\n",(0,sa.jsx)(e.h5,{children:"예제 분석"}),"\n",(0,sa.jsx)(e.p,{children:"다음은 참고한 문서에서 나온 예제입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-typescript",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"refreshTokenRotation"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// accessToken 생성"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"expirationTime"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// expirationTime 생성"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"getAccessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," () => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," refreshToken = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getRefreshToken"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// getRefreshToken으로 refreshToken 가져오기"}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!accessToken || expirationTime < ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getTime"}),"()) {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// accessToken이 없거나 expirationTime이 지금보다 작으면 (만기되면)"}),"\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," axios\n          .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"post"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/api/refresh"'}),", {\n            refreshToken,\n          })\n          ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// refresh 요청, 토큰을 담아서"}),"\n          .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"res"}),") =>"]})," {\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 받은 응답으로 정보 저장"}),"\n            accessToken = res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"}),";\n            expirationTime = res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"expirationTime"}),";\n            ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setRefreshToken"}),"(res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"refreshToken"}),");\n          })\n          .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 안되면 로그인 만료되었다고 표현"}),"\n            accessToken = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n            expirationTime = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n            ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"로그인이 만료 되었습니다."'}),");\n          });\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," accessToken;\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"setAccessToken"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"at"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"et"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})]}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 접근 토큰 설정"}),"\n      accessToken = at;\n      expirationTime = et;\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteTokens"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 초기화 후 리프레쉬 토큰 삭제"}),"\n      accessToken = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n      expirationTime = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteRefreshToken"}),"();\n    },\n  };\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"분석이 완료된 후 실제 코드와 연결하여 적용해보았다."}),"\n",(0,sa.jsx)(e.h5,{children:"응용 코드"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// shared/util/RTR.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { authInstance } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../api/axios"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { deleteRefreshToken, getRefreshToken, setRefreshToken } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./token"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InternalAxiosRequestConfig"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"axios"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Refresh Token Rotation"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"refreshTokenRotation"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// accessToken 생성"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"expirationTime"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// expirationTime 생성"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setAccessToken"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"at"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"et"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})]}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 접근 토큰 설정"}),"\n    accessToken = at;\n    expirationTime = et;\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteTokens"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 초기화 후 리프레쉬 토큰 삭제"}),"\n    accessToken = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    expirationTime = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteRefreshToken"}),"();\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"moveHome"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"location"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"href"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/"'}),";\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isExpired"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," now = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getTime"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (expirationTime ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"as"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),") < now;\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getNewTokens"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," refreshToken = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getRefreshToken"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// getRefreshToken으로 refreshToken 가져오기"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," authInstance\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"post"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/auth/refresh-token"'}),", {\n        refreshToken,\n      })\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// refresh 요청, 토큰을 담아서"}),"\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"res"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 받은 응답으로 정보 저장"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": { accessToken, expirationTime, refreshToken },\n        } = res;\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setAccessToken"}),"(accessToken, expirationTime);\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setRefreshToken"}),"(refreshToken);\n      })\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 안되면 로그인 만료되었다고 표현"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteTokens"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"로그인이 만료 되었습니다."'}),");\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"moveHome"}),"();\n      });\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"setAuthHeader"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"config"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InternalAxiosRequestConfig"}),",\n    "]}),"): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InternalAxiosRequestConfig"}),"> {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!accessToken || ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isExpired"}),"()) {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getNewTokens"}),"();\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (config !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"})," && config.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"})," !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),") {\n        config.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"Authorization"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${accessToken}"}),"`"]}),";\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"axios config에 문제 발생"'}),");\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," config;\n    },\n  };\n};\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," axios ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"axios"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../constants/constants"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { refreshTokenRotation } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../util/RTR"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," instance = axios.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"create"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"baseURL"}),": ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," });\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," authInstance = axios.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"create"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"baseURL"}),": ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," });\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { setAuthHeader } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"refreshTokenRotation"}),"();\nauthInstance.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"interceptors"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"request"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"use"}),"(setAuthHeader);\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// interceptor에 RTR이 적용된"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," { authInstance, instance };\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이제 authorization이 필요한 네트워크 요청에 사용되는 axios instance가 완성되었다. 자동으로 accessToken을 검사해서 없으면 refreshToken을 이용해서 재조정해준다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useStore } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/app/store"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { postSignIn } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/shared/api/api"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { zodResolver } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@hookform/resolvers/zod"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"FieldValues"}),", useForm } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react-hook-form"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Link"}),", useNavigate } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react-router-dom"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { z } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zod"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// schema 생성"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," schema = z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"object"}),"({\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// form 요소 유효성 검사 지정"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"email"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"잘못된 이메일 형식입니다"'})," }), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// error.[name].message에 담을 string 지정"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"비밀번호를 8자 이상 입력해주세요"'})," }),\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 네트워크 요청을 보내기 전에 형식 검사"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"LoginPage"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { login } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useStore"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," navigate = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useNavigate"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n    register,\n    handleSubmit,\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"formState"}),": { errors },\n  } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useForm"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"resolver"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"zodResolver"}),"(schema) });\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// zod를 react-hook-form에서 사용하기 위한 resolver 지정"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 자체 async는 사용할 수 없다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"onSubmit"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"d"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"FieldValues"})]}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// handleSubmit으로부터 FieldValues를 받아서 로그인 처리함."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 로그인 처리는 네트워크 요청 > accessToken을 zustand store에 담는 것으로 종료"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// login자체에 localStorage, cookie에 해당 값을 저장하고 상태를 바꾸는 로직이 들어가 있어서 login에 값만 보내면 되게 설계되어 있음."}),"\n    (",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," () => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postSignIn"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),": d.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"email"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),": d.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"password"}),",\n      });\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!data) ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"login"}),"(data.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 로그인 완료시 루트 라우트로 이동"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"navigate"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/"'}),");\n    })();\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n    \xa0{/* 이벤트 핸들러를 submit event로 보낸다.\xa0*/}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleSubmit(onSubmit)}"}),">"]}),"\n    \xa0{/* register를 이용해서 email을 지정\xa0*/}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),'")} />']}),"\n    \xa0{/* zod에서 email을 가진 요소를 찾아서 그 안의 message(에러)를 꺼낸다.\xa0*/}\n        {errors.email?.message && ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{color:"}),'"',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"red"}),'"}}>']}),"errors.email?.message as string}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"}),">"]}),"}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),'")} />']}),"\n        {errors.password?.message && (\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{color:"}),'"',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"red"}),'"}}>']}),"{errors.password?.message as string}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"}),">"]}),"\n        )}\n    \xa0{/* form event를 제출한다.\xa0*/}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"submit"'})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"to"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/signup"'}),">"]}),"회원가입",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),">"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"하지만 위의 과정은 백엔드와의 소통이 필요하다. refresh 토큰을 받았을 때 refresh Token과 access Token을 같이 전달해주는 로직이 필요하고 더불어 두 개의 브라우저 (웹, 모바일) 에서 동시에 접속했을 때 하나의 기기에서 refresh Token을 받으면 다른 기기의 refresh Token은 stale하게 되어 로그아웃되는 사태가 발생한다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)("s",{children:"수많은 삽질 끝에"})," 일반적으로 어떤 방식으로 로그인을 처리하는지\n알아보았고 그 과정에서 알게된 기술을 몽땅 적용해보기로 하였다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"react-hook-form"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721171036.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"form validation은 항상 남아 있는 숙제입니다."}),"\n",(0,sa.jsx)(e.p,{children:'처음 form을 접했을 때는 "그냥 state로 input마다 박아넣으면 안되나?" 라는 생각을 했으나 이는 불필요한 리렌더링을 일으킵니다.'}),"\n",(0,sa.jsx)(e.p,{children:"이를 방지하기 위해 비제어 컴포넌트로 전부 만들면서 리렌더링을 줄이고 validation을 입히는 과정은 반복적이며 고통스럽습니다."}),"\n",(0,sa.jsx)(e.p,{children:"모든 과정을 자동화할 순 없을까? 라이브러리가 탄생했습니다."}),"\n",(0,sa.jsx)(e.p,{children:'공식문서에서도 설명보다 "그냥 일단 써봐" 하는 느낌으로 간단하게 보여주고 있습니다. 다음은 "get started"의 코드입니다.'}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useForm, ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SubmitHandler"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react-hook-form"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Inputs"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"example"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exampleRequired"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n    register,\n    handleSubmit,\n    watch,\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"formState"}),": { errors },\n  } = useForm<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Inputs"}),">();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SubmitHandler"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Inputs"}),"> = ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(data);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"watch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"example"'}),")); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// watch input value by passing the name of it"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'/* "handleSubmit" will validate your inputs before invoking "onSubmit" */'}),"\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleSubmit(onSubmit)}"}),">"]}),'\n      {/* register your input into the hook by invoking the "register" function */}\n      ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultValue"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"test"'})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"example"}),'")} />']}),"\n\n      {/* include validation with required or other standard HTML validation rules */}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exampleRequired"}),'", { ',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"required:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"true"})," })} />"]}),"\n      {/* errors will return when field validation fails  */}\n      {errors.exampleRequired && ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"span"}),">"]}),"This field is required",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"span"}),">"]}),"}\n\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"submit"'})," />"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위의 코드만 보고 따라치면 사실 간단한 validation은 완성입니다."}),"\n",(0,sa.jsx)(e.p,{children:"하지만 부족한 점이 존재합니다. register에 config로 들어가 있는 validation을 적는 과정도 귀찮아집니다."}),"\n",(0,sa.jsx)(e.p,{children:"또한 다양한 옵션이 들어갔으면 좋겠고 그러한 스키마들을 분리해서 가독성을 높이고 싶습니다."}),"\n",(0,sa.jsx)(e.p,{children:"이 과정들도 귀찮습니다. schema 라이브러리가 탄생했습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"react-hook-form zod resolver"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721171054.png",alt:""})}),"\n",(0,sa.jsx)("s",{children:(0,sa.jsx)(e.p,{children:"이 글을 쓰게 된 이유입니다. 멋있는 개발자가 된 느낌이었습니다. 이름도 어떻게 zod입니까?"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"TypeScript-first schema validation with static type inference"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"즉 정적 타입 추론을 위한 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"이것도 일단 써봐 느낌입니다."}),"\n",(0,sa.jsx)(e.p,{children:"그래서 일단 써보았습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { z } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zod"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignUpSchema"})," = z\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"object"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nickname"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"이름을 2자 이상 입력해주세요"'})," }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"email"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"잘못된 이메일 형식입니다"'})," }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),": z\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"()\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"비밀번호를 8자 이상 입력해주세요"'})," }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"passwordConfirmation"}),": z\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"()\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"비밀번호를 8자 이상 입력해주세요"'})," }),\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"superRefine"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ passwordConfirmation, password }, ctx"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (passwordConfirmation !== password) {\n      ctx.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addIssue"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"code"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"custom"'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"비밀번호가 일치해야 합니다."'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"path"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"passwordConfirmation"'}),"],\n      });\n    }\n  });\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignUpType"})," = z.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"infer"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignUpSchema"}),">;\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"회원가입 관련 schema입니다. 보다시피 파일을 분리시켜서 schema와 그 schema를 사용하는 react-hook-form을 분리시켰습니다."}),"\n",(0,sa.jsx)(e.p,{children:"코드의 가독성도 늘어나며 schema만 변경하면 되어 유지보수성이 늘어납니다."}),"\n",(0,sa.jsx)(e.p,{children:"목적은 로그인이니 로그인 관련 schema와 react-hook-form 처리를 구현해보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { z } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zod"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignInSchema"})," = z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"object"}),"({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"email"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"잘못된 이메일 형식입니다"'})," }),\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),": z.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"string"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"비밀번호를 8자 이상 입력해주세요"'})," }),\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignInInput"})," = z.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"infer"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignInSchema"}),">;\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"우선 string이고 기본적인 email validation을 입혔습니다. 원래는 noneEmpty 라는 메소드로 required 처리를 했다고 하는데 deprecated되었고 min으로 처리할 수 있게 되었습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"LoginPage"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," login = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useUserStore"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"state"}),") =>"]})," state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"login"}),");\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," navigate = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useNavigate"}),"();\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n\xa0 \xa0 register,\n\xa0 \xa0 handleSubmit,\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"formState"}),": { errors },\n\xa0 } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useForm"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"resolver"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"zodResolver"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SignInSchema"}),") });\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n\xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n\xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleSubmit(onSubmit)}"}),">"]}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"email"}),'")} />']}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 {errors.email?.message && (\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color:"}),' "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"red"}),'" }}>']}),"{errors.email?.message as string}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"}),">"]}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 )}\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...register"}),'("',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"password"}),'")} ',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"password"'})," />"]}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 {errors.password?.message && (\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color:"}),' "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"red"}),'" }}>']}),"{errors.password?.message as string}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"}),">"]}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 )}\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"input"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"submit"'})," />"]}),"\n\xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"form"}),">"]}),"\n\xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"to"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/signup"'}),">"]}),"회원가입",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),">"]}),"\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위 코드처럼 zodResolver라는 함수에 넣어서 schema를 적용시킨다."}),"\n",(0,sa.jsx)(e.p,{children:"이제 끝난걸까?"}),"\n",(0,sa.jsx)(e.p,{children:"아니다. RTR이 실패했기 때문에 또다른 refresh Token 여정을 떠나야 한다!"}),"\n",(0,sa.jsx)(e.p,{children:"기존의 api 요청은 axios로 header나 기본 설정들을 간단하게 처리했었다."}),"\n",(0,sa.jsx)(e.p,{children:"refresh Token은 정말 기본적인 웹 개념이니까 axios에서 처리할 수 있는 무언가를 만들지 않았을까 하는 생각에 문서를 정독했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"그리고 찾아낸 interceptor입니다."}),"\n",(0,sa.jsx)(e.h2,{children:"axios interceptor"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721171000.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 요청 인터셉터 추가하기"}),"\naxios.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"interceptors"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"request"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"use"}),"(\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"config"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 요청이 전달되기 전에 작업 수행"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," config;\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 요청 오류가 있는 작업 수행"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(error);\n  },\n);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 응답 인터셉터 추가하기"}),"\naxios.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"interceptors"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"response"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"use"}),"(\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2xx 범위에 있는 상태 코드는 이 함수를 트리거 합니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 응답 데이터가 있는 작업 수행"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," response;\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2xx 외의 범위에 있는 상태 코드는 이 함수를 트리거 합니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 응답 오류가 있는 작업 수행"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(error);\n  },\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"공식문서에 존재하는 코드입니다. 정말 간단하게 되어있지만 config를 전달해서 작업을 수행하고, Promise.reject(error)로 작업에 error를 던지는 등 해석해야 될 만한 거리들이 많습니다."}),"\n",(0,sa.jsx)(e.p,{children:"늘 그랬듯 일단 부딪혀 보기로 했습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useUserStore } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/app/store"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BASE_URL"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../constants/constants"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," axios, {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AxiosError"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateAxiosDefaults"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InternalAxiosRequestConfig"}),",\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"axios"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { postAuthRefreshToken } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./api"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 재시도 확인 프로퍼티 설정"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomAxiosRequestConfig"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"extends"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InternalAxiosRequestConfig"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"_retry"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"boolean"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 기본 설정"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"baseConfig"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateAxiosDefaults"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"baseURL"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${BASE_URL}"}),"`"]}),",\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 쿠키 드러내고 인증 필요없는 인스턴스"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," instanceWithoutInterceptors = axios.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"create"}),"(baseConfig);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 인증 필요한 인스턴스"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," instance = axios.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"create"}),"(baseConfig);\n\ninstance.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"interceptors"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"request"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"use"}),"(\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 요청 전에 실행"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"config"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 토큰 가져오기"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," accessToken = useUserStore.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getState"}),"().",(0,sa.jsx)(e.span,{className:"hljs-property",children:"user"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"}),";\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 헤더에 토큰 추가"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (accessToken) {\n      config.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"Authorization"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${accessToken}"}),"`"]}),";\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 설정 반환"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," config;\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 요청 에러 발생 시 실행"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(error);\n  },\n);\n\ninstance.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"interceptors"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"response"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"use"}),"(\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 응답 성공 시 실행"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," response;\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 응답 에러 발생 시 실행"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"error"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AxiosError"})]}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 에러 정보 가져오기"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"originalRequest"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomAxiosRequestConfig"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"})," = error.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"config"}),";\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 토큰 만료 시 재시도"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (\n      error.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"response"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"401"})," &&\n      originalRequest &&\n      !originalRequest.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"_retry"}),"\n    ) {\n      originalRequest.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"_retry"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),";\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"try"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 토큰 재발급"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postAuthRefreshToken"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 토큰 갱신"}),"\n        useUserStore.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setState"}),"({\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"user"}),": { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"accessToken"}),": response.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"})," },\n        });\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 헤더에 토큰 추가"}),"\n        originalRequest.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"Authorization"})," = ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${response.accessToken}"}),"`"]}),";\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 재시도"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"instance"}),"(originalRequest);\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"catch"})," (error) {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 토큰이 만료되었을 때"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"instanceof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AxiosError"})," && error.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"response"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"403"}),") {\n          ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 로그아웃"}),"\n          useUserStore.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getState"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"logout"}),"();\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n        }\n      }\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(error);\n  },\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"우선 모든 instance가 인증이 필요한 건 아닙니다. accessToken 없이도 접근할 수 있는 데이터가 있으니 분리합니다. (instanceWithoutInterceptors)"}),"\n",(0,sa.jsx)(e.p,{children:"두 가지로 분기를 나눠야 합니다."}),"\n",(0,sa.jsx)(e.h3,{children:"요청 전"}),"\n",(0,sa.jsx)(e.p,{children:"zustand로 accessToken을 저장하고 있으니 꺼내와서 Authorization에 토큰을 담습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"요청 후"}),"\n",(0,sa.jsx)(e.p,{children:"성공한 경우는 똑같지만 실패했을 때 refresh Token으로 accessToken을 받아와야 합니다."}),"\n",(0,sa.jsx)(e.p,{children:"보통 401 (Unauthorization Error)로 표현되고 지금 api에도 그렇기 때문에 맞게 처리합니다."}),"\n",(0,sa.jsx)(e.p,{children:"이후 instance 자체를 return으로 넣어서 다시 시도시켜주면 됩니다."}),"\n",(0,sa.jsxs)(e.p,{children:["이렇게 되면 ",(0,sa.jsx)(e.code,{children:"_retry"}),"로 인해 단 한 번만 refresh Token으로 access Token을 갱신해서 요청을 다시 시행하고 아닐 경우 Promise.reject로 가서 마무리됩니다."]}),"\n",(0,sa.jsx)(e.h2,{children:"결과"}),"\n",(0,sa.jsx)(e.p,{children:"로그인과 동시에 accessToken은 localStorage로 들어가는 것을 확인할 수 있고"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721173745.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"refreshToken은 쿠키에 잘 있는 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721173806.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"accessToken이 만료되면 network 탭에 다음과 같이 표시됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-06-17/Pasted%20image%2020240721174651.png",alt:""})}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"인증이 필요한 요청을 실패합니다."}),"\n",(0,sa.jsx)(e.li,{children:"refresh-token 요청을 보냅니다. access Token을 갱신합니다."}),"\n",(0,sa.jsx)(e.li,{children:"다시 인증이 필요한 요청을 보냅니다."}),"\n",(0,sa.jsx)(e.li,{children:"인증이 필요한 요청을 기반으로 인증을 보냅니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"후기"}),"\n",(0,sa.jsx)(e.p,{children:"로그인이라는 작지만 거대한 기능을 알아보았습니다."}),"\n",(0,sa.jsx)(e.p,{children:"자동 로그인이나 이를 감지하고 리렌더링되는 헤더 같은 컴포넌트 처리가 남아있긴 했지만"}),"\n",(0,sa.jsx)(e.p,{children:"인증에 관련된 부분의 핵심적인 부분은 이 정도인 것 같습니다. (OAuth나 OIDC 같은 게 남긴 했지만)"}),"\n",(0,sa.jsx)(e.p,{children:"바닐라로 구현할 경우 굉장히 어려울 법한 부분들을 다양한 라이브러리가 채워주는 풍성한 프론트엔드 환경을 확인할 수 있었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"라이브러리를 학습하는 데 있어서 주저 없어야 하는 부분이 이런 것 같습니다. 그냥 도구이기에 라는 마음가짐으로 임해보겠습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"Reference"}),"\n",(0,sa.jsx)("a",{href:"https://docs.pmnd.rs/zustand/getting-started/introduction",children:(0,sa.jsx)(e.p,{children:"zustand 공식문서"})}),"\n",(0,sa.jsx)("a",{href:"https://react-hook-form.com/",children:"react-hook-form 공식문서"}),"\n",(0,sa.jsx)("a",{href:"https://zod.dev/",children:"zod 공식 문서"}),"\n",(0,sa.jsx)("a",{href:"https://github.com/react-hook-form/resolvers?tab=readme-ov-file#zod",children:(0,sa.jsx)(e.p,{children:"react-hook-form/zod resolver"})}),"\n",(0,sa.jsx)("a",{href:"https://axios-http.com/docs/interceptors",children:"axios interceptors"}),"\n",(0,sa.jsx)("a",{href:"https://github.com/colinhacks/zod/discussions",children:"zod discussion"}),"\n",(0,sa.jsx)("a",{href:"https://velog.io/@chchaeun/%EC%9D%B8%EC%A6%9D%EA%B3%BC",children:(0,sa.jsx)(e.p,{children:"개발새발.log"})}),"\n",(0,sa.jsx)("a",{href:"https://medium.com/@kirankumal714/implementing-refresh-token-in-react-using-axios-zustand-and-react-query-a5dbac2944b6",children:(0,sa.jsx)(e.p,{children:"Kiran Kumal Medium"})}),"\n",(0,sa.jsx)("a",{href:"https://auth0.com/docs/secure/tokens/refresh-tokens/refresh-token-rotation#maintain-user-sessions-in-spas",children:(0,sa.jsx)(e.p,{children:"auth0 by Okta"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"개인 학습을 위한 자료입니다!"}),"\n",(0,sa.jsx)(e.p,{children:"잘못된 내용이 있다면 말씀 부탁드립니다. 감사합니다."}),"\n"]})]})}function ep(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eo,{...s})}):eo(s)}function em(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"ESLint"}),"\n",(0,sa.jsx)(e.h2,{children:"Static Code Analysis"}),"\n",(0,sa.jsxs)(e.p,{children:["Analysis that finds parts that can cause potential bugs in the code itself, regardless of code execution, and fixes them in advance is called ",(0,sa.jsx)(e.code,{children:"static code analysis"}),"."]}),"\n",(0,sa.jsx)(e.h3,{children:"How ESLint Works"}),"\n",(0,sa.jsx)(e.h4,{children:"1. Read JS as a string."}),"\n",(0,sa.jsx)(e.h4,{children:"2. Structure the code with a parser that analyzes JS."}),"\n",(0,sa.jsx)(e.p,{children:"A commonly used parser is espree."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.a,{href:"https://astexplorer.net/",children:"https://astexplorer.net/"}),"\nYou can check how it's structured on the above site. (AST explorer)"]}),"\n",(0,sa.jsxs)(e.p,{children:["Result of parsing with espree\n",(0,sa.jsx)(e.img,{src:"/images/2024-06-18/Pasted%20image%2020240617191611.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"It analyzes and tells you detailed information such as the exact location of the code, not just analyzing variables, functions, and function names. That way it understands line breaks, indentation, etc. in the code."}),"\n",(0,sa.jsx)(e.p,{children:"For TS, there is also an espree-based parser called @typescript-eslint/typescript-estree."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2024-06-18/Pasted%20image%2020240617191548.png",alt:""}),"\nLooking at the picture above, the parsed parts are similar to JS, but you can see that typeAnnotation has been added."]}),"\n",(0,sa.jsx)(e.h4,{children:"3. The structured tree is called AST (Abstract Syntax Tree) and is compared with rules."}),"\n",(0,sa.jsx)(e.p,{children:"A collection of these rules is called plugins. Various rules exist, such as rules that make debugger only usable during development."}),"\n",(0,sa.jsx)(e.p,{children:"How debugger looks when analyzed with espree"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Program"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"body"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"DebuggerStatement"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"sourceType"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"module"'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"no-debugger rule"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// no-debugger"}),"\nmodule.exports = ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n	meta",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Meta information related to this rule"}),"\n		type",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'problem'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		docs",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n			description",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'Disallow the use of `debugger`'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n			recommended",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"true"})}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n			url",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'https",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"}),(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//eslint.org/docs/rules/no-debugger',"}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		fixabble",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"null"})}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Whether it can be fixed when fixed with docs, eslint --fix"}),"\n		schema",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		messages",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Warning message"}),"\n			unexpeccted",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"\"Unexpected 'debugger' sstatement.\""}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n	create(context)",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Function that checks for problems"}),"\n		return ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n			DebuggerStatement(node)",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n				context.report(",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n					node",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n					messageId",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'unexpected'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n				",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),")\n			",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"4. Report or fix."}),"\n",(0,sa.jsx)(e.h2,{children:"eslint-plugin"}),"\n",(0,sa.jsxs)(e.p,{children:["A package that collects rules, ex) ",(0,sa.jsx)(e.code,{children:"eslint-plugin-import"}),", ",(0,sa.jsx)(e.code,{children:"eslint-plugin-react"})]}),"\n",(0,sa.jsx)(e.h2,{children:"eslint-config"}),"\n",(0,sa.jsx)(e.p,{children:"A package that collects eslint-plugins and provides them as a set\n(A package that provides ESLint-related settings that can be used consistently across multiple projects)"}),"\n",(0,sa.jsx)(e.h3,{children:"Naming conventions for eslint-config and eslint-plugin"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["Must have a name with a fixed prefix like eslint-plugin-* with one word attached after it. (",(0,sa.jsx)(e.code,{children:"ex: eslint-plugin-naver"}),")"]}),"\n",(0,sa.jsxs)(e.li,{children:["Attaching a Scope in front like ",(0,sa.jsx)(e.code,{children:"@titicaca/eslint-config-triple"})," is allowed."]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["Usually ",(0,sa.jsx)(e.code,{children:"eslint-config"})," is more commonly created and distributed by companies rather than individual developers, so using others' often solves the problem."]}),"\n",(0,sa.jsx)(e.h3,{children:"Famous eslint-config"}),"\n",(0,sa.jsx)(e.h4,{children:"eslint-config-airbnb"}),"\n",(0,sa.jsx)(e.p,{children:"Maintained by over 500 people and the most popular config"}),"\n",(0,sa.jsx)(e.h4,{children:"@titicaca/triple-config-kit"}),"\n",(0,sa.jsx)(e.p,{children:"The most actively maintained and widely used config in the Korean community (developed by Interpark Triple.)"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Unlike airbnb, it was developed independently."}),"\n",(0,sa.jsx)(e.li,{children:"Test code exists for rules provided externally"}),"\n",(0,sa.jsx)(e.li,{children:"Since frontend rules are also provided separately, you can apply rules suitable for Node.js environment or React environment."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"It's also easy to install because prettier and stylelint are also managed as a monorepo."}),"\n",(0,sa.jsx)(e.h4,{children:"eslint-config-next"}),"\n",(0,sa.jsx)(e.p,{children:"A config that is essential if the code is written with Next.js."}),"\n",(0,sa.jsx)(e.h2,{children:"Creating Your Own ESLint Rules"}),"\n",(0,sa.jsx)(e.h3,{children:"1. Modifying Existing Rules: Remove import React to reduce bundle size (Syntax that disappeared from React 17 due to JSX Runtime)"}),"\n",(0,sa.jsx)(e.p,{children:"The JS file started with npm run start and the JS file created with npm run build become the same size, which is what the bundler handled."}),"\n",(0,sa.jsx)(e.p,{children:"It can be handled with tree shaking, but removing unnecessary import React can reduce tree shaking time, which will help improve build speed."}),"\n",(0,sa.jsxs)(e.p,{children:["You can detect issues by customizing existing rules. Let's use ",(0,sa.jsx)(e.code,{children:"no-restricted-imports"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"module"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"exports"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"rules"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"no-restricted-imports"'}),": [\n      ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"error"'}),",\n      {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add modules to prohibit in paths."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"paths"}),": [\n          {\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Module name"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Module name"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"importNames"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"default"'}),"],\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Warning message"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"\"import React form 'react' is not needed now.\""}),",\n          },\n        ],\n      },\n    ],\n  },\n};\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npm run lint // Command to run lint\n// You can check which files and which lines have code that doesn't match lint.\n"})}),"\n",(0,sa.jsx)(e.p,{children:"You should be able to confirm that it works as expected."}),"\n",(0,sa.jsx)(e.p,{children:"In this way, you can also prevent libraries that are not tree-shaken from being imported."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"module"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"exports"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"rules"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"no-restricted-imports"'}),": [\n      ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"error"'}),",\n      {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add modules to prohibit in paths."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"paths"}),": [\n          {\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Module name"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"lodash"'}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Warning message"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),":\n              ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"lodash는 트리쉐이킹되지 않습니다. lodash/* 형식으로 import 해주세요."'}),",\n          },\n        ],\n      },\n    ],\n  },\n};\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"2. Creating New Rules: Rule to prohibit new Date"}),"\n",(0,sa.jsx)(e.p,{children:"new Date() returns the device's time. To use only the server's time"}),"\n",(0,sa.jsx)(e.p,{children:"Let's analyze how AST is created in espree and create a new rule."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),"();\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This becomes AST as"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Program"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"11"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"body"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"ExpressionStatement"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Entire expression of that code"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"11"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"expression"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Check what expression is in ExpressionStatement"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"NewExpression"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// What type that expression is (NewExpression = constructor)"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"callee"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Name of constructor in expression representing constructor"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Identifier"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"name"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Date"'}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"arguments"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Represents arguments passed to constructor in expression representing constructor"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"sourceType"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"module"'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"It's expressed like this. Now let's make it an ESLint rule."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:["module.exports = ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n	meta",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Meta information related to this rule"}),"\n		type",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'suggestion'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		docs",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n			description",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'Disallow use of the new Date()'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n			recommended",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"false"})}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		fixabble",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'code'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Whether it can be fixed when fixed with docs, eslint --fix"}),"\n		schema",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		messages",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Warning message"}),"\n			message",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"\"Unexpected 'debugger' sstatement.\""}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n	create(context)",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Function that checks for problems"}),"\n		return ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n			NewExpression",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," function (node)",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When NewExpression is found"}),"\n				if (node.callee.name === 'Date' && node.arguments.length === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),")",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Check if that constructor is Date"}),"\n					context.report(",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Report"}),"\n						node",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," node",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Node with problem"}),"\n						messageId",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'message'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Message you want to show (taken from meta.messages)"}),"\n						fix",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," function (fixer)",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Automatically fix using fix"}),"\n							return fixer.replaceText(node",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," 'ServerDate()')\n						",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n					",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),")\n				",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n			",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"The create function must return an object, where you can declare selectors or event names that detect code smells."}),"\n",(0,sa.jsxs)(e.p,{children:["After that, you can deploy it in eslint-plugin form using ",(0,sa.jsx)(e.code,{children:"yo"})," and ",(0,sa.jsx)(e.code,{children:"generate-eslint"}),"."]}),"\n",(0,sa.jsx)(e.h2,{children:"Things to Watch Out For"}),"\n",(0,sa.jsx)(e.h3,{children:"1. Conflict with Prettier"}),"\n",(0,sa.jsx)(e.p,{children:"Prettier is a tool that helps format code. (Handles line breaks, indentation, single quotes and double quotes, etc.)"}),"\n",(0,sa.jsx)(e.p,{children:"You can either declare rules directly so they don't overlap, or use ESlint for JS and eslint-plugin-prettier for others."}),"\n",(0,sa.jsx)(e.h3,{children:"2. Exception handling for rules, and react-hooks/no-exhaustive-deps"}),"\n",(0,sa.jsxs)(e.p,{children:["Exclude specific rules arbitrarily through ",(0,sa.jsx)(e.code,{children:"eslint-disable-"})," comments."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Exclude only specific line"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"hw"'}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// eslint-disable-line no-console"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Exclude next line"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// eslint-disable-next-line no-console"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"hw"'}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Exclude specific multiple lines"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"/*eslint-disable no-console*/"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"hw"'}),");\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"/*eslint-enable no-console*/"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Exclude entire file"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"/*eslint-disable no-console*/"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"hw"'}),");\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"When using useEffect, if it internally depends on state but the rule is violated in deps, it's a problem in any case. You need to carefully check whether to turn off the rule or ignore only specific parts."}),"\n",(0,sa.jsx)(e.h3,{children:"3. ESLint Version Conflict"}),"\n",(0,sa.jsx)(e.p,{children:"If the ESLint version doesn't match, you may encounter an error that it couldn't be found because the internal version is different."}),"\n",(0,sa.jsx)(e.h1,{children:"React Test Library"}),"\n",(0,sa.jsx)(e.p,{children:"Backend testing: Check whether desired data can be correctly retrieved from the server or database, whether deadlocks or race conditions occur during data modification, whether there is data loss, whether failures occur in specific situations, etc."}),"\n",(0,sa.jsx)(e.p,{children:"Frontend testing: Performed in an environment identical or similar to general users"}),"\n",(0,sa.jsx)(e.p,{children:"Frontend has various libraries because testing design elements like HTML and CSS, user interactions, various scenarios that occur in browsers, etc. is cumbersome.\n(Unit tests at component and function level, tests that mimic all user operations, etc.)"}),"\n",(0,sa.jsx)(e.p,{children:"Among them, the most famous is React Testing Library."}),"\n",(0,sa.jsx)(e.h2,{children:"React Testing Library"}),"\n",(0,sa.jsx)(e.p,{children:"It's based on DOM Testing Library."}),"\n",(0,sa.jsx)(e.h3,{children:"DOM Testing Library"}),"\n",(0,sa.jsx)(e.p,{children:"It's based on jsdom.\njsdom is a library that allows you to use HTML and DOM even in environments like Node.js where only JS exists without HTML"}),"\n",(0,sa.jsx)(e.h4,{children:"jsdom Example"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," jsdom = ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"require"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"jsdom"'}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"JSDOM"})," } = jsdom;\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," dom = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"JSDOM"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"`<!DOCTYPE html><p>Hello world</p>`"}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(dom.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"querySelector"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"p"'}),").",(0,sa.jsx)(e.span,{className:"hljs-property",children:"textContent"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "Hello World"'}),"\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"Basics of JavaScript Testing"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Select function or module to test"}),"\n",(0,sa.jsx)(e.li,{children:"Select value that function or module is expected to return"}),"\n",(0,sa.jsx)(e.li,{children:"Enter actual return value"}),"\n",(0,sa.jsx)(e.li,{children:"Check if expected value and return value match"}),"\n",(0,sa.jsx)(e.li,{children:"Success if match, error if mismatch"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Node.js provides an assert module. However, to check actual test information such as what was tested and how tests were performed, another library is needed."}),"\n",(0,sa.jsx)(e.h3,{children:"Testing Framework"}),"\n",(0,sa.jsx)(e.p,{children:"Tests based on assertions + deliver helpful information"}),"\n",(0,sa.jsx)(e.p,{children:"There are Jest, Mocha, Karma, Jasmine, etc."}),"\n",(0,sa.jsx)(e.h4,{children:"Jest"}),"\n",(0,sa.jsx)(e.p,{children:"Let's look at Jest's actual operation process."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// math.js"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"sum"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"a, b"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," a + b;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"module"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"exports"})," = {\n  sum,\n};\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// math.test.js"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { sum } = ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"require"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./math"'}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"test"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"두 인수가 덧셈이 되어야 합니다."'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"expect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"sum"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),")).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toBe"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Pass"}),"\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"test"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"두 인수가 덧셈이 되어야 합니다."'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"expect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"sum"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),")).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toBe"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error"}),"\n});\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npm run test\n\n> jest\n"})}),"\n",(0,sa.jsx)(e.h4,{children:"Writing React Component Test Code"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Render component"}),"\n",(0,sa.jsx)(e.li,{children:"Perform actions in component as needed"}),"\n",(0,sa.jsx)(e.li,{children:"Compare expected value and actual value"}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"Project Creation"}),"\n",(0,sa.jsx)(e.p,{children:"In the case of cra, it's already installed by default."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npx create-react-app react-test --template typescript\n"})}),"\n",(0,sa.jsx)(e.p,{children:"Check App.test.tsx file creation"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { render, screen } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@testing-library/react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"App"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./App"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"test"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"renders learn react link"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"render"}),"(",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"App"})," />"]})}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Render App"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," linkElement = screen.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getByText"}),"(",(0,sa.jsx)(e.span,{className:"hljs-regexp",children:"/learn react/i"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Find DOM element with learn react string."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"expect"}),"(linkElement).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toBeInTheDocument"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Check if DOM element is inside document"}),"\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Functions to get HTML elements with specific something"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"getBy... : Returns element matching condition of argument, error on failure"}),"\n",(0,sa.jsx)(e.li,{children:"getAllBy...: Returns multiple elements matching condition of argument, error on failure"}),"\n",(0,sa.jsx)(e.li,{children:"findBy ... : getBy that returns Promise, default 1000ms timeout, finds asynchronously (used when finding elements after async actions), error on failure"}),"\n",(0,sa.jsx)(e.li,{children:"findAllBy... : Plural form of findBy, error on failure"}),"\n",(0,sa.jsx)(e.li,{children:"queryBy... : Same as getBy but returns null on failure"}),"\n",(0,sa.jsx)(e.li,{children:"queryAllBy... : Plural form of query, null on failure"}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"Static Components"}),"\n",(0,sa.jsx)(e.p,{children:"Components that always return the same result without separate state\nTo test this, you can find the element you want to test after rendering and perform the test."}),"\n",(0,sa.jsx)(e.p,{children:"Looking at the code in the book, you can organize the following methods."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"beforeEach"})," : Function executed before each test"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"describe"})," : Role of grouping tests with similar properties into one group"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"it"})," : Alias for test."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"getByTestId"})," : testid is a reserved word in React Testing Library. It can be used to select elements that are difficult or cumbersome to select with get and other selectors. It uses the DOM element's dataset (non-standard attribute), and if you do data-testid=~, you can select it with getByTestId, findByTestId, etc."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-html",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data-testid"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"something"'}),">"]}),"무언가",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"}),">"]}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["There are also many intuitive methods like ",(0,sa.jsx)(e.code,{children:"toHaveAttribute"}),", ",(0,sa.jsx)(e.code,{children:"toBeVisible"}),", etc."]}),"\n",(0,sa.jsx)(e.h5,{children:"Dynamic Components"}),"\n",(0,sa.jsx)(e.p,{children:"Pure components without any state values are easy to test. (stateless component)\nHowever, components with state values, components that manage state values using useState, need to be approached differently."}),"\n",(0,sa.jsx)(e.h6,{children:"Components where users change input through useState"}),"\n",(0,sa.jsx)(e.p,{children:"Testing Library mimics input and tests component changes according to state changes.\n(Refer to book, there are various action-related methods like userEvent.type)"}),"\n",(0,sa.jsx)(e.h5,{children:"Components where async events occur"}),"\n",(0,sa.jsx)(e.p,{children:"In the case of complex functions like fetch (header settings, response types, etc.), mocking is difficult, making it hard to apply all scenarios to tests."}),"\n",(0,sa.jsx)(e.p,{children:"To solve this, we use MSW, a library that intercepts actual networks and sends responses."}),"\n",(0,sa.jsx)(e.p,{children:"The focus when using async components with fetch is fetch response mocking, and rendering comparison after async requests end using findBy."}),"\n",(0,sa.jsx)(e.h4,{children:"Custom Hook Testing"}),"\n",(0,sa.jsxs)(e.p,{children:["Test custom hooks using ",(0,sa.jsx)(e.code,{children:"react-hooks-testing-library"}),"."]}),"\n",(0,sa.jsx)(e.h4,{children:"Things to Consider Before Writing Tests"}),"\n",(0,sa.jsx)(e.h5,{children:"Test Coverage"}),"\n",(0,sa.jsx)(e.p,{children:"An indicator of how much software has been tested"}),"\n",(0,sa.jsx)(e.p,{children:"It's an indicator of how much code is being tested, but it cannot determine whether it's being done well."}),"\n",(0,sa.jsx)(e.h5,{children:"Judgment Conditions for Testing"}),"\n",(0,sa.jsx)(e.p,{children:"In practice, there are many cases that depend on QA. It's not easy to write and operate test code leisurely."}),"\n",(0,sa.jsx)(e.p,{children:"Before writing test code, it's important to first identify the most vulnerable or important parts of the application."}),"\n",(0,sa.jsx)(e.p,{children:"ex) Payment part"}),"\n",(0,sa.jsx)(e.p,{children:"Test code is written to gain confidence in software quality, a goal that cannot be easily achieved with simple code writing alone."}),"\n",(0,sa.jsx)(e.h5,{children:"Types of Testing"}),"\n",(0,sa.jsx)(e.p,{children:"Unit Test: Tests that verify whether each code or component works accurately as intended in an independently separated environment"}),"\n",(0,sa.jsx)(e.p,{children:"Integration Test: Tests that verify whether multiple components that passed unit tests work normally as one function when combined"}),"\n",(0,sa.jsx)(e.p,{children:"End to End Test: Called E2E test, tests that check the overall functionality of an application using robots that work like actual users"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [count, setCount] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h1"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"aria-label"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"heading"'}),">"]}),"{count}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h1"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"card"'}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data-testid"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"button"'}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{()"})," =>"]})," {\n            Array.from({ length: 3000 }).forEach(function addDummy() {\n              DUMMY.push(Math.random().toString());\n            });\n            setCount(function toggle(prev) {\n              return prev + 1;\n            });\n          }}\n        >\n          {count}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"App"}),";\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { fireEvent, render, screen } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@testing-library/react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { expect, test } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"vitest"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"App"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./App"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"test"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Button Push"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"render"}),"(",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"App"})," />"]})}),");\n\n  fireEvent.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"click"}),"(screen.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"findByTestId"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"button"'}),"));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," count = screen.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getByLabelText"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"heading"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"expect"}),"(count.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"textContent"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toEqual"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"1"'}),");\n});\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"This is content organized and fleshed out for Modern React Deep Dive study."}),"\n",(0,sa.jsx)(e.p,{children:"If there are any incorrect contents, please let me know. Thank you."}),"\n"]})]})}function ex(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(em,{...s})}):em(s)}function eN(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"ESLint"}),"\n",(0,sa.jsx)(e.h2,{children:"정적 코드 분석"}),"\n",(0,sa.jsxs)(e.p,{children:["코드의 실행과는 별개로 코드 자체만으로 잠재적 버그를 야기하는 부분을 찾아내어 사전에 수정하는 분석을 ",(0,sa.jsx)(e.code,{children:"정적 코드 분석"}),"이라고 합니다."]}),"\n",(0,sa.jsx)(e.h3,{children:"ESLint 동작 방식"}),"\n",(0,sa.jsx)(e.h4,{children:"1. JS를 문자열로 읽는다."}),"\n",(0,sa.jsx)(e.h4,{children:"2. JS를 분석하는 parser로 코드를 구조화합니다."}),"\n",(0,sa.jsx)(e.p,{children:"자주 사용하는 parser로는 espree가 있습니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.a,{href:"https://astexplorer.net/",children:"https://astexplorer.net/"}),"\n위 사이트로 어떻게 구조화되는지 확인할 수 있습니다. (AST explorer)"]}),"\n",(0,sa.jsxs)(e.p,{children:["parser를 espree로 한 결과\n",(0,sa.jsx)(e.img,{src:"/images/2024-06-18/Pasted%20image%2020240617191611.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"변수, 함수, 함수명을 분석하는 것이 아니라 코드의 정확한 위치와 같은 세세한 정보를 분석해서 알려줍니다. 그렇게 코드의 줄바꿈, 들여쓰기 등을 파악합니다."}),"\n",(0,sa.jsx)(e.p,{children:"TS도 @typescript-eslinttypescript-estree 라고 하는 espree 기반 parser가 존재합니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2024-06-18/Pasted%20image%2020240617191548.png",alt:""}),"\n위 사진을 보면 JS와 parsing된 부분은 비슷하지만 여기에 typeAnnotation이 추가된 것을 확인할 수 있습니다."]}),"\n",(0,sa.jsx)(e.h4,{children:"3. 구조화한 트리를 AST(Abstract Syntax Tree)라 하고 이를 규칙과 대조합니다."}),"\n",(0,sa.jsx)(e.p,{children:"이러한 규칙들의 모음을 plugins라고 합니다. debugger를 개발 과정에서만 사용하게 만드는 규칙 등등 다양한 규칙이 존재합니다."}),"\n",(0,sa.jsx)(e.p,{children:"debugger를 espree로 분석한 모습"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Program"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"body"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"DebuggerStatement"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"sourceType"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"module"'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"no-debugger 규칙"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// no-debugger"}),"\nmodule.exports = ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n	meta",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 해당 규칙과 관련된 메타 정보"}),"\n		type",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'problem'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		docs",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n			description",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'Disallow the use of `debugger`'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n			recommended",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"true"})}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n			url",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'https",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"}),(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//eslint.org/docs/rules/no-debugger',"}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		fixabble",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"null"})}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// docs, eslint --fix로 수정했을 때 수정가능한지 여부"}),"\n		schema",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		messages",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 경고 문구"}),"\n			unexpeccted",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"\"Unexpected 'debugger' sstatement.\""}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n	create(context)",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 문제점 확인하는 함수"}),"\n		return ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n			DebuggerStatement(node)",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n				context.report(",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n					node",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n					messageId",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'unexpected'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n				",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),")\n			",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"4. report 혹은 fix합니다."}),"\n",(0,sa.jsx)(e.h2,{children:"eslint-plugin"}),"\n",(0,sa.jsxs)(e.p,{children:["규칙을 모아놓은 패키지, ex) ",(0,sa.jsx)(e.code,{children:"eslint-plugin-import"}),", ",(0,sa.jsx)(e.code,{children:"eslint-plugin-react"})]}),"\n",(0,sa.jsx)(e.h2,{children:"eslint-config"}),"\n",(0,sa.jsx)(e.p,{children:"eslint-plugin을 모아놓고 한 세트로 제공하는 패키지\n(여러 프로젝트에 걸쳐 동일하게 사용할 수 있는 ESLint 관련 설정을 제공하는 패키지)"}),"\n",(0,sa.jsx)(e.h3,{children:"eslint-config와 eslint-plugin의 네이밍 규칙"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["eslint-plugin-* 처럼 한 단어가 뒤에 붙은 prefix가 고정인 이름을 가져야 합니다. (",(0,sa.jsx)(e.code,{children:"ex: eslint-plugin-naver"}),")"]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"@titicaca/eslint-config-triple"})," 처럼 Scope를 앞에 붙는 것은 허용됩니다."]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["보통 ",(0,sa.jsx)(e.code,{children:"eslint-config"}),"는 개인 개발자보다는 회사에서 만든 후 배포하는 형태가 일반적이기 때문에 남의 것 쓰면 해결되는 경우가 많다."]}),"\n",(0,sa.jsx)(e.h3,{children:"유명한 eslint-config"}),"\n",(0,sa.jsx)(e.h4,{children:"eslint-config-airbnb"}),"\n",(0,sa.jsx)(e.p,{children:"500여 명이 유지보수하고 있으며 가장 인기있는 config"}),"\n",(0,sa.jsx)(e.h4,{children:"@titicaca/triple-config-kit"}),"\n",(0,sa.jsx)(e.p,{children:"한국 커뮤니티에서 가장 유지보수가 활발하고 많이 쓰이는 config (인터파크트리플에서 개발함.)"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"airbnb와는 다르게 자체적으로 개발하였다."}),"\n",(0,sa.jsx)(e.li,{children:"외부로 제공하는 규칙에 대한 테스트 코드가 존재"}),"\n",(0,sa.jsx)(e.li,{children:"frontend 규칙도 별도로 제공하기 때문에 Node.js 환경 또는 리액트 환경에 맞는 규칙을 적용할 수 있습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"다른 prettier, stylelint도 모노레포로 만들어서 관리하고 있어서 설치하기 용이하다."}),"\n",(0,sa.jsx)(e.h4,{children:"eslint-config-next"}),"\n",(0,sa.jsx)(e.p,{children:"Next.js로 작성된 코드라면 꼭 필요한 config입니다."}),"\n",(0,sa.jsx)(e.h2,{children:"나만의 ESLint 규칙 만들기"}),"\n",(0,sa.jsx)(e.h3,{children:"1. 기존 규칙 변경 : import React를 제거해서 번들 크기를 줄이기 (React 17부터 JSX Runtime으로 인해 사라진 문법)"}),"\n",(0,sa.jsx)(e.p,{children:"npm run start로 시작한 것과 npm run build로 만든 JS파일은 동일한 크기가 되는데 이는 번들러가 처리해준 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"트리 쉐이킹으로 처리할 수는 있지만 불필요한 import React를 제거하면 트리 쉐이킹의 시간을 줄일 수 있게 되기 때문에 빌드 속도 향상에 도움이 될 것입니다."}),"\n",(0,sa.jsxs)(e.p,{children:["기존 규칙을 커스터마이징해서 이슈를 감지할 수 있습니다. ",(0,sa.jsx)(e.code,{children:"no-restricted-imports"})," 를 활용해보겠습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"module"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"exports"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"rules"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"no-restricted-imports"'}),": [\n      ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"error"'}),",\n      {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//paths에 금지시킬 모듈을 추가합니다."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"paths"}),": [\n          {\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 모듈명"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 모듈 이름"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"importNames"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"default"'}),"],\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 경고 메시지"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"\"import React form 'react' is not needed now.\""}),",\n          },\n        ],\n      },\n    ],\n  },\n};\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npm run lint // 린트 실행 명령어\n// 린트에 맞지 않는 코드들 어느 파일 몇 줄에 있는지 확인할 수 있게 됩니다.\n"})}),"\n",(0,sa.jsx)(e.p,{children:"예상대로 잘 되는 것을 확인할 수 있을 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"이와 같이 트리쉐이킹 되지 않는 라이브러리들이 import 되는 것을 방지할 수도 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"module"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"exports"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"rules"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"no-restricted-imports"'}),": [\n      ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"error"'}),",\n      {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//paths에 금지시킬 모듈을 추가합니다."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"paths"}),": [\n          {\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 모듈명"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"lodash"'}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 경고 메시지"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message"}),":\n              ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"lodash는 트리쉐이킹되지 않습니다. lodash/* 형식으로 import 해주세요."'}),",\n          },\n        ],\n      },\n    ],\n  },\n};\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"2. 새 규칙 만들기 : new Date를 금지시키는 규칙"}),"\n",(0,sa.jsx)(e.p,{children:"new Date() 는 기기의 시간을 리턴해준다. 서버의 시간만을 사용하게 하기 위해서"}),"\n",(0,sa.jsx)(e.p,{children:"espree에서 AST를 어떻게 만드는지 분석해서 새 규칙을 만들어 보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),"();\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이는 AST로"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Program"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"11"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"body"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"ExpressionStatement"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 해당 코드의 표현식 전체"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"11"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"expression"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ExpressionStatement에 어떤 표현이 들어가 있는지 확인"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"NewExpression"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 해당 표현이 어떤 타입인지 (NewExpression = 생성자)"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"callee"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 생성자를 표현한 표현식에서 생성자의 이름"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"type"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Identifier"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"start"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"end"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"name"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Date"'}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"arguments"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 생성자를 표현한 표현식에서 생성자에 전달하는 인수를 나타낸다."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"sourceType"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"module"'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이렇게 표현됩니다. 이제 ESLint 규칙으로 만들어보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:["module.exports = ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n	meta",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 해당 규칙과 관련된 메타 정보"}),"\n		type",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'suggestion'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		docs",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n			description",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'Disallow use of the new Date()'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n			recommended",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"false"})}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		fixabble",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'code'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// docs, eslint --fix로 수정했을 때 수정가능한지 여부"}),"\n		schema",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		messages",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 경고 문구"}),"\n			message",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"\"Unexpected 'debugger' sstatement.\""}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n	create(context)",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 문제점 확인하는 함수"}),"\n		return ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n			NewExpression",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," function (node)",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// NewExpression을 찾았을 때"}),"\n				if (node.callee.name === 'Date' && node.arguments.length === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),")",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 해당 생성자가 Date인지 확인"}),"\n					context.report(",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 리포트"}),"\n						node",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," node",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 문제가 되는 노드"}),"\n						messageId",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," 'message'",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 노출하고 싶은 message (meta.messages에서 가져온다.)"}),"\n						fix",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," function (fixer)",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// fix를 이용해서 자동으로 수정합니다."}),"\n							return fixer.replaceText(node",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," 'ServerDate()')\n						",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n					",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),")\n				",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n			",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n		",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n	",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"create 함수는 객체를 반환해야 하는데 여기서 코드 스멜을 감지할 선택자나 이벤트명 등을 선언할 수 있습니다."}),"\n",(0,sa.jsxs)(e.p,{children:["이후 ",(0,sa.jsx)(e.code,{children:"yo"}),"와 ",(0,sa.jsx)(e.code,{children:"generate-eslint"}),"를 이용해서 eslint-plugin 형태로 배포할 수 있습니다."]}),"\n",(0,sa.jsx)(e.h2,{children:"주의할 점"}),"\n",(0,sa.jsx)(e.h3,{children:"1. Prettier와 충돌"}),"\n",(0,sa.jsx)(e.p,{children:"Prettier는 코드의 포매팅을 도와주는 도구입니다. (줄바꿈, 들여쓰기, 작은 따옴표와 큰 따옴표 등을 담당)"}),"\n",(0,sa.jsx)(e.p,{children:"직접 규칙을 안 겹치게 선언하거나 JS에는 ESlint, 그외는 eslint-plugin-prettier를 사용하는 방법이 있습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"2. 규칙에 대한 예외 처리, 그리고 react-hooks/no-exhaustive-deps"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"eslint-disable-"})," 주석을 통해서 특정 규칙을 임의로 제외시킨다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 특정 줄만 제외"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"hw"'}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// eslint-disable-line no-console"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 다음 줄 제외"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// eslint-disable-next-line no-console"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"hw"'}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 특정 여러 줄 제외"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"/*eslint-disable no-console*/"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"hw"'}),");\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"/*eslint-enable no-console*/"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 파일 전체 제외"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"/*eslint-disable no-console*/"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"hw"'}),");\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"useEffect 사용시 내부적으로 상태에 의존하고 있는데 deps에서 규칙이 위반된다고 나올 경우 어떤 경우든 문제입니다. 규칙을 끌지 특정 부분만 무시할지 신중하게 점검해야 합니다."}),"\n",(0,sa.jsx)(e.h3,{children:"3. ESLint 버전 충돌"}),"\n",(0,sa.jsx)(e.p,{children:"ESLint의 버전이 맞지 않을 경우 내부적으로 버전이 틀려서 찾지 못했다는 오류를 마주할 수 있습니다."}),"\n",(0,sa.jsx)(e.h1,{children:"React Test Library"}),"\n",(0,sa.jsx)(e.p,{children:"백엔드의 테스트 : 서버나 디비에서 원하는 데이터를 올바르게 가져올 수 있는지, 데이터 수정 간 교착 상태나 경쟁 상태가 발생하지는 않는지 데이터 손실은 없는지, 특정 상황에서 장애가 발생하지 않는지 등을 확인"}),"\n",(0,sa.jsx)(e.p,{children:"프론트엔드의 테스트 : 일반적인 사용자와 동일하거나 유사한 환경에서 수행"}),"\n",(0,sa.jsx)(e.p,{children:"프론트엔드는 HTML, CSS 같은 디자인 요소, 사용자의 인터랙션, 브라우저에서 발생하는 다양한 시나리오 등등 테스팅하기 번거로워서 다양한 라이브러리가 존재합니다.\n(컴포넌트, 함수 수준의 유닛 테스트, 사용자 작동을 모두 흉내내서 테스트 등등)"}),"\n",(0,sa.jsx)(e.p,{children:"그중 가장 유명한게 React Testing Library입니다."}),"\n",(0,sa.jsx)(e.h2,{children:"React Testing Library"}),"\n",(0,sa.jsx)(e.p,{children:"DOM Testing Library 기반입니다."}),"\n",(0,sa.jsx)(e.h3,{children:"DOM Testing Library"}),"\n",(0,sa.jsx)(e.p,{children:"jsdom 기반입니다.\njsdom은 Node.js 같은 HTML없이 js만 존재하는 환경에서도 HTML과 DOM을 사용할 수 있도록 하는 라이브러리"}),"\n",(0,sa.jsx)(e.h4,{children:"jsdom 예시"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," jsdom = ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"require"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"jsdom"'}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"JSDOM"})," } = jsdom;\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," dom = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"JSDOM"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"`<!DOCTYPE html><p>Hello world</p>`"}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(dom.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"querySelector"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"p"'}),").",(0,sa.jsx)(e.span,{className:"hljs-property",children:"textContent"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "Hello World"'}),"\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"자바스크립트 테스트의 기초"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"테스트할 함수나 모듈을 선정"}),"\n",(0,sa.jsx)(e.li,{children:"함수나 모듈이 반환하길 기대하는 값 선정"}),"\n",(0,sa.jsx)(e.li,{children:"실제 반환 값 기입"}),"\n",(0,sa.jsx)(e.li,{children:"기대값과 반환값이 일치하는지 확인"}),"\n",(0,sa.jsx)(e.li,{children:"일치시 성공 불일치시 에러"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Node.js는 assert라는 모듈을 제공합니다. 하지만 무엇을 테스트했는지 무슨 테스트를 어떻게 수행했는지 실제 테스트 정보를 확인하려면 다른 라이브러리가 필요하다."}),"\n",(0,sa.jsx)(e.h3,{children:"Testing Framework"}),"\n",(0,sa.jsx)(e.p,{children:"어설션을 기반으로 테스트 + 도움이 될만한 정보 전달"}),"\n",(0,sa.jsx)(e.p,{children:"Jest, Mocha, Karma, Jasmine 등등이 있습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"Jest"}),"\n",(0,sa.jsx)(e.p,{children:"Jest의 실제 동작 과정을 보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// math.js"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"sum"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"a, b"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," a + b;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"module"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"exports"})," = {\n  sum,\n};\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// math.test.js"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { sum } = ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"require"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./math"'}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"test"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"두 인수가 덧셈이 되어야 합니다."'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"expect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"sum"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),")).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toBe"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 통과"}),"\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"test"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"두 인수가 덧셈이 되어야 합니다."'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"expect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"sum"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),")).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toBe"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 에러"}),"\n});\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npm run test\n\n> jest\n"})}),"\n",(0,sa.jsx)(e.h4,{children:"리액트 컴포넌트 테스트 코드 작성하기"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"컴포넌트 렌더링"}),"\n",(0,sa.jsx)(e.li,{children:"필요에 의해 컴포넌트에서 액션 수행"}),"\n",(0,sa.jsx)(e.li,{children:"기대값과 실제값 비교"}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"프로젝트 생성"}),"\n",(0,sa.jsx)(e.p,{children:"cra의 경우 기본 장착 되있긴 함."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npx create-react-app react-test --template typescript\n"})}),"\n",(0,sa.jsx)(e.p,{children:"App.test.tsx 파일 생성 확인"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { render, screen } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@testing-library/react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"App"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./App"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"test"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"renders learn react link"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"render"}),"(",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"App"})," />"]})}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// App 렌더링"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," linkElement = screen.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getByText"}),"(",(0,sa.jsx)(e.span,{className:"hljs-regexp",children:"/learn react/i"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// learn react 문자열을 가진 DOM 요소 찾음."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"expect"}),"(linkElement).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toBeInTheDocument"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// DOM 요소가 document 내부에 있는지 확인"}),"\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"특정 무언가를 가진 HTML 요소를 가져오는 함수"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"getBy... : 인수의 조건에 맞는 요소 반환, 실패시 에러"}),"\n",(0,sa.jsx)(e.li,{children:"getAllBy...: 인수의 조건에 맞는 복수 개의 요소 반환, 실패시 에러"}),"\n",(0,sa.jsx)(e.li,{children:"findBy ... : Promise를 반환하는 getBy, 기본값 1000ms 타임 아웃, 비동기로 찾는다는 것 (비동기 액션 이후 요소를 찾을 때 사용), 실패시 에러"}),"\n",(0,sa.jsx)(e.li,{children:"findAllBy... : findBy의 복수형, 실패시 에러"}),"\n",(0,sa.jsx)(e.li,{children:"queryBy... : getBy와 같은데 실패시 null 반환"}),"\n",(0,sa.jsx)(e.li,{children:"queryAllBy... : query의 복수형, 실패시 null"}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"정적 컴포넌트"}),"\n",(0,sa.jsx)(e.p,{children:"별도의 상태가 존재하지 않아 항상 같은 결과를 반환하는 컴포넌트\n이를 테스트하기 위해서는 렌더링 후에 테스트를 원하는 요소를 찾아 테스트를 수행하면 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"책에 있는 코드들을 확인하면 다음의 메소드들을 정리해볼 수 있습니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"beforeEach"})," : 각 테스트를 수행하기 전에 실행하는 함수"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"describe"})," : 비슷한 속성을 가진 테스트를 하나의 그룹으로 묶는 역할"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"it"})," : test의 alias입니다."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"getByTestId"})," : testid는 리액트 테스팅 라이브러리의 예약어입니다. get 등의 선택자로 선택하기 어렵거나 곤란한 요소를 선택하기 위해 사용할 수 있습니다. DOM 요소의 dataset(비표준 attribute)을 이용해서 사용하며 data-testid=~ 로하면 getByTestId, findByTestId 등으로 선택할 수 있습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-html",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data-testid"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"something"'}),">"]}),"무언가",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"p"}),">"]}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["이외에도 ",(0,sa.jsx)(e.code,{children:"toHaveAttribute"}),", ",(0,sa.jsx)(e.code,{children:"toBeVisible"})," 등으로 직관적인 메소드들이 많다."]}),"\n",(0,sa.jsx)(e.h5,{children:"동적 컴포넌트"}),"\n",(0,sa.jsx)(e.p,{children:"아무런 상태값이 없는 순수한 컴포넌트는 테스트하기 간편하다. (stateless component)\n하지만 상태값이 있는 컴포넌트, useState를 사용해 상태값을 관리하는 컴포넌트의 경우 다르게 접근해야 합니다."}),"\n",(0,sa.jsx)(e.h6,{children:"useState를 통해 사용자가 입력을 변경하는 컴포넌트"}),"\n",(0,sa.jsx)(e.p,{children:"Testing Library에서는 입력을 흉내 내고, 또 state의 변화에 따른 컴포넌트의 변화를 테스트합니다.\n(책 참고, userEvent.type 같은 다양한 동작관련 메소드 들이 있습니다.)"}),"\n",(0,sa.jsx)(e.h5,{children:"비동기 이벤트가 발생하는 컴포넌트"}),"\n",(0,sa.jsx)(e.p,{children:"fetch처럼 복잡한 함수의 경우(header 설정, response 종류 등등) 모킹이 어려워서 테스트에 모든 시나리오를 적용하기 어렵다."}),"\n",(0,sa.jsx)(e.p,{children:"이를 해결하기 위해 실제 네트워크를 가로채고 응답을 보내는 라이브러리인 MSW를 사용합니다."}),"\n",(0,sa.jsx)(e.p,{children:"fetch를 이용한 비동기 컴포넌트를 사용할 때의 중점은 fetch 응답 모킹, findBy를 활용한 비동기 요청이 끝난 후 렌더링 비교입니다."}),"\n",(0,sa.jsx)(e.h4,{children:"사용자 정의 훅 테스트"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"react-hooks-testing-library"})," 를 활용해서 사용자 정의 훅을 테스트합니다."]}),"\n",(0,sa.jsx)(e.h4,{children:"테스트를 작성하기에 앞서 고려해야 할 점"}),"\n",(0,sa.jsx)(e.h5,{children:"테스트 커버리지"}),"\n",(0,sa.jsx)(e.p,{children:"소프트웨어가 얼마나 테스트됐는지를 나타내는 지표"}),"\n",(0,sa.jsx)(e.p,{children:"얼마나 많은 코드가 테스트되고 있는지를 나타내는 지표이지만 잘되고 있는지 여부를 판별할 수는 없다."}),"\n",(0,sa.jsx)(e.h5,{children:"테스트를 하는 판단 조건"}),"\n",(0,sa.jsx)(e.p,{children:"실무에서는 QA에 의존하는 경우가 많다. 여유롭게 테스트 코드를 작성하고 운영하기가 쉽지 않다."}),"\n",(0,sa.jsx)(e.p,{children:"테스트 코드를 작성하기 전에 최우선적으로 애플리케이션에서 가장 취약하거나 중요한 부분을 파악하는 것이 중요하다."}),"\n",(0,sa.jsx)(e.p,{children:"ex) 결제 파트"}),"\n",(0,sa.jsx)(e.p,{children:"테스트 코드는 단순 코드 작성만으로는 쉽게 이룰 수 없는 목표인 소프트웨어 품질에 대한 확신을 얻기 위해 작성하는 것입니다."}),"\n",(0,sa.jsx)(e.h5,{children:"테스팅의 종류"}),"\n",(0,sa.jsx)(e.p,{children:"Unit Test : 각각의 코드나 컴포넌트가 독립적으로 분리된 환경에서 의도된 대로 정확히 작동하는지 검증하는 테스트"}),"\n",(0,sa.jsx)(e.p,{children:"Integration Test : 유닛 테스트를 통과한 여러 컴포넌트가 묶여서 하나의 기능으로 정상적으로 작동하는지 확인하는 테스트"}),"\n",(0,sa.jsx)(e.p,{children:"End to End Test : E2E 테스트라 하며, 실제 사용자처럼 작동하는 로봇을 활용해 애플리케이션의 전체적인 기능을 확인하는 테스트"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"App"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [count, setCount] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h1"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"aria-label"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"heading"'}),">"]}),"{count}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h1"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"card"'}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data-testid"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"button"'}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{()"})," =>"]})," {\n            Array.from({ length: 3000 }).forEach(function addDummy() {\n              DUMMY.push(Math.random().toString());\n            });\n            setCount(function toggle(prev) {\n              return prev + 1;\n            });\n          }}\n        >\n          {count}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"App"}),";\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { fireEvent, render, screen } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@testing-library/react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { expect, test } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"vitest"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"App"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./App"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"test"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Button Push"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"render"}),"(",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"App"})," />"]})}),");\n\n  fireEvent.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"click"}),"(screen.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"findByTestId"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"button"'}),"));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," count = screen.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getByLabelText"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"heading"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"expect"}),"(count.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"textContent"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toEqual"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"1"'}),");\n});\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"모던 리액트 딥다이브 스터디를 위해서 정리하고 살을 붙힌 내용입니다."}),"\n",(0,sa.jsx)(e.p,{children:"잘못된 내용이 있다면 말씀 부탁드립니다. 감사합니다."}),"\n"]})]})}function eu(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eN,{...s})}):eN(s)}function eg(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"Design"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722113132.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Analyzing the above design and thinking about how to divide it to use server components as much as possible in a Next.js way, it can be divided as follows."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["Main card at the top: Fetched from server during initial page rendering and supplemented with suspense for waiting time. (server component)","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"For the apply button, designed to branch in various ways depending on login status. (client component because event handlers are included)"}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.li,{children:["Recently viewed notices part: Designed as a ",(0,sa.jsx)(e.code,{children:"queue"})," data structure because when data comes in from the front, the data behind should disappear (server component)"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722120938.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"(red : server component, blue: client component)"}),"\n",(0,sa.jsx)(e.h2,{children:"Server Component Design"}),"\n",(0,sa.jsx)(e.p,{children:"To design server components, they must be server components at the page level first. This is because if the top-level component is a client component, server components cannot be used."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"RCC (React Client Component) cannot import server components. This is because the server environment does not exist in the browser."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"When using server components, Next.js uses a streaming method that can load each component separately."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722121441.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["The way to handle loading state by dividing by component is to use React's ",(0,sa.jsx)(e.code,{children:"Suspense"}),". If you wrap a server component with ",(0,sa.jsx)(e.code,{children:"Suspense"})," extended by Next, the component inside ",(0,sa.jsx)(e.code,{children:"fallback"})," replaces that server component until the server component is rendered."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722121816.png",alt:""})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"TTFB : Time to First Byte\nFCP : Time to First Contentful Paint\nTTI : Time to Interactive"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"The picture above is the method before streaming. Because all components had to be rendered for the page to load, TTFB, FCP, and TTI could only be shown sequentially."}),"\n",(0,sa.jsx)(e.p,{children:"Forcing users to wait until all loading screens are finished before entering the page is bound to be bad for UX."}),"\n",(0,sa.jsx)(e.p,{children:"For example, entering Naver to read webtoons, but having to wait for all content like sports, entertainment, and news to be available just to press one webtoon page entry button is something that can be optimized even if the page performance is good and loads quickly."}),"\n",(0,sa.jsx)(e.p,{children:"Next solved this with streaming."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722121647.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Each component has its own part. By each having processes of receiving data, rendering HTML, and hydrating, TTFB, FCP, and TTI are all pulled forward, leading to page performance optimization."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"In the Gheuppay project, we proceeded with development by utilizing this as much as possible."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Design Using Next Cookie"}),"\n",(0,sa.jsx)(e.p,{children:"In React, communication proceeds as follows."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722125032.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"In Next.js where a frontend server exists, communication proceeds simply as follows."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722124750.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Browser > Frontend server (node.js environment) > Backend server. Because it moves like this, SSR, SSG, ISG, etc. became possible."}),"\n",(0,sa.jsx)(e.p,{children:'Server components refer to frontend "server" components. This is also why streaming that can send data divided to the browser is possible.'}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722125217.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"When using Suspense, as shown in the picture above, fallback is sent first, and when server component rendering is finished on the frontend server, the component is sent to the browser and fallback is removed."}),"\n",(0,sa.jsx)(e.p,{children:"In this work, I wanted to utilize this for recently viewed notices. The problem is that to finish server component rendering and receive Suspense, things inside server components must be server-related."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"Server components: Cannot use client-related things. Cannot access Web API, document, web storage, etc., and cannot use state, hooks, etc. Instead, data that only exists on the server such as db, internal services, file systems, etc. can be accessed with async, await."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"I could have implemented recently viewed notices using web storage like localStorage or sessionStorage, but because it's web storage, it couldn't be used inside server components, and then Suspense couldn't be utilized."}),"\n",(0,sa.jsx)(e.p,{children:"What I found for this was Next Cookie."}),"\n",(0,sa.jsxs)(e.p,{children:["In existing React, cookies could be accessed using document.cookie. (Only when not httpOnly) (",(0,sa.jsx)(e.a,{href:"https://ko.javascript.info/cookie",children:"https://ko.javascript.info/cookie"}),")"]}),"\n",(0,sa.jsx)(e.p,{children:"Because cookies are included in communication, they move as shown in the following picture"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722125032.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["Cookie manipulation in Next is possible on the frontend server. ",(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/app/api-reference/functions/cookies",children:"https://nextjs.org/docs/app/api-reference/functions/cookies"})]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722130714.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can CRUD cookies between the browser and backend server, and since this runs on the frontend server, it was usable inside server components."}),"\n",(0,sa.jsxs)(e.p,{children:["Based on this, functions were created and branches were divided.\n",(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/app/api-reference/functions/cookies",children:"https://nextjs.org/docs/app/api-reference/functions/cookies"})]}),"\n",(0,sa.jsx)(e.p,{children:"Keep in mind that cookies were utilized for server component design to use Suspense, and detailed stories will be covered in the recently viewed notices design section."}),"\n",(0,sa.jsx)(e.h3,{children:"Process to Next Cookie (Considerations)"}),"\n",(0,sa.jsx)(e.p,{children:"Actually, initially I tried to handle login status or recently viewed notices with global state management."}),"\n",(0,sa.jsx)(e.p,{children:"Global state is fixed in that route. It is not saved when route change occurs."}),"\n",(0,sa.jsx)(e.p,{children:"This is because zustand has a middleware called persist that stores data using localStorage even during route changes."}),"\n",(0,sa.jsx)(e.p,{children:"There were many trials and errors to use this."}),"\n",(0,sa.jsx)(e.p,{children:"I really looked up numerous references and found ways like not doing hydrate and then doing rehydrate on the client side to use zustand that runs on both client and server in Next."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," useUserStore ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/stores/create-store"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Execute rehydrate on mount."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Hydration"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    useUserStore.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"persist"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rehydrate"}),"();\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Hydration"}),";\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This was using so-called full-body contortions."}),"\n",(0,sa.jsx)(e.p,{children:'I focused on global "state". The zustand developer often said in GitHub issues that understanding would be easier if you know that "state" does not exist on the server. In addition, a team member said that there\'s actually localStorage, but it doesn\'t seem different from global state. Moreover, zustand also uses rehydrate on the client side and utilizes localStorage, so it could only be used in client components.'}),"\n",(0,sa.jsx)(e.p,{children:'I couldn\'t answer easily either and focused on "state".'}),"\n",(0,sa.jsx)(e.p,{children:"I focused on whether the state being stored now needs to change rendering in one route? Or whether it just needs to be fetched once as global data and can be changed."}),"\n",(0,sa.jsx)(e.p,{children:'I learned that data that should be managed in the browser is "simple data like notice information, login status" rather than "state", and zustand was deleted from the Gheuppay project, and in this process, I met Next cookie which can also be utilized on the server.'}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"In the process of solving these problems, I strongly came to think that technology is ultimately just a tool. If I had thought more about the meaning of global state management and proceeded with design, I wouldn't have used a tool like zustand."}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"Page Implementation"}),"\n",(0,sa.jsx)(e.p,{children:"Now let's look at implementation in earnest with code. I'll talk about the reasons for writing the code and related trouble issues."}),"\n",(0,sa.jsx)(e.h2,{children:"Overall Page Structure Design"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"page"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ params }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PageProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"base-container"'}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"NoticeDetailCardSkeleton"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"NoticeDetailCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shopId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{params.shop_id}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticeId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{params.notice_id}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"my-12"'}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h2"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"text-l py-8 font-bold md:text-2xl"'}),">"]}),"최근에 본 공고",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h2"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"grid grid-cols-2 gap-4 lg:grid-cols-3"'}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{[1,"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"5"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"6"}),"]",(0,sa.jsx)(e.span,{className:"hljs-attr",children:".map"}),"((",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),") =>"]})," (\n              ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"NoticeCardSkeleton"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{value}"})," />"]}),"\n            ))}\n          >\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"RecentNotices"}),"\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shopId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{params.shop_id}"}),"\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticeId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{params.notice_id}"}),"\n            />"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This is the overall page structure."}),"\n",(0,sa.jsx)(e.p,{children:"I created skeletons for the main card and recently viewed notices and made them fallbacks of Suspense so that skeletons can be seen before server components are rendered. Since it's close to a UI component, I'll move on quickly."}),"\n",(0,sa.jsx)(e.h2,{children:"Main Card Design"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"NoticeDetailCard"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  shopId,\n  noticeId,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeDetailCardProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," noticeDetail = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getShopNoticeDetail"}),"(shopId, noticeId);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"type"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," address = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"address"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," userId = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"userId"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," hourlyWage = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"calculateWagePercentage"}),"(noticeDetail.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"hourlyPay"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," date = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dateFormat"}),"(noticeDetail.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"startsAt"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLater"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"boolean"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"compareWorkingDateDiffFromNow"}),"(\n    noticeDetail.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"startsAt"}),",\n    noticeDetail.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"workhour"}),",\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," userApplication =\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," userId === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"string"'})," && ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"employee"'}),"\n      ? ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getUsersUserIdApplications"}),"(userId)\n      : ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This is NoticeDetailCard that extracts and uses shopId and noticeId from params. I could receive user information using cookies and proceeded with rendering through this."}),"\n",(0,sa.jsx)(e.p,{children:"Through this information, branch processing of the apply button was possible from when creating the server component."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"RegisterButton"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  address,\n  userApplication,\n  shopId,\n  noticeId,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"RegisterButtonProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (userApplication === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n      ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"LinkButton"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'""'})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),'"/',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),'"}>']}),"\n        신청하기\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"LinkButton"}),">"]})]}),"\n    );\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isRegister = userApplication.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"items"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"some"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"obj"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n      obj.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"notice"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," === noticeId && obj.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"pending"'}),"\n    );\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isRejected = userApplication.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"items"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"some"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"obj"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n      obj.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"notice"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," === noticeId && obj.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"rejected"'}),"\n    );\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"By passing down data that utilized cookies as props like above, the apply button, which is a client component, was able to have various function expansions like modal functionality, Link, etc."}),"\n",(0,sa.jsx)(e.h2,{children:"Recently Viewed Notices Design"}),"\n",(0,sa.jsx)(e.p,{children:"This is the purpose of writing this article and the part I put the most effort into."}),"\n",(0,sa.jsxs)(e.p,{children:["First, the logic for storing notices should be a ",(0,sa.jsx)(e.code,{children:"queue"})," data structure. If the function that stores has this, users just need to send arguments. Since it's related to cookies, I tried to make it clean with one function, hiding specific implementation and revealing only what's needed."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use server"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get notices."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," getNotices = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeIds"}),"[]> => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"currentNotice"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeIds"}),"[] = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"parse"}),"(\n    (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"notices"'}),")) || ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"[]"'}),",\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," currentNotice;\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Internal function that parses notices"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," setNotices = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticesIdList"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeIds"}),"[]): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),"> => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"notices"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"(noticesIdList));\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Logic to store notices using queue data structure"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postNotice"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"notice"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetNotices"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"items"'}),"][",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"][",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"item"'}),"],\n"]}),"): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),"> {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"currentNotice"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeIds"}),"[] = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getNotices"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newNoticeId = { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": notice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shopId"}),": notice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"shop"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Check for duplicates"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isDuplicated = currentNotice.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"some"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"n"}),") =>"]})," n.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," === notice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (isDuplicated) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setNotices"}),"([\n      newNoticeId,\n      ...currentNotice.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"filter"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"n"}),") =>"]})," n.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," !== notice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"}),"),\n    ]);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (currentNotice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," >= ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setNotices"}),"([newNoticeId, ...currentNotice.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"slice"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),")]);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setNotices"}),"([newNoticeId, ...currentNotice]);\n  }\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["By structuring the data storage logic like above, I simplified it so that when getting notices, it's ",(0,sa.jsx)(e.code,{children:"getNotices()"})," and when storing, it's ",(0,sa.jsx)(e.code,{children:"postNotice(data)"})," format."]}),"\n",(0,sa.jsx)(e.p,{children:"Since it automatically handles duplicate processing and data management, subsequent work became faster."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"RecentNotices"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  shopId,\n  noticeId,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReCentNoticesProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," notices = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getNotices"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"PostNoticesEffect"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shopId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{shopId}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticeId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{noticeId}"})," />"]}),"\n      {notices &&\n        notices.length > 1 &&\n        notices.map(async (notice) => {\n          if (notice.id === noticeId) return null; // early return\n          const cardContents = await fetchNotices(notice);\n          return (\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"LinkButton"}),"\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticeId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.id}"}),"\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shopId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.shop.item.id}"}),"\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.id}"}),"\n            >"]}),"\n              ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"NoticeCard"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"address1"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.shop.item.address1}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"closed"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.closed}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"hourlyPay"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.hourlyPay}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticeId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.id}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"imageUrl"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.shop.item.imageUrl}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.shop.item.name}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"startsAt"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.startsAt}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"workhour"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.workhour}"}),"\n              />"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"LinkButton"}),">"]}),"\n          );\n        })}\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"You can see there's a part called PostNoticeEffect. This is to store data using UseEffect."}),"\n",(0,sa.jsx)(e.p,{children:"The reason for using it this way is because rendering proceeds in the following process."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Enter the page."}),"\n",(0,sa.jsx)(e.li,{children:"Recently viewed notices are rendered."}),"\n",(0,sa.jsx)(e.li,{children:"Since entry occurred, add the currently viewed notice to cookies as well."}),"\n",(0,sa.jsx)(e.li,{children:"Recently viewed notices re-render (change) due to cookie change."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"This showed data changing once more after server component rendering, and I considered this a problem."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"PostNoticesEffect"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  shopId,\n  noticeId,\n}: {\n  shopId: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  noticeId: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n}"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetchData"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getShopNoticeDetail"}),"(shopId, noticeId);\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postNotice"}),"(data.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),");\n    };\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetchData"}),"();\n  }, []);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"By inserting the code above, postNotice was executed during client rendering to put data in cookies, and during re-rendering that occurs when cookies change,"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (notice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," === noticeId) ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),"; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// early return"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"I blocked the currently viewed notice with early return so users don't feel the rendered change."}),"\n",(0,sa.jsx)(e.p,{children:"This way, because it's a server component, it renders very quickly and can even express skeletons due to suspense."}),"\n",(0,sa.jsx)(s7,{id:"988246692"}),"\n",(0,sa.jsx)(e.h3,{children:"Troubleshooting"}),"\n",(0,sa.jsx)(e.h4,{children:"Async functions should not be put in handlers."}),"\n",(0,sa.jsx)(e.p,{children:"I found an error where the page freezes when rapidly clicking notice cards."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"NoticeCard"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  hourlyPay,\n  startsAt,\n  workhour,\n  noticeId,\n  shopId,\n  imageUrl,\n  name,\n  address1,\n  content,\n  closed,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeCardProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," hourlyWage = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"calculateWagePercentage"}),"(hourlyPay);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," date = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dateFormat"}),"(startsAt);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLater"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"boolean"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"compareWorkingDateDiffFromNow"}),"(startsAt, workhour);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleClick"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (content) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postNoticeAction"}),"(content);\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirectAction"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`/admin/notice-detail/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${shopId}"}),"/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${noticeId}"}),"`"]}),");\n    }\n  };\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"I thought the problem occurred here where events are passed with branch processing by content,"}),"\n",(0,sa.jsx)(e.p,{children:"but in the current post case, it's managed with cookies, and because the function that sets this cookie was in the button's event handler, continuously pressing the setter function asynchronously"}),"\n",(0,sa.jsx)(e.p,{children:"caused server overload and the page froze."}),"\n",(0,sa.jsx)(e.p,{children:"Rapid clicking event handler > async function that stores cookies continuously executed > phenomenon where content disappears at a specific point > handled by middleware due to redirectAction() function (if content doesn't exist, moves to owner page, but since not owner, forcibly moves to list page)"}),"\n",(0,sa.jsx)(e.h5,{children:"Solution"}),"\n",(0,sa.jsx)(e.p,{children:"I simply changed it to a method of storing when accessing the page. It looks short, but the process of finding it out was a bit painful. I thought I need to think more about writing code well."}),"\n",(0,sa.jsx)(e.h4,{children:"There are limits to storing in cookies."}),"\n",(0,sa.jsx)(e.p,{children:"Currently, I'm storing the id of notice cards, but originally I used to put notice data itself in cookies."}),"\n",(0,sa.jsx)(e.p,{children:"However, there was a problem where objects couldn't be stored beyond 3, and I, who was developing with cookie omnipotence, remembered that cookie data is up to 4MB."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240701225259.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Cookie size was around 3327 when 3 objects were stored, and when I checked, the unit was Byte, meaning cookies that can accept up to 4096Byte couldn't accept more."}),"\n",(0,sa.jsx)(e.h5,{children:"Solution"}),"\n",(0,sa.jsx)(e.p,{children:"After thinking about it, I changed it to a logic that stores id and fetches the latest data using that id on the side that retrieves it, solving the problem."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n notices.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," > ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"})," &&\n        notices.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"slice"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (notice, ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"index"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),") => {\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newCardContents = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetchNotices"}),"(notice);\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Now, because only id is stored in cookies, I could reduce the amount of data included in communication and store necessary data appropriately."}),"\n",(0,sa.jsx)(e.p,{children:"This part that could be seen in the entire code was code written to solve this problem."}),"\n",(0,sa.jsx)(e.h1,{children:"reference"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming",children:"https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/app/api-reference/functions/cookies",children:"https://nextjs.org/docs/app/api-reference/functions/cookies"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://ko.javascript.info/cookie",children:"https://ko.javascript.info/cookie"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"This is an article containing the methods I considered, problems I encountered, and their solution processes during the Gheuppay project!"}),"\n",(0,sa.jsx)(e.p,{children:"If there are any incorrect contents, please let me know. Thank you."}),"\n"]})]})}function ef(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eg,{...s})}):eg(s)}function ey(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"설계"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722113132.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"위의 시안을 분석해보고 Next.js 식으로 최대한 서버 컴포넌트를 이용하려면 다음과 같이 분기를 나눠서 생각해보면 다음과 같습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["위쪽의 메인이 되는 카드 : 초기 페이지 렌더링 시 서버에서 받아오고 suspense로 기다리는 시간 보완. (server component)","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"신청하기 버튼의 경우 로그인 상태에 따라서 여러가지 분기가 나뉘어지게 설계. (이벤트 핸들러가 들어가기 때문에 client component)"}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.li,{children:["최근에 본 공고 파트 : 앞에서 데이터가 들어오면 뒤의 데이터는 없어져야 하니 ",(0,sa.jsx)(e.code,{children:"queue"})," 자료구조로 설계 (server component)"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722120938.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"(red : server component, blue: client component)"}),"\n",(0,sa.jsx)(e.h2,{children:"서버 컴포넌트 설계"}),"\n",(0,sa.jsx)(e.p,{children:"서버 컴포넌트를 설계하기 위해선 페이지 단위에서 일단 서버 컴포넌트여야 합니다. 최상단의 컴포넌트가 클라이언트 컴포넌트일 경우 서버 컴포넌트를 사용할 수 없게 되기 때문입니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"RCC (React Client Component) 는 서버 컴포넌트를 import할 수 없습니다. 서버 환경이 브라우저에 존재하지 않기 때문입니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"서버 컴포넌트를 사용할 경우 Next.js 에서는 각각의 컴포넌트를 따로 loading할 수 있는 streaming 방식을 사용합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722121441.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["컴포넌트 별로 분할해서 loading state를 처리하는 방법은 리액트의 ",(0,sa.jsx)(e.code,{children:"Suspense"}),"를 사용하는 것입니다. next에서 확장시킨 ",(0,sa.jsx)(e.code,{children:"Suspense"}),"로 서버 컴포넌트를 감싸면 서버 컴포넌트가 렌더링 되기 전까지 ",(0,sa.jsx)(e.code,{children:"fallback"})," 안에 있는 컴포넌트가 해당 서버 컴포넌트를 대신합니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722121816.png",alt:""})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"TTFB : 첫 바이트까지의 시간\nFCP : 최초 컨텐츠가 페인팅되기까지의 시간\nTTI : 사용자가 인터렉션을 할 수 있게 되는 시간"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"위 사진은 streaming 이전의 방식입니다. 모든 컴포넌트가 렌더링이 되야 페이지가 로딩되기 때문에 TTFB, FCP, TTI 가 순차적으로 보여질 수 밖에 없었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"로딩 화면이 모두 끝나고 페이지에 진입할 수 있도록 강제하는 것은 UX적으로 안 좋을 수 밖에 없습니다."}),"\n",(0,sa.jsx)(e.p,{children:"예를 들어 네이버에 웹툰을 보러 들어갔는데 웹툰 페이지 진입 버튼 하나를 누르기 위해서 스포츠, 연예, 뉴스 모든 컨텐츠가 사용가능한 상태가 되기까지 기다리는 것은 페이지 성능이 좋아서 빨리 로딩되더라도 더 최적화할 여지가 있는 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"Next는 이를 streaming으로 해결했습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722121647.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"각각의 컴포넌트는 각각의 파트를 가집니다. 데이터를 받고 HTML을 렌더링하고 하이드레이션하는 과정들을 각각 가짐으로써 TTFB, FCP, TTI를 모두 당기게 되어 페이지 성능 최적화를 이끌게 됩니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"급페이 프로젝트에서는 이를 최대한 활용하며 개발을 나아갔습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Next Cookie를 이용한 설계"}),"\n",(0,sa.jsx)(e.p,{children:"React에서는 다음과 같이 통신이 진행됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722125032.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"프론트엔드 서버가 존재하는 Next.js에서는 간단하게 다음과 같이 통신이 진행됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722124750.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"브라우저 > 프론트엔드 서버(node.js 환경) > 백엔드 서버 식이죠. 위처럼 움직이기 때문에 SSR이나 SSG, ISG 등등이 가능하게 된 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:'서버 컴포넌트는 프론트엔드 "서버" 컴포넌트를 말하는데요. 데이터를 분할해서 브라우저로 보낼 수 있는 streaming이 가능한 이유도 이것 때문입니다.'}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722125217.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Suspense를 이용하면 위 사진처럼 fallback을 먼저 보내고 프론트엔드 서버에서 서버 컴포넌트 렌더링을 끝내면 브라우저에 컴포넌트를 보내고 fallback을 치우는 식이죠."}),"\n",(0,sa.jsx)(e.p,{children:"이번 작업에서 최근 본 공고에 이를 활용하고자 했는데요. 문제는 서버 컴포넌트 렌더링을 끝내고 Suspense를 받기 위해서는 서버 컴포넌트 내부의 것들이 서버 관련이어야 한다는 것입니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"서버 컴포넌트 : 클라이언트 관련된 것들을 사용할 수 없습니다. Web API, document, web storage 등등에 접근할 수 없고 상태,훅등을 사용할 수 없습니다. 대신 db, 내부 서비스, 파일 시스템 등 서버에만 있는 데이터는 async, await으로 접근할 수 있습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"로컬 스토리지나 세션 스토리지 같은 web storage를 사용해서 최근 본 공고를 구현할 수는 있었으나 web storage라서 서버 컴포넌트 안에서는 쓸 수 없었고 그럼 Suspense를 활용할 수 없게 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"이를 위해 찾게 된 것이 Next Cookie였습니다."}),"\n",(0,sa.jsxs)(e.p,{children:["기존 React에서는 쿠키를 document.cookie를 이용해서 접근이 가능했습니다. (httpOnly가 아닐 경우에만) (",(0,sa.jsx)(e.a,{href:"https://ko.javascript.info/cookie",children:"https://ko.javascript.info/cookie"}),")"]}),"\n",(0,sa.jsx)(e.p,{children:"쿠키는 통신에 담기기 때문에 다음의 사진대로 움직이게 되죠"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722125032.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["Next 에서의 쿠키 조작은 프론트엔드 서버에서 가능합니다. ",(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/app/api-reference/functions/cookies",children:"https://nextjs.org/docs/app/api-reference/functions/cookies"})]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240722130714.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"브라우저와 백엔드 서버 사이에서 쿠키를 CRUD할 수 있고 이는 프론트엔드 서버에서 실행되기에 서버 컴포넌트 안에서도 사용가능한 것이었습니다."}),"\n",(0,sa.jsxs)(e.p,{children:["이를 기반으로 함수를 만들어주고 분기를 나누게 되었습니다.\n",(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/app/api-reference/functions/cookies",children:"https://nextjs.org/docs/app/api-reference/functions/cookies"})]}),"\n",(0,sa.jsx)(e.p,{children:"Suspense 사용을 위한 서버 컴포넌트 설계를 위해 쿠키를 활용했다 라는 것을 알아두고 자세한 이야기는 최근 본 공고 설계 부분에서 다루도록 하겠습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"Next Cookie까지 오게된 과정 (고민들)"}),"\n",(0,sa.jsx)(e.p,{children:"사실 처음에는 로그인 상태나 최근 본 공고는 전역 상태 관리로 처리하려고 했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"전역 상태라는 것은 해당 route에서 고정됩니다. route change가 일어나면 저장이 되지 않습니다."}),"\n",(0,sa.jsx)(e.p,{children:"zustand에서 persist라는 미들웨어가 존재해서 route change에서도 로컬 스토리지를 활용해 데이터를 저장해 놓았기 때문인데요."}),"\n",(0,sa.jsx)(e.p,{children:"이를 사용하기 위한 많은 시행 착오가 있었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"정말 수많은 레퍼런스도 찾아보았고 클라이언트와 서버 둘다 실행되는 zustand를 Next에서 사용하기 위해서 hydrate를 진행하지 않다가 rehydrate를 클라이언트 단에서 하는 등의 방식도 찾게 되었습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," useUserStore ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/stores/create-store"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// mount 시 rehydrate를 실행합니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Hydration"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    useUserStore.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"persist"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rehydrate"}),"();\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Hydration"}),";\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"소위 온몸 비틀기를 사용한 것인데요."}),"\n",(0,sa.jsx)(e.p,{children:'전역 "상태" 에 집중해보았습니다. zustand 개발자분은 깃허브 이슈에서 서버에는 "상태"가 존재하지 않다는 사실을 알면 이해가 편할꺼라고 이야기를 자주했습니다. 거기에 팀원이 사실 로컬 스토리지가 있는데 전역 상태와의 차이가 없는 것 같다고 말씀 해주셨습니다. 더구나 주스탄드 역시 rehydrate를 클라이언트 단에서 사용하고 로컬 스토리지를 활용하기 때문에 클라이언트 컴포넌트에서밖에 사용할 수 없었죠.'}),"\n",(0,sa.jsx)(e.p,{children:'저도 선뜻 대답할 수 없었고 "상태"라는 것에 집중해보았습니다.'}),"\n",(0,sa.jsx)(e.p,{children:"지금 저장하고 있는 상태가 한 라우트에서 렌더링의 변화가 이루어져야 하는 것인가? 아니면 전역 데이터로써 한번 가져오고 바꿀 수만 있으면 되는 것인가 에 집중해보았습니다."}),"\n",(0,sa.jsx)(e.p,{children:'브라우저에서 관리되어야할 데이터는 "상태" 보단 "공고에 대한 정보, 로그인 여부 같은 단순 데이터" 라는 사실을 알게 되었고 zustand는 급페이 프로젝트에서 삭제하게 되고 이 과정 속에서 서버에서도 활용이 가능한 Next cookie를 만나게 됩니다.'}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"이 문제들을 해결하는 과정에서 기술은 어디까지나 도구 라는 생각을 강하게 갖게 되었습니다. 전역 상태 관리 라는 것의 의미를 많이 고민하고 설계를 진행했더라면 zustand라는 도구를 사용하지 않았을 것입니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"페이지 구현"}),"\n",(0,sa.jsx)(e.p,{children:"이제 구현에 대해서 본격적으로 코드와 함께 찾아보겠습니다. 코드를 작성한 이유와 그와 관련된 트러블 이슈를 이야기해보겠습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"전체 페이지 구조 설계"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"page"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ params }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PageProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"base-container"'}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"NoticeDetailCardSkeleton"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"NoticeDetailCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shopId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{params.shop_id}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticeId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{params.notice_id}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"my-12"'}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h2"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"text-l py-8 font-bold md:text-2xl"'}),">"]}),"최근에 본 공고",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h2"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"grid grid-cols-2 gap-4 lg:grid-cols-3"'}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{[1,"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"5"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"6"}),"]",(0,sa.jsx)(e.span,{className:"hljs-attr",children:".map"}),"((",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),") =>"]})," (\n              ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"NoticeCardSkeleton"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{value}"})," />"]}),"\n            ))}\n          >\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"RecentNotices"}),"\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shopId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{params.shop_id}"}),"\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticeId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{params.notice_id}"}),"\n            />"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"페이지 전체 구조입니다."}),"\n",(0,sa.jsx)(e.p,{children:"메인 카드와 최근 본 공고의 스켈레톤을 제작하고 이를 Suspense의 fallback으로 만듬으로써 서버 컴포넌트들이 렌더링 되기 전에 스켈레톤을 볼 수 있도록 하였습니다. ui 컴포넌트에 가까우니 빠르게 넘어가겠습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"메인 카드 설계"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"NoticeDetailCard"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  shopId,\n  noticeId,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeDetailCardProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," noticeDetail = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getShopNoticeDetail"}),"(shopId, noticeId);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"type"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," address = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"address"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," userId = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"userId"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," hourlyWage = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"calculateWagePercentage"}),"(noticeDetail.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"hourlyPay"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," date = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dateFormat"}),"(noticeDetail.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"startsAt"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLater"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"boolean"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"compareWorkingDateDiffFromNow"}),"(\n    noticeDetail.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"startsAt"}),",\n    noticeDetail.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"workhour"}),",\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," userApplication =\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," userId === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"string"'})," && ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"employee"'}),"\n      ? ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getUsersUserIdApplications"}),"(userId)\n      : ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"shopId와 noticeId를 param에서 꺼내며 사용되는 NoticeDetailCard 입니다. 쿠키를 활용해서 사용자의 정보를 받아 올 수 있으며 이를 통해 렌더링을 진행했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"이 정보를 통해서 서버 컴포넌트를 만들 때부터 신청하기 버튼의 분기 처리가 가능합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"RegisterButton"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  address,\n  userApplication,\n  shopId,\n  noticeId,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"RegisterButtonProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (userApplication === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n      ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"LinkButton"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'""'})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),'"/',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"login"}),'"}>']}),"\n        신청하기\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"LinkButton"}),">"]})]}),"\n    );\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isRegister = userApplication.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"items"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"some"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"obj"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n      obj.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"notice"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," === noticeId && obj.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"pending"'}),"\n    );\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isRejected = userApplication.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"items"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"some"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"obj"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n      obj.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"notice"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," === noticeId && obj.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"rejected"'}),"\n    );\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위처럼 쿠키가 활용된 데이터를 props으로 내려줌으로써 클라이언트 컴포넌트인 신청하기 버튼이 모달 기능, Link 등등 다양한 기능 확장을 가질 수 있게 되었습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"최근 본 공고 설계"}),"\n",(0,sa.jsx)(e.p,{children:"이번 글 쓰기의 목적이자 제일 공을 많이 들였던 파트입니다."}),"\n",(0,sa.jsxs)(e.p,{children:["우선 공고를 저장하는 로직은 ",(0,sa.jsx)(e.code,{children:"큐"})," 자료구조여야 합니다. 저장하는 함수에서 이를 갖고 있다면 사용하는 사람은 인수를 보내기만 하면 되겠죠. cookie와 관련되어 있기에 구체적인 구현은 숨기고 드러나는 부분은 함수 하나로 클린하게 만들기 위해 노력했습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use server"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// notice를 가져옵니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," getNotices = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeIds"}),"[]> => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"currentNotice"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeIds"}),"[] = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"parse"}),"(\n    (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"notices"'}),")) || ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"[]"'}),",\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," currentNotice;\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// notice를 파싱해주는 내부 함수"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," setNotices = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticesIdList"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeIds"}),"[]): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),"> => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"notices"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"(noticesIdList));\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// notice를 큐 자료구조를 활용하여 저장하는 로직"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postNotice"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"notice"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetNotices"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"items"'}),"][",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"][",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"item"'}),"],\n"]}),"): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),"> {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"currentNotice"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeIds"}),"[] = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getNotices"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newNoticeId = { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": notice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shopId"}),": notice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"shop"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 중복 확인"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isDuplicated = currentNotice.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"some"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"n"}),") =>"]})," n.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," === notice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (isDuplicated) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setNotices"}),"([\n      newNoticeId,\n      ...currentNotice.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"filter"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"n"}),") =>"]})," n.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," !== notice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"}),"),\n    ]);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (currentNotice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," >= ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setNotices"}),"([newNoticeId, ...currentNotice.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"slice"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),")]);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setNotices"}),"([newNoticeId, ...currentNotice]);\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"데이터를 저장하는 로직을 위처럼 구성해놓아 notice를 가져올 때는 getNotices() 저장할때는 postNotice(데이터) 형식으로 단순화시켰습니다."}),"\n",(0,sa.jsx)(e.p,{children:"자동으로 중복처리, 데이터 관리를 해주기에 추후 작업이 빨라지게 되었습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"RecentNotices"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  shopId,\n  noticeId,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReCentNoticesProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," notices = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getNotices"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"PostNoticesEffect"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shopId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{shopId}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticeId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{noticeId}"})," />"]}),"\n      {notices &&\n        notices.length > 1 &&\n        notices.map(async (notice) => {\n          if (notice.id === noticeId) return null; // early return\n          const cardContents = await fetchNotices(notice);\n          return (\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"LinkButton"}),"\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticeId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.id}"}),"\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shopId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.shop.item.id}"}),"\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.id}"}),"\n            >"]}),"\n              ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"NoticeCard"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"address1"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.shop.item.address1}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"closed"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.closed}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"hourlyPay"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.hourlyPay}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"noticeId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.id}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"imageUrl"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.shop.item.imageUrl}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.shop.item.name}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"startsAt"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.startsAt}"}),"\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"workhour"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cardContents.workhour}"}),"\n              />"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"LinkButton"}),">"]}),"\n          );\n        })}\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"보시면 PostNoticeEffect 라는 부분이 있는데요. 이는 UseEffect로 데이터를 저장해주기 위함입니다."}),"\n",(0,sa.jsx)(e.p,{children:"이렇게 사용하는 이유는 다음의 과정으로 렌더링이 진행되기 때문입니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"페이지에 진입합니다."}),"\n",(0,sa.jsx)(e.li,{children:"최근 본 공고가 렌더링됩니다."}),"\n",(0,sa.jsx)(e.li,{children:"진입이 되었기에 쿠키에서 현재 보는 공고도 추가시킨다."}),"\n",(0,sa.jsx)(e.li,{children:"쿠키 변경으로 인해서 최근 본 공고가 리렌더링 (변경 됩니다.)"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"이는 서버 컴포넌트 렌더링 이후에 한번 더 데이터가 바뀌는 모습을 보여주게 되었고 이를 문제로 여겼습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"PostNoticesEffect"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  shopId,\n  noticeId,\n}: {\n  shopId: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  noticeId: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n}"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetchData"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getShopNoticeDetail"}),"(shopId, noticeId);\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postNotice"}),"(data.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"item"}),");\n    };\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetchData"}),"();\n  }, []);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위의 코드를 삽입해서 클라이언트 렌더링 시에 postNotice를 실행시켜서 데이터를 쿠키에 담게 하였고 쿠키가 바뀌게 되면서 발생하는 리렌더링 시"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (notice.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," === noticeId) ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),"; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// early return"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"early return으로 현재 보는 공고는 차단하여 사용자는 렌더링된 것을 느끼지 못하게 하였습니다."}),"\n",(0,sa.jsx)(e.p,{children:"이로써 서버 컴포넌트이기에 굉장히 빠르게 렌더링 되면서 suspense로 인한 스켈레톤 표현까지 할 수 있게 되었습니다."}),"\n",(0,sa.jsx)(s7,{id:"988246692"}),"\n",(0,sa.jsx)(e.h3,{children:"트러블 슈팅"}),"\n",(0,sa.jsx)(e.h4,{children:"핸들러에 비동기 함수를 넣어선 안됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"공고 카드를 광클하면 멈추는 오류를 발견했습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"NoticeCard"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n\xa0 hourlyPay,\n\xa0 startsAt,\n\xa0 workhour,\n\xa0 noticeId,\n\xa0 shopId,\n\xa0 imageUrl,\n\xa0 name,\n\xa0 address1,\n\xa0 content,\n\xa0 closed,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NoticeCardProps"})]}),") {\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," hourlyWage = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"calculateWagePercentage"}),"(hourlyPay);\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," date = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dateFormat"}),"(startsAt);\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLater"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"boolean"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"compareWorkingDateDiffFromNow"}),"(startsAt, workhour);\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleClick"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (content) {\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postNoticeAction"}),"(content);\n\xa0 \xa0 } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirectAction"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`/admin/notice-detail/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${shopId}"}),"/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${noticeId}"}),"`"]}),");\n\xa0 \xa0 }\n\xa0 };\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"content로 분기처리를 해서 이벤트를 전달하는데 여기서 문제가 발생한 줄 알았으나"}),"\n",(0,sa.jsx)(e.p,{children:"현재 post의 경우 cookie로 관리되고 있는데 이 cookie를 set하는 함수가 버튼의 이벤트 핸들러에 있어서 setter함수를 비동기적으로 계속 누르면"}),"\n",(0,sa.jsx)(e.p,{children:"서버에 과부하가 걸려서 페이지가 멈추게 되었던 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"이벤트 핸들러 광클 > cookie를 저장하는 비동기 함수 계속 실행 > 특정 시점에 content가 없어지는 현상 > redirectAction() 함수로 인해 middleware에서 처리(content가 없으면 사장님 페이지로 이동되지만 사장님이 아니기에 list page로 강제 이동)"}),"\n",(0,sa.jsx)(e.h5,{children:"해결 방법"}),"\n",(0,sa.jsx)(e.p,{children:"간단하게 페이지에 접근하면서 저장하는 방식으로 변경했습니다. 짧게 보이긴 하지만 그 알아내는 과정이 조금 고통스러웠어요. 코드를 잘 작성하는 것에 대해 더 고민을 해야되겠다고 생각했습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"쿠키에 저장하는 건 한계가 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"현재는 공고 카드의 id를 저장하고 있지만 기존에는 공고 데이터 자체를 쿠키에 넣는 식으로 사용했었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"하지만 도중 객체가 3개 이상 저장되지 않는 문제가 있었고 쿠키 만능 주의로 개발하던 저는 쿠키의 데이터가 4MB까지 였다는 사실을 기억해내게 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-21/Pasted%20image%2020240701225259.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"cookie size가 3327 정도가 객체 3개가 담겨있을 때였고 확인을 하니 단위는 Byte 즉 4096Byte 까지가 용량인 쿠키가 더 받아들일 수 없었던 것입니다."}),"\n",(0,sa.jsx)(e.h5,{children:"해결 방법"}),"\n",(0,sa.jsx)(e.p,{children:"고민을 하다가 id를 저장해놓고 꺼내오는 쪽에서 해당 id를 활용하여 최신 데이터를 받아오는 로직으로 변경해서 문제를 해결하였습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n notices.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," > ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"})," &&\n\xa0 \xa0 \xa0 \xa0 notices.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"slice"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (notice, ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"index"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),") => {\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newCardContents = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetchNotices"}),"(notice);\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이제 id만 쿠키에 저장하기 때문에 통신에 들여지는 데이터 양을 줄일 수 있었고 필요한 데이터들을 알맞게 저장할 수 있었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"전체 코드에서 볼 수 있었던 이 부분은 이 문제를 해결하기 위해 작성된 코드입니다."}),"\n",(0,sa.jsx)(e.h1,{children:"reference"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming",children:"https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/app/api-reference/functions/cookies",children:"https://nextjs.org/docs/app/api-reference/functions/cookies"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://ko.javascript.info/cookie",children:"https://ko.javascript.info/cookie"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"급페이 프로젝트 중 고민했던 방식, 부딪히게 된 문제, 그것의 해결과정을 담은 글입니다!"}),"\n",(0,sa.jsx)(e.p,{children:"잘못된 내용이 있다면 말씀 부탁드립니다. 감사합니다."}),"\n"]})]})}function ew(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(ey,{...s})}):ey(s)}function ek(s){let{id:e}=s;return(0,sa.jsx)("div",{children:(0,sa.jsx)("iframe",{className:"aspect-video w-full",src:"https://www.youtube.com/embed/".concat(e),title:"YouTube Video Player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})})}function eb(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"Design"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-22/Pasted%20image%2020240722170554.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"This is part of the Gheuppay header. The notification window that opens when clicked is implemented with infinite scroll for that data."}),"\n",(0,sa.jsx)(e.p,{children:"The initial value is held by the header throughout as a Server component, and when notifications are clicked and detected by interceptor observer, the next data is finally loaded."}),"\n",(0,sa.jsx)(e.p,{children:"The principle of notification creation is as follows."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Click apply button for a specific shop with part-time worker account"}),"\n",(0,sa.jsx)(e.li,{children:"Click approve or cancel button with that shop owner account"}),"\n",(0,sa.jsx)(e.li,{children:"Click notification window with part-time worker account"}),"\n",(0,sa.jsx)(e.li,{children:"If there are multiple, scroll down to activate infinite scroll"}),"\n",(0,sa.jsx)(e.li,{children:"Check that application notification among the called data"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"In this process, two access tokens are needed (shop owner, part-time worker), and since we wanted to use mock data without worrying about data fetching, it wasn't easy to apply because infinite scroll had to be used.\nSo while searching, I learned about MSW."}),"\n",(0,sa.jsx)(e.p,{children:"MSW is a mocking server worker that mocks the server to intercept requests and return specified responses. I partially introduced MSW to check infinite scroll implementation in an environment where other development was not finished."}),"\n",(0,sa.jsx)(e.h1,{children:"Implementation"}),"\n",(0,sa.jsx)(e.h2,{children:"MSW"}),"\n",(0,sa.jsx)(e.h3,{children:"Environment Setup"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npx msw init ./public --save\n"})}),"\n",(0,sa.jsx)(e.p,{children:"This is a shortcut to put MSW-related resources in the public folder."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// /mocks/browser.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { setupWorker } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"msw/browser"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { handlers } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./handlers"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," worker = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setupWorker"}),"(...handlers);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// /mocks/server.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { setupServer } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"msw/node"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { handlers } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./handlers"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," server = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setupServer"}),"(...handlers);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// /mocks/index.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"initMsw"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"undefined"'}),") { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If server"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { server } = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../mocks/server"'}),");\n    server.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"listen"}),"();\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If browser"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { worker } = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../mocks/browser"'}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," worker.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"start"}),"();\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// /mocks/msw-component"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"MSWComponent"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children }: { children: React.ReactNode }"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [mswReady, setMswReady] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n \n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"init"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," initMsw = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./index"'}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"res"}),") =>"]})," res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"initMsw"}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"initMsw"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setMswReady"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),");\n    };\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!mswReady) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"init"}),"();\n    }\n  }, [mswReady]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"{children}",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),";\n};\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"metadata"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Metadata"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"description"}),":\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"급하게 일손이 필요한 자리에 더 많은 시급을 제공해서 아르바이트생을 구할 수 있는 서비스"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"template"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"%s | 급PAY"'}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"default"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"급PAY"'}),",\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"icons"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"icon"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/icons/favicon.png"'}),",\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"RootLayout"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  children,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Readonly"}),"<{\n  children: React.ReactNode;\n}>"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"html"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"lang"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"ko"'}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"MSWComponent"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"body"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"relative"'}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Header"})," />"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"main"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"min-h-screen"'}),">"]}),"{children}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"main"}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Footer"})," />"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"body"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"MSWComponent"}),">"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"html"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Put MSWComponent in Root so that MSW works when accessing Root."}),"\n",(0,sa.jsx)(e.h3,{children:"Handler Design"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@description"}),"\n * You can use msw using handlers.\n * 1. Uncomment MswComponent in layout.tsx in app.\n * 2. Add desired api to handlers array using msw syntax.\n * 3. Generate mock files for changed items with npx msw init ./public --save.\n *\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@error"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable",children:"Solution"}),"\n * Errors may occur if something was deleted and differs from mock files.\n *\n * You can solve it by rebuilding with npx msw init ./public --save.\n */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," handlers = [\n  http.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.NEXT_PUBLIC_BASE_URL}"}),"/users/*/alerts`"]}),",\n    ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ request, params, cookies }"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// params receives the * of the first argument. Therefore, you must use searchParams"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// to get the desired query."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," offset = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),").",(0,sa.jsx)(e.span,{className:"hljs-property",children:"searchParams"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"offset"'}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (offset === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"0"'}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// makeAlertMockData is a Mock function I arbitrarily created. I made it to give id randomly."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Internally, it gets a random value in Node.js environment through Math.random() and then creates and sends id."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," alertMockData1 = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"makeAlertMockData"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Privatize function's return value using closure."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// This is the Response object recommended by MSW. You can send responses"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// in various forms like json, text, xml, etc."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HttpResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"(alertMockData1);\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (offset === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"6"'}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," alertMockData2 = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"makeAlertMockData"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"다음 offset으로 이동"'}),");\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HttpResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"(alertMockData2);\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," alertMockData3 = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"makeAlertMockData"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HttpResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"(alertMockData3);\n      }\n    },\n  ),\n];\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["As the comment says, you can intercept APIs by manipulating the handlers function. All requests matching the regex ",(0,sa.jsx)(e.code,{children:"users/*/alerts"})," will be intercepted and flow according to the function below."]}),"\n",(0,sa.jsx)(e.p,{children:"Each if, else if, else has meaning."}),"\n",(0,sa.jsx)(e.p,{children:"Explaining the meanings in order:"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["Check if data comes well (",(0,sa.jsx)(e.code,{children:'offset==="0"'}),")"]}),"\n",(0,sa.jsxs)(e.li,{children:["Check if next data comes well and confirm that offset moves and it's the second data (",(0,sa.jsx)(e.code,{children:"offset==='6'"}),")"]}),"\n",(0,sa.jsx)(e.li,{children:"After that, since data comes without console.log, you can clearly confirm that infinite scroll implementation is complete."}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"Mock Data Design"}),"\n",(0,sa.jsx)(e.p,{children:"After that, mock data design is very important."}),"\n",(0,sa.jsx)(e.p,{children:"The biggest concern was how to check if different data is being called."}),"\n",(0,sa.jsx)(e.p,{children:"I found the answer after a shorter time than I thought."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// mock.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," makeAlertMockData = (): ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"alertMockData"})," =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"offset"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"limit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"count"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Total count"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"hasNext"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),", ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Whether next content exists"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"items"}),": [\n      {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"item"}),": {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"random"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toString"}),"(),\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"hi"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"result"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accepted"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"read"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"application"}),": {\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"item"}),": {\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"random"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toString"}),"(),\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"It's using Math.random() for id like above."}),"\n",(0,sa.jsx)(e.p,{children:"In React, a fiber tree called workinprogress is created separately in the background, and when a different part appears, rendering is performed by committing to the current tree that is currently shown."}),"\n",(0,sa.jsx)(e.p,{children:'Here, key plays an important role in checking "different parts". So React even shows a warning to always use key when creating components as arrays like the map method (to prevent unnecessary rendering)'}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:["{alerts.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," > ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"})," ? (\n        alerts.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"item, index"}),") =>"]})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (alerts.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," === index + ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),")\n            ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n              ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"IntersectionArea"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item.item.id}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onImpression"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{onImpression}"}),">"]}),"\n                ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AlertCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"item"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onDelete"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{onDelete}"})," />"]}),"\n              ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"IntersectionArea"}),">"]})]}),"\n            );\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Like this. IntersetionArea is a component I made specifically for interceptor observer. When detected, it calls onImpression."}),"\n",(0,sa.jsx)(e.p,{children:"Here, key is not used, but for the reason above, you must use it by putting a unique value in key. Usually id is put."}),"\n",(0,sa.jsx)(e.p,{children:"Now you'll understand a bit why Math.random() was put in mock data!"}),"\n",(0,sa.jsx)(e.p,{children:"Because Math.random() always calls different values, you can easily check if it's the same data or not. If the same data was given, a warning would appear."}),"\n",(0,sa.jsx)(e.h3,{children:"MSW Execution"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-22/Pasted%20image%2020240702221704.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Hehe"}),"\n",(0,sa.jsx)(e.p,{children:"After that, I successfully confirmed infinite scroll."}),"\n",(0,sa.jsx)(ek,{id:"kJrTBYZtssQ"}),"\n",(0,sa.jsx)(e.h1,{children:"reference"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.a,{href:"https://oliveyoung.tech/blog/2024-01-23/msw-frontend/",children:"https://oliveyoung.tech/blog/2024-01-23/msw-frontend/"}),"\n",(0,sa.jsx)(e.a,{href:"https://www.handongryong.com/post/msw/",children:"https://www.handongryong.com/post/msw/"}),"\n",(0,sa.jsx)(e.a,{href:"https://velog.io/@sangpok/Next.js-App-Router-MSW",children:"https://velog.io/@sangpok/Next.js-App-Router-MSW"})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"This is an article containing the methods I considered, problems I encountered, and their solution processes during the Gheuppay project!"}),"\n",(0,sa.jsx)(e.p,{children:"If there are any incorrect contents, please let me know. Thank you."}),"\n"]})]})}function e_(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eb,{...s})}):eb(s)}function ev(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"설계"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-22/Pasted%20image%2020240722170554.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"급페이 헤더의 일부분입니다. 클릭시 열리는 알림창을 구현하는데 해당 데이터는 무한 스크롤로 구현합니다."}),"\n",(0,sa.jsx)(e.p,{children:"초기 값은 Server component로써 헤더가 내내 갖고 있게 되고 알림을 누르고 interceptor observer로 감지가 되면 비로소 다음 데이터를 로딩하는 것으로 설계하였습니다."}),"\n",(0,sa.jsx)(e.p,{children:"알림 생성의 원리는 다음과 같습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"알바 계정으로 특정 가게 지원하기 버튼 클릭"}),"\n",(0,sa.jsx)(e.li,{children:"해당 가게 주인 계정으로 승인 혹은 취소 버튼 클릭"}),"\n",(0,sa.jsx)(e.li,{children:"알바 계정으로 알림창 클릭"}),"\n",(0,sa.jsx)(e.li,{children:"여러 개일 경우 스크롤을 내려서 인피니티 스크롤 작동"}),"\n",(0,sa.jsx)(e.li,{children:"호출되는 데이터중에 해당 지원 알림 확인"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"이 과정에서 accesstoken이 두개가 필요하고(가게 주인, 알바) 데이터 fetching 신경 쓰지 않고 mock data를 사용하자니 인피니티 스크롤을 사용해야 하기 때문에 적용하기가 쉽지 않았습니다.\n그래서 찾아보다가 MSW라는 것을 알게 되었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"MSW는 server를 mocking함으로써 요청을 가로채서 지정된 response를 리턴하게 해주는 mocking server worker입니다. MSW를 일부 도입하여 다른 개발이 끝나지 않은 환경에서 인피니티 스크롤 구현을 확인하고자 하였습니다."}),"\n",(0,sa.jsx)(e.h1,{children:"구현"}),"\n",(0,sa.jsx)(e.h2,{children:"MSW"}),"\n",(0,sa.jsx)(e.h3,{children:"환경 설정"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npx msw init ./public --save\n"})}),"\n",(0,sa.jsx)(e.p,{children:"public 폴더 안에 msw 관련 리소스들을 담는 단축키입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// /mocks/browser.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { setupWorker } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"msw/browser"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { handlers } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./handlers"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," worker = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setupWorker"}),"(...handlers);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// /mocks/server.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { setupServer } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"msw/node"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { handlers } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./handlers"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," server = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setupServer"}),"(...handlers);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// /mocks/index.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"initMsw"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"undefined"'}),") { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 서버 일 경우"}),"\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { server } = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../mocks/server"'}),");\n\xa0 \xa0 server.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"listen"}),"();\n\xa0 } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 브라우저일 경우"}),"\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { worker } = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../mocks/browser"'}),");\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," worker.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"start"}),"();\n\xa0 }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// /mocks/msw-component"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useEffect, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"MSWComponent"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children }: { children: React.ReactNode }"}),") => {\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [mswReady, setMswReady] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n\xa0\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"init"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," initMsw = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./index"'}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"res"}),") =>"]})," res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"initMsw"}),");\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"initMsw"}),"();\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setMswReady"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),");\n\xa0 \xa0 };\n\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!mswReady) {\n\xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"init"}),"();\n\xa0 \xa0 }\n\xa0 }, [mswReady]);\n\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"{children}",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),";\n};\n"]})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"metadata"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Metadata"})," = {\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"description"}),":\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"급하게 일손이 필요한 자리에 더 많은 시급을 제공해서 아르바이트생을 구할 수 있는 서비스"'}),",\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": {\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"template"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"%s | 급PAY"'}),",\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"default"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"급PAY"'}),",\n\xa0 },\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"icons"}),": {\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"icon"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/icons/favicon.png"'}),",\n\xa0 },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"RootLayout"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n\xa0 children,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Readonly"}),"<{\n\xa0 children: React.ReactNode;\n}>"]}),") {\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n\xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"html"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"lang"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"ko"'}),">"]}),"\n\xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"MSWComponent"}),">"]}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"body"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"relative"'}),">"]}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Header"})," />"]}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"main"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"min-h-screen"'}),">"]}),"{children}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"main"}),">"]}),"\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Footer"})," />"]}),"\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"body"}),">"]}),"\n\xa0 \xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"MSWComponent"}),">"]}),"\n\xa0 \xa0 ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"html"}),">"]})]}),"\n\xa0 );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"MSWComponent를 Root에 넣어줘서 Root에 접근시 msw가 작동되도록 해줍니다."}),"\n",(0,sa.jsx)(e.h3,{children:"핸들러 설계"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@description"}),"\n * handlers를 이용해서 msw를 사용할 수 있습니다.\n * 1. app 에 있는 layout.tsx에서 MswComponent 주석 해제합니다.\n * 2. msw의 문법을 이용해서 handlers 배열에 원하는 api를 추가합니다.\n * 3. npx msw init ./public --save 로 변경된 사항에 대한 mock 파일을 생성합니다.\n *\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@error"})," 해결 방법\n * 무언가를 지워서 mock파일과 달라졌을 경우 에러가 발생할 수 있습니다.\n *\n * npx msw init ./public --save 으로 다시 빌딩하셔서 해결하시면 됩니다.\n */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," handlers = [\n  http.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.NEXT_PUBLIC_BASE_URL}"}),"/users/*/alerts`"]}),",\n    ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ request, params, cookies }"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// params는 첫번째 인수의 *을 받습니다. 고로 searchParams를 이용해야만"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 원하는 query를 얻을 수 있습니다."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," offset = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),").",(0,sa.jsx)(e.span,{className:"hljs-property",children:"searchParams"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"offset"'}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (offset === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"0"'}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// makeAlertMockData는 임의로 만든 Mock 함수입니다. id를 랜덤으로 주기 위해 만들었습니다."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 내부적으로 Math.random()을 통해서 Node.js 환경에서 랜덤한 값을 얻은 후에 id를 만들어 보내줍니다."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," alertMockData1 = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"makeAlertMockData"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 클로저를 이용해서 함수의 리턴값을 private화 합니다."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// MSW에서 권장하는 Response 객체입니다. json, text, xml 등 다양한 형태로"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 응답을 보낼 수 있습니다."}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HttpResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"(alertMockData1);\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (offset === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"6"'}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," alertMockData2 = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"makeAlertMockData"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"다음 offset으로 이동"'}),");\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HttpResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"(alertMockData2);\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," alertMockData3 = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"makeAlertMockData"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HttpResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"(alertMockData3);\n      }\n    },\n  ),\n];\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["주석대로 handlers 함수를 조작해서 api를 가로챌 수 있습니다. ",(0,sa.jsx)(e.code,{children:"현재 users/*/alerts"})," 정규식에 해당하는 모든 요청은 가로채지고 아래의 함수대로 흘러갈 것입니다."]}),"\n",(0,sa.jsx)(e.p,{children:"각 if, else if, else 는 의미가 존재합니다."}),"\n",(0,sa.jsx)(e.p,{children:"순서대로 의미를 설명해보면"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["데이터가 잘 오는지 확인 (",(0,sa.jsx)(e.code,{children:'offset==="0"'}),")"]}),"\n",(0,sa.jsxs)(e.li,{children:["다음 데이터가 잘 오는지 확인하고 offset이 움직이는지 두번째 데이터인지 확실히 확인 (",(0,sa.jsx)(e.code,{children:"offset==='6'"}),")"]}),"\n",(0,sa.jsx)(e.li,{children:"이후부턴 console.log가 없는 채로 데이터가 오기 때문에 인피니티 스크롤 구현이 되었는지 확실하게 확인할 수 있습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"mock data 설계"}),"\n",(0,sa.jsx)(e.p,{children:"이후 mock data 설계가 매우 중요한데요."}),"\n",(0,sa.jsx)(e.p,{children:"가장 큰 고민은 서로 다른 데이터를 호출하고 있는지를 어떻게 확인할지 고민을 했었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"생각보단 짧은 시간 후에 답을 찾게 되었는데요."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// mock.ts"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," makeAlertMockData = (): ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"alertMockData"})," =>"]})," {\n\xa0 ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"offset"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"limit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"count"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 전체 개수"}),"\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"hasNext"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),", ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 다음 내용 존재 여부"}),"\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"items"}),": [\n\xa0 \xa0 \xa0 {\n\xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"item"}),": {\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"random"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toString"}),"(),\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"hi"'}),",\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"result"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accepted"'}),",\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"read"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n\xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"application"}),": {\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"item"}),": {\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"random"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toString"}),"(),\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위처럼 id에 Math.random()을 사용하는 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"리액트에서는 백그라운드에서 workinprogress라는 fiber tree를 따로 생성해놓고 다른 부분이 생겼을 때 현재 보여지는 current tree에 commit하면서 렌더링을 수행하는데요."}),"\n",(0,sa.jsx)(e.p,{children:'여기서 "다른 부분"을 확인하는데 중요한 역할이 key입니다. 그래서 리액트는 map 메소드 처럼 배열로 컴포넌트를 만들 때 key를 꼭 사용하라고 경고창까지 나오게 되죠 (불필요한 렌더링 방지)'}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:["{alerts.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," > ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"})," ? (\n        alerts.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"item, index"}),") =>"]})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (alerts.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," === index + ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),")\n            ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n              ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"IntersectionArea"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item.item.id}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onImpression"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{onImpression}"}),">"]}),"\n                ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AlertCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"item"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{item}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onDelete"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{onDelete}"})," />"]}),"\n              ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"IntersectionArea"}),">"]})]}),"\n            );\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이런식으로 말입니다. IntersetionArea는 제가 만든 interceptor observer 전용 컴포넌트에요 감지되면 onImpression을 호출합니다."}),"\n",(0,sa.jsx)(e.p,{children:"여기선 key를 사용하지 않지만 위의 이유 때문에 key에 고유한 값을 넣어서 사용해야만 합니다. 주로 id를 넣죠."}),"\n",(0,sa.jsx)(e.p,{children:"mock data에 Math.random()을 넣은 이유를 이제 조금 이해가 되실 겁니다!"}),"\n",(0,sa.jsx)(e.p,{children:"Math.random()은 항상 다른 값을 호출하기 때문에 같은 데이터인지 아닌지 쉽게 확인할 수 있는 것입니다. 같은 데이터를 주었다면 경고창이 나오게 되겠죠."}),"\n",(0,sa.jsx)(e.h3,{children:"MSW 실행"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-22/Pasted%20image%2020240702221704.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"씨익"}),"\n",(0,sa.jsx)(e.p,{children:"이후 성공적으로 인피니티 스크롤을 확인했습니다."}),"\n",(0,sa.jsx)(ek,{id:"kJrTBYZtssQ"}),"\n",(0,sa.jsx)(e.h1,{children:"reference"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.a,{href:"https://oliveyoung.tech/blog/2024-01-23/msw-frontend/",children:"https://oliveyoung.tech/blog/2024-01-23/msw-frontend/"}),"\n",(0,sa.jsx)(e.a,{href:"https://www.handongryong.com/post/msw/",children:"https://www.handongryong.com/post/msw/"}),"\n",(0,sa.jsx)(e.a,{href:"https://velog.io/@sangpok/Next.js-App-Router-MSW",children:"https://velog.io/@sangpok/Next.js-App-Router-MSW"})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"급페이 프로젝트 중 고민했던 방식, 부딪히게 된 문제, 그것의 해결과정을 담은 글입니다!"}),"\n",(0,sa.jsx)(e.p,{children:"잘못된 내용이 있다면 말씀 부탁드립니다. 감사합니다."}),"\n"]})]})}function eP(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(ev,{...s})}):ev(s)}function eT(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"Background"}),"\n",(0,sa.jsx)(e.p,{children:"The mindset of this project was to become an individual who helps team members, and I was grateful to take on the role of team leader, so the responsibility was even greater."}),"\n",(0,sa.jsx)(e.p,{children:"Due to that sense of responsibility, I did a lot of work so that team members could focus only on development, beyond my part."}),"\n",(0,sa.jsx)(e.p,{children:"From implementing functions like uploading images to S3 URLs using S3, which are absolutely necessary, to developing components that help with blur processing, I did various tasks beyond my part."}),"\n",(0,sa.jsx)(e.p,{children:"The problems our team encountered were two."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Separating owner account and part-time worker account was possible using cookies, but implementing access restrictions was difficult."}),"\n",(0,sa.jsx)(e.li,{children:"Vercel organization cannot deploy for free. In addition, I wanted to show previews when PRing."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"I'll explain the journey to solve this."}),"\n",(0,sa.jsx)(e.h1,{children:"Implementation"}),"\n",(0,sa.jsx)(e.h2,{children:"middle ware"}),"\n",(0,sa.jsx)(e.p,{children:"I roughly knew about the existence of middleware when implementing an express server for capstone design."}),"\n",(0,sa.jsx)(e.p,{children:"I thought of it as something that exists between things. After learning about the existence of middleware in Next's official documentation, I thought I should look into it more."}),"\n",(0,sa.jsx)(e.p,{children:"In Next, you can think of middleware as existing between the browser and frontend server."}),"\n",(0,sa.jsx)(e.p,{children:"I implemented logic that uses cookies stored on the frontend server to identify users and render appropriately."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/server"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextRequest"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/server"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { getCookie } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./app/_util/cookie"'}),";\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * Middleware that redirects to another place when caught by site restrictions.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable",children:"request"}),"\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@returns"}),"\n */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loginRequired"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"request"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextRequest"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," token = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"type"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isLandingPage = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextUrl"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pathname"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/"'}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isAdminPage = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextUrl"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pathname"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/admin"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isAlbaPage =\n    request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextUrl"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pathname"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/profile-detail"'}),") ||\n    request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextUrl"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pathname"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/profile-register"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (isLandingPage && token) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/notice-list"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (isLandingPage) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"next"}),"();\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!token) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/login"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"employee"'})," && isAdminPage) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/notice-list"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"employer"'})," && isAlbaPage) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/notice-list"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"next"}),"();\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," config = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"matcher"}),": [\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// The pages below are pages that can be accessed in common."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/((?!login|signup|notice-list|notice-detail|api|_next/static|_next/image|images|icons|fonts|favicon.ico).*)"'}),",\n  ],\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This is how it receives request, checks it, and processes it as response."}),"\n",(0,sa.jsx)(e.p,{children:"I organized owner pages, part-time worker pages, initial screens, etc. well and put them in response to improve readability."}),"\n",(0,sa.jsx)(e.h2,{children:"vercel github action"}),"\n",(0,sa.jsx)(e.p,{children:"Originally, I was going to use netlify that I used in a basic project, but since we're using Next, I thought deployment using Vercel would be good, and team members agreed, so we proceeded this way."}),"\n",(0,sa.jsx)(e.p,{children:"I thought I would need to use GitHub action for automatic deployment this time too, but Vercel automatically deploys and shows previews for each PR, so I thought it would be convenient."}),"\n",(0,sa.jsx)(e.p,{children:"The problem here is that for teams, you need to deploy for a fee."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722182732.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"While analyzing other yaml code, I found that preview uses CLI, and I started searching, wondering if organization is free in CLI?"}),"\n",(0,sa.jsx)(e.p,{children:"While searching, I saw a comment in a GitHub issue."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"It seems like there's no way other than accessing through vercel CLI. Try using CLI once (English)"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"organization GUI paid > organization CLI free was the case."}),"\n",(0,sa.jsx)(e.p,{children:"I found documentation that perfectly matched my situation and proceeded. Now I'm happy that I know simple terms since I've done a lot."}),"\n",(0,sa.jsx)(e.h3,{children:"vercel CLI Execution"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npm i -g vercel\n\nvercel\n"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"There was a problem where it doesn't connect with CLI if .github file exists. Move it separately, connect, and proceed again."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Install and run vercel."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722183549.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["After answering as instructed above, you can see that there is a ",(0,sa.jsx)(e.code,{children:".vercel"})," folder in my project folder."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// .vercel"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"orgId"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"..."'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"projectId"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"..."'})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Like above. It exists to identify my project, so let's write it down somewhere."}),"\n",(0,sa.jsxs)(e.p,{children:["After that, I'll use ",(0,sa.jsx)(e.a,{href:"https://github.com/amondnet/vercel-action",children:"amondnet/vercel-action"})," action to entrust build to vercel."]}),"\n",(0,sa.jsx)(e.p,{children:"For this, you need to issue an account token."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722183804.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Let's put the 3 tokens obtained so far in secrets."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722183946.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"After that, get a GitHub token itself from developer and store it as a secret in API_TOKEN-GITHUB."}),"\n",(0,sa.jsx)(e.p,{children:"Now preparation is complete. Let's put the files below in /.github/workflows."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-yaml",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"# vercel-merge.yml"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Deploy"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"to"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"on"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"merge"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"on:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"push:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"branches:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"main"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"jobs:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"build_and_deploy:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"runs-on:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"ubuntu-latest"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"steps:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/checkout@v2"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"amondnet/vercel-action@v20"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"with:"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"github-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.API_TOKEN_GITHUB"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-args:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"--prod"'}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-org-id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_ORG_ID}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-project-id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_PROJECT_ID}}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This file deploys using vercel-action with vercel token and github token. I specified branches, and since our team's main is the deployment branch, I set it to deploy to vercel the moment main is pushed."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-yaml",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"# vercel-pull-request.yml"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Create"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"preview"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"URL"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"on"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"pull"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"request"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"on:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pull_request:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"branches:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"develop"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"jobs:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"build_and_deploy:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"runs-on:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"ubuntu-latest"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"steps:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/checkout@v2"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"amondnet/vercel-action@v20"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel-deploy"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"with:"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"github-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.GITHUB_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-org-id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.ORG_ID}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-project-id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.PROJECT_ID}}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"preview-url"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"|\n          echo ${{ steps.vercel-deploy.outputs.preview-url }}\n"})]})}),"\n",(0,sa.jsx)(e.p,{children:"Preview is the same. Now the top commit will change every time it's committed in PR."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722184634.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can confirm that automatic deployment using GitHub action is complete."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://gheup-pay-project.vercel.app/",children:"https://gheup-pay-project.vercel.app/"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722184808.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can confirm that preview is also successfully shown."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722184832.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"However, other code using vercel existed, and since preview is a part that team members use very frequently, the timing for replacement became ambiguous, so it wasn't applied."}),"\n",(0,sa.jsx)(e.p,{children:"The code below also functions similarly to the code above."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-yaml",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Preview"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"on:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pull_request:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"branches:"})," [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"develop"'}),"]\n\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"jobs:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-preview:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"runs-on:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"ubuntu-latest"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"permissions:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"contents:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"read"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pages:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"write"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"deployments:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"write"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"write"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"issues:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"write"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pull-requests:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"write"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"env:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"VERCEL_ORG_ID:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_ORG_ID"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"VERCEL_PROJECT_ID:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_PROJECT_ID"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"steps:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/checkout@v4"}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Install"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"CLI"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"npm"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"install"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"--global"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel@latest"}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Get"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Environment"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Variables"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"pull"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"--yes"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"--environment=preview"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"--token=${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Build"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Project"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Artifacts"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"build"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"--token=${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Deploy"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Project"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Artifacts"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"to"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Vercel"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"deploy"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'|\n          vercel deploy --prebuilt --token=${{ secrets.VERCEL_TOKEN }} > vercel-output.txt\n          echo "preview_url=$(cat vercel-output.txt)" >> $GITHUB_OUTPUT\n'}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Comment"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"PR"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"with"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Preview"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"URL"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"thollander/actions-comment-pull-request@v2"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"with:"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"|\n            \uD83C\uDF89 구현한 기능 Preview: ${{ steps.deploy.outputs.preview_url }}\n"})]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722185400.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Like above, it adds URL as a comment for each commit in PR."}),"\n",(0,sa.jsx)(e.h1,{children:"reference"}),"\n",(0,sa.jsx)("a",{href:"https://gist.github.com/ky28059/1c9af929a9030105da8cf00006b50484",children:(0,sa.jsx)(e.p,{children:"vercel CLI deployment related gist"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/app/building-your-application/routing/middleware",children:"https://nextjs.org/docs/app/building-your-application/routing/middleware"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"This is an article containing the methods I considered, problems I encountered, and their solution processes during the Gheuppay project!"}),"\n",(0,sa.jsx)(e.p,{children:"If there are any incorrect contents, please let me know. Thank you."}),"\n"]})]})}function eS(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eT,{...s})}):eT(s)}function eI(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"배경"}),"\n",(0,sa.jsx)(e.p,{children:"이번 프로젝트의 마음가짐은 팀원들에게 도움이 되는 개인이 되자 였는데요. 팀장 직책을 감사하게도 맡게 되어서 좀 더 그 책임이 컸습니다."}),"\n",(0,sa.jsx)(e.p,{children:"그 책임감으로 인하여 제 부분 이외에도 팀원들이 개발에만 집중할 수 있도록 많은 작업들을 해왔는데요."}),"\n",(0,sa.jsx)(e.p,{children:"S3를 이용한 S3 url에 이미지를 올리는 함수 구현같은 꼭 필요한 것부터 블러 처리를 도와주는 컴포넌트 개발까지 제 부분 이외에도 여러가지 작업들을 해왔습니다."}),"\n",(0,sa.jsx)(e.p,{children:"저희 팀이 만났던 문제는 두가지였습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"사장님 계정과 알바님 계정을 분리하는 것까지는 쿠키를 이용해서 가능했지만 접근 제한을 구현하는 게 어렵다."}),"\n",(0,sa.jsx)(e.li,{children:"vercel organization은 유료 배포가 불가능합니다. 더불어 PR시 프리뷰까지 보여줬으면 좋겠습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"이를 해결하기 위한 여정을 설명드리겠습니다."}),"\n",(0,sa.jsx)(e.h1,{children:"구현"}),"\n",(0,sa.jsx)(e.h2,{children:"middle ware"}),"\n",(0,sa.jsx)(e.p,{children:"미들웨어의 존재는 캡스톤 디자인으로 express 서버를 구현할 때 대략적으로 알고 있었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"무언가의 사이에 있는 존재 정도로 생각했었는데요. next의 공식문서에서 middle ware의 존재를 알게된 후 좀 더 찾아봐야겠다는 생각을 하게 되었습니다."}),"\n",(0,sa.jsx)(e.p,{children:"next에서 middle ware는 브라우저와 프론트엔드 서버 사이에 존재한다고 생각하면 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"프론트엔드 서버에 저장된 쿠키를 활용해 사용자를 판별하고 알맞게 렌더링 시키는 로직을 구현했습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/server"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextRequest"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/server"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { getCookie } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./app/_util/cookie"'}),";\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * 사이트의 제한 조건에 걸렸을 때 다른 곳으로 리다이렉트 시켜주는 미들웨어입니다.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable",children:"request"}),"\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@returns"}),"\n */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loginRequired"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"request"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextRequest"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," token = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"type"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isLandingPage = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextUrl"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pathname"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/"'}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isAdminPage = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextUrl"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pathname"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/admin"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isAlbaPage =\n    request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextUrl"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pathname"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/profile-detail"'}),") ||\n    request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextUrl"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pathname"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/profile-register"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (isLandingPage && token) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/notice-list"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (isLandingPage) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"next"}),"();\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!token) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/login"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"employee"'})," && isAdminPage) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/notice-list"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"employer"'})," && isAlbaPage) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/notice-list"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"next"}),"();\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," config = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"matcher"}),": [\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 아래 페이지들은 공통으로 들어갈 수 있는 페이지입니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/((?!login|signup|notice-list|notice-detail|api|_next/static|_next/image|images|icons|fonts|favicon.ico).*)"'}),",\n  ],\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"request를 받아서 확인한 후 response로 처리한 모습입니다."}),"\n",(0,sa.jsx)(e.p,{children:"사장님 페이지, 알바님 페이지, 초기 화면 등을 잘 구분해서 정리한 후 이를 response에 담아서 가독성을 높혔습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"vercel github action"}),"\n",(0,sa.jsx)(e.p,{children:"원래는 기초 프로젝트에서 사용했던 netlify를 사용하려고 했으나 Next를 쓰는 것이니 만큼 vercel을 이용한 배포가 좋지 않을까 생각하였고 팀원들도 동의해줘서 이대로 진행하게 되었다."}),"\n",(0,sa.jsx)(e.p,{children:"이번에도 자동 배포를 위해서 github aciton을 사용해야 되나 생각했지만 그럴 필요 없이 vercel에서 자동배포를 해주고 preview까지 pr마다 보여준다고 해서 편하게 생각했었다."}),"\n",(0,sa.jsx)(e.p,{children:"여기서 문제는 team일 경우에는 유료로 배포를 해야한다는 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722182732.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"다른 yaml 코드를 분석하던 중에 preview 쪽에서 CLI를 이용하는 것을 발견하고 organization은 CLI에서 무료인가? 생각 후 찾아보기 시작했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"찾아보던 중 깃허브 이슈에서 한마디를 보게 되었다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"vercel CLI로 접근하는 것 밖에는 방법이 없는 것 같네. CLI 한번 써봐 (영어)"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"organization GUI 유료 > organization CLI 무료 인 거였습니다."}),"\n",(0,sa.jsx)(e.p,{children:"나의 상황에 딱 맞는 문서를 찾게 되어서 진행하게 되었다. 이제 많이 했기에 간단한 용어 정도는 알고 있음에 기뻐하며 말입니다."}),"\n",(0,sa.jsx)(e.h3,{children:"vercel CLI 실행"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npm i -g vercel\n\nvercel\n"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:".github 파일이 존재하면 CLI로 연결되지 않는 문제가 있었다. 따로 옮겨둔 후 연결하고 다시 진행해주면 됩니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"vercel을 설치후 실행합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722183549.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["위처럼 시키는 대로 대답한 후에 보면 나의 프로젝트 폴더에 ",(0,sa.jsx)(e.code,{children:".vercel"})," 이라는 폴더가 있는 것을 볼 수 있습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// .vercel"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"orgId"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"..."'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"projectId"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"..."'})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위처럼 말입니다. 내 프로젝트를 식별하기 위해서 존재하니 어디에 적어두자."}),"\n",(0,sa.jsxs)(e.p,{children:["이후엔 vercel에 build를 맡기기 위해 ",(0,sa.jsx)(e.a,{href:"https://github.com/amondnet/vercel-action",children:"amondnet/vercel-action"})," 라는 액션을 쓸 것입니다."]}),"\n",(0,sa.jsx)(e.p,{children:"이를 위해선 account token을 발급받아야 합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722183804.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"지금까지 얻은 3가지 토큰을 secret에 담아보겠습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722183946.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"이후 developer에서 github 자체 토큰도 하나 얻어서 API_TOKEN-GITHUB에 secret으로 저장해놓는다."}),"\n",(0,sa.jsx)(e.p,{children:"이제 준비는 끝났다. /.github/workflows 파일에 아래의 파일들을 넣어주자."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-yaml",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"# vercel-merge.yml"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Deploy"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"to"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"on"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"merge"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"on:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"push:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"branches:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"main"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"jobs:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"build_and_deploy:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"runs-on:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"ubuntu-latest"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"steps:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/checkout@v2"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"amondnet/vercel-action@v20"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"with:"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"github-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.API_TOKEN_GITHUB"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-args:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"--prod"'}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-org-id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_ORG_ID}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-project-id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_PROJECT_ID}}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이 파일은 vercel-action을 이용해서 vercel token과 github token에 맞는 배포를 합니다. branches를 통해 브랜치를 특정해놨는데 우리 팀은 main이 배포 브랜치이기 때문에 main에 push하는 순간 vercel에 배포할 수 있도록 설정했습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-yaml",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"# vercel-pull-request.yml"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Create"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"preview"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"URL"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"on"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"pull"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"request"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"on:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pull_request:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"branches:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"develop"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"jobs:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"build_and_deploy:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"runs-on:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"ubuntu-latest"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"steps:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/checkout@v2"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"amondnet/vercel-action@v20"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel-deploy"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"with:"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"github-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.GITHUB_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-org-id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.ORG_ID}}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-project-id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.PROJECT_ID}}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"preview-url"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"|\n          echo ${{ steps.vercel-deploy.outputs.preview-url }}\n"})]})}),"\n",(0,sa.jsx)(e.p,{children:"preview의 경우에도 이와 같습니다. 이제 PR에서 commit될 때마다 최상단의 commit이 바뀌게 될 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722184634.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"github action을 이용한 자동배포가 완료된 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://gheup-pay-project.vercel.app/",children:"https://gheup-pay-project.vercel.app/"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722184808.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"프리뷰 역시 성공적으로 보여지는 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722184832.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"하지만 기존에 vercel을 사용하는 다른 코드가 존재했고 preview는 팀원들이 굉장히 자주 쓰는 부분이기 때문에 교체하는 시기가 애매해져서 적용은 하지 않게 되었다."}),"\n",(0,sa.jsx)(e.p,{children:"아래의 코드도 위의 코드와 유사하게 기능하는 코드입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-yaml",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Preview"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"on:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pull_request:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"branches:"})," [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"develop"'}),"]\n\n",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"jobs:"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"vercel-preview:"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"runs-on:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"ubuntu-latest"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"permissions:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"contents:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"read"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pages:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"write"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"deployments:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"write"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id-token:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"write"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"issues:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"write"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pull-requests:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"write"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"env:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"VERCEL_ORG_ID:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_ORG_ID"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"VERCEL_PROJECT_ID:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_PROJECT_ID"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"steps:"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"actions/checkout@v4"}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Install"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"CLI"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"npm"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"install"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"--global"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel@latest"}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Get"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Environment"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Variables"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"pull"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"--yes"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"--environment=preview"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"--token=${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Build"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Project"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Artifacts"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"vercel"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"build"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"--token=${{"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"secrets.VERCEL_TOKEN"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"}}"}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Deploy"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Project"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Artifacts"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"to"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Vercel"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"deploy"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"run:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'|\n          vercel deploy --prebuilt --token=${{ secrets.VERCEL_TOKEN }} > vercel-output.txt\n          echo "preview_url=$(cat vercel-output.txt)" >> $GITHUB_OUTPUT\n'}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-bullet",children:"-"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Comment"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"PR"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"with"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"Preview"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"URL"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"uses:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"thollander/actions-comment-pull-request@v2"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"with:"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"message:"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:"|\n            \uD83C\uDF89 구현한 기능 Preview: ${{ steps.deploy.outputs.preview_url }}\n"})]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-07-23/Pasted%20image%2020240722185400.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"위처럼 PR의 커밋마다 URL을 comment로 달아준다."}),"\n",(0,sa.jsx)(e.h1,{children:"reference"}),"\n",(0,sa.jsx)("a",{href:"https://gist.github.com/ky28059/1c9af929a9030105da8cf00006b50484",children:(0,sa.jsx)(e.p,{children:"vercel CLI 배포 관련 gist"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://nextjs.org/docs/app/building-your-application/routing/middleware",children:"https://nextjs.org/docs/app/building-your-application/routing/middleware"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"급페이 프로젝트 중 고민했던 방식, 부딪히게 된 문제, 그것의 해결과정을 담은 글입니다!"}),"\n",(0,sa.jsx)(e.p,{children:"잘못된 내용이 있다면 말씀 부탁드립니다. 감사합니다."}),"\n"]})]})}function eC(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eI,{...s})}):eI(s)}function eA(s){let e={a:"a",blockquote:"blockquote",code:"code",del:"del",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"Background"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240727221740.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"This is the design mockup for this project."}),"\n",(0,sa.jsx)(e.p,{children:"If you check the right property, you can see that button types change according to three criteria: style, size, and state."}),"\n",(0,sa.jsx)(e.p,{children:"Thinking about problems in the current situation, there are about two."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Since we use tailwind, there's a problem with easily managing various types."}),"\n",(0,sa.jsx)(e.li,{children:"Since the design is not yet complete, there's a very high possibility that the design will change. We need to be able to easily see design changes according to code changes."}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"Implementation"}),"\n",(0,sa.jsx)(e.h2,{children:"Easily Managing Various Types of Buttons Implemented with Tailwind"}),"\n",(0,sa.jsx)(e.p,{children:"Tailwind styles using its own existing classes."}),"\n",(0,sa.jsx)(e.p,{children:"This has the advantage of not creating situations where CSS files increase or you need to worry about class names,"}),"\n",(0,sa.jsx)(e.p,{children:"but since class names are ultimately strings, it has the disadvantage of making conditional styling inconvenient."}),"\n",(0,sa.jsx)(e.p,{children:"In the case of CSS-in-JS like styled Component, there's a convenient method of passing styles as props and processing conditionally."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://styled-components.com/docs/basics#attaching-additional-props",children:"https://styled-components.com/docs/basics#attaching-additional-props"})}),"\n",(0,sa.jsx)(e.p,{children:"To solve this problem, you can simply process it as an object."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"STYLE"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"white"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"bg-white text-primary"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"orange"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"bg-primary text-white hover:bg-[#d43914] active:scale-[0.99]"'}),",\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BUTTON"})," =\n  ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"w-full rounded-md border-[1.5px] border-primary py-2 text-center font-bold duration-200 hover:scale-[1.005] disabled:scale-[1] disabled:border-none disabled:bg-gray-40 disabled:text-white md:py-[10px] lg:py-[14px]"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Button"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  children,\n  className,\n  btnColor = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"orange"'}),",\n  btnType = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"button"'}),",\n  ...rest\n}: ButtonProps"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{btnType}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"`${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"BUTTON"}),"} ${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"STYLE"}),"[",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnColor"}),"]} ${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"}`}\n      {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...rest"}),"}\n    >"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"However, this method cannot receive VSCode's intellisense support, so you have to write it in the element's className and then move it again."}),"\n",(0,sa.jsx)(e.p,{children:"With the confidence that the development world wouldn't go through such an inconvenient process, I started researching."}),"\n",(0,sa.jsx)(e.p,{children:"Then I learned about cva."}),"\n",(0,sa.jsx)(e.h3,{children:"cva (Class Variance Authority)"}),"\n",(0,sa.jsx)(e.p,{children:"After reading the documentation, it's a library that exists to conditionally apply CSS in tailwind."}),"\n",(0,sa.jsx)(e.p,{children:"Let's see how to use it."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { cva } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"class-variance-authority"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BUTTON_STYLE"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cva"}),"(\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Styles that will be applied by default"}),"\n  [\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"flex"'}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"disabled:scale-100"'}),",\n  ],\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// variants can be seen as one large object. The lowest elements each mean one style. For example, btnSize has styles of large and x-small."}),"\n  {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variants"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnSize"}),": {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"large"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"h-[48px]"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"min-w-[280px]"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"text-base"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"py-3"'}),"],\n        ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"x-small"'}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"h-[32px]"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"min-w-[74px]"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"text-sm"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"py-1.5"'}),"],\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnStyle"}),": {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"solid"}),": [\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"bg-brand-primary"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"text-white"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'" hover:bg-interaction-hover"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"active:bg-interaction-pressed"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"disabled:bg-interaction-inactive"'}),",\n        ],\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"outlined"}),": [\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"border-brand-primary"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n    },\n  },\n);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Usage"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"buttonVariants"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),":",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"flex"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnStyle"}),":large, ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnSize"}),":solid })\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Style (string) of large solid button with flex className added"}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Intellisense Support"}),"\n",(0,sa.jsx)(e.p,{children:"If you put the code below in VSCode, you can also receive intellisense support."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//settings.json"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"tailwindCSS.experimental.classRegex"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),(0,sa.jsx)(e.span,{className:"hljs-string",children:'"cva\\\\(([^)]*)\\\\)"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"[\\"\'`]([^\\"\'`]*).*?[\\"\'`]"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),(0,sa.jsx)(e.span,{className:"hljs-string",children:'"cx\\\\(([^)]*)\\\\)"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"(?:\'|\\"|`)([^\']*)(?:\'|\\"|`)"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"In addition, you can increase stability by also using the tw-merge (tailwind-merge) library to solve style conflicts that sometimes occur when using cva."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { cva, ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"VariantProps"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"class-variance-authority"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { twMerge } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"tailwind-merge"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," buttonVariants = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cva"}),"([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"your"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"base"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"classes"'}),"], {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variants"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"intent"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"primary"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"your"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"primary"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"classes"'}),"],\n    },\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultVariants"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"intent"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"primary"'}),",\n  },\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ButtonVariants"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"extends"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"VariantProps"}),"<typeof buttonVariants> {}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"button"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variants"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ButtonVariants"})]}),") =>\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"twMerge"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"buttonVariants"}),"(variants));\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"clsx + twMerge + cva"}),"\n",(0,sa.jsx)(e.p,{children:"I brought a util function that makes it convenient to use by utilizing clsx, a library that converts conditionally processed objects into arrays to strings using cva.\n(shadcn forever)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," clsx ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"clsx"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ClassValue"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"clsx"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { twMerge } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"tailwind-merge"'}),";\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * Returns tailwind code with conditional processing and priority conflicts resolved.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," inputs cva variants\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@returns"})," tailwind code with conditional processing complete and priority conflicts resolved\n */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cn"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"...inputs: ClassValue[]"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"twMerge"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"clsx"}),"(inputs));\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"By utilizing this, you can implement a common button component like the code below."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["interface ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ButtonProps"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"extends"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ButtonHTMLAttributes"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HTMLButtonElement"}),"> {\n  children?: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ReactNode"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnStyle"}),":\n    | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"solid"'}),"\n    | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"outlined"'}),"\n    | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"outlined_secondary"'}),"\n    | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"danger"'}),"\n    | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"none_background"'}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnSize"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"large"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"x-small"'}),";\n}\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * Button component configured as defined in Figma.\n * You can determine additional button styles with className.\n * All attributes of basic button tag can be included.\n * Button colors are set according to theme.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 정지현, 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"}),' children : Write content to put inside button. (ex. "버튼")\n * ',(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," btnStyle : Determines button style.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," btnSize : Determines button size.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@returns"})," Returns button component.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@example"}),'\n *  <Button btnSize="x-small" btnStyle="solid">\n            solid x-small\n          </Button>\n    <Button btnSize="x-small" btnStyle="solid" disabled>\n            disabled\n          </Button>\n */']}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Button"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{\n  children,\n  btnSize,\n  btnStyle,\n  className,\n  ...rest\n}: ButtonProps"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"submit"'}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cn("}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"buttonVariants"}),"({\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnStyle"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnSize"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),",\n        }),\n      )}\n      {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...rest"}),"}\n    >"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"Experience Where This Processing Was Helpful"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240805002120.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"The design mockup changed in the middle."}),"\n",(0,sa.jsxs)(e.p,{children:["A ",(0,sa.jsx)(e.code,{children:"none_background"})," btnStyle was added, and a situation arose where that style had to be added to the existing component."]}),"\n",(0,sa.jsx)(e.p,{children:'Thinking "this is why I optimized," I solved the situation by adding just the following two lines.'}),"\n",(0,sa.jsxs)(e.p,{children:["One in type\n",(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240805002252.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["One in variants\n",(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240805002307.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"I thought it would be good since it's a util function frequently used in the industry, but it was an experience that really hit me during the maintenance process."}),"\n",(0,sa.jsx)(e.p,{children:"Although it's a small and cute project compared to actual products now, in the case of large projects, good maintainability is an incredibly huge advantage."}),"\n",(0,sa.jsx)(e.p,{children:"I don't think it's good to apply it to all components because the boilerplate isn't small (especially cva variants),"}),"\n",(0,sa.jsx)(e.p,{children:"but for common components or UI components that are likely to change design-wise, I think it's good to review it first with a good mindset."}),"\n",(0,sa.jsx)(e.h2,{children:"Method to Easily Check Changed Items Due to Code Changes"}),"\n",(0,sa.jsx)(e.p,{children:"It didn't end here. At the point when I learned that design mockups change, I thought it would be good if there was a way to easily check all types."}),"\n",(0,sa.jsx)(e.p,{children:"I decided to solve this problem using storybook that I had reviewed before."}),"\n",(0,sa.jsx)(e.h3,{children:"storybook"}),"\n",(0,sa.jsx)(e.p,{children:"Storybook is one of the tools that stands out in collaboration with other professions."}),"\n",(0,sa.jsx)(e.p,{children:"This is because developers can get a sense of what shape it will have just by looking at code, but other professions may not know, so showing it visually is important."}),"\n",(0,sa.jsx)(e.p,{children:'In conclusion, work "efficiency" increases. I\'ll briefly explain the integration process and move on.'}),"\n",(0,sa.jsx)(e.h4,{children:"Installation"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npx storybook@latest init\n"})}),"\n",(0,sa.jsx)(e.p,{children:"After various settings, a guide about storybook installation will appear."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npm run storybook\n"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722213921.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can see that development mode is on at port 6006."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722214046.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"When you enter, it moves to a website like this."}),"\n",(0,sa.jsx)(e.p,{children:"After that, the file will have the following files."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722214129.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:".storybook"})," is files related to storybook's overall settings"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"stories"})," folder is where you write actual story files."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722214349.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["Things written in ",(0,sa.jsx)(e.code,{children:"args"})," are reflected on the storybook website."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722214454.png",alt:""})}),"\n",(0,sa.jsx)(e.h4,{children:"Code Generation"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722215100.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// /components/CustomButton.tsx"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./customButton.css"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropTypes"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"prop-types"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"CustomButton"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{\n  size,\n  label,\n  variant,\n  backgroundColor,\n  color,\n}"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," style = {\n    backgroundColor,\n    color,\n  };\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{["}),'\n        "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"custom-button"}),'",\n        `',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"custom-button--"}),"${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),"}`,\n        `",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"custom-button--"}),"${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variant"}),"}`,\n      ]",(0,sa.jsx)(e.span,{className:"hljs-attr",children:".join"}),'(" ")}\n      ',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{style}"}),"\n    >"]}),"\n      {label}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]})]}),"\n  );\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// You can manipulate these settings on the storybook settings website"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomButton"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"propTypes"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropTypes"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"oneOf"}),"([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"sm"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"md"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"lg"'}),"]),\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"backgroundColor"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropTypes"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"string"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropTypes"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"string"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"label"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropTypes"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"string"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"isRequired"}),",\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Default value settings if props are not passed."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomButton"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"defaultProps"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"backgroundColor"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"md"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variant"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"outline"'}),",\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722215325.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-css",children:[(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"font-family"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Nunito Sans"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Helvetica Neue"'}),", Helvetica, Arial, sans-serif;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"font-weight"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"700"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"border"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"border-radius"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3em"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"cursor"}),": pointer;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"display"}),": inline-block;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"line-height"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button--outline"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"background-color"}),": white;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"border"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1px"})," solid black;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button--solid"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"background-color"}),": black;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"border"}),": none;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"color"}),": white;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button--sm"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"font-size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"12px"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"padding"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10px"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"16px"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button--md"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"font-size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"14px"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"padding"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"11px"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"20px"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button--lg"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"font-size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"16px"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"padding"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"12px"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"24px"}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Classes change according to props, and different CSS is applied."}),"\n",(0,sa.jsx)(e.h4,{children:"Story Creation"}),"\n",(0,sa.jsx)(e.p,{children:"Create componentname.stories.ts in the stories folder. (This is a story.)"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240724211856.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomButton"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../components/CustomButton"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Test/CustomButton"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Set story name"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"component"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomButton"}),", ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Import Component"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"label"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Button"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Specify commonly used props, here it's text inside button"}),"\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Solid"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Pass those props to storybook with args."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variant"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"solid"'}),",\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Outline"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variant"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"outline"'}),",\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Small"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"sm"'}),",\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Medium"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"md"'}),",\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Large"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"lg"'}),",\n  },\n};\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Toolbar Check"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240724213935.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"You can change themes by clicking the background icon."}),"\n",(0,sa.jsx)(e.p,{children:"If you want to change themes to colors other than light and black, you can use parameters."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240724214129.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Solid"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variant"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"solid"'}),",\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"parameters"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"backgrounds"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"values"}),": [\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n        },\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n        },\n      ],\n    },\n  },\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Like above, you can change toolbar settings for specific components only."}),"\n",(0,sa.jsxs)(e.p,{children:["If you change ",(0,sa.jsx)(e.code,{children:"export default"})]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Test/CustomButton"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"component"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomButton"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"label"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Button"'}),",\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"parameters"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"backgrounds"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"values"}),": [\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n        },\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n        },\n      ],\n    },\n  },\n};\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["If you want to put it in all components! You can add it to the ",(0,sa.jsx)(e.code,{children:"preview.js"})," file in the ",(0,sa.jsx)(e.code,{children:".storybook"})," directory that handles storybook's overall settings."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// .storybook/preview.js"}),"\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/** ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@type"})," {",(0,sa.jsx)(e.span,{className:"hljs-type",children:" import('@storybook/react').Preview "}),"} */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," preview = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"parameters"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"actions"}),": { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"argTypesRegex"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"^on[A-Z].*"'})," },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"controls"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"matchers"}),": {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),": ",(0,sa.jsx)(e.span,{className:"hljs-regexp",children:"/(background|color)$/i"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"date"}),": ",(0,sa.jsx)(e.span,{className:"hljs-regexp",children:"/Date$/"}),",\n      },\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add inside parameters"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"backgrounds"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"values"}),": [\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n        },\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n        },\n      ],\n    },\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," preview;\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"The integrated storybook launches a storybook-related website on port 6006. (when entering command)"}),"\n",(0,sa.jsx)(e.p,{children:"Even if button types are modified, you can easily check button states by just entering the command."}),"\n",(0,sa.jsx)(e.h4,{children:"Troubleshooting"}),"\n",(0,sa.jsx)(e.p,{children:"I thought I integrated it properly, but as development always goes, troubleshooting followed."}),"\n",(0,sa.jsx)(e.p,{children:"I thought the great storybook had no fault and it was my fault, so I started looking for my mistakes."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2024-09-11/%EC%8A%A4%ED%86%A0%EB%A6%AC%EB%B6%81%20%EC%97%B0%EA%B2%B0%20%EC%8B%A4%ED%8C%A8.png",alt:""}),"\n(",(0,sa.jsx)(e.del,{children:"This is our project's common button component ta-da hehe"}),")"]}),"\n",(0,sa.jsx)(e.p,{children:"When this situation occurs, my internal manual is to first remove the impatient mind and create cases."}),"\n",(0,sa.jsx)(e.p,{children:"There seemed to be three main ones."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Compatibility with next.js > Looks fine in GitHub issues and recent posts"}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.strong,{children:"Compatibility with tailwind > I searched following the flow."})}),"\n",(0,sa.jsx)(e.li,{children:"Storybook's own problem > Lowest probability, so put priority behind."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"After thinking about situation 2 and searching, I found the answer."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Preview"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@storybook/react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../styles/globals.css"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"preview"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Preview"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"parameters"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"controls"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"matchers"}),": {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),": ",(0,sa.jsx)(e.span,{className:"hljs-regexp",children:"/(background|color)$/i"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"date"}),": ",(0,sa.jsx)(e.span,{className:"hljs-regexp",children:"/Date$/i"}),",\n      },\n    },\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," preview;\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"I had to think that preview is also a type of component file."}),"\n",(0,sa.jsx)(e.p,{children:"In other words, if you don't put globals.css, it doesn't automatically apply styles when you put className. (tailwind is not connected.)"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/%EC%8A%A4%ED%86%A0%EB%A6%AC%EB%B6%81%20%EC%97%B0%EB%8F%99.gif",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["Solved! Now by just entering the ",(0,sa.jsx)(e.code,{children:"pnpm storybook"})," command, you can easily understand what state components connected to storybook in our current project are in."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"These are experiences I had during the Kkom-kkom project. I think I grew a lot today too!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you for reading! Please watch over me!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you."}),"\n"]})]})}function eR(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eA,{...s})}):eA(s)}function eE(s){let e={a:"a",blockquote:"blockquote",code:"code",del:"del",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"배경"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240727221740.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"이번 프로젝트의 디자인 시안입니다."}),"\n",(0,sa.jsx)(e.p,{children:"오른쪽 property를 확인해보면 style, size, state로 세가지의 기준을 따라서 버튼의 종류가 바뀌는 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"현재 상황에서의 문제를 생각해보면 두가지 정도가 있습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"우리는 tailwind를 사용하기 때문에 다양한 종류를 간편하게 관리하는 것에 대한 문제가 있습니다."}),"\n",(0,sa.jsx)(e.li,{children:"디자인이 아직 완성되기 전이기 때문에 디자인이 변경될 가능성이 아주 높은 상황입니다. 코드 변경에 따른 디자인 변화를 쉽게 볼 수 있어야 합니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"구현"}),"\n",(0,sa.jsx)(e.h2,{children:"tailwind로 구현된 버튼의 다양한 종류를 간편하게 관리"}),"\n",(0,sa.jsx)(e.p,{children:"tailwind는 이미 존재하는 자체 클래스를 활용하여 스타일링을 합니다."}),"\n",(0,sa.jsx)(e.p,{children:"이 때문에 CSS 파일이 늘어난다거나 class name을 신경써야 되는 상황을 만들지 않는다는 장점이 있으나"}),"\n",(0,sa.jsx)(e.p,{children:"class name은 결국 string이기 때문에 조건부 스타일링이 불편하다는 단점을 갖고 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"styled Component 같은 CSS-in-JS 같은 경우 prop으로 스타일을 내려서 조건부로 처리하는 방법이 있어서 편리하다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://styled-components.com/docs/basics#attaching-additional-props",children:"https://styled-components.com/docs/basics#attaching-additional-props"})}),"\n",(0,sa.jsx)(e.p,{children:"이 문제를 해결하기 위해서는 단순하게 객체로 처리하면 됩니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"STYLE"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"white"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"bg-white text-primary"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"orange"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"bg-primary text-white hover:bg-[#d43914] active:scale-[0.99]"'}),",\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BUTTON"})," =\n  ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"w-full rounded-md border-[1.5px] border-primary py-2 text-center font-bold duration-200 hover:scale-[1.005] disabled:scale-[1] disabled:border-none disabled:bg-gray-40 disabled:text-white md:py-[10px] lg:py-[14px]"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Button"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  children,\n  className,\n  btnColor = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"orange"'}),",\n  btnType = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"button"'}),",\n  ...rest\n}: ButtonProps"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{btnType}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"`${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"BUTTON"}),"} ${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"STYLE"}),"[",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnColor"}),"]} ${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"}`}\n      {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...rest"}),"}\n    >"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"하지만 이 방법은 vscode의 intellisense 지원을 받을 수 없어서 element의 className에 적어놨다가 다시 옮기는 방식으로 해야 합니다."}),"\n",(0,sa.jsx)(e.p,{children:"개발의 세계에선 이런 불편한 과정을 거치지 않을 것이라는 확신과 함께 연구를 시작했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"그러다 cva를 알게 되었다."}),"\n",(0,sa.jsx)(e.h3,{children:"cva (Class Variance Authority)"}),"\n",(0,sa.jsx)(e.p,{children:"문서를 읽어보니 tailwind에서 조건부로 css를 입히기 위해서 존재하는 라이브러리라고 합니다."}),"\n",(0,sa.jsx)(e.p,{children:"사용하는 걸 일단 봐보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { cva } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"class-variance-authority"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"BUTTON_STYLE"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cva"}),"(\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 기본적으로 적용될 스타일"}),"\n  [\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"flex"'}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"disabled:scale-100"'}),",\n  ],\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// variants는 하나의 큰 객체로 보면 됩니다. 최 하위 요소들은 스타일 하나를 의미합니다. 예를 들면 btnSize는 large, x-small이라는 스타일을 갖고 있습니다."}),"\n  {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variants"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnSize"}),": {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"large"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"h-[48px]"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"min-w-[280px]"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"text-base"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"py-3"'}),"],\n        ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"x-small"'}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"h-[32px]"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"min-w-[74px]"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"text-sm"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"py-1.5"'}),"],\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnStyle"}),": {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"solid"}),": [\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"bg-brand-primary"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"text-white"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'" hover:bg-interaction-hover"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"active:bg-interaction-pressed"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"disabled:bg-interaction-inactive"'}),",\n        ],\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"outlined"}),": [\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"border-brand-primary"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n    },\n  },\n);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 사용하는 쪽"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"buttonVariants"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),":",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"flex"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnStyle"}),":large, ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnSize"}),":solid })\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// flex라는 className이 추가된 large solid button의 스타일 (string)"}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"intellisense 지원"}),"\n",(0,sa.jsx)(e.p,{children:"아래의 코드를 vscode에 넣어주면 intellisense의 지원도 받을 수 있다고 합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-json",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//settings.json"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"{"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:'"tailwindCSS.experimental.classRegex"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:":"})," ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),(0,sa.jsx)(e.span,{className:"hljs-string",children:'"cva\\\\(([^)]*)\\\\)"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"[\\"\'`]([^\\"\'`]*).*?[\\"\'`]"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"["}),(0,sa.jsx)(e.span,{className:"hljs-string",children:'"cx\\\\(([^)]*)\\\\)"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:","})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"(?:\'|\\"|`)([^\']*)(?:\'|\\"|`)"'}),(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"]"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-punctuation",children:"}"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"여기에 더해서 cva를 사용할 때 가끔 일어나는 스타일 충돌을 해결하기 위한 tw-merge (tailwind-merge) 라이브러리도 함께 사용하면 더 안정성을 높힐 수 있다고 합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { cva, ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"VariantProps"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"class-variance-authority"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { twMerge } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"tailwind-merge"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," buttonVariants = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cva"}),"([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"your"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"base"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"classes"'}),"], {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variants"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"intent"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"primary"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"your"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"primary"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"classes"'}),"],\n    },\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultVariants"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"intent"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"primary"'}),",\n  },\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ButtonVariants"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"extends"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"VariantProps"}),"<typeof buttonVariants> {}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"button"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variants"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ButtonVariants"})]}),") =>\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"twMerge"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"buttonVariants"}),"(variants));\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"clsx + twMerge + cva"}),"\n",(0,sa.jsx)(e.p,{children:"여기서 cva를 이용하여 조건부 처리된 객체를 배열을 string으로 만들어주는 라이브러리인 clsx를 이용하여 사용하기 편하게 만든 유틸 함수를 가져왔다.\n(shadcn 만만세)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," clsx ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"clsx"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ClassValue"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"clsx"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { twMerge } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"tailwind-merge"'}),";\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * 조건부 처리 및 우선순위 충돌 해결된 tailwind 코드를 반환합니다.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," inputs cva variants\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@returns"})," 조건부 처리 완료 및 우선순위 충돌 해결된 tailwind 코드\n */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cn"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"...inputs: ClassValue[]"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"twMerge"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"clsx"}),"(inputs));\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이를 활용하면 아래 코드처럼 공통 버튼 컴포넌트를 구현할 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["interface ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ButtonProps"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"extends"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ButtonHTMLAttributes"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HTMLButtonElement"}),"> {\n  children?: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ReactNode"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnStyle"}),":\n    | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"solid"'}),"\n    | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"outlined"'}),"\n    | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"outlined_secondary"'}),"\n    | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"danger"'}),"\n    | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"none_background"'}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnSize"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"large"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"x-small"'}),";\n}\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * 피그마에 정의된 대로 구성되어 있는 버튼 컴포넌트입니다.\n * className으로 추가적인 버튼의 스타일을 결정할 수 있습니다.\n * 기본 버튼 태그의 속성 전부 들어갈 수 있습니다.\n * 버튼의 색상은 테마에 맞게 설정되어 있습니다.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 정지현, 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"}),' children : 버튼 안에 담을 내용을 적습니다. (ex. "버튼")\n * ',(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," btnStyle : 버튼의 스타일을 결정합니다.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," btnSize : 버튼의 크기를 결정합니다.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@returns"})," 버튼 컴포넌트를 반환합니다.\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@example"}),'\n *  <Button btnSize="x-small" btnStyle="solid">\n            solid x-small\n          </Button>\n    <Button btnSize="x-small" btnStyle="solid" disabled>\n            disabled\n          </Button>\n */']}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Button"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{\n  children,\n  btnSize,\n  btnStyle,\n  className,\n  ...rest\n}: ButtonProps"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"submit"'}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cn("}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"buttonVariants"}),"({\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnStyle"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnSize"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),",\n        }),\n      )}\n      {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...rest"}),"}\n    >"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"이러한 처리가 도움이 된 경험"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240805002120.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"중간에 디자인 시안이 바뀌었다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"none_background"})," 라는 btnStyle이 하나 추가되었는데 기존 컴포넌트에 해당 스타일을 추가해야 하는 상황이 생긴 것입니다."]}),"\n",(0,sa.jsx)(e.p,{children:"이때를 위해서 최적화를 했지 라고 생각하면서 다음의 딱 두 줄을 추가하여 상황을 해결했습니다."}),"\n",(0,sa.jsxs)(e.p,{children:["타입에 하나\n",(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240805002252.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["varaiants에 하나\n",(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240805002307.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"현업에서도 자주 사용되는 유틸 함수라고 하여 좋을 것이라고 생각은 했으나 유지 보수하는 과정이 굉장히 와닿았던 경험이었다."}),"\n",(0,sa.jsx)(e.p,{children:"지금은 실제 프로덕트에 비하면 작고 귀여운 프로젝트이지만 대형 프로젝트의 경우 유지 보수성이 좋은 건 엄청나게 큰 장점입니다."}),"\n",(0,sa.jsx)(e.p,{children:"모든 컴포넌트에 적용하는 것은 사실 보일러 플레이트가 적진 않기 때문에 (특히나 cva variants) 다 적용하는 것이 좋다고는 생각하지 않지만"}),"\n",(0,sa.jsx)(e.p,{children:"공통 컴포넌트나 디자인적으로 변경될 가능성이 큰 ui 컴포넌트의 경우에는 좋은 마음가짐으로 먼저 검토해보는 게 좋을 것 같다."}),"\n",(0,sa.jsx)(e.h2,{children:"코드 변경으로 인하여 변경된 사항들을 손쉽게 확인하는 방법"}),"\n",(0,sa.jsx)(e.p,{children:"여기서 끝이 아니었다. 디자인 시안이 변경된다는 것을 알게 된 시점에서 모든 종류를 쉽게 확인할 수 있는 방법이 있다면 좋겠다고 생각했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"이전에 검토했었던 storybook을 사용해서 이 문제를 해결하기로 했습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"storybook"}),"\n",(0,sa.jsx)(e.p,{children:"storybook이란 타 직종과의 협업에서 두각을 드러내는 툴 중에 하나입니다."}),"\n",(0,sa.jsx)(e.p,{children:"코드만 봐도 개발자는 어떤 모양을 가지게 될지 감이 올 수 있지만 타 직종은 모를 수 있기 때문에 시각적으로 보여주는 것이 중요하기 때문입니다."}),"\n",(0,sa.jsx)(e.p,{children:'결론적으로는 일의 "효율성"이 늘어나게 됩니다. 간단하게 연동 과정을 설명하고 넘어가겠다.'}),"\n",(0,sa.jsx)(e.h4,{children:"설치"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npx storybook@latest init\n"})}),"\n",(0,sa.jsx)(e.p,{children:"각종 세팅을 쳐낸 후에 storybook 설치에 대한 안내가 나올 것입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"npm run storybook\n"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722213921.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"6006번 포트에서 개발 모드를 킨걸 볼 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722214046.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"들어가면 이런 웹사이트로 이동합니다."}),"\n",(0,sa.jsx)(e.p,{children:"그 후 파일에는 다음과 같은 파일들을 가지게 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722214129.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:".storybook"}),"은 스토리북의 전체적인 설정과 관련된 파일들"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"stories"})," 폴더에 파일들을 실제 스토리 파일을 작성하는 곳입니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722214349.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"args"})," 라는 곳에 작성한 것들이 스토리북 웹 사이트에 반영됩니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722214454.png",alt:""})}),"\n",(0,sa.jsx)(e.h4,{children:"코드 생성"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722215100.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// /components/CustomButton.tsx"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./customButton.css"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropTypes"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"prop-types"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"CustomButton"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{\n  size,\n  label,\n  variant,\n  backgroundColor,\n  color,\n}"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," style = {\n    backgroundColor,\n    color,\n  };\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{["}),'\n        "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"custom-button"}),'",\n        `',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"custom-button--"}),"${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),"}`,\n        `",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"custom-button--"}),"${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variant"}),"}`,\n      ]",(0,sa.jsx)(e.span,{className:"hljs-attr",children:".join"}),'(" ")}\n      ',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{style}"}),"\n    >"]}),"\n      {label}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]})]}),"\n  );\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 스토리북 설정 웹사이트에 해당 설정을 조작할 수 있다"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomButton"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"propTypes"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropTypes"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"oneOf"}),"([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"sm"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"md"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"lg"'}),"]),\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"backgroundColor"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropTypes"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"string"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropTypes"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"string"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"label"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropTypes"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"string"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"isRequired"}),",\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// props가 전달되지 않았다면 기본 값 설정입니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomButton"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"defaultProps"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"backgroundColor"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"md"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variant"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"outline"'}),",\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240722215325.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-css",children:[(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"font-family"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Nunito Sans"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Helvetica Neue"'}),", Helvetica, Arial, sans-serif;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"font-weight"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"700"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"border"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"border-radius"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3em"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"cursor"}),": pointer;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"display"}),": inline-block;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"line-height"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button--outline"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"background-color"}),": white;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"border"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1px"})," solid black;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button--solid"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"background-color"}),": black;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"border"}),": none;\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"color"}),": white;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button--sm"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"font-size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"12px"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"padding"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10px"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"16px"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button--md"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"font-size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"14px"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"padding"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"11px"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"20px"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-selector-class",children:".custom-button--lg"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"font-size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"16px"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attribute",children:"padding"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"12px"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"24px"}),";\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"props에 따라서 class가 변경되어 다른 css가 들어가게 됩니다."}),"\n",(0,sa.jsx)(e.h4,{children:"스토리 생성"}),"\n",(0,sa.jsx)(e.p,{children:"stories 폴더의 컴포넌트이름.stories.ts를 만든다. (스토리 입니다.)"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240724211856.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomButton"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../components/CustomButton"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Test/CustomButton"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// story 이름 설정"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"component"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomButton"}),", ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Component 가져오기"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"label"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Button"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 공통적으로 쓰이는 props 지정, 여기서는 버튼 안에 있는 text"}),"\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Solid"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// args로 스토리북에 해당 props를 내려준다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variant"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"solid"'}),",\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Outline"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variant"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"outline"'}),",\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Small"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"sm"'}),",\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Medium"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"md"'}),",\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Large"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"size"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"lg"'}),",\n  },\n};\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"툴바 확인"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240724213935.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"배경 아이콘을 누르면 테마를 변경할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"여기서 light, black 이외의 색으로 테마를 변경하고 싶으면 parameters를 사용하면 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/Pasted%20image%2020240724214129.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Solid"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"variant"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"solid"'}),",\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"parameters"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"backgrounds"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"values"}),": [\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n        },\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n        },\n      ],\n    },\n  },\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위처럼 특정 컴포넌트만 툴바 설정을 변경시킬 수 있습니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"export default"}),"를 변경해주면"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"title"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Test/CustomButton"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"component"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomButton"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"args"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"label"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Button"'}),",\n  },\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"parameters"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"backgrounds"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"values"}),": [\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n        },\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n        },\n      ],\n    },\n  },\n};\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["만약 모든 컴포넌트에 넣고 싶다! 하면 스토리북의 전체 설정을 담당하는 ",(0,sa.jsx)(e.code,{children:".storybook"})," 디렉토리에 ",(0,sa.jsx)(e.code,{children:"preview.js"})," 파일에 추가해주면 됩니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// .storybook/preview.js"}),"\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/** ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@type"})," {",(0,sa.jsx)(e.span,{className:"hljs-type",children:" import('@storybook/react').Preview "}),"} */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," preview = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"parameters"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"actions"}),": { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"argTypesRegex"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"^on[A-Z].*"'})," },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"controls"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"matchers"}),": {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),": ",(0,sa.jsx)(e.span,{className:"hljs-regexp",children:"/(background|color)$/i"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"date"}),": ",(0,sa.jsx)(e.span,{className:"hljs-regexp",children:"/Date$/"}),",\n      },\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// parameters 내 추가"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"backgrounds"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"values"}),": [\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"blue"'}),",\n        },\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"name"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"red"'}),",\n        },\n      ],\n    },\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," preview;\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"연동이 끝난 storybook은 6006 포트에 storybook관련 사이트를 띄워준다. (명령어 입력시)"}),"\n",(0,sa.jsx)(e.p,{children:"버튼의 종류가 수정되어도 명령어만 입력하면 버튼의 상태를 쉽게 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"트러블 슈팅"}),"\n",(0,sa.jsx)(e.p,{children:"분명히 정상적으로 연동했다고 생각했는데 개발이 늘 그렇듯 트러블 슈팅은 따라왔다."}),"\n",(0,sa.jsx)(e.p,{children:"대 스토리북은 잘못 없고 일단 내 잘못이다 생각하고 내 실수를 찾아보기 시작했습니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2024-09-11/%EC%8A%A4%ED%86%A0%EB%A6%AC%EB%B6%81%20%EC%97%B0%EA%B2%B0%20%EC%8B%A4%ED%8C%A8.png",alt:""}),"\n(",(0,sa.jsx)(e.del,{children:"우리 프로젝트의 공통 버튼 컴포넌트입니다 짜자잔 ㅎㅎ"}),")"]}),"\n",(0,sa.jsx)(e.p,{children:"이런 상황이 생기면 일단 조급한 마음을 지우고 경우의 수를 만드는 게 내 마음속의 메뉴얼입니다."}),"\n",(0,sa.jsx)(e.p,{children:"크게 세가지 있는 것 같았다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"next.js와의 호환성 > 깃 허브 이슈에서도, 최근 포스트에서도 문제 없어보임"}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.strong,{children:"tailwind와의 호환성 > 흐름을 따라서 찾아보았다."})}),"\n",(0,sa.jsx)(e.li,{children:"storybook 자체의 문제 > 제일 확률이 적으니 우선순위 뒤로 뺌."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"2번 상황을 생각하고 찾아본 결과 답을 찾게 되었다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Preview"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@storybook/react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../styles/globals.css"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"preview"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Preview"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"parameters"}),": {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"controls"}),": {\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"matchers"}),": {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),": ",(0,sa.jsx)(e.span,{className:"hljs-regexp",children:"/(background|color)$/i"}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"date"}),": ",(0,sa.jsx)(e.span,{className:"hljs-regexp",children:"/Date$/i"}),",\n      },\n    },\n  },\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," preview;\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"preview도 일종의 컴포넌트 파일이라고 생각해야 되는 것이었다."}),"\n",(0,sa.jsx)(e.p,{children:"즉, globals.css를 넣지 않으면 className을 넣는다고 자동으로 스타일을 넣지 않는다. (tailwind가 연결되지 않는다.)"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-11/%EC%8A%A4%ED%86%A0%EB%A6%AC%EB%B6%81%20%EC%97%B0%EB%8F%99.gif",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"해결! 이제 pnpm storybook 명령어만 입력하면 현재 우리 프로젝트의 storybook과 연결된 컴포넌트의 상태가 어떻게 되어 있는지 쉽게 파악할 수 있습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"꼼꼼 프로젝트 진행 중에 겪은 경험들입니다. 오늘도 많이 성장한 것 같아요!"}),"\n",(0,sa.jsx)(e.p,{children:"읽어주셔서 감사합니다! 지켜봐주세요!"}),"\n",(0,sa.jsx)(e.p,{children:"감사합니다."}),"\n"]})]})}function eM(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eE,{...s})}):eE(s)}function eq(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"Background"}),"\n",(0,sa.jsx)(e.p,{children:"This project has really many types of modals."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240731004520.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Moreover, since the design mockup was not yet fully complete, there was a possibility that more would be added."}),"\n",(0,sa.jsx)(e.h1,{children:"Implementation"}),"\n",(0,sa.jsx)(e.h2,{children:"Situation Analysis"}),"\n",(0,sa.jsx)(e.p,{children:"I thought about things that exist in common, even though all modals are slightly different."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"padding and border-radius"}),"\n",(0,sa.jsx)(e.li,{children:"Existence of backdrop"}),"\n",(0,sa.jsx)(e.li,{children:"background-color"}),"\n",(0,sa.jsx)(e.li,{children:"Overlapping UI elements like fonts for title and description"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:'For 1, 2, 3, I made a "modal" component so it can be assembled,'}),"\n",(0,sa.jsx)(e.p,{children:"and for 4, I thought it would be good to implement it so that the assembly side can do it easily, even though frequently used cases are bundled with Compound Pattern to increase coupling between components."}),"\n",(0,sa.jsx)(e.p,{children:"The implementation method of the component itself was solved, and now I had to think about how to trigger rendering."}),"\n",(0,sa.jsx)(e.h2,{children:"Rendering Method"}),"\n",(0,sa.jsx)(e.h3,{children:"Global State Management"}),"\n",(0,sa.jsx)(e.p,{children:"Embarrassingly, when I implemented modals before, I think I couldn't think of good code because I was pressed by deadlines..."}),"\n",(0,sa.jsx)(e.p,{children:"Below is the method I originally used. It's a modal that implements opening and closing using context api."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// A kind of factory pattern."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Modal"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ children, button }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [isModalOpen, setIsModalOpen] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," modalRef = useClickOutside<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HTMLDivElement"}),">(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setIsModalOpen"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),"));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleOpen"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setIsModalOpen"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleClose"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setIsModalOpen"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ModalContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handleClose"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isModalOpen"})," }}>"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleOpen}"}),">"]}),"{button}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]}),"\n      {isModalOpen && (\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"fixed inset-0 z-40 flex items-end bg-black bg-opacity-50 md:items-center md:justify-center"'}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{modalRef}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"bg-background-secondary z-50 w-full rounded-t-xl md:w-[384px] md:rounded-b-xl"'}),"\n          >"]}),"\n            {children}\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      )}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ModalContext.Provider"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"A modal using context api like this"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/context%20api%EB%A5%BC%20%ED%99%9C%EC%9A%A9%ED%95%9C%20%EB%AA%A8%EB%8B%AC.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"When the modal is opened, the button that opens the modal also re-renders."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/context%20api%EB%A5%BC%20%ED%99%9C%EC%9A%A9%ED%95%9C%20%EB%AA%A8%EB%8B%AC%20profiler.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"This is unavoidable because context ultimately changes state in the parent component"}),"\n",(0,sa.jsx)(e.p,{children:"It makes developers comfortable, but you can't prevent components in between from re-rendering when state changes (so context api is also called global state injection rather than global state management.)"}),"\n",(0,sa.jsx)(e.p,{children:"Since zustand was set as the global state management library in this project, I started thinking about using it to create."}),"\n",(0,sa.jsx)(e.h3,{children:"toss slash"}),"\n",(0,sa.jsx)(e.p,{children:"While doing that, I found a hook that handles overlay in toss's open source library."}),"\n",(0,sa.jsx)(e.p,{children:"Overlay means something laid on top, and here it means putting a screen on top of a screen."}),"\n",(0,sa.jsx)(e.p,{children:"In other words, not only modals but also components on top of existing screens like sidebars and toasts are called overlays."}),"\n",(0,sa.jsx)(e.h4,{children:"Detailed Analysis of useOverlay"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://github.com/toss/slash/blob/main/packages/react/use-overlay/src/useOverlay.ko.md",children:"https://github.com/toss/slash/blob/main/packages/react/use-overlay/src/useOverlay.ko.md"})}),"\n",(0,sa.jsx)(e.h5,{children:"OverlayProvider"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// OverlayProvider.tsx"}),"\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/** ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@tossdocs"}),"-ignore */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"}),", {\n  createContext,\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropsWithChildren"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),",\n  useCallback,\n  useMemo,\n  useState,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Store with context api"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayContext"})," = createContext<{\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Context that checks whether it's mounted or not"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"mount"}),"(",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"element"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),"): ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unmount"}),"(",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),"): ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n} | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// In deployment stage"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (process.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"env"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"NODE_ENV"})," !== ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"production"'}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Set displayName"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayContext"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"displayName"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"OverlayContext"'}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create Provider that receives children"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"OverlayProvider"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ children }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropsWithChildren"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create state that stores id and component"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [overlayById, setOverlayById] = useState<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),">>(\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(),\n  );\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create mount function"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," mount = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"element"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"})]}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Don't call mount continuously, only call when first mounted (useCallback)"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setOverlayById"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"overlayById"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," cloned = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(overlayById);\n      cloned.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(id, element);\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," cloned;\n    });\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create unmount function"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," unmount = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Don't call unmount continuously, only call when first unmounted (useCallback)"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setOverlayById"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"overlayById"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," cloned = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(overlayById);\n      cloned.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"delete"}),"(id);\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," cloned;\n    });\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Store mount, unmount in context"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," context = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMemo"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ({ mount, unmount }), [mount, unmount]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Pass context down using Context API and render components using id and element"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{context}"}),">"]}),"\n      {children}\n      {[...overlayById.entries()].map(([id, element]) => (\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"React.Fragment"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{id}"}),">"]}),"{element}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"React.Fragment"}),">"]}),"\n      ))}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayContext.Provider"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Role of OverlayProvider"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Has state that stores components and passes it down globally so it can be changed with context api."}),"\n",(0,sa.jsx)(e.li,{children:"Opens components using state. (When empty, nothing is visible even if open.)"}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"Added 2024-11-29"}),"\n",(0,sa.jsxs)(e.p,{children:["Looking at the code above, you can see that ",(0,sa.jsx)(e.code,{children:"id:string"})," and ",(0,sa.jsx)(e.code,{children:"element:ReactNode"})," are put as elements of ",(0,sa.jsx)(e.code,{children:"Map"})," in a state called ",(0,sa.jsx)(e.code,{children:"overlayById"})," and then used inside ",(0,sa.jsx)(e.code,{children:"Provider"}),"."]}),"\n",(0,sa.jsxs)(e.p,{children:["At this time, you can see that ",(0,sa.jsx)(e.code,{children:"element:ReactNode"})," is used as ",(0,sa.jsx)(e.code,{children:"children"})," of ",(0,sa.jsx)(e.code,{children:"Fragment"})," inside ",(0,sa.jsx)(e.code,{children:"Provider"}),", and this is because ",(0,sa.jsx)(e.code,{children:"element:ReactNode"})," is a function called ",(0,sa.jsx)(e.code,{children:"createElement(tag, props, ...children)"}),". (To be precise, it's ",(0,sa.jsx)(e.code,{children:"JSX.Element"}),", and ",(0,sa.jsx)(e.code,{children:"ReactNode"})," is a broader concept that includes ",(0,sa.jsx)(e.code,{children:"string, number"}),", etc.)"]}),"\n",(0,sa.jsxs)(e.p,{children:["Actual ",(0,sa.jsx)(e.code,{children:"JSX.Element"})," like ",(0,sa.jsx)(e.code,{children:"<ComponentName/>"})," is internally changed by React to execution of ",(0,sa.jsx)(e.code,{children:"createElement"})," function, returns a JS object, and further makes it into Fiber, Fiber Tree."]}),"\n",(0,sa.jsxs)(e.p,{children:["We directly used this intermediate stage. So we can't use the element of overlayById state like ",(0,sa.jsx)(e.code,{children:"<element key={id}/>"})," as if using a component, and must use it as ",(0,sa.jsx)(e.code,{children:"children"}),"."]}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"useOverlay"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useContext, useEffect, useMemo, useRef, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayContext"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./OverlayProvider"'}),";\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/** ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@tossdocs"}),"-ignore */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayController"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayControlRef"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./OverlayController"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./types"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," elementId = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Options"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exitOnUnmount"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"boolean"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useOverlay"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ exitOnUnmount = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"})," }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Options"})," = {}"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get overlayContext (has mount, unmount)"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," context = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useContext"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayContext"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Throw error if context doesn't exist (only usable within Provider)"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (context == ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"useOverlay is only available within OverlayProvider."'}),");\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Separate mount, unmount with destructuring"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { mount, unmount } = context;\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create state that stores id"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [id] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"String"}),"(elementId++));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create overlayRef, provide close function using useImperativeHandle"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," overlayRef = useRef<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayControlRef"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//  When exitOnUnmount is true, execute unmount when component unmounts"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//  When exitOnUnmount is false, don't execute unmount when component unmounts, must directly call exit(unmount)"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (exitOnUnmount) {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unmount"}),"(id);\n      }\n    };\n  }, [exitOnUnmount, id, unmount]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Cache object using useMemo"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMemo"}),"(\n    ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ({\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Return open, close, exit functions"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// open: receive overlayElement and execute mount"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// close: execute overlayRef.current?.close()"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// exit: execute unmount"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"open"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overlayElement"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"})]}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"mount"}),"(\n          id,\n          ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayController"}),"\n            // ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"NOTE:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"state"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"should"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"be"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"reset"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"every"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"time"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"we"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"open"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"an"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overlay"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{Date.now()}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{overlayRef}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overlayElement"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{overlayElement}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onExit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{()"})," =>"]})," {\n              unmount(id);\n            }}\n          />"]}),",\n        );\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n        overlayRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"close"}),"();\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unmount"}),"(id);\n      },\n    }),\n    [id, mount, unmount],\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Role of useOverlay"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Read context and provide functions that can mount and unmount (here mount and unmount are putting in memory (global state))"}),"\n",(0,sa.jsx)(e.li,{children:"Generate and inject id used internally in context"}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"OverlayController"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/** ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@tossdocs"}),"-ignore */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," {\n  forwardRef,\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Ref"}),",\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./types"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Props"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Result"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overlayElement"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onExit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayControlRef"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayController"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"forwardRef"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"OverlayController"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n  { overlayElement: OverlayElement, onExit }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Props"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Ref"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayControlRef"}),">,\n"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Whether it's rendered on actual DOM, not memory"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [isOpenOverlay, setIsOpenOverlay] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Function to close Overlay from DOM"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," handleOverlayClose = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setIsOpenOverlay"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),"), []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add close function to object passed via ref"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useImperativeHandle"}),"(ref, ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": handleOverlayClose };\n  }, [handleOverlayClose]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Open Overlay when component mounts"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["// ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"NOTE:"})," Without requestAnimationFrame, Open animation sometimes doesn't execute."]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Method that enables calling callback function before next repaint in browser"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"requestAnimationFrame"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setIsOpenOverlay"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),");\n    });\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Render OverlayElement"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayElement"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isOpen"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{isOpenOverlay}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleOverlayClose}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{onExit}"}),"\n    />"]})}),"\n  );\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Role of OverlayController"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Render Element on actual DOM"}),"\n",(0,sa.jsx)(e.li,{children:"Process animation by calling function before repaint (requestAnimationFrame can execute function before repaint because it has its own queue and executes like micro queue.)"}),"\n",(0,sa.jsx)(e.li,{children:"Put handler to close modal with useOverlay's open"}),"\n",(0,sa.jsx)(e.li,{children:"Remove Element"}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"Overall Structure Diagram"}),"\n",(0,sa.jsx)(e.p,{children:"When comprehensively drawing the structure diagram, it's as follows."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240828112132.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Points solved through this:"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Modals are defined below main that doesn't have influence so that z-index is not buried in stacking context."}),"\n",(0,sa.jsx)(e.li,{children:"Modal components can be directly injected from components."}),"\n",(0,sa.jsx)(e.li,{children:"Multiple modals can appear on the same page and can exist simultaneously."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.strong,{children:"Stacking context"})," is a 3D conceptualization of HTML elements using a virtual Z-axis. The Z-axis is user-based, assuming the user is looking at the viewport or webpage. Each HTML element occupies 3D space using priority according to its own attributes.\n",(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240914114250.png",alt:""}),"\nIt's complicated, but simply put, z-index cannot beat parent's z-index. Even if you have z-index: 6, if the parent is 4, you cannot beat elements higher than 4 at the parent level with z-index.\n(",(0,sa.jsx)(e.code,{children:"DIV #4 has z-index:6 but is behind DIV #1 with z-index:5."}),")"]}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"Improvements Suited to Project"}),"\n",(0,sa.jsx)(e.p,{children:"After analysis was complete, I felt stronger after studying everything related. Haha.."}),"\n",(0,sa.jsx)(e.p,{children:"When thinking about points to improve in useOverlay for the project, they were as follows."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Replacing global state injection with global state management can escape re-rendering problems. Since this project uses zustand for global state, work to carve it out with zustand is needed."}),"\n",(0,sa.jsxs)(e.li,{children:["Slash's library seemed like a previously implemented library. (It was importing React.) If we refactor it to some extent by current standards, we can increase readability. Simply, in the part that receives component id, a global variable was specified to put id, and this can be refactored to use ",(0,sa.jsx)(e.code,{children:"useId"}),", a hook made for React to create ids."]}),"\n",(0,sa.jsx)(e.li,{children:"OverlayController stage is separately divided into exit and close for animation processing related to mount and unmount (like Framer-Motion's AnimatePresense), but I thought this harmed readability. I thought we could create one state and process it when doing animation processing in the part that creates components like modals and sidebars, not putting it in the hook. I could confirm that in the existing library, this part had long comments, and personally, I think code that reads well without comments is better. Since our project didn't place great importance on mount and unmount animations, we decided to remove it."}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"useCustomOverlay Structure Diagram"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240828112816.png",alt:""})}),"\n",(0,sa.jsx)(e.h5,{children:"OverlayStore"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { devtools } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zustand/middleware"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { createStore } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zustand/vanilla"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayState"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),">;\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayActions"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mount"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"element"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"})]}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"unmount"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStore"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayState"})," & ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayActions"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," initOverlayStore = (): ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"OverlayState"})," =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"() };\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultInitState"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayState"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(),\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createOverlayStore"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"initState"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayState"})," = defaultInitState,\n"]}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," createStore<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStore"}),">()(\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"devtools"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"set"}),") =>"]})," ({\n      ...initState,\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mount"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"id, element"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(\n          ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"state"}),") =>"]})," {\n            state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ElementsInMemory"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(id, element);\n            ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ElementsInMemory"}),") };\n          },\n          ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"mount"'}),",\n        );\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"unmount"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"id"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(\n          ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"state"}),") =>"]})," {\n            state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ElementsInMemory"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"delete"}),"(id);\n            ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ElementsInMemory"}),") };\n          },\n          ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"unmount"'}),",\n        );\n      },\n    })),\n  );\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"By using zustand store method, logic related to mount and unmount could be hidden in the store. (Logic separation good)"}),"\n",(0,sa.jsx)(e.h6,{children:"Troubleshooting"}),"\n",(0,sa.jsx)(e.p,{children:"As a short troubleshooting, zustand uses shallow equal to detect state changes, so just deleting didn't cause re-rendering."}),"\n",(0,sa.jsx)(e.p,{children:"When data changes, you need to put a new Map in return for re-rendering to occur normally."}),"\n",(0,sa.jsx)(e.h5,{children:"OverlayStoreProvider"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStore"}),",\n  createOverlayStore,\n  initOverlayStore,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/stores/modal-store"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Fragment"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropsWithChildren"}),",\n  createContext,\n  useContext,\n  useRef,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useStoreWithEqualityFn } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zustand/traditional"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStoreApi"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReturnType"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," createOverlayStore>;\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStoreContext"})," = createContext<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStoreApi"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),">(\n  ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n);\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"OverlayStoreProvider"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ children }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropsWithChildren"})]}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," storeRef = useRef<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStoreApi"}),">();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!storeRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),") {\n    storeRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createOverlayStore"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"initOverlayStore"}),"());\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayStoreContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{storeRef.current}"}),">"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayStoreContext.Provider"}),">"]})]}),"\n  );\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"OverlayProvider"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useOverlayStore"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"store"}),") =>"]})," store.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ElementsInMemory"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      {[...ElementsInMemory.entries()].map(([id, element]) => (\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Fragment"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{id}"}),">"]}),"{element}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Fragment"}),">"]}),"\n      ))}\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," useOverlayStore = <T,>(\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"selector"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"store"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStore"})]}),") =>"]})," T,\n): ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"T"})," =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," overlayStoreContext = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useContext"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStoreContext"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!overlayStoreContext) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"`useModalStore must be used within ModalStoreProvider`"}),");\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useStoreWithEqualityFn"}),"(overlayStoreContext, selector);\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Component connected to OverlayStore. Must be placed below main to solve stacking context."}),"\n",(0,sa.jsx)(e.p,{children:"Map's entries expand Map and take out components inside, and since they render sequentially, components implemented later win in stacking context and overwrite."}),"\n",(0,sa.jsx)(e.h5,{children:"useCustomOverlay"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useOverlayStore } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/providers/modal-store-provider"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useId, useMemo } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./types"'}),";\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * Hook that renders components below root by combining with Zustand.\n * Renders components that receive close as prop.\n * You can create components like Modal component that receive close function as prop and put them in.\n * This component only lifts them below root. \n * \n * You can also create another CustomOverlay inside a modal to lift one more modal. \n * However, useOutSideClick must be handled separately.\n * \n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable",children:"overlayElement"}),"\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@returns"})," The component is rendered below root.\n *  const overlay1 = useCustomOverlay(({ close }) => (\n    <Modal close={close}>\n      <Modal.HeaderWithClose />\n      <Modal.Title>제목</Modal.Title>\n      <Modal.Description>난 예시다.</Modal.Description>\n      <Modal.Description>해냈다.</Modal.Description>\n    </Modal>\n  ));\n  return (\n    <button onClick={overlay1.open}>overlay1에 넣은 컴포넌트를 여는 버튼/button>\n */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCustomOverlay"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overlayElement"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Generate unique id with useId"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," id = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useId"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," mount = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useOverlayStore"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"store"}),") =>"]})," store.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"mount"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," unmount = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useOverlayStore"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"store"}),") =>"]})," store.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"unmount"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Cache object using useMemo"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMemo"}),"(\n    ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ({\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"open"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"mount"}),"(id, ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"overlayElement"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unmount"}),"(id) }));\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unmount"}),"(id);\n      },\n    }),\n    [id, mount, unmount, overlayElement],\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This is useCustomOverlay, which I liked the most while implementing."}),"\n",(0,sa.jsx)(e.p,{children:"I processed id to have a unique value using useId, and made it call with a component when calling, so on the usage side,"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," modalSendEmailOverlay = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCustomOverlay"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ close }"}),") =>"]})," (\n    ",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ModalSendEmail"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{close}"})," />"]})}),"\n  ));\n ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\nonClick={modalSendEmailOverlay.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"open"}),"}    \n"]})}),"\n",(0,sa.jsx)(e.p,{children:"I made it so that you can render by just using the open method."}),"\n",(0,sa.jsx)(e.p,{children:"Now fellow developers can manage overlays by going through just three processes."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Assemble component to display screen (must have close prop that closes overlay.)"}),"\n",(0,sa.jsx)(e.li,{children:"Put in useCustomOverlay"}),"\n",(0,sa.jsx)(e.li,{children:"instance.open"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"This way, I implemented a universal hook that can be put not only in modals but also in sidebars and toasts!!!!!"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"++ 2024-11-29"}),"\n",(0,sa.jsx)(e.p,{children:"Looking back, this method reduced useOverlay's functionality too much."}),"\n",(0,sa.jsxs)(e.p,{children:["In toss's useOverlay, modals can be handled simultaneously by using ",(0,sa.jsx)(e.code,{children:"Promise"})," to make it a handling function that performs specific actions rather than a function that opens modals."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Function that manages purchase action, not a function that opens purchase modal"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," handlePurchase = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," () => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isOk = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," {\n    overlay.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"open"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ close, isOpen }"}),") =>"]})," (\n      ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"PurchaseModal"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handleCancel"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{()"})," =>"]})," {\n          resolve(false);\n          close();\n        }}\n        handleConfirm={() => {\n          resolve(true);\n          close();\n        }}\n        isOpen={isOpen}\n      />"]}),"\n    ));\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (isOk) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"결제가 완료되었습니다."'}),");\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"결제가 취소되었습니다."'}),");\n  }\n}, [overlay]);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This enables declarative programming, making it a much better method in terms of readability or scalability. This will shine even more as the product grows."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Compound Pattern + useCustomOverlay Example (Common Modal Component)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalContextType"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalContext"})," = createContext<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalContextType"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalProps"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"closeOnFocusOut"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"boolean"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"children"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n}\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * Modal component\n *\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@description"})," Made with compound pattern and can be used together as an argument of useCustomOverlay.\n * Each element doesn't have margin set. You can specify with className and combine to use.\n *\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," close Function to close modal\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," children Inside modal\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," closeOnFocusOut Whether to close modal when clicking outside screen\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@example"}),'\n * ```tsx\n  export function ModalWarning({ handleConfirm, close }: ModalWarningProps) {\n    const handleClick = async () => {\n      await handleConfirm();\n      close();\n    };\n    return (\n      <Modal close={close} closeOnFocusOut>\n        <header className="flex justify-center pb-4 pt-6">\n          <Alert width={24} height={24} />\n        </header>\n        <div className="mx-12 text-center md:mx-9">\n          <Modal.Title className="mb-2 text-slate-50 md:text-text-primary">\n            회원 탈퇴를 진행하시겠어요?\n          </Modal.Title>\n          <Modal.Description className="mb-4">\n            그룹장에 있는 모든 그룹은 삭제되고, 모든 그룹에서 나가집니다.\n          </Modal.Description>\n          <Modal.TwoButtonSection\n            closeBtnStyle="outlined_secondary"\n            confirmBtnStyle="danger"\n            buttonDescription="회원 탈퇴"\n            onClick={handleClick}\n            close={close}\n          />\n        </div>\n      </Modal>\n    );\n  }\n */']}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Modal"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  children,\n  close,\n  closeOnFocusOut,\n  className,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," modalRef = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useClickOutside"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"close"}),"();\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// eslint-disable-next-line react/jsx-no-constructed-context-values"}),"\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ModalContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"})," }}>"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cn(overlayVariants())}"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"motion.div"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"animate"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"opacity:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"y:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"0"})," }}\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"initial"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"opacity:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"y:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"100"})," }}\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"transition"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"duration:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"0.1"})," }}\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cn(modalVariants({"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"})," }))}\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"closeOnFocusOut"}),"\n              ? (",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"modalRef"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"as"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"LegacyRef"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"HTMLDivElement"}),">"]})," | undefined)\n              : null\n          }\n        >\n          {children}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"motion.div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ModalContext.Provider"}),">"]}),'\n  );\n}\n//...\nexport function useModal() {\n  const context = useContext(ModalContext);\n\n  if (!context) {\n    throw new Error("useModal must be used within a ModalProvider");\n  }\n\n  return context;\n}\n//...\nfunction HeaderWithClose({ className }: HeaderWithCloseProps) {\n  const { close } = useModal();\n  return (\n    ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{headerWithCloseVariants({"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"})," })}>"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"button"'})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{close}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"aria-label"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"닫기"'}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"CloseButton"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"rounded-xl duration-100 hover:scale-105"'}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"width"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{24}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"height"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{24}"}),"\n        />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"}),">"]}),'\n  );\n}\nHeaderWithClose.displayName = "Modal.HeaderWithClose";\n']})]})}),"\n",(0,sa.jsx)(e.p,{children:"As mentioned in useCustomOverlay analysis, you can confirm that animation processing related to mount and unmount is implemented inside components."}),"\n",(0,sa.jsx)(e.p,{children:"In this project, since there are various modals with similar internal elements, I also implemented constituent elements with compound pattern."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"Compound pattern is one of the design patterns used in frontend environments,\na pattern where you can bring only one component with internal state implemented using context api and utilize components inside properties, implementing various components as if assembling.\nHowever, it also has the disadvantage that tree shaking is impossible, so caution is needed when using it."}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"HandleArticleModal"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  close,\n  onSubmit,\n  defaultContent,\n  defaultImage,\n  defaultTitle,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HandleArticleModalProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { handleNext, handlePrev, isNext } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useNextPage"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [imageFile, setImageFile] = useState<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"File"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," handleImageFile = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"selectedImageFile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"File"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})]}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setImageFile"}),"(selectedImageFile);\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"usePreventScroll"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Modal"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{close}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"closeOnFocusOut"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{false}"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Modal.HeaderWithClose"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"fixed right-7 top-7"'})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"relative"'}),">"]}),"\n        {isNext ? (\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ArticleForm"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"file"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{imageFile}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handlePrev"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handlePrev}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handlePost"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{onSubmit}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultContent"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{defaultContent}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultTitle"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{defaultTitle}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultImage"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{defaultImage}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{close}"}),"\n          />"]}),"\n        ) : (\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"FileDragDown"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"file"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{imageFile}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSelect"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleImageFile}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultPreview"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{defaultImage}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handleNext"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleNext}"}),"\n          />"]}),"\n        )}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Modal"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This is an example of modal assembly using this. On the assembly side, you can confirm that it's implemented just by putting components and necessary logic inside Modal without needing to know the internal logic or styles that implement the modal."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/%EA%B2%8C%EC%8B%9C%EA%B8%80%20%EC%B6%94%EA%B0%80.gif",alt:""})}),"\n",(0,sa.jsx)(e.h1,{children:"Afterword"}),"\n",(0,sa.jsx)(e.p,{children:"I met a good problem situation, so I was able to have time to analyze toss slash's hook this time."}),"\n",(0,sa.jsx)(e.p,{children:"It was an experience where I learned a lot of knowledge I wouldn't have known if I hadn't analyzed things like requestAnimateFrame or useImperative hook."}),"\n",(0,sa.jsx)(e.p,{children:"This useOverlay is a small size compared to other open source libraries, but"}),"\n",(0,sa.jsx)(e.p,{children:"I think I can now analyze even large open sources without fear when I meet good problems in the future."}),"\n",(0,sa.jsx)(e.p,{children:"Let's grow more"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://github.com/772-company/kkom-kkom/pull/80",children:"https://github.com/772-company/kkom-kkom/pull/80"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"These are experiences I had during the Kkom-kkom project. I think I grew a lot today too!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you for reading! Please watch over me!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you."}),"\n"]})]})}function eO(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eq,{...s})}):eq(s)}function eL(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"배경"}),"\n",(0,sa.jsx)(e.p,{children:"이번 프로젝트에는 정말 많은 종류의 모달이 존재합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240731004520.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"심지어 디자인 시안이 아직 다 완성되지 않은 상황이었기에 더 추가될지도 모르는 상황이었다."}),"\n",(0,sa.jsx)(e.h1,{children:"구현"}),"\n",(0,sa.jsx)(e.h2,{children:"상황 분석"}),"\n",(0,sa.jsx)(e.p,{children:"모달들이 전부 조금씩 다르게 생겼으나 공통적으로 존재하는 것들을 생각해보았다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"padding과 border-radius"}),"\n",(0,sa.jsx)(e.li,{children:"backdrop의 존재"}),"\n",(0,sa.jsx)(e.li,{children:"background-color"}),"\n",(0,sa.jsx)(e.li,{children:"주제, 설명의 폰트 같은 겹치는 UI 요소들"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:'1,2,3 의 경우 "모달" 이라는 컴포넌트를 만들어서 조립할 수 있게 만들어주고'}),"\n",(0,sa.jsx)(e.p,{children:"4 의 경우 자주 쓰이는 경우 Compound Pattern으로 묶어서 컴포넌트 간의 결합성을 높히게 되긴 하지만 조립하는 쪽에서 쉽게 할 수 있도록 구현하는게 좋다고 생각하였습니다."}),"\n",(0,sa.jsx)(e.p,{children:"컴포넌트 자체의 구현 방식은 해결되었고 이제 렌더링은 어떻게 시킬지 생각해야 했습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"렌더링 방법"}),"\n",(0,sa.jsx)(e.h3,{children:"전역 상태 관리"}),"\n",(0,sa.jsx)(e.p,{children:"부끄럽지만 기존에 모달을 구현할 때는 마감 기한에 밀려서 좋은 코드를 생각하지 못했던 것 같다..."}),"\n",(0,sa.jsx)(e.p,{children:"아래는 원래 사용하던 방식입니다. context api를 활용하여 모달이 열리고 닫히고를 구현해놓은 모달입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 일종의 팩토리 패턴입니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Modal"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ children, button }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [isModalOpen, setIsModalOpen] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," modalRef = useClickOutside<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HTMLDivElement"}),">(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setIsModalOpen"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),"));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleOpen"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setIsModalOpen"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleClose"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setIsModalOpen"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ModalContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handleClose"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isModalOpen"})," }}>"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleOpen}"}),">"]}),"{button}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]}),"\n      {isModalOpen && (\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"fixed inset-0 z-40 flex items-end bg-black bg-opacity-50 md:items-center md:justify-center"'}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{modalRef}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"bg-background-secondary z-50 w-full rounded-t-xl md:w-[384px] md:rounded-b-xl"'}),"\n          >"]}),"\n            {children}\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      )}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ModalContext.Provider"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이렇게 context api를 사용한 모달은"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/context%20api%EB%A5%BC%20%ED%99%9C%EC%9A%A9%ED%95%9C%20%EB%AA%A8%EB%8B%AC.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"모달을 열었을 때 모달을 여는 버튼도 리렌더링됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/context%20api%EB%A5%BC%20%ED%99%9C%EC%9A%A9%ED%95%9C%20%EB%AA%A8%EB%8B%AC%20profiler.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"이는 어쩔수가 없는게 context가 결국 상위 컴포넌트에 있는 상태를 바꾸기 때문"}),"\n",(0,sa.jsx)(e.p,{children:"개발자가 편해지긴 하지만 상태를 바꿔서 그 사이의 컴포넌트들이 리렌더링 되는 것을 막을 순 없음 ( 그래서 context api는 전역 상태 관리라기보단 전역 상태 주입이라고도 합니다. )"}),"\n",(0,sa.jsx)(e.p,{children:"이번 프로젝트에서 전역 상태 관리 라이브러리로 zustand을 세팅했으니 우선 이를 활용해서 만들어 보자 하고 고민을 시작했습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"toss slash"}),"\n",(0,sa.jsx)(e.p,{children:"그러던 중 toss의 오픈 소스 라이브러리에 overlay를 다루는 훅이 있는 것을 발견했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"overlay란 위에 까는 것을 의미하며 여기서는 화면 위에 화면을 올리는 것을 말합니다."}),"\n",(0,sa.jsx)(e.p,{children:"즉, 모달 뿐만 아니라 사이드바, 토스트 등 존재하는 화면 위에 있는 컴포넌트도 overlay라고 합니다."}),"\n",(0,sa.jsx)(e.h4,{children:"useOverlay 상세 분석"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://github.com/toss/slash/blob/main/packages/react/use-overlay/src/useOverlay.ko.md",children:"https://github.com/toss/slash/blob/main/packages/react/use-overlay/src/useOverlay.ko.md"})}),"\n",(0,sa.jsx)(e.h5,{children:"OverlayProvider"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// OverlayProvider.tsx"}),"\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/** ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@tossdocs"}),"-ignore */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"}),", {\n  createContext,\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropsWithChildren"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),",\n  useCallback,\n  useMemo,\n  useState,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// context api로 저장"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayContext"})," = createContext<{\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 마운트 되는지 안되는지 확인하는 context"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"mount"}),"(",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"element"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),"): ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unmount"}),"(",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),"): ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n} | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배포 단계에서는"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (process.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"env"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"NODE_ENV"})," !== ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"production"'}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// displayName을 설정"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayContext"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"displayName"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"OverlayContext"'}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// children을 받는 Provider 생성"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"OverlayProvider"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ children }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropsWithChildren"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// id와 컴포넌트를 저장하는 state 생성"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [overlayById, setOverlayById] = useState<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),">>(\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(),\n  );\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// mount 함수 생성"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," mount = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"element"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"})]}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// mount를 계속 호출하지 않고 처음 마운트 될때만 호출 (useCallback)"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setOverlayById"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"overlayById"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," cloned = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(overlayById);\n      cloned.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(id, element);\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," cloned;\n    });\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// unmount 함수 생성"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," unmount = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// unmount를 계속 호출하지 않고 처음 언마운트 될때만 호출 (useCallback)"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setOverlayById"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"overlayById"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," cloned = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(overlayById);\n      cloned.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"delete"}),"(id);\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," cloned;\n    });\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// context에 mount, unmount를 저장"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," context = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMemo"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ({ mount, unmount }), [mount, unmount]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// context를 Context API를 활용해서 아래로 내리고 id와 element를 사용해서 컴포넌트를 렌더링"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{context}"}),">"]}),"\n      {children}\n      {[...overlayById.entries()].map(([id, element]) => (\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"React.Fragment"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{id}"}),">"]}),"{element}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"React.Fragment"}),">"]}),"\n      ))}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayContext.Provider"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"OverlayProvider의 역할"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"컴포넌트를 저장하는 상태를 갖고 context api로 바꿀 수 있게 전역으로 내려준다."}),"\n",(0,sa.jsx)(e.li,{children:"상태를 이용해서 컴포넌트를 열어놓는다. (비어져 있을 때는 열려있어도 아무것도 보이지 않는다.)"}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"2024-11-29 추가"}),"\n",(0,sa.jsxs)(e.p,{children:["위 코드를 보면 ",(0,sa.jsx)(e.code,{children:"overlayById"})," 라는 상태에 ",(0,sa.jsx)(e.code,{children:"id:string"}),"과 ",(0,sa.jsx)(e.code,{children:"element:ReactNode"}),"를 ",(0,sa.jsx)(e.code,{children:"Map"}),"의 요소로 넣어둔 후 ",(0,sa.jsx)(e.code,{children:"Provider"})," 내부에서 쓰는 것을 볼 수 있습니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["이때 ",(0,sa.jsx)(e.code,{children:"Provider"})," 내부에서 ",(0,sa.jsx)(e.code,{children:"Fragment"}),"의 ",(0,sa.jsx)(e.code,{children:"children"}),"으로 ",(0,sa.jsx)(e.code,{children:"element:ReactNode"}),"를 사용하는 것을 볼 수 있는데 이는 ",(0,sa.jsx)(e.code,{children:"element:ReactNode"}),"가 ",(0,sa.jsx)(e.code,{children:"createElement(tag, props, ...children)"})," 이라는 함수이기 때문입니다. ( 정확히는 ",(0,sa.jsx)(e.code,{children:"JSX.Element"}),"이고 ",(0,sa.jsx)(e.code,{children:"ReactNode"}),"는 ",(0,sa.jsx)(e.code,{children:"string, number"})," 등을 포함하는 좀 더 큰 개념입니다. )"]}),"\n",(0,sa.jsxs)(e.p,{children:["실제 ",(0,sa.jsx)(e.code,{children:"<ComponentName/>"})," 같은 ",(0,sa.jsx)(e.code,{children:"JSX.Element"}),"은 ",(0,sa.jsx)(e.code,{children:"React"})," 내부적으로 ",(0,sa.jsx)(e.code,{children:"createElement"})," 함수의 실행으로 바뀌어서 JS 객체를 반환하고 더 나아가 이를 Fiber, Fiber Tree로 만든다."]}),"\n",(0,sa.jsxs)(e.p,{children:["우린 이 중간 단계를 직접 사용한 것입니다. 그래서 overlayById 상태의 element를 컴포넌트를 사용하는 것처럼 ",(0,sa.jsx)(e.code,{children:"<element key={id}/>"}),"로 사용할 수 없고 ",(0,sa.jsx)(e.code,{children:"children"}),"으로써 사용해야 합니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"useOverlay"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useContext, useEffect, useMemo, useRef, useState } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayContext"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./OverlayProvider"'}),";\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/** ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@tossdocs"}),"-ignore */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayController"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayControlRef"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./OverlayController"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./types"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," elementId = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Options"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exitOnUnmount"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"boolean"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useOverlay"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ exitOnUnmount = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"})," }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Options"})," = {}"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// overlayContext를 가져옴 (mount, unmount가 있음)"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," context = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useContext"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayContext"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// context가 없으면 에러 발생 (Provider 내부에서만 사용 가능)"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (context == ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"useOverlay is only available within OverlayProvider."'}),");\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 비구조 할당으로 mount, unmount를 분리"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { mount, unmount } = context;\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// id를 저장하는 state 생성"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [id] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"String"}),"(elementId++));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// overlayRef를 생성, useImperativeHandle을 사용하여 close 함수를 제공"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," overlayRef = useRef<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayControlRef"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//  exitOnUnmount가 true일 때, 컴포넌트가 언마운트 될 때 unmount 실행"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//  exitOnUnmount가 false일 때, 컴포넌트가 언마운트 될 때 unmount 실행하지 않음, 직접 exit(unmount)를 호출해야 함"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (exitOnUnmount) {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unmount"}),"(id);\n      }\n    };\n  }, [exitOnUnmount, id, unmount]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useMemo를 사용하여 객체를 캐싱"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMemo"}),"(\n    ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ({\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// open, close, exit 함수를 반환"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// open: overlayElement를 받아서 mount 실행"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// close: overlayRef.current?.close() 실행"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// exit: unmount 실행"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"open"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overlayElement"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"})]}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"mount"}),"(\n          id,\n          ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayController"}),"\n            // ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"NOTE:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"state"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"should"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"be"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"reset"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"every"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"time"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"we"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"open"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"an"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overlay"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{Date.now()}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{overlayRef}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overlayElement"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{overlayElement}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onExit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{()"})," =>"]})," {\n              unmount(id);\n            }}\n          />"]}),",\n        );\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n        overlayRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),"?.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"close"}),"();\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unmount"}),"(id);\n      },\n    }),\n    [id, mount, unmount],\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"useOverlay의 역할"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"context를 읽고 mount, unmount할 수 있는 함수 제공 (여기서 mount와 unmount는 메모리에 담는 것(전역 상태))"}),"\n",(0,sa.jsx)(e.li,{children:"context 내부적으로 사용할 id 생성, 주입"}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"OverlayController"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/** ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@tossdocs"}),"-ignore */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," {\n  forwardRef,\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Ref"}),",\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./types"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Props"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 결과물"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overlayElement"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onExit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayControlRef"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayController"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"forwardRef"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"OverlayController"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n  { overlayElement: OverlayElement, onExit }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Props"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Ref"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayControlRef"}),">,\n"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 메모리가 아닌 실제 DOM에 렌더링되는지 여부"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [isOpenOverlay, setIsOpenOverlay] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// DOM에서 Overlay를 닫는 함수"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," handleOverlayClose = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setIsOpenOverlay"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),"), []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ref로 전달된 객체에 close 함수를 추가"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useImperativeHandle"}),"(ref, ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": handleOverlayClose };\n  }, [handleOverlayClose]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 컴포넌트가 마운트되면 Overlay를 열기"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["// ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"NOTE:"})," requestAnimationFrame이 없으면 가끔 Open 애니메이션이 실행되지 않는다."]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 브라우저에 다음 리페인트 전에 콜백 함수 호출을 가능하게 하는 메소드"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"requestAnimationFrame"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setIsOpenOverlay"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),");\n    });\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// OverlayElement를 렌더링"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayElement"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isOpen"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{isOpenOverlay}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleOverlayClose}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{onExit}"}),"\n    />"]})}),"\n  );\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"OverlayController의 역할"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"실제 DOM에 Element를 렌더링"}),"\n",(0,sa.jsx)(e.li,{children:"리페인트 전에 함수를 호출해서 애니메이션 처리 (requestAnimationFrame은 마이크로 큐처럼 본인의 큐를 갖고 실행되기 때문에 리페인트 전에 함수를 실행시킬 수 있습니다.)"}),"\n",(0,sa.jsx)(e.li,{children:"useOverlay의 open으로 모달을 끄는 handler 올리기"}),"\n",(0,sa.jsx)(e.li,{children:"Element 내리기"}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"전체 구조도"}),"\n",(0,sa.jsx)(e.p,{children:"종합적으로 구조도를 구려보면 다음과 같다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240828112132.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"이를 통해 해결되는 점은"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"z-index가 쌓임맥락으로 묻혀지지 않도록 영향이 가지않는 main 아래에 모달이 정의됩니다."}),"\n",(0,sa.jsx)(e.li,{children:"컴포넌트에서 모달 컴포넌트를 직접 주입할 수 있습니다."}),"\n",(0,sa.jsx)(e.li,{children:"같은 페이지에서 여러 모달이 나올 수 있고 동시에도 있을 수 있습니다."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.strong,{children:"쌓임 맥락"}),"(stacking context)은 가상의 Z축을 사용한 HTML 요소의 3차원 개념화입니다. Z축은 사용자 기준이며, 사용자는 뷰포트 혹은 웹페이지를 바라보고 있을 것으로 가정합니다. 각각의 HTML 요소는 자신의 속성에 따른 우선순위를 사용해 3차원 공간을 차지합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240914114250.png",alt:""}),"\n어렵게 되어 있지만 쉽게 말하자면 z-index는 부모의 z-index를 이길 수 없다는 것입니다. 자신이 z-index: 6이더라도 부모가 4라면 부모 단에 있는 4보다 높은 요소들을 z-index로 이길 수 없다.\n(",(0,sa.jsx)(e.code,{children:"DIV #4는 z-index:6이지만 z-index:5인 DIV #1보다 뒤에 있습니다."}),")"]}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"프로젝트에 맞게 개선"}),"\n",(0,sa.jsx)(e.p,{children:"분석이 끝난 후 관련된 공부를 다 한 나는 강해진 느낌이 들었다. 하핳.."}),"\n",(0,sa.jsx)(e.p,{children:"프로젝트를 위해서 useOverlay에서 개선할 점을 생각해보니 다음과 같았다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"전역 상태 주입에서 전역 상태 관리로 교체하는 것이 리렌더링 문제에서 벗어날 수 있습니다. 이번 프로젝트에서 전역 상태는 zustand를 사용하고 있기에 zustand로 깎아내는 작업이 필요하다."}),"\n",(0,sa.jsxs)(e.li,{children:["slash의 라이브러리는 이전에 구현된 라이브러리 같았다. (React를 import 받고 있었음.) 현재 기준으로 어느정도 리팩토링을 하게 되면 가독성을 늘릴 수 있을 것입니다. 간단하게는 컴포넌트의 id를 받는 부분에서 전역 변수를 지정해서 id를 넣어주고 있었는데 이는 react에서 id를 만들 때 쓰라고 만든 훅인 ",(0,sa.jsx)(e.code,{children:"useId"}),"를 사용하여 리팩토링할 수 있는 식입니다."]}),"\n",(0,sa.jsx)(e.li,{children:"OverlayController 단은 마운트, 언마운트 관련해서 애니메이션 처리 (Framer-Motion의 AnimatePresense 같은)를 위해 exit, close로 따로 분리되어 있는데 이는 가독성을 해친다고 생각했습니다. 훅에 넣지 말고 모달, 사이드바 같은 컴포넌트를 만드는 부분에서 애니메이션 처리를 할 때 상태를 하나 만들어서 처리해도 된다고 생각했습니다. 기존 라이브러리에서도 이 부분 때문에 주석이 길게 되어 있는 것을 확인할 수 있었는데 개인적으로는 주석 없이도 잘 읽히는 코드가 더 좋은 것 같다. 우리 프로젝트에서는 마운트, 언마운트 시의 애니메이션에 큰 비중을 두지 않았기 때문에 들어내기로 했습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"useCustomOverlay 구조도"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240828112816.png",alt:""})}),"\n",(0,sa.jsx)(e.h5,{children:"OverlayStore"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { devtools } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zustand/middleware"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { createStore } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zustand/vanilla"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayState"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),">;\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayActions"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mount"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"element"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"})]}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"unmount"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStore"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayState"})," & ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayActions"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," initOverlayStore = (): ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"OverlayState"})," =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"() };\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultInitState"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayState"})," = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(),\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createOverlayStore"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"initState"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayState"})," = defaultInitState,\n"]}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," createStore<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStore"}),">()(\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"devtools"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"set"}),") =>"]})," ({\n      ...initState,\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mount"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"id, element"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(\n          ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"state"}),") =>"]})," {\n            state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ElementsInMemory"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(id, element);\n            ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ElementsInMemory"}),") };\n          },\n          ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"mount"'}),",\n        );\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"unmount"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"id"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(\n          ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"state"}),") =>"]})," {\n            state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ElementsInMemory"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"delete"}),"(id);\n            ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"(state.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ElementsInMemory"}),") };\n          },\n          ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"unmount"'}),",\n        );\n      },\n    })),\n  );\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"zustand store 방식으로 함으로써 mount, unmount 관련된 로직을 store에 숨길수 있게 되었다. (로직 분리 굳)"}),"\n",(0,sa.jsx)(e.h6,{children:"트러블 슈팅"}),"\n",(0,sa.jsx)(e.p,{children:"짧은 트러블 슈팅으로는 zustand에서는 shallow equal을 사용하여 상태의 변화를 감지하는데 delete만 지워서 리렌더링이 막 일어나게 되었었다."}),"\n",(0,sa.jsx)(e.p,{children:"데이터 변경시 return으로 새로운 Map을 넣어줘야 리렌더링이 정상적으로 일어난다."}),"\n",(0,sa.jsx)(e.h5,{children:"OverlayStoreProvider"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStore"}),",\n  createOverlayStore,\n  initOverlayStore,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/stores/modal-store"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Fragment"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropsWithChildren"}),",\n  createContext,\n  useContext,\n  useRef,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useStoreWithEqualityFn } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"zustand/traditional"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStoreApi"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReturnType"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," createOverlayStore>;\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStoreContext"})," = createContext<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStoreApi"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),">(\n  ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n);\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"OverlayStoreProvider"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ children }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropsWithChildren"})]}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," storeRef = useRef<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStoreApi"}),">();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!storeRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"}),") {\n    storeRef.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createOverlayStore"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"initOverlayStore"}),"());\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayStoreContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{storeRef.current}"}),">"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"OverlayStoreContext.Provider"}),">"]})]}),"\n  );\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"OverlayProvider"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ElementsInMemory"})," = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useOverlayStore"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"store"}),") =>"]})," store.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ElementsInMemory"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      {[...ElementsInMemory.entries()].map(([id, element]) => (\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Fragment"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{id}"}),">"]}),"{element}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Fragment"}),">"]}),"\n      ))}\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," useOverlayStore = <T,>(\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"selector"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"store"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStore"})]}),") =>"]})," T,\n): ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"T"})," =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," overlayStoreContext = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useContext"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"OverlayStoreContext"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!overlayStoreContext) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"`useModalStore must be used within ModalStoreProvider`"}),");\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useStoreWithEqualityFn"}),"(overlayStoreContext, selector);\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"OverlayStore와 연결된 컴포넌트입니다. 쌓임 맥락을 해결하기 위해서 main 아래에 놓아야합니다."}),"\n",(0,sa.jsx)(e.p,{children:"Map의 entries로 Map을 전개해서 안에 있는 컴포넌트들을 꺼내주는데 순차적으로 렌더링되기 때문에 뒤에 구현되는 컴포넌트가 쌓임 맥락에서 이기게 되어 덮어써지게 됩니다."}),"\n",(0,sa.jsx)(e.h5,{children:"useCustomOverlay"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useOverlayStore } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/providers/modal-store-provider"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useId, useMemo } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./types"'}),";\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * Zustand와 결합하여 루트 아래에 컴포넌트를 렌더링하는 훅입니다.\n * close를 prop으로 받는 컴포넌트를 렌더링합니다.\n * Modal 컴포넌트와 같이 close 함수를 prop으로 받는 컴포넌트를 만들어서 넣어주시면 됩니다.\n * 해당 컴포넌트는 루트 아래로 띄워주기만 합니다. \n * \n * 모달 안에 다른 CustomOverlay를 만들어서 모달을 하나 더 띄우셔도 됩니다. \n * 단,useOutSideClick은 따로 처리해주셔야 합니다.\n * \n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable",children:"overlayElement"}),"\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@returns"})," 루트 아래에 해당 컴포넌트가 렌더링됩니다.\n *  const overlay1 = useCustomOverlay(({ close }) => (\n    <Modal close={close}>\n      <Modal.HeaderWithClose />\n      <Modal.Title>제목</Modal.Title>\n      <Modal.Description>난 예시다.</Modal.Description>\n      <Modal.Description>해냈다.</Modal.Description>\n    </Modal>\n  ));\n  return (\n    <button onClick={overlay1.open}>overlay1에 넣은 컴포넌트를 여는 버튼/button>\n */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCustomOverlay"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"overlayElement"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CreateOverlayElement"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useId로 고유한 id를 생성"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," id = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useId"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," mount = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useOverlayStore"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"store"}),") =>"]})," store.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"mount"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," unmount = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useOverlayStore"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"store"}),") =>"]})," store.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"unmount"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useMemo를 사용하여 객체를 캐싱"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMemo"}),"(\n    ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ({\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"open"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"mount"}),"(id, ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"overlayElement"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unmount"}),"(id) }));\n      },\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unmount"}),"(id);\n      },\n    }),\n    [id, mount, unmount, overlayElement],\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"구현하면서 제일 맘에 들었던 useCustomOverlay입니다."}),"\n",(0,sa.jsx)(e.p,{children:"useId를 이용해서 id가 고유값을 갖도록 처리했으며 호출할 때 컴포넌트를 들고 호출하게 해서 사용하는 단에서는"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," modalSendEmailOverlay = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCustomOverlay"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ close }"}),") =>"]})," (\n\xa0 \xa0 ",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ModalSendEmail"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{close}"})," />"]})}),"\n\xa0 ));\n\xa0",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\nonClick={modalSendEmailOverlay.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"open"}),"} \xa0 \xa0\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"open이라는 메소드만 사용하면 렌더링시킬 수 있도록 하였습니다."}),"\n",(0,sa.jsx)(e.p,{children:"이제 동료 개발자는 세가지 과정만 거치면 오버레이를 관리할 수 있게 된 것입니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"화면을 띄울 컴포넌트 조립 (오버레이를 닫는 close라는 프롭을 가져야 합니다.)"}),"\n",(0,sa.jsx)(e.li,{children:"useCustomOverlay에 담음"}),"\n",(0,sa.jsx)(e.li,{children:"인스턴스.open"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"이로써 모달뿐만 아니라 사이드바, 토스트에도 넣을 수 있는 만능 훅을 구현했다!!!!!"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"++ 2024-11-29"}),"\n",(0,sa.jsxs)(e.p,{children:["돌이켜보면 이 방식은 ",(0,sa.jsx)(e.code,{children:"useOverlay"}),"의 기능을 너무 많이 줄인 방식입니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["toss의 useOverlay에서는 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 활용해서 모달을 여는 함수가 아닌 특정 동작을 하는 핸들링 함수로 모달을 동시에 핸들링할 수 있습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-jsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// purchase 모달을 여는 함수가 아닌 purchase라는 동작을 관리하는 함수"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," handlePurchase = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," () => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," isOk = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," {\n    overlay.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"open"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ close, isOpen }"}),") =>"]})," (\n      ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"PurchaseModal"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handleCancel"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{()"})," =>"]})," {\n          resolve(false);\n          close();\n        }}\n        handleConfirm={() => {\n          resolve(true);\n          close();\n        }}\n        isOpen={isOpen}\n      />"]}),"\n    ));\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (isOk) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"결제가 완료되었습니다."'}),");\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"결제가 취소되었습니다."'}),");\n  }\n}, [overlay]);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이는 선언적으로 프로그래밍을 할 수 있게 하여 가독성이나 확장성 측면에서 훨씬 좋은 방식입니다. 이는 프로덕트가 커질 수록 더 빛을 낼 것입니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Compound Pattern + useCustomOverlay 예제 (공통 모달 컴포넌트)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalContextType"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalContext"})," = createContext<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalContextType"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalProps"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"closeOnFocusOut"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"boolean"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"children"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n}\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * 모달 컴포넌트\n *\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@description"})," 컴파운드 패턴으로 만들어졌으며 useCustomOverlay의 인수로써 함께 사용하시면 됩니다.\n * 각 요소들은 margin이 정해져 있지 않습니다. className으로 지정해서 조합해서 사용하시면 됩니다.\n *\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," close 모달을 끄는 함수\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," children 모달 내부\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," closeOnFocusOut 화면 밖 클릭시 모달을 끄는 여부\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@example"}),'\n * ```tsx\n  export function ModalWarning({ handleConfirm, close }: ModalWarningProps) {\n    const handleClick = async () => {\n      await handleConfirm();\n      close();\n    };\n    return (\n      <Modal close={close} closeOnFocusOut>\n        <header className="flex justify-center pb-4 pt-6">\n          <Alert width={24} height={24} />\n        </header>\n        <div className="mx-12 text-center md:mx-9">\n          <Modal.Title className="mb-2 text-slate-50 md:text-text-primary">\n            회원 탈퇴를 진행하시겠어요?\n          </Modal.Title>\n          <Modal.Description className="mb-4">\n            그룹장에 있는 모든 그룹은 삭제되고, 모든 그룹에서 나가집니다.\n          </Modal.Description>\n          <Modal.TwoButtonSection\n            closeBtnStyle="outlined_secondary"\n            confirmBtnStyle="danger"\n            buttonDescription="회원 탈퇴"\n            onClick={handleClick}\n            close={close}\n          />\n        </div>\n      </Modal>\n    );\n  }\n */']}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Modal"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  children,\n  close,\n  closeOnFocusOut,\n  className,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ModalProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," modalRef = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useClickOutside"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"close"}),"();\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// eslint-disable-next-line react/jsx-no-constructed-context-values"}),"\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ModalContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"})," }}>"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cn(overlayVariants())}"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"motion.div"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"animate"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"opacity:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"y:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"0"})," }}\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"initial"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"opacity:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"y:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"100"})," }}\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"transition"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"duration:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"0.1"})," }}\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cn(modalVariants({"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"})," }))}\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ref"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"closeOnFocusOut"}),"\n              ? (",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"modalRef"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"as"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"LegacyRef"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"HTMLDivElement"}),">"]})," | undefined)\n              : null\n          }\n        >\n          {children}\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"motion.div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ModalContext.Provider"}),">"]}),'\n  );\n}\n//...\nexport function useModal() {\n  const context = useContext(ModalContext);\n\n  if (!context) {\n    throw new Error("useModal must be used within a ModalProvider");\n  }\n\n  return context;\n}\n//...\nfunction HeaderWithClose({ className }: HeaderWithCloseProps) {\n  const { close } = useModal();\n  return (\n    ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{headerWithCloseVariants({"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"})," })}>"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"button"'})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{close}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"aria-label"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"닫기"'}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"CloseButton"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"rounded-xl duration-100 hover:scale-105"'}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"width"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{24}"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"height"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{24}"}),"\n        />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"button"}),">"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"}),">"]}),'\n  );\n}\nHeaderWithClose.displayName = "Modal.HeaderWithClose";\n']})]})}),"\n",(0,sa.jsx)(e.p,{children:"useCustomOverlay 분석에서 이야기 했듯이 마운트, 언마운트 관련 애니메이션 처리는 컴포넌트 내부에 구현되어져 있는 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"이번 프로젝트에서는 비슷한 내부 요소를 가진 모달이 다양하게 있기 때문에 compound pattern으로 구성 요소들도 구현하였습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"compound pattern이란 프론트엔드 환경에서 사용되는 디자인 패턴 중에 하나로,\ncontext api를 이용해서 내부 상태가 구현된 하나의 컴포넌트만 가져와서 프로퍼티 안에 있는 컴포넌트를 활용, 마치 조립하듯이 다양한 컴포넌트를 구현할 수 있는 패턴입니다.\n단, 트리 쉐이킹이 불가능하다는 단점도 갖고 있어 사용하는데 주의가 필요합니다."}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"HandleArticleModal"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  close,\n  onSubmit,\n  defaultContent,\n  defaultImage,\n  defaultTitle,\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HandleArticleModalProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { handleNext, handlePrev, isNext } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useNextPage"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [imageFile, setImageFile] = useState<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"File"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," handleImageFile = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"selectedImageFile"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"File"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})]}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setImageFile"}),"(selectedImageFile);\n  }, []);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"usePreventScroll"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Modal"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{close}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"closeOnFocusOut"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{false}"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Modal.HeaderWithClose"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"fixed right-7 top-7"'})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"relative"'}),">"]}),"\n        {isNext ? (\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ArticleForm"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"file"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{imageFile}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handlePrev"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handlePrev}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handlePost"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{onSubmit}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultContent"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{defaultContent}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultTitle"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{defaultTitle}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultImage"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{defaultImage}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"close"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{close}"}),"\n          />"]}),"\n        ) : (\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"FileDragDown"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"file"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{imageFile}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSelect"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleImageFile}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"defaultPreview"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{defaultImage}"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handleNext"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleNext}"}),"\n          />"]}),"\n        )}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Modal"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이를 활용한 모달 조립 예시입니다. 조립하는 쪽에서는 모달을 구현하는 내부 로직, 스타일을 알 필요 없이 Modal안에 컴포넌트와 필요한 로직을 넣기만 하면 구현되는 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/%EA%B2%8C%EC%8B%9C%EA%B8%80%20%EC%B6%94%EA%B0%80.gif",alt:""})}),"\n",(0,sa.jsx)(e.h1,{children:"후기"}),"\n",(0,sa.jsx)(e.p,{children:"좋은 문제 상황을 만나서 이번에 toss slash의 훅을 분석하는 시간을 가질 수 있게 되었다."}),"\n",(0,sa.jsx)(e.p,{children:"requestAnimateFrame이나 useImperative 훅 등 분석하지 않았다면 몰랐을 지식들을 많이 알게된 경험이었다."}),"\n",(0,sa.jsx)(e.p,{children:"이번 useOverlay는 다른 오픈 소스 라이브러리에 비하면 작은 크기이지만"}),"\n",(0,sa.jsx)(e.p,{children:"추후에 좋은 문제를 만나면 이제 두려움 없이 커다란 오픈 소스라도 분석할 수 있을 것 같다."}),"\n",(0,sa.jsx)(e.p,{children:"더 성장해보자"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://github.com/772-company/kkom-kkom/pull/80",children:"https://github.com/772-company/kkom-kkom/pull/80"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"꼼꼼 프로젝트 진행 중에 겪은 경험들입니다. 오늘도 많이 성장한 것 같아요!"}),"\n",(0,sa.jsx)(e.p,{children:"읽어주셔서 감사합니다! 지켜봐주세요!"}),"\n",(0,sa.jsx)(e.p,{children:"감사합니다."}),"\n"]})]})}function eD(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eL,{...s})}):eL(s)}function eB(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"Background"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/progressbar%20%EC%98%88%EC%8B%9C.gif",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"The picture above is a Codeit site made with Next.js."}),"\n",(0,sa.jsx)(e.p,{children:"You can see that when you click a tab element, which is a Link component, the address changes and a progress bar operates."}),"\n",(0,sa.jsx)(e.p,{children:"Since the Kkom-kkom project is made with Next.js, rendering occurs frequently when URLs change. (There's also a lot of rendering related to searchParams.)"}),"\n",(0,sa.jsx)(e.p,{children:"I thought that adding a progress bar would greatly improve UX and started thinking about it."}),"\n",(0,sa.jsx)(e.h1,{children:"Implementation"}),"\n",(0,sa.jsx)(e.p,{children:"Next doesn't expose router events externally, making it very difficult to implement loading that occurs when changing pages."}),"\n",(0,sa.jsx)(e.p,{children:"I found a simple library that solved this, but I wanted to know the actual operation process, so I started researching focusing on actually implemented code."}),"\n",(0,sa.jsx)(e.h2,{children:"Code Analysis"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://buildui.com/posts/global-progress-in-nextjs",children:"https://buildui.com/posts/global-progress-in-nextjs"})}),"\n",(0,sa.jsx)(e.p,{children:"I analyzed the post above."}),"\n",(0,sa.jsx)(e.h3,{children:"layout.tsx"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// layout.tsx"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ProgressBarLink"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ProgressBar"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./progress-bar"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Layout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children }: { children: ReactNode }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBar"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"fixed top-0 h-1 bg-sky-500"'})," />"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"border-b border-gray-700"'}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"nav"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"m-4 flex gap-4"'}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/demo-1"'}),">"]}),"Home",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/demo-1/posts/1"'}),">"]}),"Post 1",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/demo-1/posts/2"'}),">"]}),"Post 2",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/demo-1/posts/3"'}),">"]}),"Post 3",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"nav"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"}),">"]}),"\n\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"m-4"'}),">"]}),"{children}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBar"}),">"]})]}),"\n    </div>\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"progress-bar"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// progress-bar"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AnimatePresence"}),",\n  motion,\n  useMotionTemplate,\n  useSpring,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"framer-motion"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Link"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/link"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useRouter } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/navigation"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ComponentProps"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),",\n  createContext,\n  startTransition,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Specify global state with createContext"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ProgressBarContext"})," = createContext<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReturnType"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," useProgress> | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(\n  ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Want to connect and use with useProgress using a hook called useProgressBar."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgressBar"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," progress = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useContext"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ProgressBarContext"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (progress === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Need to be inside provider"'}),");\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," progress;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Progress Bar component itself"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"ProgressBar"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  className,\n  children,\n}: {\n  className: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  children: ReactNode;\n}"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Use useProgress"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," progress = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgress"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useMotionTemplate: Hook that makes multiple motion values into one motion value"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Here, it's made to extend like width: ~%. Internally, when progress.value becomes 100, it's complete"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," width = useMotionTemplate",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${progress.value}"}),"%`"]}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{progress}"}),">"]}),"\n      // progress.reset when animations of all existing nodes are complete //\n      AnimatePresence detects that progress.state is complete and can execute exit animation // After that, reset function is executed.\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AnimatePresence"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onExitComplete"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{progress.reset}"}),">"]}),'\n        // Get mounting state from progress\n        {progress.state !== "complete" && (\n          ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"motion.div"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"width"})," }}\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"opacity:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"0"})," }}\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{className}"}),"\n          />"]}),"\n        )}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AnimatePresence"}),">"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarContext.Provider"}),">"]})]}),"\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Link component that will be linked with ProgressBar"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"ProgressBarLink"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  href,\n  children,\n  ...rest\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ComponentProps"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Link"}),">"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Extract useProgress from context."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," progress = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgressBar"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," router = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRouter"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{href}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{(e)"})," =>"]})," {\n        // Delete default behavior.\n        e.preventDefault();\n        // Make progress in-progress state.\n        progress.start();\n        startTransition(() => {\n          // Change router.push to latest rendering. If you press something else in the middle, it can be immediately cancelled.\n          router.push(href.toString());\n          // router.push has void as return value and there's no way to know if the function is in progress. For this, transition is used.\n          // startTransition makes functions inside update all at once without UI rendering.\n          // Through this, router.push and progress.done update at once.\n\n          // When clicked, state change of progress.start happens immediately but state change of progress.done proceeds only after router.push ends.\n          // You can think of it as async in the state world.\n\n          // When push ends, end progress with done. (If initial or in-progress, make it complete.)\n          progress.done();\n        });\n      }}\n      {...rest}\n    >\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),">"]})]}),"\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useProgress (main body)"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgress"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Current state"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [state, setState] = useState<\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'}),"\n  >(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Put animation value with Spring."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," value = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useSpring"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Force applied to opposite side"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"damping"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"25"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Degree of inertia"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mass"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0.5"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Degree of sudden movement"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"stiffness"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"300"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If distance is lower than this, end animation."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"restDelta"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0.1"}),",\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Hook that executes callback function with interval"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInterval"}),"(\n    ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Start progress but if bar is complete state, do reset first."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"() === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Stop by making motionValue 0."}),"\n        value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"jump"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n      }\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get motionValue"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," current = value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"();\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Degree of change?"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," diff;\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If 0, move 15 at once"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (current === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),") {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"15"}),";\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When 50 or less, move quickly"}),"\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (current < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"50"}),") {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rand"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10"}),");\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If exceeded, move 1 to 5."}),"\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rand"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),");\n      }\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add to motionValue (max 99)"}),"\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(current + diff, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"99"}),"));\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If in-progress state, delay (time interval) is 750 (0.75s), otherwise remove"}),"\n    state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'})," ? ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"750"})," : ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  );\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If initial, make it 0"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),") {\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"jump"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If completing, go to 100."}),"\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'}),") {\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),");\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When value changes, if latest is 100, make it complete state."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"on"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"change"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"latest"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// on event can get motionValue. latest is motionValue"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (latest === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'}),");\n      }\n    });\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// value, state, event handler called value.on disappears every time component unmounts."}),"\n  }, [value, state]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reset"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Make it initial"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),");\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"start"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Make it start"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'}),");\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"done"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Function that makes it completing if initial or in-progress, otherwise returns to original state"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setState"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"state"}),") =>"]}),"\n      state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'})," || state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'})," ? ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'})," : state,\n    );\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { state, value, start, done, reset };\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Function that randomly extracts one positive number between max and min"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rand"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"min"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"max"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"floor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"random"}),"() * (max - min + ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),")) + min;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useInterval: Function that gives interval if callback and delay are received"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInterval"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"callback"}),": () => ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"delay"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Closure that stores callback"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," savedCallback = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRef"}),"(callback);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Function that changes callback"}),"\n    savedCallback.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"})," = callback;\n  }, [callback]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Function that executes callback stored in ref"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"tick"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n      savedCallback.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"current"}),"();\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (delay !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Execute once"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"tick"}),"();\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Turn on timer"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," id = ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setInterval"}),"(tick, delay);\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Delete timer when unmounting"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"clearInterval"}),"(id);\n    }\n  }, [delay]);\n}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"Analysis Results"}),"\n",(0,sa.jsx)(e.p,{children:"Very complex code came out, but in conclusion, it seems to start with the idea that progress bar doesn't have to be related to actual loading percentage."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Progress bar immediately goes to 15 when operating."}),"\n",(0,sa.jsx)(e.li,{children:"After that, progress bar is randomly filled from 15 to 99."}),"\n",(0,sa.jsx)(e.li,{children:"When it becomes 99, router.push and progress bar unmount simultaneously using startTransition."}),"\n",(0,sa.jsx)(e.li,{children:"When progress bar unmounts, component remains until animation ends using Framer-Motion's AnimatePresense. > Smooth unmount is achieved."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Here, the part where progress bar unmount logic was put together with router.push using concurrent rendering with startTransition was very impressive."}),"\n",(0,sa.jsx)(e.p,{children:"Analysis is complete, so now let's find a way to utilize it."}),"\n",(0,sa.jsx)(e.p,{children:"Things to refactor for our project are as follows."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Since we have our own LinkButton, we should make refactoring easy by not creating Link separately and receiving logic from hook and passing it down. => Create separately as hook, hide internal logic"}),"\n",(0,sa.jsx)(e.li,{children:"I'll make state management readable using useReducer."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Refactoring Results"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { rand } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/utils/get-rand"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useSpring } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"framer-motion"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { startTransition, useEffect, useReducer, useRef } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," useInterval ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./use-interval"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"StateType"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ActionType"})," =\n  | { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"start"'})," }\n  | { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"done"'})," }\n  | { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"reset"'})," }\n  | { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'})," };\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reducer"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"state"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"StateType"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"action"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ActionType"})]}),"): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"StateType"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"switch"})," (action.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"type"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"case"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"start"'}),":\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"case"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"done"'}),":\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'})," || state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'}),"\n        ? ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'}),"\n        : state;\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"case"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"reset"'}),":\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"case"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'}),":\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"default"}),":\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Unhandled action type"'}),");\n  }\n}\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@description"}),'\n * Hook containing progress internal logic.\n *\n * If you want to create a component (view) that displays like progress bar, you can use state, value, reset.\n * Please refer to progress bar for detailed implementation\n *\n * If you want to create a component connected to a component like progress bar, you can use the progress function of "useProgressBar" instead of this hook.\n *\n * ',(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@example"}),"\n * export function ProgressBar({\n  className,\n  children,\n}: {\n  className: string;\n  children: ReactNode;\n}) {\n  // Use useProgress\n  let progress = useProgress();\n  // useMotionTemplate: Hook that makes multiple motion values into one motion value\n  // Here, it's made to extend like width: ~%. Internally, when progress.value becomes 100, it's complete\n  let width = useMotionTemplate`${progress.value}%`;\n\n  return (\n    <ProgressBarContext.Provider value={progress}>\n      <AnimatePresence onExitComplete={progress.reset}>\n        {progress.state !== \"complete\" && (\n          <motion.div\n            style={{ width }}\n            exit={{ opacity: 0 }}\n            className={className}\n          />\n        )}\n      </AnimatePresence>\n      {children}\n    </ProgressBarContext.Provider>\n  );\n}\n *\n */"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgress"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Current state"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [state, dispatch] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useReducer"}),"(reducer, ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Put animation value with Spring."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," value = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useSpring"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Force applied to opposite side"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"damping"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"25"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Degree of inertia"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mass"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0.5"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Degree of sudden movement"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"stiffness"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"300"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If distance is lower than this, end animation."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"restDelta"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0.1"}),",\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Hook that executes callback function with interval"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInterval"}),"(\n    ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Start progress but if bar is complete state, do reset first."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"() === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Stop by making motionValue 0."}),"\n        value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"jump"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get motionValue"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," current = value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Degree of change?"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," diff;\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If 0, move 15 at once"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (current === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),") {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"15"}),";\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When 50 or less, move quickly"}),"\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (current < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"50"}),") {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rand"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10"}),");\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If exceeded, move 1 to 5."}),"\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rand"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),");\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add to motionValue (max 99)"}),"\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(current + diff, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"99"}),"));\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If in-progress state, delay (time interval) is 750 (0.75s), otherwise remove"}),"\n    state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'})," ? ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"750"})," : ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  );\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," unsubscribe = value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"on"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"change"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"latest"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (latest === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dispatch"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'})," });\n      }\n    });\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If initial, make it 0"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),") {\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"jump"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If completing, go to 100."}),"\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'}),") {\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),");\n    }\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unsubscribe"}),"();\n    };\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When value changes, if latest is 100, make it complete state."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// value, state changes, event handler called value.on disappears every time component unmounts."}),"\n  }, [value, state]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleProgress"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"func"}),": () => ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"})]}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dispatch"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"start"'})," });\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startTransition"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"func"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dispatch"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"done"'})," });\n    });\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n    state,\n    value,\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"reset"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dispatch"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"reset"'})," }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"progress"}),": handleProgress,\n  };\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"To summarize:"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"useProgress hook passed down to view components like Progress Bar that display loading used flux pattern with useReducer to hide detailed state management and improve readability."}),"\n",(0,sa.jsx)(e.li,{children:"From pattern where start and done were separated and usage side had to directly implement startTransition, it became hidden in useProgress hook."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"On the usage side:"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Link"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"LinkProps"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/link"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useRouter } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/navigation"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MouseEventHandler"}),", useCallback } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useProgressBar } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../progress-bar/progress-bar"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"LinkWithProgressProps"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"extends"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"LinkProps"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"LinkWithProgress"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  href,\n  className,\n  children,\n  ...props\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"}),".",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropsWithChildren"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"LinkWithProgressProps"}),">"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { progress } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgressBar"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," router = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRouter"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handleClick"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MouseEventHandler"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HTMLAnchorElement"}),"> = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"e"}),") =>"]})," {\n      e.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"preventDefault"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"progress"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," router.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(href.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toString"}),"()));\n    },\n    [href, progress, router],\n  );\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{href}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleClick}"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...props"}),"}>"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"By just passing a callback to progress, it can be connected to progress Bar."}),"\n",(0,sa.jsx)(e.p,{children:"If we add progress to existing LinkButton, it's as follows."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"LinkButton"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  href,\n  children,\n  btnStyle,\n  btnSize,\n  className,\n  ...rest\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"LinkButtonProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { progress } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgressBar"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," router = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRouter"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handleClick"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MouseEventHandler"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HTMLAnchorElement"}),"> = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"e"}),") =>"]})," {\n      e.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"preventDefault"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"progress"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," router.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(href.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toString"}),"()));\n    },\n    [href, progress, router],\n  );\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{href}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cn(buttonVariants({"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnStyle"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnSize"})," }))}\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleClick}"}),"\n      {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...rest"}),"}\n    >"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"I saw a technique for the first time where state changes can proceed together with other functions using startTransition like async await, and I think I'll use it often!"}),"\n",(0,sa.jsx)(e.p,{children:"While refactoring to handle state management with flux pattern using useReducer, I felt the code becoming concise, and after directly feeling it,"}),"\n",(0,sa.jsx)(e.p,{children:"I understood why techniques implemented using flux patterns like useReducer or zustand are used when complex logic appears."}),"\n",(0,sa.jsx)(e.p,{children:"As always, I think all technologies are well remembered when you look for them to solve your own problems. I learned a lot this time too."}),"\n",(0,sa.jsx)(e.h3,{children:"It wasn't the end..."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/progress%20bar%20%EB%A6%AC%EB%A0%8C%EB%8D%94%EB%A7%81%20%EC%97%90%EB%9F%AC.gif",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Re-rendering error hehe... I checked because it was too slow..."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240818002733.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Components that receive progress function are also re-rendering due to progress bar"}),"\n",(0,sa.jsx)(e.p,{children:"useContext is a hook that injects state, so it re-renders child components in addition to things connected to state."}),"\n",(0,sa.jsx)(e.p,{children:"Progress bar is a component whose state changes frequently and is at the top level, causing re-rendering."}),"\n",(0,sa.jsx)(e.p,{children:'I tried to solve this by using zustand to "manage" state, but'}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://github.com/pmndrs/zustand/discussions/885",children:"https://github.com/pmndrs/zustand/discussions/885"})}),"\n",(0,sa.jsx)(e.p,{children:"It says that zustand using useSyncExternalStore is not compatible with startTransition without additional setup."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240828114258.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"I found that the zustand developer made a custom hook."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://www.npmjs.com/package/use-zustand",children:"https://www.npmjs.com/package/use-zustand"})}),"\n",(0,sa.jsx)(e.p,{children:"I used this, but since it's combining with a method connected using Next.js and context api, it didn't seem to be the exception handling the developer had conceived."}),"\n",(0,sa.jsx)(e.p,{children:"I thought of a different method rather than using context api to create re-rendering or using zustand to create an incomplete loading bar."}),"\n",(0,sa.jsx)(e.p,{children:"Then I confirmed a library called next-nprogress-bar in existing sites using Next.js."}),"\n",(0,sa.jsx)(e.p,{children:"This wasn't a method using startTransition. I'll try it."}),"\n",(0,sa.jsx)(e.h2,{children:"next-nprogress-bar"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"pnpm install next-nprogress-bar\n"})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AppProgressBar"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"as"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ProgressBar"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next-nprogress-bar"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Providers"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children }: { children: React.ReactNode }"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      {children}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBar"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"height"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"4px"'}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"#fffd00"'}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"options"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"showSpinner:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"false"})," }}\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shallowRouting"}),"\n      />"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Providers"}),";\n"]})}),"\n",(0,sa.jsx)("s",{children:"It's really unfair how easy it is ㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠ"}),"\n",(0,sa.jsx)(e.p,{children:"It seemed to work by styling the html itself. I think I spent too much time on this, so I should definitely analyze the library next time."}),"\n",(0,sa.jsx)(e.p,{children:"Now it says that if you don't put special options in Link itself, progress bar operates automatically."}),"\n",(0,sa.jsx)(e.h3,{children:"Troubleshooting"}),"\n",(0,sa.jsx)(e.p,{children:"In Next.js, there's a lot of component rendering according to SearchParams."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240914151931.png",alt:""}),"\n(Example of free board page that sorts differently according to searchParams)"]}),"\n",(0,sa.jsx)(e.p,{children:"It would be more natural if progress bar appears even when changing sort criteria from popular to latest."}),"\n",(0,sa.jsx)(e.p,{children:"However, next-nprogress-bar wasn't implementing this."}),"\n",(0,sa.jsx)(e.p,{children:"Therefore, I solved this problem using useEffect."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AppProgressBar"}),", startProgress } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next-nprogress-bar"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useSearchParams } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/navigation"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),", useEffect } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"ProgressBarProvider"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{\n  children,\n}: {\n  children: ReactNode;\n}"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," searchParams = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useSearchParams"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startProgress"}),"();\n  }, [searchParams]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      {children}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AppProgressBar"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"height"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"4px"'}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"#10b981"'}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"options"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"showSpinner:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"false"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"minimum:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"0.15"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"easing:"}),' "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ease"}),'",\n          ',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"speed:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"500"}),",\n        }}\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shallowRouting"}),"\n      />"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n}\n\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Now you can confirm that progress bar moves even when sorting."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/progressbar%EA%B2%8C%EC%8B%9C%ED%8C%90.gif",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"Afterword"}),"\n",(0,sa.jsx)(e.p,{children:"I learned what ideas are for implementing progress bar and how it's implemented in Next.js."}),"\n",(0,sa.jsx)(e.p,{children:"Although it was applied to the project using a library, I learned a lot while analyzing code implemented through concurrent rendering in that process."}),"\n",(0,sa.jsx)(e.p,{children:"I'll grow more."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"These are experiences I had during the Kkom-kkom project. I think I grew a lot today too!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you for reading! Please watch over me!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you."}),"\n"]})]})}function eF(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eB,{...s})}):eB(s)}function eU(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"배경"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/progressbar%20%EC%98%88%EC%8B%9C.gif",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"위의 사진은 Next.js로 만든 코드잇 사이트입니다."}),"\n",(0,sa.jsx)(e.p,{children:"Link 컴포넌트인 탭 요소를 누르면 주소가 바뀌면서 progress bar가 동작하는 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"꼼꼼 프로젝트는 Next.js로 만들어졌기 때문에 url이 변경되면서 렌더링이 일어나는 경우가 많다. (searchParams와 관련된 렌더링도 많다.)"}),"\n",(0,sa.jsx)(e.p,{children:"이때 progress bar를 추가하면 UX가 크게 향상될 것이라고 생각하고 고민을 시작했습니다."}),"\n",(0,sa.jsx)(e.h1,{children:"구현"}),"\n",(0,sa.jsx)(e.p,{children:"Next는 router event를 외부에 노출시키지 않아서 페이지 바꿀 때 로딩 생기는 걸 구현하는게 매우 어렵다."}),"\n",(0,sa.jsx)(e.p,{children:"이를 해결한 간단한 라이브러리도 찾았으나 실제 동작 과정을 알고 싶어서 실제로 구현된 코드를 위주로 연구를 시작했습니다."}),"\n",(0,sa.jsx)(e.h2,{children:"코드 분석"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://buildui.com/posts/global-progress-in-nextjs",children:"https://buildui.com/posts/global-progress-in-nextjs"})}),"\n",(0,sa.jsx)(e.p,{children:"위의 포스팅을 분석해보았다."}),"\n",(0,sa.jsx)(e.h3,{children:"layout.tsx"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// layout.tsx"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ProgressBarLink"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ProgressBar"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./progress-bar"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Layout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children }: { children: ReactNode }"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBar"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"fixed top-0 h-1 bg-sky-500"'})," />"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"border-b border-gray-700"'}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"nav"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"m-4 flex gap-4"'}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/demo-1"'}),">"]}),"Home",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/demo-1/posts/1"'}),">"]}),"Post 1",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/demo-1/posts/2"'}),">"]}),"Post 2",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"}),">"]}),"\n            ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/demo-1/posts/3"'}),">"]}),"Post 3",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarLink"}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"nav"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"}),">"]}),"\n\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"m-4"'}),">"]}),"{children}",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"div"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBar"}),">"]})]}),"\n    </div>\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"progress-bar"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// progress-bar"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AnimatePresence"}),",\n  motion,\n  useMotionTemplate,\n  useSpring,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"framer-motion"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Link"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/link"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useRouter } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/navigation"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ComponentProps"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),",\n  createContext,\n  startTransition,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// createContext로 전역 상태 지정"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ProgressBarContext"})," = createContext<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReturnType"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," useProgress> | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),">(\n  ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useProgressBar 라는 훅으로 useProgress와 연결해서 사용하고자 함."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgressBar"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," progress = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useContext"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ProgressBarContext"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (progress === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Need to be inside provider"'}),");\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," progress;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Progress Bar 컴포넌트 그 자체"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"ProgressBar"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  className,\n  children,\n}: {\n  className: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n  children: ReactNode;\n}"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useProgress 사용"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," progress = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgress"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useMotionTemplate: 여러 motion value를 하나의 motion value로 만드는 훅"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 여기서는 width: ~% 이런식으로 길어지게 만들어 놓음. 내부적으로 progress.value가 100이 되면 complete임"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," width = useMotionTemplate",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${progress.value}"}),"%`"]}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarContext.Provider"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"value"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{progress}"}),">"]}),"\n      // 존재하는 모든 노드의 애니메이션이 완료되면 progress.reset //\n      AnimatePresence가 progress.state가 complete된걸 감지해서 exit 애니메이션을\n      실행시킬 수 있게 해주고 // 이후에 reset 함수가 실행됩니다.\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AnimatePresence"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onExitComplete"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{progress.reset}"}),">"]}),'\n        // 마운트시키는 상태를 progress에서 가져옴\n        {progress.state !== "complete" && (\n          ',(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"motion.div"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"style"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"width"})," }}\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"exit"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"opacity:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"0"})," }}\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{className}"}),"\n          />"]}),"\n        )}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AnimatePresence"}),">"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBarContext.Provider"}),">"]})]}),"\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ProgressBar와 연동될 링크 컴포넌트"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"ProgressBarLink"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  href,\n  children,\n  ...rest\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ComponentProps"}),"<",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Link"}),">"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useProgress를 context에서 꺼낸다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," progress = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgressBar"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," router = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRouter"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{href}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{(e)"})," =>"]})," {\n        // 기본 동작을 삭제합니다.\n        e.preventDefault();\n        // progress를 in-progress 상태로 만듬.\n        progress.start();\n        startTransition(() => {\n          // router.push를 가장 나중 렌더링으로 바꾼다. 중간에 다른거 누르면 즉시 취소될 수 있습니다.\n          router.push(href.toString());\n          // router.push는 void가 리턴값이며 함수가 진행중인지 알 수 있는 방법이 없다. 이를 위해 transition을 사용합니다.\n          // startTransition은 내부의 함수들이 UI 렌더링 없이 한번에 업데이트 되게 해준다.\n          // 이를 통해 router.push와 progress.done은 한번에 업데이트 되게 됩니다.\n\n          // 클릭시 progress.start라는 상태 변화는 바로 일어나지만 progress.done이라는 상태 변화는 router.push가 끝나야 진행됩니다.\n          // 상태 계의 async라고 보면 될 것 같다.\n\n          // push가 끝나면 done으로 progress를 끝낸다. (initial이거나 in-progress면 complete으로 만듬.)\n          progress.done();\n        });\n      }}\n      {...rest}\n    >\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),">"]})]}),"\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useProgress (본체)"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgress"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 현재 상태"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [state, setState] = useState<\n    ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'}),"\n  >(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Spring으로 애니메이션 value 넣음."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," value = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useSpring"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 반대쪽에 가해지는 힘"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"damping"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"25"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 무기력해지는 정도"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mass"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0.5"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// sudden movement 정도"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"stiffness"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"300"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 거리가 이것보다 낮아지면 애니메이션을 끝낸다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"restDelta"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0.1"}),",\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// interval로 콜백함수를 실행시켜주는 훅"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInterval"}),"(\n    ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// progress를 시작하는데 bar가 complete 상태면 reset부터 합니다."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"() === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// motionValue를 0으로 만들어서 멈춘다."}),"\n        value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"jump"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n      }\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// motionValue를 가져와서"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," current = value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"();\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 바뀌는 정도인듯?"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," diff;\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 0이면 한번에 15움직이고"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (current === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),") {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"15"}),";\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 50 이하일때는 빠르게 움직이고"}),"\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (current < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"50"}),") {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rand"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10"}),");\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 초과하면 1 ~ 5까지 움직인다."}),"\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rand"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),");\n      }\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// motionValue에 추가 (최대 99)"}),"\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(current + diff, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"99"}),"));\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// in-progress 상태이면 delay (시간텀) 을 750 (0.75s) 아니면 없앰"}),"\n    state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'})," ? ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"750"})," : ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  );\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// initia이면 0으로"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),") {\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"jump"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// completing이면 100으로 간다."}),"\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'}),") {\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),");\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// value가 변화할 때 latest가 100이면 complete 상태로 만든다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"on"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"change"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"latest"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// on 이벤트는 motionValue를 가져올 수 있습니다. lastest가 motionValue임"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (latest === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'}),");\n      }\n    });\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// value, state, 컴포넌트 언마운트 시마다 value.on 이라는 이벤트 핸들러는 사라진다."}),"\n  }, [value, state]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reset"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// initial로 만듬"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),");\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"start"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// start로 만듬"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setState"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'}),");\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"done"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// initial이거나 in-progress면 completing아니면 원상태로 돌리는 함수"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setState"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"state"}),") =>"]}),"\n      state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'})," || state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'})," ? ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'})," : state,\n    );\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { state, value, start, done, reset };\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 랜덤하게 max와 min 사이에서 양수 하나를 꺼내는 함수"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rand"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"min"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"max"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"floor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"random"}),"() * (max - min + ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),")) + min;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// useInterval: callback과 delay를 받으면 interval을 주는 함수"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInterval"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"callback"}),": () => ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"delay"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// callback을 저장하는 클로저"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," savedCallback = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRef"}),"(callback);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// callback을 변경하는 함수"}),"\n    savedCallback.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"current"})," = callback;\n  }, [callback]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ref에 담긴 callback 실행하는 함수"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"tick"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n      savedCallback.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"current"}),"();\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (delay !== ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 일단 실행"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"tick"}),"();\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 타이머 켜라"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," id = ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setInterval"}),"(tick, delay);\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 언마운트 될 때 타이머 지워라"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"clearInterval"}),"(id);\n    }\n  }, [delay]);\n}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"분석 결과"}),"\n",(0,sa.jsx)(e.p,{children:"굉장히 복잡한 코드가 나왔지만 결론적으로는 progress bar가 실제 로딩 퍼센트와 관련이 없어도 된다는 아이디어로 시작되는 것 같다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"progress bar는 동작시 바로 15로 간다."}),"\n",(0,sa.jsx)(e.li,{children:"이후 progress bar는 15 부터 99까지 랜덤으로 채워진다."}),"\n",(0,sa.jsx)(e.li,{children:"99가 되었을 때 startTransition을 이용해서 router.push와 progress bar의 언마운트가 동시에 됩니다."}),"\n",(0,sa.jsx)(e.li,{children:"progress bar의 언마운트 시에 Framer-Motion의 AnimatePresense를 이용해서 언마운트되더라도 컴포넌트가 애니메이션 종료까지 남아있게 됩니다. > 부드러운 언마운트가 이루어 진다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"여기서 startTransition을 이용한 동시성 렌더링으로 progress bar가 언마운트 되는 로직을 router.push와 함께 넣어둔 부분이 굉장히 인상 깊었다."}),"\n",(0,sa.jsx)(e.p,{children:"분석은 끝났으니 이제 활용할 방법을 찾아보겠습니다."}),"\n",(0,sa.jsx)(e.p,{children:"우리 프로젝트를 리팩토링할만한 것들은 다음과 같다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"우리 만의 LinkButton이 있기 때문에 Link를 따로 만들지 않고 훅에서 로직을 받아와서 내려주는 방식으로 리팩토링이 쉽게 해줘야 합니다. => 훅으로 따로 생성, 내부 로직은 감춤"}),"\n",(0,sa.jsx)(e.li,{children:"useReducer를 이용해서 state 관리를 가독성 있게 하겠습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"리팩토링 결과"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { rand } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/utils/get-rand"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useSpring } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"framer-motion"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { startTransition, useEffect, useReducer, useRef } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," useInterval ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./use-interval"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"StateType"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'})," | ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ActionType"})," =\n  | { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"start"'})," }\n  | { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"done"'})," }\n  | { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"reset"'})," }\n  | { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'})," };\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reducer"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"state"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"StateType"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"action"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ActionType"})]}),"): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"StateType"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"switch"})," (action.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"type"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"case"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"start"'}),":\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"case"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"done"'}),":\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'})," || state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'}),"\n        ? ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'}),"\n        : state;\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"case"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"reset"'}),":\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"case"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'}),":\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"default"}),":\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Unhandled action type"'}),");\n  }\n}\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@description"}),'\n * progress 내부 로직이 담긴 훅입니다.\n *\n * progress bar와 같이 표시해주는 컴포넌트(view)를 만드시려면 state, value, reset 를 사용하시면 됩니다.\n * 자세한 구현 사항은 progress bar를 참고해주세요\n *\n * progress bar와 같은 컴포넌트와 연결되어 있는 컴포넌트를 만드시고 싶으시면 이 훅이 아닌 "useProgressBar"의\n * progress 함수를 사용하시면 됩니다.\n *\n * ',(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@example"}),'\n * export function ProgressBar({\n  className,\n  children,\n}: {\n  className: string;\n  children: ReactNode;\n}) {\n  // useProgress 사용\n  let progress = useProgress();\n  // useMotionTemplate: 여러 motion value를 하나의 motion value로 만드는 훅\n  // 여기서는 width: ~% 이런식으로 길어지게 만들어 놓음. 내부적으로 progress.value가 100이 되면 complete임\n  let width = useMotionTemplate`${progress.value}%`;\n\n  return (\n    <ProgressBarContext.Provider value={progress}>\n      <AnimatePresence onExitComplete={progress.reset}>\n        {progress.state !== "complete" && (\n          <motion.div\n            style={{ width }}\n            exit={{ opacity: 0 }}\n            className={className}\n          />\n        )}\n      </AnimatePresence>\n      {children}\n    </ProgressBarContext.Provider>\n  );\n}\n *\n */']}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgress"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 현재 상태"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," [state, dispatch] = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useReducer"}),"(reducer, ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Spring으로 애니메이션 value 넣음."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," value = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useSpring"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 반대쪽에 가해지는 힘"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"damping"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"25"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 무기력해지는 정도"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mass"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0.5"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// sudden movement 정도"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"stiffness"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"300"}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 거리가 이것보다 낮아지면 애니메이션을 끝낸다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"restDelta"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0.1"}),",\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// interval로 콜백함수를 실행시켜주는 훅"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInterval"}),"(\n    ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// progress를 시작하는데 bar가 complete 상태면 reset부터 합니다."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"() === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// motionValue를 0으로 만들어서 멈춘다."}),"\n        value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"jump"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// motionValue를 가져와서"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," current = value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 바뀌는 정도인듯?"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," diff;\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 0이면 한번에 15움직이고"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (current === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),") {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"15"}),";\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 50 이하일때는 빠르게 움직이고"}),"\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (current < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"50"}),") {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rand"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10"}),");\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 초과하면 1 ~ 5까지 움직인다."}),"\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n        diff = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"rand"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),");\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// motionValue에 추가 (최대 99)"}),"\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Math"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"min"}),"(current + diff, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"99"}),"));\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// in-progress 상태이면 delay (시간텀) 을 750 (0.75s) 아니면 없앰"}),"\n    state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"in-progress"'})," ? ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"750"})," : ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),",\n  );\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," unsubscribe = value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"on"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"change"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"latest"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (latest === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dispatch"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"complete"'})," });\n      }\n    });\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// initial이면 0으로"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"initial"'}),") {\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"jump"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// completing이면 100으로 간다."}),"\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (state === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"completing"'}),") {\n      value.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),");\n    }\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unsubscribe"}),"();\n    };\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// value가 변화할 때 latest가 100이면 complete 상태로 만든다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// value, state 변화, 컴포넌트 언마운트 시마다 value.on 이라는 이벤트 핸들러는 사라진다."}),"\n  }, [value, state]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleProgress"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"func"}),": () => ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"void"})]}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dispatch"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"start"'})," });\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startTransition"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"func"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dispatch"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"done"'})," });\n    });\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n    state,\n    value,\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"reset"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dispatch"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"type"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"reset"'})," }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"progress"}),": handleProgress,\n  };\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"정리하자면 다음과 같다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Progress Bar처럼 로딩을 표시하는 view 컴포넌트에 내려줄 useProgress 훅은 useReducer를 이용한 flux 패턴으로 세부 상태 관리는 감추어서 가독성을 높였습니다."}),"\n",(0,sa.jsx)(e.li,{children:"start, done으로 나누어져 사용하는 쪽에서 startTransition을 직접 구현해야했던 패턴에서 useProgress 훅으로 해당 훅을 숨기게 되었다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"사용하는 쪽에서는"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Link"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"LinkProps"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/link"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useRouter } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/navigation"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MouseEventHandler"}),", useCallback } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useProgressBar } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../progress-bar/progress-bar"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"interface"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"LinkWithProgressProps"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"extends"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"LinkProps"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"LinkWithProgress"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  href,\n  className,\n  children,\n  ...props\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"React"}),".",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PropsWithChildren"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"LinkWithProgressProps"}),">"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { progress } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgressBar"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," router = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRouter"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handleClick"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MouseEventHandler"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HTMLAnchorElement"}),"> = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"e"}),") =>"]})," {\n      e.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"preventDefault"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"progress"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," router.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(href.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toString"}),"()));\n    },\n    [href, progress, router],\n  );\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{href}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleClick}"})," {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...props"}),"}>"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"progress에 콜백을 넘기는 것 만으로도 progress Bar와 연결될 수 있게 되었다."}),"\n",(0,sa.jsx)(e.p,{children:"기존 LinkButton 에 progress를 추가해보면 다음과 같다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//..."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"LinkButton"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{\n  href,\n  children,\n  btnStyle,\n  btnSize,\n  className,\n  ...rest\n}: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"LinkButtonProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { progress } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useProgressBar"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," router = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useRouter"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"handleClick"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MouseEventHandler"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HTMLAnchorElement"}),"> = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useCallback"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"e"}),") =>"]})," {\n      e.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"preventDefault"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"progress"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," router.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(href.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toString"}),"()));\n    },\n    [href, progress, router],\n  );\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"href"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{href}"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{cn(buttonVariants({"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnStyle"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"btnSize"})," }))}\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onClick"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{handleClick}"}),"\n      {",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"...rest"}),"}\n    >"]}),"\n      {children}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Link"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"상태 변화를 다른 함수와 함께 진행시킬 수 있는 startTransition으로 async await 처럼 사용하는 기법을 처음 보게 되었는데 자주 사용하게 될 것 같다!"}),"\n",(0,sa.jsx)(e.p,{children:"useReducer를 활용한 flux 패턴으로 상태 관리를 처리하는 리팩토링을 진행하면서 코드가 간결해지는 것을 느꼈고 직접 느껴보니"}),"\n",(0,sa.jsx)(e.p,{children:"복잡한 로직이 나올 때 useReducer나 zustand 같은 flux 패턴을 사용하여 구현된 기법을 사용하는 이유를 알게 되었다."}),"\n",(0,sa.jsx)(e.p,{children:"늘 느끼지만 모든 기술이 자신의 문제를 해결하기 위해 찾아볼 때 기억에 잘 새겨지는 것 같다. 이번에도 많이 배웠다."}),"\n",(0,sa.jsx)(e.h3,{children:"끝이 아니었다..."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/progress%20bar%20%EB%A6%AC%EB%A0%8C%EB%8D%94%EB%A7%81%20%EC%97%90%EB%9F%AC.gif",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"리렌더링 에러 ㅎㅎ... 너무 느려서 확인해봤더니.."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240818002733.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"progress라는 함수를 받는 컴포넌트도 progress bar로 인해서 리렌더링 되는 상황이다"}),"\n",(0,sa.jsx)(e.p,{children:"useContext는 상태를 주입하는 훅이기에 상태와 연결된 것 이외에도 하위 컴포넌트들을 리렌더링 시킨다."}),"\n",(0,sa.jsx)(e.p,{children:"progress bar라는 상태가 빈번하게 변화하는 컴포넌트가 최상위에 있어서 리렌더링이 발생하는 것."}),"\n",(0,sa.jsx)(e.p,{children:'zustand를 이용해서 상태를 "관리"하여 이를 해결해보려고 했지만'}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://github.com/pmndrs/zustand/discussions/885",children:"https://github.com/pmndrs/zustand/discussions/885"})}),"\n",(0,sa.jsx)(e.p,{children:"useSyncExternalStore를 활용하는 zustand는 별도의 추가 없이는 startTransition과 함께 호환되지 않는다고 합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240828114258.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"찾아보니 zustand 개발자가 커스텀 훅을 만들어놨다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://www.npmjs.com/package/use-zustand",children:"https://www.npmjs.com/package/use-zustand"})}),"\n",(0,sa.jsx)(e.p,{children:"이걸 사용했지만 next.js와 context api를 활용해서 연결된 방식과 결합하는 것이다 보니 개발자가 구상했었던 예외처리가 아닌 것 같았다."}),"\n",(0,sa.jsx)(e.p,{children:"구조적으로 context api를 활용해서 리렌더링을 만드는 것, zustand로 불완전한 로딩바를 만드는 것보다는 다른 방법을 생각하게 되었다."}),"\n",(0,sa.jsx)(e.p,{children:"그러다 기존 next.js를 활용한 사이트들에서 next-nprogress-bar 라는 라이브러리를 확인했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"이는startTransition을 활용하는 방식이 아니었다. 시도해보기로 합니다."}),"\n",(0,sa.jsx)(e.h2,{children:"next-nprogress-bar"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsx)(e.code,{className:"hljs language-terminal",children:"pnpm install next-nprogress-bar\n"})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AppProgressBar"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"as"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ProgressBar"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next-nprogress-bar"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Providers"})," = (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ children }: { children: React.ReactNode }"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      {children}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ProgressBar"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"height"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"4px"'}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"#fffd00"'}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"options"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"showSpinner:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"false"})," }}\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shallowRouting"}),"\n      />"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Providers"}),";\n"]})}),"\n",(0,sa.jsx)("s",{children:"진짜 억울할 정도로 너무 쉽다 ㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠ"}),"\n",(0,sa.jsx)(e.p,{children:"html 자체에 스타일링을 줘서 작동하는 방식인 것 같았다. 여기에 시간을 너무 많이 쏟은 것 같아 라이브러리 분석은 다음에 꼭 해봐야겠다."}),"\n",(0,sa.jsx)(e.p,{children:"이제 Link 자체에 특별한 옵션을 안 넣으면 자동으로 progress bar가 동작한다고 합니다."}),"\n",(0,sa.jsx)(e.h3,{children:"트러블 슈팅"}),"\n",(0,sa.jsx)(e.p,{children:"Next.js에서는 SearchParams에 따른 컴포넌트 렌더링이 많다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240914151931.png",alt:""}),"\n(searchParams에 따라서 정렬을 다르게 하는 자유게시판 페이지의 예시)"]}),"\n",(0,sa.jsx)(e.p,{children:"인기순에서 최신순으로 정렬기준을 바꿨을 때도 progress bar가 나오는데 좀더 자연스러울 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"하지만 next-nprogress-bar에서는 이를 구현하지 않고 있었다."}),"\n",(0,sa.jsx)(e.p,{children:"따라서 useEffect를 활용하여 이 문제를 해결하였습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use client"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AppProgressBar"}),", startProgress } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next-nprogress-bar"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { useSearchParams } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/navigation"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ReactNode"}),", useEffect } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"react"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"ProgressBarProvider"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{\n  children,\n}: {\n  children: ReactNode;\n}"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," searchParams = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useSearchParams"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useEffect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startProgress"}),"();\n  }, [searchParams]);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsx)(e.span,{className:"hljs-tag",children:"<>"}),"\n      {children}\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"AppProgressBar"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"height"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"4px"'}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"color"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"#10b981"'}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"options"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{{"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"showSpinner:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"false"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"minimum:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"0.15"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"easing:"}),' "',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"ease"}),'",\n          ',(0,sa.jsx)(e.span,{className:"hljs-attr",children:"speed:"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"500"}),",\n        }}\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"shallowRouting"}),"\n      />"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-tag",children:"</>"})]}),"\n  );\n}\n\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이제 정렬을 해도 progress bar가 움직이는 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/progressbar%EA%B2%8C%EC%8B%9C%ED%8C%90.gif",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"후기"}),"\n",(0,sa.jsx)(e.p,{children:"progress bar를 구현하기 위한 아이디어는 무엇이고 next.js에서는 그것을 어떻게 구현하는지를 알아보았다."}),"\n",(0,sa.jsx)(e.p,{children:"비록 프로젝트에는 라이브러리를 활용하는 쪽으로 적용되었지만 그 과정에서 동시성 렌더링을 통해서 구현한 코드를 분석하면서 많은 것을 배웠다."}),"\n",(0,sa.jsx)(e.p,{children:"더 성장해보겠습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"꼼꼼 프로젝트 진행 중에 겪은 경험들입니다. 오늘도 많이 성장한 것 같아요!"}),"\n",(0,sa.jsx)(e.p,{children:"읽어주셔서 감사합니다! 지켜봐주세요!"}),"\n",(0,sa.jsx)(e.p,{children:"감사합니다."}),"\n"]})]})}function ez(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eU,{...s})}):eU(s)}function eH(s){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"Background"}),"\n",(0,sa.jsx)(e.p,{children:"In Next.js, fetch on the server side is overridden to add useful features like duplicate communication handling."}),"\n",(0,sa.jsx)(e.p,{children:"Normally, if you just use fetch in server components and client components, you can use communication with that feature added."}),"\n",(0,sa.jsx)(e.p,{children:"The problem here is when access token and refresh token are included."}),"\n",(0,sa.jsx)(e.p,{children:"In server components, cookies are accessed using cookies from next/headers, and in client components, browser cookies are used to access cookies."}),"\n",(0,sa.jsx)(e.p,{children:"Different methods become a problem when implementing functions for refresh token rotation."}),"\n",(0,sa.jsx)(e.h1,{children:"Implementation"}),"\n",(0,sa.jsx)(e.p,{children:"The code below is code written by another team member before work came to me. It was a method implemented using middleware."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/server"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextFetchEvent"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextRequest"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/server"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostTeamIdAuthRefreshTokenResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./lib/apis/type"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"middleware"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"request"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextRequest"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"event"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextFetchEvent"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," hasAccessToken = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"cookies"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"has"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," hasRefreshToken = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"cookies"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"has"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"refreshToken"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { pathname } = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextUrl"}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// NOTE - When accessing login, signup pages after login"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (\n    hasAccessToken &&\n    (pathname.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/login"'}),") || pathname.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/signup"'}),"))\n  ) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// NOTE - When accessing pages other than landing, login, signup pages before login"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (\n    !hasAccessToken &&\n    !(\n      pathname.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/login"'}),") ||\n      pathname.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/signup"'}),") ||\n      pathname === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/"'}),"\n    )\n  ) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/login"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// NOTE - When accessToken has expired and new token must be issued through refreshToken"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!hasAccessToken && hasRefreshToken) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," refreshTokenValue = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"cookies"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"refreshToken"'}),")?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"value"}),";\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// NOTE - Async work to receive new accessToken using Fetch"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," fetchPromise = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n      ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}"}),"/auth/refresh-token`"]}),",\n      {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"method"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"POST"'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"headers"}),": {\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Content-Type"'}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"application/json"'}),",\n        },\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"body"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"({\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"refreshToken"}),": refreshTokenValue,\n        }),\n      },\n    )\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (response) => {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!response.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ok"}),") {\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"refresh token 요청 실패"'}),");\n        }\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostTeamIdAuthRefreshTokenResponse"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create NextResponse object and set cookies"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," nextResponse = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"next"}),"();\n        nextResponse.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"cookies"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),", data.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"}),");\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," nextResponse;\n      })\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/login"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n      });\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Use waitUntil to wait until async work is complete"}),"\n    event.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"waitUntil"}),"(fetchPromise);\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Continue request after async work is complete."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Use NextResponse object returned from fetchPromise at this time"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," {\n      fetchPromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"nextResponse"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(nextResponse);\n      });\n    });\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"next"}),"();\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," config = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"matcher"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/((?!api|_next/static|_next/image|favicon.ico).*)"'}),",\n};\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["It was logic that processed tokens before desired communication using a method called ",(0,sa.jsx)(e.code,{children:"waitUntil"})," when routes changed."]}),"\n",(0,sa.jsx)(e.p,{children:"However, exceptions occurred in the following situations."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"If server actions are not used, requests are made without going through frontend server, so middleware is not passed"}),"\n",(0,sa.jsx)(e.li,{children:"refreshToken exists but branch processing to log in again (error)"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"After thinking about it, I reached the conclusion that refreshToken must be processed in the fetch request itself, like axios's interceptor."}),"\n",(0,sa.jsx)(e.h2,{children:"Import Using Server Actions"}),"\n",(0,sa.jsx)(e.p,{children:"next/headers cannot be on the client side and can be called in server components and server actions. (Error handling if called on client side)"}),"\n",(0,sa.jsx)(e.p,{children:"This applied to all cases even if it wasn't actually executed conditionally, as long as it was connected with import."}),"\n",(0,sa.jsx)(e.p,{children:'The thought I had at this time was "Can\'t I just connect server actions and client fetch and do branch processing?"'}),"\n",(0,sa.jsx)(e.p,{children:"Then I wrote the following code."}),"\n",(0,sa.jsx)(e.h3,{children:"myFetch"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { clientFetch } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./clientFetch"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," serverFetch ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./serverFetch"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./types"'}),";\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * myFetch is a fetch function that can be used on server and client.\n * When used on server, it uses serverFetch, and when used on client, it uses clientFetch.\n * You can use it like fetch when using it.\n * You can send cookies using the withCredentials option.\n * Can be used in fetches that need accessToken.\n * Internally, when accessToken expires, it issues a new accessToken using refreshToken.\n *\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable",children:"input"}),"\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable",children:"init"}),"\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@returns"})," Promise<T>\n **/"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," myFetch<T>(\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"input"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"URL"})," | globalThis.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"Request"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"init"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"}),",\n): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"<T> {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"})," !== ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"undefined"'}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"clientFetch"}),"(input, init);\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," data;\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"serverFetch"}),"(input, init);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," data;\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This is fetch with token processing functionality attached, myFetch."}),"\n",(0,sa.jsx)(e.h3,{children:"clientFetch"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { getCookie, setCookie } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"cookies-next"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostAuthRefreshTokenResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../type"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./types"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"clientFetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"input"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | URL | globalThis.",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Request"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"init"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"}),",\n"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Read accessToken."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," accessToken = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," newInit = init;\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// withCredentials is a flag that says we'll do token authentication processing."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (newInit?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"withCredentials"})," === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," headers = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Headers"}),"(init?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),");\n    headers.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Authorization"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${accessToken}"}),"`"]}),");\n    newInit = { ...init, headers };\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Process tokens."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(input, newInit);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If token has expired"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"401"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Process refresh token rotation"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," refreshTokenValue = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"refreshToken"'}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (refreshTokenValue) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newAccessToken = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n        ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}"}),"/auth/refresh-token`"]}),",\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"method"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"POST"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"headers"}),": {\n            ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Content-Type"'}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"application/json"'}),",\n          },\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"body"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"({\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"refreshToken"}),": refreshTokenValue,\n          }),\n        },\n      );\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (newAccessToken.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ok"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"newAccessTokenValue"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostAuthRefreshTokenResponse"})," =\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," newAccessToken.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),", newAccessTokenValue.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"}),");\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," headers = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Headers"}),"(init?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),");\n        headers.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Authorization"'}),",\n          ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${newAccessTokenValue.accessToken}"}),"`"]}),",\n        );\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newInitAfterFetch = { ...init, headers };\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newRes = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(input, newInitAfterFetch);\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," newRes;\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ResponseError"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"엑세스 토큰 호출 실패"'}),", newAccessToken);\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ResponseError"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"로그인을 다시 해주세요!"'}),", res);\n    }\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ok"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ResponseError"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러가 발생했습니다."'}),", res);\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," res;\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["This is a function that executes when in client (",(0,sa.jsx)(e.code,{children:"window !== undefined"}),") state. It has logic to receive and fetch again if refresh token rotation is needed."]}),"\n",(0,sa.jsx)(e.h3,{children:"serverFetch"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use server"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { cookies } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/headers"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"."'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostTeamIdAuthRefreshTokenResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../type"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"serverFetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"input"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | URL | globalThis.",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Request"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"init"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"}),",\n"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," cookieStore = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cookies"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," accessToken = cookieStore.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),")?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"value"}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (init?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"withCredentials"})," === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," headers = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Headers"}),"(init?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),");\n    headers.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Authorization"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${accessToken}"}),"`"]}),");\n    init = { ...init, headers };\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(input, init);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"401"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," refreshTokenValue = cookieStore.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"refreshToken"'}),")?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"value"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (refreshTokenValue) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newAccessToken = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n        ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}"}),"/auth/refresh-token`"]}),",\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"method"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"POST"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"headers"}),": {\n            ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Content-Type"'}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"application/json"'}),",\n          },\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"body"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"({\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"refreshToken"}),": refreshTokenValue,\n          }),\n        },\n      );\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (newAccessToken.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ok"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"newAccessTokenValue"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostTeamIdAuthRefreshTokenResponse"})," =\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," newAccessToken.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," headers = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Headers"}),"(init?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),");\n        headers.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Authorization"'}),",\n          ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${newAccessTokenValue.accessToken}"}),"`"]}),",\n        );\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newInit = { ...init, headers };\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newRes = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(input, newInit);\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," newRes;\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"엑세스 토큰 호출 실패"'}),");\n      }\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"로그인을 다시 해주세요!"'}),");\n    }\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ok"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"responseError"}),"(res);\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," res;\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["This is a function that executes when in server state (",(0,sa.jsx)(e.code,{children:"window===undefined"}),"). It executes refresh token rotation using cookies from next/headers."]}),"\n",(0,sa.jsx)(e.p,{children:"The following logic executes so errors don't occur."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Because server actions are imported on client side, runtime errors are ignored."}),"\n",(0,sa.jsx)(e.li,{children:"Pass next/header without error handling."}),"\n",(0,sa.jsxs)(e.li,{children:["Because branch processing was done with ",(0,sa.jsx)(e.code,{children:"window===undefined"}),", cases where server functions are used on client are blocked."]}),"\n",(0,sa.jsx)(e.li,{children:"Can be used on both server and client"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Implementing axios's base url functionality"}),"\n",(0,sa.jsx)(e.p,{children:"While doing code review, I found code that receives URL as a constant and passes it down to myFetch."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240914193655.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"In axios, there's functionality to store base url and write only routes after that url on the usage side."}),"\n",(0,sa.jsx)(e.h3,{children:"Currying Function"}),"\n",(0,sa.jsx)(e.p,{children:"While thinking about how to implement this in functional programming, I remembered the currying function I learned before."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"Currying function: Something that divides a function that receives multiple arguments into functions that receive only one argument so they can be called sequentially in chain form\nThe principle is to pass only one argument at a time. Because arguments received at each stage are all referenced in the last stage, they stack up in memory and become GC collection targets all at once when execution context ends after being called in the last stage."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"I started implementing using this."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Currying function for instance"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"newFetch"})," =\n  (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"url"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>\n  <T>",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"input"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | URL | globalThis.",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Request"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"init"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"})]}),") =>"]}),"\n    myFetch<T>(url + input, init);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// instance.tsx"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," instance = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"newFetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"`{url}`"}),");\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"With the function above, base_url added myFetch with all types processed became usable."}),"\n",(0,sa.jsx)(e.p,{children:"On the usage side, it became very simple now."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Call site"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getUserHistory"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"try"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," instance<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetTeamIdUserHistoryResponse"}),">(\n      ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/user/history"'}),",\n      {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"method"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"GET"'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"withCredentials"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n      },\n    );\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," response;\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"catch"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," error;\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Tokens were processed using only instance and withCredentials while detailed logic was hidden inside!!!"}),"\n",(0,sa.jsx)(e.p,{children:"The best point is that since only api changed, you only need to change myFetch to instance without needing to change other code."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Side that uses getUserHistory"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetTeamIdUserHistoryResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/lib/apis/type"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { getUserHistory } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/lib/apis/user"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"DateBoxCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./date-box-card"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"DateBoxList"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getUserHistory"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Can be used without changes."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (data.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tasksDone"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),") ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"history"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetTeamIdUserHistoryResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"tasksDone"'}),"]> =\n    data.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tasksDone"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reduce"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"acc, cur"}),") =>"]})," {\n      acc.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(cur.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"date"}),", [...(acc.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(cur.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"date"}),") || []), cur]);\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," acc;\n    }, ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"());\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"mt-[27px] flex flex-col gap-10 md:mt-6"'}),">"]}),"\n      {[...history.entries()].map(([date, history]) => (\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"DateBoxCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{date}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"date"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{date}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"tasksDone"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{history}"})," />"]}),"\n      ))}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.h1,{children:"Afterword"}),"\n",(0,sa.jsx)(e.p,{children:"I had an experience of processing tokens using server actions."}),"\n",(0,sa.jsx)(e.p,{children:"The thrill of making it with server actions was great, but the time when implementing base url was when I really thought I had grown a lot."}),"\n",(0,sa.jsx)(e.p,{children:"It was content I saw in Core JavaScript a few months ago, but I felt like I finally understood it properly by utilizing it."}),"\n",(0,sa.jsx)(e.p,{children:"It was an exciting experience thinking that knowledge stacks up."}),"\n",(0,sa.jsx)(e.p,{children:"I'll grow more."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"++ 2024-11-29"}),"\n",(0,sa.jsx)(e.p,{children:"Later, I learned that if you use a method of reading cookies on the client, you can't apply httpOnly to those cookies, and this causes security problems, so I replaced all client-side cookies with server cookies."}),"\n",(0,sa.jsx)(e.p,{children:"The logic of reading cookies through separation of server actions and client-side code became largely unnecessary."}),"\n",(0,sa.jsx)(e.p,{children:"Token storage strategies are diverse and methods of attacking them are diverse, so I think it's something you always need to think about while working as a frontend developer."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"These are experiences I had during the Kkom-kkom project. I think I grew a lot today too!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you for reading! Please watch over me!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you."}),"\n"]})]})}function eW(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eH,{...s})}):eH(s)}function eV(s){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"배경"}),"\n",(0,sa.jsx)(e.p,{children:"next.js에서는 서버 단의 fetch를 override해서 중복 통신 처리 같은 유익한 기능을 추가했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"평소에는 서버 컴포넌트와 클라이언트 컴포넌트에서 그냥 fetch를 쓰면 해당 기능이 첨가된 통신을 사용할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"여기서 문제는 access token과 refresh token이 들어갈 때입니다."}),"\n",(0,sa.jsx)(e.p,{children:"서버 컴포넌트에서는 next/headers의 쿠키를 사용하여 쿠키에 접근하고 클라이언트 컴포넌트에서는 브라우저 쿠키로 쿠키에 접근합니다."}),"\n",(0,sa.jsx)(e.p,{children:"서로 다른 방식은 refresh token rotation을 위한 함수를 구현할 때 문제가 됩니다."}),"\n",(0,sa.jsx)(e.h1,{children:"구현"}),"\n",(0,sa.jsx)(e.p,{children:"아래의 코드는 나에게 업무가 넘어오기 전 다른 팀원이 짠 코드다. middleware 활용하여 구현된 방식이었다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/server"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextFetchEvent"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextRequest"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/server"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostTeamIdAuthRefreshTokenResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./lib/apis/type"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"middleware"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"request"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextRequest"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"event"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextFetchEvent"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," hasAccessToken = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"cookies"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"has"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," hasRefreshToken = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"cookies"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"has"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"refreshToken"'}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { pathname } = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextUrl"}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// NOTE - 로그인 후 로그인, 회원가입 페이지에 접근하는 경우"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (\n    hasAccessToken &&\n    (pathname.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/login"'}),") || pathname.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/signup"'}),"))\n  ) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// NOTE - 로그인 전에 랜딩, 로그인, 회원가입 페이지 외에 다른 페이지에 접근하는 경우"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (\n    !hasAccessToken &&\n    !(\n      pathname.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/login"'}),") ||\n      pathname.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"startsWith"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/signup"'}),") ||\n      pathname === ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/"'}),"\n    )\n  ) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/login"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// NOTE - accessToken이 만료되어서 refreshToken을 통해 새로운 토큰을 발급해야 하는 경우"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!hasAccessToken && hasRefreshToken) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," refreshTokenValue = request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"cookies"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"refreshToken"'}),")?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"value"}),";\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// NOTE - Fetch를 사용하여 새로운 accessToken을 발급받는 비동기 작업"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," fetchPromise = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n      ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}"}),"/auth/refresh-token`"]}),",\n      {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"method"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"POST"'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"headers"}),": {\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Content-Type"'}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"application/json"'}),",\n        },\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"body"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"({\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"refreshToken"}),": refreshTokenValue,\n        }),\n      },\n    )\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (response) => {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!response.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ok"}),") {\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"refresh token 요청 실패"'}),");\n        }\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostTeamIdAuthRefreshTokenResponse"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// NextResponse 객체를 만들어 쿠키를 설정"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," nextResponse = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"next"}),"();\n        nextResponse.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"cookies"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),", data.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"}),");\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," nextResponse;\n      })\n      .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"redirect"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"URL"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/login"'}),", request.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"url"}),"));\n      });\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// waitUntil을 사용하여 비동기 작업이 완료될 때까지 기다림"}),"\n    event.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"waitUntil"}),"(fetchPromise);\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 비동기 작업이 완료된 후 요청을 계속 진행하도록 합니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 이때 fetchPromise에서 반환한 NextResponse 객체 사용"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," {\n      fetchPromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"nextResponse"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(nextResponse);\n      });\n    });\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"NextResponse"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"next"}),"();\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," config = {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"matcher"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/((?!api|_next/static|_next/image|favicon.ico).*)"'}),",\n};\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["라우트가 변경될 때 ",(0,sa.jsx)(e.code,{children:"waitUntil"}),"이라는 메소드로 원하는 통신 이전에 토큰을 처리해주는 로직이었다."]}),"\n",(0,sa.jsx)(e.p,{children:"하지만 다음의 상황에서 예외가 발생했습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"서버 액션을 사용하지 않으면 프론트엔드 서버를 거치지 않고 요청을 하기 때문에 미들웨어를 거치지 않게 됨"}),"\n",(0,sa.jsx)(e.li,{children:"refreshToken은 있으나 다시 로그인 하라고 분기 처리 (에러)"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"고민해본 결과 axios의 interceptor처럼 fetch 요청 자체에 refreshToken을 처리해야 한다는 결론에 이르렀다."}),"\n",(0,sa.jsx)(e.h2,{children:"서버 액션을 이용한 import"}),"\n",(0,sa.jsx)(e.p,{children:"next/headers는 클라이언트 단에 있을 수 없고 서버 컴포넌트, 서버 액션에서 호출할 수 있었다. (클라이언트 단에서 호출하면 에러 처리)"}),"\n",(0,sa.jsx)(e.p,{children:"그건 조건부로 실제로 실행되는 것이 아니여도 import로 연결되어 있다면 전부 해당되었다."}),"\n",(0,sa.jsx)(e.p,{children:'이때 든 생각은 "서버 액션과 일단 클라이언트 fetch를 연결하고 분기 처리하면 되지 않나?" 였습니다.'}),"\n",(0,sa.jsx)(e.p,{children:"그러곤 다음의 코드를 작성했습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"myFetch"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { clientFetch } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./clientFetch"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," serverFetch ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./serverFetch"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./types"'}),";\n\n",(0,sa.jsxs)(e.span,{className:"hljs-comment",children:["/**\n * myFetch는 서버와 클라이언트에서 사용할 수 있는 fetch 함수입니다.\n * 서버에서 사용할 때는 serverFetch를 사용하고, 클라이언트에서 사용할 때는 clientFetch를 사용합니다.\n * 사용하실 때는 fetch처럼 사용하시면 됩니다.\n * withCredentials 옵션을 사용하면 쿠키를 전송할 수 있습니다.\n * accessToken이 필요한 fetch에서 사용하시면 됩니다.\n * 내부적으로 accessToken이 만료되었을 때, refreshToken을 사용하여 새로운 accessToken을 발급받습니다.\n *\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@author"})," 이승현\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable",children:"input"}),"\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@param"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable",children:"init"}),"\n * ",(0,sa.jsx)(e.span,{className:"hljs-doctag",children:"@returns"})," Promise<T>\n **/"]}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," myFetch<T>(\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"input"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"URL"})," | globalThis.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"Request"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"init"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"}),",\n): ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"<T> {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"typeof"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"})," !== ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"undefined"'}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"clientFetch"}),"(input, init);\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," data;\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"serverFetch"}),"(input, init);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," data;\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"토큰 처리 기능이 붙혀진 fetch, myFetch 입니다."}),"\n",(0,sa.jsx)(e.h3,{children:"clientFetch"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { getCookie, setCookie } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"cookies-next"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostAuthRefreshTokenResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../type"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"type"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./types"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"clientFetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"input"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | URL | globalThis.",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Request"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"init"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"}),",\n"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// accessToken를 읽는다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," accessToken = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," newInit = init;\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// withCredentials는 토큰 인증 처리를 하겠다는 flag입니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (newInit?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"withCredentials"})," === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," headers = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Headers"}),"(init?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),");\n    headers.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Authorization"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${accessToken}"}),"`"]}),");\n    newInit = { ...init, headers };\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 토큰 처리를 합니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(input, newInit);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 만약 토큰이 만료되었다면"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"401"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// refresh token rotation 처리"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," refreshTokenValue = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"refreshToken"'}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (refreshTokenValue) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newAccessToken = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n        ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}"}),"/auth/refresh-token`"]}),",\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"method"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"POST"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"headers"}),": {\n            ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Content-Type"'}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"application/json"'}),",\n          },\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"body"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"({\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"refreshToken"}),": refreshTokenValue,\n          }),\n        },\n      );\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (newAccessToken.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ok"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"newAccessTokenValue"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostAuthRefreshTokenResponse"})," =\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," newAccessToken.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setCookie"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),", newAccessTokenValue.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"accessToken"}),");\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," headers = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Headers"}),"(init?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),");\n        headers.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Authorization"'}),",\n          ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${newAccessTokenValue.accessToken}"}),"`"]}),",\n        );\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newInitAfterFetch = { ...init, headers };\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newRes = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(input, newInitAfterFetch);\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," newRes;\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ResponseError"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"엑세스 토큰 호출 실패"'}),", newAccessToken);\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ResponseError"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"로그인을 다시 해주세요!"'}),", res);\n    }\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ok"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ResponseError"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러가 발생했습니다."'}),", res);\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," res;\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["클라이언트 (",(0,sa.jsx)(e.code,{children:"window !== undefined"}),") 상태일 때 실행될 함수입니다. refresh token rotation이 필요한 경우에 받고 fetch를 다시 하도록 하는 로직을 갖고 있습니다."]}),"\n",(0,sa.jsx)(e.h3,{children:"serverFetch"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-string",children:'"use server"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { cookies } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next/headers"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"."'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostTeamIdAuthRefreshTokenResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"../type"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"serverFetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"input"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | URL | globalThis.",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Request"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"init"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"}),",\n"]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," cookieStore = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cookies"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," accessToken = cookieStore.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"accessToken"'}),")?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"value"}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (init?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"withCredentials"})," === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," headers = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Headers"}),"(init?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),");\n    headers.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Authorization"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${accessToken}"}),"`"]}),");\n    init = { ...init, headers };\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," res = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(input, init);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"401"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," refreshTokenValue = cookieStore.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"refreshToken"'}),")?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"value"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (refreshTokenValue) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newAccessToken = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n        ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${process.env.NEXT_PUBLIC_KKOM_KKOM_URL}"}),"/auth/refresh-token`"]}),",\n        {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"method"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"POST"'}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"headers"}),": {\n            ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Content-Type"'}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"application/json"'}),",\n          },\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"body"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"({\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"refreshToken"}),": refreshTokenValue,\n          }),\n        },\n      );\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (newAccessToken.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ok"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"newAccessTokenValue"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostTeamIdAuthRefreshTokenResponse"})," =\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," newAccessToken.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," headers = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Headers"}),"(init?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"headers"}),");\n        headers.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Authorization"'}),",\n          ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Bearer ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${newAccessTokenValue.accessToken}"}),"`"]}),",\n        );\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newInit = { ...init, headers };\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newRes = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(input, newInit);\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," newRes;\n      } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"엑세스 토큰 호출 실패"'}),");\n      }\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"로그인을 다시 해주세요!"'}),");\n    }\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!res.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"ok"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"responseError"}),"(res);\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," res;\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["서버 상태(",(0,sa.jsx)(e.code,{children:"window===undefined"}),")일 때 실행될 함수입니다. refresh token rotation을 next/headers의 cookie를 이용해서 실행합니다."]}),"\n",(0,sa.jsx)(e.p,{children:"다음의 로직이 실행되어 에러가 일어나지 않는 것입니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"서버 액션을 클라이언트단에서 import하기 때문에 런타임 에러가 무시됩니다."}),"\n",(0,sa.jsx)(e.li,{children:"next/header를 에러처리 안하고 넘어간다."}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"window===undefined"})," 로 분기처리했기 때문에 클라이언트에서 서버 함수를 사용하는 경우의 수는 차단됩니다."]}),"\n",(0,sa.jsx)(e.li,{children:"서버, 클라이언트 모두 사용 가능해짐"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"axios의 base url 기능 구현"}),"\n",(0,sa.jsx)(e.p,{children:"코드 리뷰를 하던 중에 URL을 상수로 받아서 myFetch에 내려받는 코드를 발견하였습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240914193655.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"axios에서는 base url을 저장해놓고 사용하는 쪽에서는 해당 url 뒤에 있는 라우트만 적어서 사용하는 기능이 있습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"커링 함수"}),"\n",(0,sa.jsx)(e.p,{children:"함수형 프로그래밍에서는 이걸 어떻게 구현할까 고민을 하다가 이전에 학습했던 커링 함수가 생각났다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"커링 함수: 여러 개의 인자를 받는 함수를 하나의 인자만 받는 함수로 나눠서 순차적으로 호출될 수 있게 체인 형태로 구성한 것\n한번에 하나의 인자만 전달하는 것을 원칙으로 합니다. 각 단계에서 받은 인자들을 모두 마지막 단계에서 참조하기 때문에 메모리에 차곡차곡 쌓였다가 마지막 단계에서 호출해서 실행 컨텍스트가 끝나면 한번에 GC의 수거 대상이 됩니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"이를 이용해서 구현을 시작했습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// instance를 위한 커링 함수"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"newFetch"})," =\n  (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"url"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})]}),") =>\n  <T>",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"input"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"})," | URL | globalThis.",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Request"}),", ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"init"}),"?: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"MyFetchOptions"})]}),") =>"]}),"\n    myFetch<T>(url + input, init);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// instance.tsx"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," instance = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"newFetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"`{url}`"}),");\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위의 함수로 타입까지 다 처리된 base_url 첨가 myFetch를 사용할 수 있게 되었다."}),"\n",(0,sa.jsx)(e.p,{children:"사용하는 쪽에서는 이제 엄청 간단해졌다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 호출부"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getUserHistory"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"try"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," instance<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetTeamIdUserHistoryResponse"}),">(\n      ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/user/history"'}),",\n      {\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"method"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"GET"'}),",\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"withCredentials"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n      },\n    );\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," response;\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"catch"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," error;\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"세부 로직은 속으로 숨겨져 있는 상태에서 instance와 withCredentials만 사용해서 token이 처리되었다!!!"}),"\n",(0,sa.jsx)(e.p,{children:"제일 좋은 점은 api만 변경되었기 때문에 다른 코드를 변경할 필요 없이 myFetch를 instance로 변경만 하면 된다는 것입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// getUserHistory를 사용하는 쪽"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetTeamIdUserHistoryResponse"})," } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/lib/apis/type"'}),";\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," { getUserHistory } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"@/lib/apis/user"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"import"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"DateBoxCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"from"})," ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"./date-box-card"'}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"DateBoxList"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," data = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getUserHistory"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 변화가 없이 사용할 수 있습니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (data.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tasksDone"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"length"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),") ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"history"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"<",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetTeamIdUserHistoryResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"tasksDone"'}),"]> =\n    data.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tasksDone"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reduce"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"acc, cur"}),") =>"]})," {\n      acc.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(cur.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"date"}),", [...(acc.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(cur.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"date"}),") || []), cur]);\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," acc;\n    }, ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"());\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"mt-[27px] flex flex-col gap-10 md:mt-6"'}),">"]}),"\n      {[...history.entries()].map(([date, history]) => (\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"DateBoxCard"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"key"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{date}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"date"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{date}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"tasksDone"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{history}"})," />"]}),"\n      ))}\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.h1,{children:"후기"}),"\n",(0,sa.jsx)(e.p,{children:"서버 액션을 사용해서 토큰 처리를 해보는 경험을 했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"서버 액션으로 만들었을 때의 쾌감도 굉장했지만 base url을 구현할 때가 진짜 많이 성장했구나 생각했던 때였습니다."}),"\n",(0,sa.jsx)(e.p,{children:"몇개월 전에 코어 자바스크립트에서 봤던 내용인데 이제야 제대로 활용되어 이해된 느낌이 들었다."}),"\n",(0,sa.jsx)(e.p,{children:"지식은 차곡차곡 쌓이는 구나 생각하면서 짜릿했던 경험입니다."}),"\n",(0,sa.jsx)(e.p,{children:"더 성장해보겠습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"++ 2024-11-29"}),"\n",(0,sa.jsx)(e.p,{children:"이후에 클라이언트에서 쿠키를 읽는 방식을 쓰면 해당 쿠키에 httpOnly를 적용할 수가 없는 것을 알게 되고 이는 보안 문제가 발생한다는 것을 알게 되면서 기존 클라이언트 단의 쿠키를 전부 서버 쿠키로 교체하게 되었다."}),"\n",(0,sa.jsx)(e.p,{children:"기존에 서버 액션과 클라이언트 단의 코드 분리를 통해서 쿠키를 읽는 로직은 사실상 크게 필요 없어진 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"토큰을 저장하는 전략은 다양하고 그것을 공격하는 방법은 다양하기 때문에 프론트엔드 개발자로써 일하면서 항상 고민해야 하는 부분인 것 같다."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"꼼꼼 프로젝트 진행 중에 겪은 경험들입니다. 오늘도 많이 성장한 것 같아요!"}),"\n",(0,sa.jsx)(e.p,{children:"읽어주셔서 감사합니다! 지켜봐주세요!"}),"\n",(0,sa.jsx)(e.p,{children:"감사합니다."}),"\n"]})]})}function eJ(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eV,{...s})}):eV(s)}function eG(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"Background"}),"\n",(0,sa.jsx)(e.p,{children:"The Kkom-kkom project actively utilized tanstack query."}),"\n",(0,sa.jsx)(e.p,{children:"Tanstack query is good for managing server state, but when used together with Next.js, there are disadvantages if you only use it in client components like React."}),"\n",(0,sa.jsx)(e.p,{children:"For example, let's think about pagination of the entire free board page."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240914202641.png",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"Disadvantages of Existing CSR-based Pagination Method"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240816005045.png",alt:""})}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Cannot use Next.js's unique fetch method using Streaming."}),"\n",(0,sa.jsx)(e.li,{children:"Cannot enjoy the advantage of bringing HTML structure before Hydration to reduce TTFB, which is an advantage during SSR."}),"\n",(0,sa.jsx)(e.li,{children:"Since skeletons can also be put as Suspense fallback during SSR, you can implement skeletons using tanstack query's isPending as is."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Personally, I thought that not being able to use Streaming was the most fatal."}),"\n",(0,sa.jsx)(e.p,{children:"Even if you use parallel fetch using Promise.all, similar effects would come out, but since it's not the best, if there's a way to combine them, combine them, and if there's no way, it seemed good to make rules between SSR (Streaming) and Tanstack query (parallel fetching) and use both."}),"\n",(0,sa.jsx)(e.h1,{children:"Implementation"}),"\n",(0,sa.jsx)(e.h2,{children:"Streaming-style query"}),"\n",(0,sa.jsx)(e.p,{children:"While searching to solve this, I found the answer in the official documentation."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://tanstack.com/query/latest/docs/framework/react/guides/advanced-ssr#streaming-with-server-components",children:"https://tanstack.com/query/latest/docs/framework/react/guides/advanced-ssr#streaming-with-server-components"})}),"\n",(0,sa.jsx)(e.p,{children:"If you read it, you can find clues to use streaming method and tanstackquery simultaneously."}),"\n",(0,sa.jsx)(e.p,{children:"It's implemented in a way where prefetchQuery itself is thought of as SSR, skeleton is thrown first, and then when prefetchQuery ends, the corresponding component is rendered."}),"\n",(0,sa.jsx)(e.p,{children:"This way, tanstack query's advantages and streaming method could be combined."}),"\n",(0,sa.jsx)(e.p,{children:"After processing queryClient by referring to the documentation,"}),"\n",(0,sa.jsx)(e.p,{children:"useQuery > useSuspenseQuery"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useArticleQuery"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useSuspenseQuery"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }],\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryFn"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getArticlesArticleId"}),"({ articleId }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"staleTime"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2000"}),",\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Dehydrate queryClient that uses prefetchQuery to make it a shell and pass it down."}),"\n",(0,sa.jsx)(e.p,{children:"Components wrapped in Suspense will have fallback replace that position until queries used inside are fetched. (Streaming method)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Page"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ params: { boardId } }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Props"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," articleId = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Number"}),"(boardId);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queryClient = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getQueryClient"}),"();\n\n  queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"prefetchInfiniteQuery"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ pageParam }"}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getArticlesArticleIdComments"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"cursor"}),": pageParam, articleId }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"initialPageParam"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n  });\n\n  queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"prefetchQuery"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"getUser"'}),"],\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryFn"}),": getUser,\n  });\n\n  queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"prefetchQuery"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }],\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryFn"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getArticlesArticleId"}),"({ articleId }),\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HydrationBoundary"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"state"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{dehydrate(queryClient)}"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"GtmPageView"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pageTitle"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"`",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"boardId:"})," ${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"boardId"}),"}`} />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"border-b border-black border-opacity-10 dark:border-b dark:border-white dark:border-opacity-10"'}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"text-text-primary mb-1 flex items-center gap-1 text-base font-medium"'}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Image"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"src"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/icons/medal.svg"'})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"alt"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Medal"'})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"width"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{16}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"height"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{16}"})," />"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h2"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"selection:bg-inherit"'}),">"]}),"베스트 랭킹",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h2"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonRankingChart"})," />"]}),"}>\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ArticleRankingChart"})," />"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonArticleHeader"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ArticleHeader"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{articleId}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonArticleContent"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ArticleContent"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{articleId}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonArticleLikeSection"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"LikeSection"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{articleId}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonCommentForm"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"CommentForm"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{articleId}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonCommentList"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"CommentsList"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{articleId}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HydrationBoundary"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/%EC%9E%90%EC%9C%A0%EA%B2%8C%EC%8B%9C%ED%8C%90%20streaming%20%EB%B0%A9%EC%8B%9D%20%EB%A0%8C%EB%8D%94%EB%A7%81.gif",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"The video above is a video where communication processing was increased with the code below."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"r"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(r, ms));\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"Troubleshooting"}),"\n",(0,sa.jsx)(e.p,{children:"There was a bug where Suspense wasn't applied to pagination."}),"\n",(0,sa.jsx)(e.p,{children:"Suspense wasn't reading SearchParams changes, so streaming-style rendering wasn't working,"}),"\n",(0,sa.jsx)(e.p,{children:"I solved the problem by putting SearchParams as key in Suspense itself so each Suspense recognizes it as different."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:["<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Suspense"})," key={",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"(searchParams)} fallback={",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"SkeletonCardList"})," />"]})}),"}>\n  ",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ArticlesList"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"searchParams"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{searchParams}"})," />"]})}),"\n</",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Suspense"}),">\n"]})}),"\n",(0,sa.jsx)(e.h2,{children:"Optimistic Updates"}),"\n",(0,sa.jsx)(e.p,{children:"There are other ways to improve UX besides Streaming."}),"\n",(0,sa.jsx)(e.p,{children:"Optimistic updates are one of them, and the logic can be easily explained as follows."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Cancel current query. (before fetch execution)"}),"\n",(0,sa.jsx)(e.li,{children:"Save current query."}),"\n",(0,sa.jsx)(e.li,{children:"Change query assuming it succeeded."}),"\n",(0,sa.jsxs)(e.li,{children:["If query succeeds, connect query with actual data (after fetch completion)","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"If query fails, restore query to query saved in step 2."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"onMutation is used for before fetch execution, and onError, onSettled are used for after fetch completion."}),"\n",(0,sa.jsx)(e.p,{children:"You can easily think of a like button as an example."}),"\n",(0,sa.jsx)(e.p,{children:"No matter how much you spam the like button, you've never experienced likes or unlikes becoming slow."}),"\n",(0,sa.jsx)(e.h3,{children:"Like Button Implementation"}),"\n",(0,sa.jsx)(e.p,{children:"I actually had to implement a like button in this project too."}),"\n",(0,sa.jsx)(e.p,{children:"Looking at the following code, you can confirm that the logic explained above is well contained."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useHandleArticleLikeMutation"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queryClient = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useQueryClient"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMutation"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mutationFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ articleId, isLiked }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HandleArticleLikeMutationProps"})]}),") =>"]}),"\n      isLiked\n        ? ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteArticlesArticleIdLike"}),"({ articleId })\n        : ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postArticlesArticleIdLike"}),"({ articleId }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onMutate"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," ({ articleId, isLiked }) => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//  Cancel query"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cancelQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }],\n      });\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get current query."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," previousArticle =\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"getQueryData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdResponse"}),">([\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),",\n          { articleId },\n        ]);\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Modify query assuming it succeeded"}),"\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdResponse"}),",\n        [",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," }],\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdResponse"}),"\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }], ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"input"}),") =>"]}),"\n        input\n          ? {\n              ...input,\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLiked"}),": isLiked === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeCount"}),":\n                isLiked === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"})," ? input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"likeCount"})," + ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"})," : input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"likeCount"})," - ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n            }\n          : input,\n      );\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { previousArticle };\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Change to original query on cancel"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onError"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, { articleId }, context"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (context?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousArticle"}),") {\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdResponse"}),">(\n          [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }],\n          context.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousArticle"}),",\n        );\n      }\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Connect with actual data whether success or error"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSettled"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data, error, { articleId }"}),") =>"]})," {\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"invalidateQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }],\n      });\n    },\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"As a result, you can confirm that no matter how much you press like, it doesn't operate slowly."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/%EC%A2%8B%EC%95%84%EC%9A%94,%20%EC%A2%8B%EC%95%84%EC%9A%94%20%EC%B7%A8%EC%86%8C%20%EB%B2%84%ED%8A%BC.gif",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"Infinite Scroll"}),"\n",(0,sa.jsx)(e.p,{children:"Infinite scroll is a method of increasing data as if scroll is infinite by utilizing logic that sends fetch when a specific part is detected."}),"\n",(0,sa.jsx)(e.p,{children:"Since it's a very common pattern in frontend environments, Tanstack query has a hook that supports this."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": postsData,\n  isPending,\n  isError,\n  fetchNextPage,\n} = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInfiniteQuery"}),"({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"posts"'}),"],\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ pageParam }"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getPosts"}),"(pageParam, ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"PAGE_LIMIT"}),"),\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"initialPageParam"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"getNextPageParam"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"lastPage, allPages, lastPageParam, allPageParams"}),") =>"]}),"\n    lastPage.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"hasMore"})," ? lastPageParam + ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"})," : ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n});\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["It sends fetch using ",(0,sa.jsx)(e.code,{children:"fetchNextPage"})," function and determines if it's the last using getNextPageParam."]}),"\n",(0,sa.jsx)(e.p,{children:"However, this cannot use Suspense, but fortunately Tanstack Query was supporting useSuspenseInfiniteQuery, an InfiniteQuery with Suspense added."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://tanstack.com/query/latest/docs/framework/react/guides/migrating-to-v5#new-hooks-for-suspense",children:"https://tanstack.com/query/latest/docs/framework/react/guides/migrating-to-v5#new-hooks-for-suspense"})}),"\n",(0,sa.jsx)(e.h2,{children:"Streaming + Infinite Scroll + Optimistic Updates"}),"\n",(0,sa.jsx)(e.p,{children:"When I thought about it, I thought comments would be a part where all three (suspense, infinite scroll, optimistic updates) could be applied."}),"\n",(0,sa.jsx)(e.p,{children:"I thought that if comments are implemented with streaming method and infinite scroll method, and optimistic updates are applied when modifying, adding, or deleting them, there would be tremendous UX improvement."}),"\n",(0,sa.jsx)(e.p,{children:"The most difficult thing was TypeScript (it wasn't easy to analyze and make even inside...)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"usePostCommentsMutation"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queryClient = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useQueryClient"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," mockTime = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toISOString"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMutation"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mutationFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ articleId, content }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostCommentsMutation"})]}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postArticlesArticleIdComments"}),"({\n        articleId,\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": { content },\n      }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onMutate"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," ({ articleId, content, id, image, nickname }) => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cancelQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n      });\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," previousComments = queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"getQueryData"}),"<\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }]);\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (previousComments) {\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n          >,\n          [",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," }],\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n          >\n        >(\n          [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n          ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"input"}),":\n              | ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n                  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n                  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n                >\n              | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n          "]}),") =>"]})," {\n            ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!input) {\n              ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pages"}),": [\n                  {\n                    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nextCursor"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n                    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"list"}),": [\n                      {\n                        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"writer"}),": {\n                          image,\n                          nickname,\n                          id,\n                        },\n                        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": mockTime,\n                        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": mockTime,\n                        content,\n                        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": -",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n                      },\n                    ],\n                  },\n                ],\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pageParams"}),": [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"],\n              };\n            }\n            ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pages"}),": [\n                {\n                  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nextCursor"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pages"}),"[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"].",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextCursor"}),",\n                  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"list"}),": [\n                    {\n                      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"writer"}),": {\n                        image,\n                        nickname,\n                        id,\n                      },\n                      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": mockTime,\n                      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": mockTime,\n                      content,\n                      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": -",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n                    },\n                    ...input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pages"}),"[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"].",(0,sa.jsx)(e.span,{className:"hljs-property",children:"list"}),",\n                  ],\n                },\n                ...input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pages"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"slice"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"),\n              ],\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pageParams"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pageParams"}),",\n            };\n          },\n        );\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { previousComments };\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onError"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, variables, context"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showToast"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"error"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"댓글 등록에 실패했습니다."'}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (context?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),") {\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n        >(\n          [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": variables.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"articleId"})," }],\n          context.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),",\n        );\n      }\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSettled"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data, error, variables"}),") =>"]})," {\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"invalidateQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": variables.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"articleId"})," }],\n      });\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"invalidateQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": variables.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"articleId"})," }],\n      });\n    },\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"The important thing is that data (query) that went through useInfiniteQuery has a different structure from data structure given by server"}),"\n",(0,sa.jsx)(e.p,{children:"Pages unit array and object with pageParams is the top-level structure."}),"\n",(0,sa.jsxs)(e.p,{children:["In conclusion, you only need to optimistically update the ",(0,sa.jsx)(e.code,{children:"pages[0]"})," part."]}),"\n",(0,sa.jsx)(e.p,{children:"Since I implemented add logic, delete and modify logic can also be implemented similarly."}),"\n",(0,sa.jsx)(e.p,{children:"The code for comment deletion is as follows."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useDeleteCommentsMutation"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queryClient = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useQueryClient"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMutation"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mutationFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ commentId }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"DeleteCommentsMutation"})]}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteCommentsCommentId"}),"({\n        commentId,\n      }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onMutate"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," ({ articleId, commentId }) => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cancelQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n      });\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," previousComments = queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"getQueryData"}),"<\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }]);\n\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n        | ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n          >\n        | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n        [",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," }],\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n        >\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }], ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"input"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!input) {\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," input;\n        } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pages"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pages"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"page"}),") =>"]})," ({\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nextCursor"}),": page.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextCursor"}),",\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"list"}),": page.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"list"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"filter"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"comment"}),") =>"]})," comment.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," !== commentId),\n            })),\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pageParams"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pageParams"}),",\n          };\n        }\n      });\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { previousComments };\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onError"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, variables, context"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (context?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),") {\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n        >(\n          [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": variables.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"articleId"})," }],\n          context.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),",\n        );\n      }\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSettled"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data, error, variables"}),") =>"]})," {\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"invalidateQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": variables.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"articleId"})," }],\n      });\n    },\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Comment modification code"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"usePatchCommentsMutation"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queryClient = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useQueryClient"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMutation"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mutationFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ commentId, data }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PatchCommentsMutation"})]}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"patchCommentsCommentId"}),"({ data, commentId }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onMutate"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," ({ articleId, ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": { content }, commentId }) => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cancelQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n      });\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," previousComments = queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"getQueryData"}),"<\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }]);\n\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n        >,\n        [",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," }],\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n        >\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }], ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"input"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!input) {\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," input;\n        }\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pages"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pages"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"page"}),") =>"]})," ({\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nextCursor"}),": page.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextCursor"}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"list"}),": page.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"list"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"comment"}),") =>"]})," {\n              ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (comment.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," === commentId) {\n                ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n                  ...comment,\n                  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toISOString"}),"(),\n                  content,\n                };\n              }\n              ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," comment;\n            }),\n          })),\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pageParams"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pageParams"}),",\n        };\n      });\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { previousComments };\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onError"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, { articleId }, context"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showToast"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"error"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"댓글 수정에 실패했습니다."'}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (context?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),") {\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n        >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }], context.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),");\n      }\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSettled"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data, error, { articleId }"}),") =>"]})," {\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"invalidateQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n      });\n    },\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"I think I actually worked harder to read types of setQueryData and InfiniteData than to implement code."}),"\n",(0,sa.jsx)(e.p,{children:"In conclusion, it was easy once I knew the following structure."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.code,{children:"setQueryData<received data, query key, given data>"})}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.code,{children:"InfiniteData<entire data structure, pageParam structure>"})}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"Troubleshooting"}),"\n",(0,sa.jsx)(e.h4,{children:"When comments are put consecutively, two are created."}),"\n",(0,sa.jsx)(e.p,{children:"When I thought about it, if you send a comment while mutation that posts comments is in pending state or query connected to it is still fetching, mutations get tangled and problems occur."}),"\n",(0,sa.jsx)(e.p,{children:"I was developing while checking Naver webtoon comments together to see how Naver solves comment-related problems, and there it seemed to solve this problem by blocking comments as spam prevention when inputting consecutively."}),"\n",(0,sa.jsx)(e.p,{children:"I solved the problem by implementing logic that gets comment-related infiniteQuery, reads isFetching (check if query is fetching), reads mutation's isPending (check if mutation is executing), and shows alert if it meets restriction conditions."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"CommentForm"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ boardId }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ArticleCommentProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { register, handleSubmit, setValue } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useForm"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mode"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"onSubmit"'}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"resolver"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"yupResolver"}),"(schema),\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," articleId = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Number"}),"(boardId);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": user } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useUserQuery"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { isFetching } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useArticlesCommentsQuery"}),"(articleId);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { mutate, isPending } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"usePostCommentsMutation"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SubmitHandler"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CommentForm"}),"> = ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"formData"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (isFetching || isPending) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(\n        ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"도배 방지를 위하여 글을 입력한 후 일정시간 동안 추가입력을 제한하고 있습니다."'}),",\n      );\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n    }\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!user) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"잠시 후에 다시 시도해주세요."'}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n    }\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"mutate"}),"({\n      articleId,\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"content"}),": formData.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"content"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"image"}),": user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"image"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nickname"}),": user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nickname"}),",\n    });\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setValue"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"content"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'""'}),");\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"onInvalid"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"error"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"any"})]}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(error.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"content"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"message"}),");\n  };\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Hydration Error"}),"\n",(0,sa.jsx)(e.p,{children:"A hydration error occurred when implementing comment modification."}),"\n",(0,sa.jsx)(e.p,{children:"It was caused by time, and it was a problem where time from server-dehydrated query differed from time from client side."}),"\n",(0,sa.jsx)(e.p,{children:"Since it was implemented with new Date(), it couldn't help but be different."}),"\n",(0,sa.jsx)(e.p,{children:"To solve this, I removed SSR using suppressHydrationWarning and was able to apply optimistic updates normally."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:["<time\n  className=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"border-border-primary text-text-disabled border-l border-opacity-10 pl-4 text-xs font-medium leading-3 md:text-sm md:leading-[14px]"'}),"\n  suppressHydrationWarning\n>\n  {timeDiff} {comment.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"updatedAt"})," !== comment.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"createdAt"})," && ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"(수정됨)"'}),"}\n</time>\n"]})}),"\n",(0,sa.jsx)(e.h1,{children:"Afterword"}),"\n",(0,sa.jsx)(e.p,{children:"It was a precious experience where I was deeply immersed in Tanstack Query and managed queries."}),"\n",(0,sa.jsx)(e.p,{children:"I think Tanstack query is a collection of features that would naturally exist in the development world where all tedious and repetitive tasks are made into functions."}),"\n",(0,sa.jsx)(e.p,{children:"Learning new technologies always comes with troubleshooting, but the thrill of overcoming it is so good that I keep learning."}),"\n",(0,sa.jsx)(e.p,{children:"I'll grow more."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"These are experiences I had during the Kkom-kkom project. I think I grew a lot today too!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you for reading! Please watch over me!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you."}),"\n"]})]})}function eQ(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eG,{...s})}):eG(s)}function e$(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"배경"}),"\n",(0,sa.jsx)(e.p,{children:"꼼꼼 프로젝트에서는 tanstack query를 적극 활용하였습니다."}),"\n",(0,sa.jsx)(e.p,{children:"tanstack query가 서버 상태를 관리하는데는 좋지만 Next.js와 함께 사용할 때 리액트처럼 클라이언트 컴포넌트에서만 사용한다면 생기는 단점이 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"예를 들면 자유게시판 전체 페이지의 페이지 네이션을 생각해보겠습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240914202641.png",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"기존 CSR를 이용한 페이지네이션 방식의 단점"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/Pasted%20image%2020240816005045.png",alt:""})}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Streaming을 이용한 Next.js 만의 fetch 방식을 사용할 수 없다."}),"\n",(0,sa.jsx)(e.li,{children:"SSR시에 장점인 Hydration 이전의 HTML 구조를 가져와서 TTFB를 줄일 수 있다는 장점을 누릴 수 없다."}),"\n",(0,sa.jsx)(e.li,{children:"SSR시 스켈레톤을 Suspense fallback으로도 넣을 수 있기 때문에 tanstack query의 isPending을 활용한 스켈레톤을 그대로 구현할 수 있습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"개인적으로는 Streaming 방식을 사용할 수 없는 것이 제일 치명적이라고 생각했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Promise.all을 이용한 병렬 fetch를 사용해도 비슷한 효과가 나오겠지만 최선이 아니기 때문에 결합할 수 있는 방법이 있다면 결합하고 방법이 없다면 SSR (Streaming) 과 Tanstack query (병렬 fetching) 사이의 규칙을 만들어서 둘다 쓰는 것이 좋아보였습니다."}),"\n",(0,sa.jsx)(e.h1,{children:"구현"}),"\n",(0,sa.jsx)(e.h2,{children:"streaming 방식의 query"}),"\n",(0,sa.jsx)(e.p,{children:"이를 해결하기 위해 찾아보던 중 공식문서에서 답을 찾게 되었다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://tanstack.com/query/latest/docs/framework/react/guides/advanced-ssr#streaming-with-server-components",children:"https://tanstack.com/query/latest/docs/framework/react/guides/advanced-ssr#streaming-with-server-components"})}),"\n",(0,sa.jsx)(e.p,{children:"읽어보면 streaming 방식과 tanstackquery를 동시에 쓸 수 있는 단서를 찾을 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"prefetchQuery 자체를 SSR로 생각해서 스켈레톤을 먼저 던지고 그 다음에 prefetchQuery가 끝나면 해당되는 컴포넌트가 렌더링되는 방식으로 구현됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"이로써 tanstack query의 이점과 streaming 방식을 결합할 수 있게 된 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"문서를 참고해서 queryClient를 처리해준 후"}),"\n",(0,sa.jsx)(e.p,{children:"useQuery > useSuspenseQuery"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useArticleQuery"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useSuspenseQuery"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }],\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryFn"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getArticlesArticleId"}),"({ articleId }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"staleTime"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2000"}),",\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"prefetchQuery를 사용하는 queryClient를 dehydrate해서 껍데기로 만든 후 내려준다."}),"\n",(0,sa.jsx)(e.p,{children:"Suspense로 감싸져 있는 컴포넌트들은 내부에서 사용하는 query가 fetch되기 전까지 fallback이 그 자리를 대신하게 됩니다. (Streaming 방식)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"Page"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ params: { boardId } }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Props"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," articleId = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Number"}),"(boardId);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queryClient = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getQueryClient"}),"();\n\n  queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"prefetchInfiniteQuery"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ pageParam }"}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getArticlesArticleIdComments"}),"({ ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"cursor"}),": pageParam, articleId }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"initialPageParam"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n  });\n\n  queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"prefetchQuery"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"getUser"'}),"],\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryFn"}),": getUser,\n  });\n\n  queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"prefetchQuery"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }],\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryFn"}),": ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getArticlesArticleId"}),"({ articleId }),\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," (\n    ",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HydrationBoundary"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"state"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{dehydrate(queryClient)}"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"GtmPageView"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pageTitle"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"`",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"boardId:"})," ${",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"boardId"}),"}`} />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"border-b border-black border-opacity-10 dark:border-b dark:border-white dark:border-opacity-10"'}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"text-text-primary mb-1 flex items-center gap-1 text-base font-medium"'}),">"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Image"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"src"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/icons/medal.svg"'})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"alt"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Medal"'})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"width"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{16}"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"height"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{16}"})," />"]}),"\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h2"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"className"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"selection:bg-inherit"'}),">"]}),"베스트 랭킹",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"h2"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"header"}),">"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonRankingChart"})," />"]}),"}>\n          ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ArticleRankingChart"})," />"]}),"\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"section"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonArticleHeader"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ArticleHeader"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{articleId}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonArticleContent"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ArticleContent"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{articleId}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonArticleLikeSection"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"LikeSection"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{articleId}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonCommentForm"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"CommentForm"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{articleId}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"fallback"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{"}),"<",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"SkeletonCommentList"})," />"]}),"}>\n        ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"CommentsList"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{articleId}"})," />"]}),"\n      ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"Suspense"}),">"]}),"\n    ",(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"HydrationBoundary"}),">"]})]}),"\n  );\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/%EC%9E%90%EC%9C%A0%EA%B2%8C%EC%8B%9C%ED%8C%90%20streaming%20%EB%B0%A9%EC%8B%9D%20%EB%A0%8C%EB%8D%94%EB%A7%81.gif",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"위 영상은 아래 코드로 통신 처리를 늘린 영상입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"r"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(r, ms));\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"트러블 슈팅"}),"\n",(0,sa.jsx)(e.p,{children:"페이지네이션에 Suspense가 적용되지 않는 버그가 있었다."}),"\n",(0,sa.jsx)(e.p,{children:"SearchParams가 변경되는 것을 Suspense가 읽지 못하여 Streaming 방식의 렌더링이 작동하지 않는 것인데"}),"\n",(0,sa.jsx)(e.p,{children:"Suspense 자체에 SeachParams를 key로 넣어서 각 Suspense가 다른 것으로 인식하도록 하여 문제를 해결하였습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:["<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Suspense"})," key={",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"JSON"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"stringify"}),"(searchParams)} fallback={",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"SkeletonCardList"})," />"]})}),"}>\n  ",(0,sa.jsx)(e.span,{className:"xml",children:(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"ArticlesList"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"searchParams"}),"=",(0,sa.jsx)(e.span,{className:"hljs-string",children:"{searchParams}"})," />"]})}),"\n</",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Suspense"}),">\n"]})}),"\n",(0,sa.jsx)(e.h2,{children:"낙관적 업데이트"}),"\n",(0,sa.jsx)(e.p,{children:"UX를 향상시키는 방법에는 Streaming 이외에도 존재합니다."}),"\n",(0,sa.jsx)(e.p,{children:"낙관적 업데이트가 그 중 하나인데 쉽게 로직을 설명해보면 다음과 같다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"현재 쿼리를 취소합니다. (fetch 실행전)"}),"\n",(0,sa.jsx)(e.li,{children:"현재 쿼리를 저장합니다."}),"\n",(0,sa.jsx)(e.li,{children:"성공했다고 가정하고 쿼리를 변경시킨다."}),"\n",(0,sa.jsxs)(e.li,{children:["쿼리가 성공하면 쿼리를 실제 데이터와 연결 (fetch 완료 이후)","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"쿼리가 실패하면 쿼리를 2번에서 저장된 쿼리로 되돌린다."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"fetch 실행전은 onMutation, fetch 완료 이후는 onError, onSettled를 이용해서 구현합니다."}),"\n",(0,sa.jsx)(e.p,{children:"쉽게 생각해보면 좋아요 버튼을 예로 들 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"좋아요 버튼을 아무리 연타해도 좋아요, 좋아요 취소가 느려진 경험은 없을 것입니다."}),"\n",(0,sa.jsx)(e.h3,{children:"좋아요 버튼 구현"}),"\n",(0,sa.jsx)(e.p,{children:"이번 프로젝트에서도 실제로 좋아요 버튼을 구현해야 했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"다음의 코드를 보면 위에서 설명한 로직이 잘 담겨있는 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useHandleArticleLikeMutation"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queryClient = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useQueryClient"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMutation"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mutationFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ articleId, isLiked }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"HandleArticleLikeMutationProps"})]}),") =>"]}),"\n      isLiked\n        ? ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteArticlesArticleIdLike"}),"({ articleId })\n        : ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postArticlesArticleIdLike"}),"({ articleId }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onMutate"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," ({ articleId, isLiked }) => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//  쿼리 취소"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cancelQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }],\n      });\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 현재 쿼리 가져옴."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," previousArticle =\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"getQueryData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdResponse"}),">([\n          ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),",\n          { articleId },\n        ]);\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 됐다고 가정하고 쿼리 수정"}),"\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdResponse"}),",\n        [",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," }],\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdResponse"}),"\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }], ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"input"}),") =>"]}),"\n        input\n          ? {\n              ...input,\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"isLiked"}),": isLiked === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"}),",\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"likeCount"}),":\n                isLiked === ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"})," ? input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"likeCount"})," + ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"})," : input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"likeCount"})," - ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n            }\n          : input,\n      );\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { previousArticle };\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 취소시 원래 쿼리로 바꿈"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onError"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, { articleId }, context"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (context?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousArticle"}),") {\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdResponse"}),">(\n          [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }],\n          context.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousArticle"}),",\n        );\n      }\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 성공, 에러 어느쪽이든 실제 데이터와 연결"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSettled"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data, error, { articleId }"}),") =>"]})," {\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"invalidateQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { articleId }],\n      });\n    },\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"결과적으로 아무리 좋아요를 눌러도 느리게 동작하지 않는 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-09-14/%EC%A2%8B%EC%95%84%EC%9A%94,%20%EC%A2%8B%EC%95%84%EC%9A%94%20%EC%B7%A8%EC%86%8C%20%EB%B2%84%ED%8A%BC.gif",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"무한스크롤"}),"\n",(0,sa.jsx)(e.p,{children:"무한스크롤은 특정 부분이 감지되면 fetch를 보내는 로직을 활용해서 마치 스크롤이 무한으로 있는 것처럼 데이터를 늘려나가는 방식입니다."}),"\n",(0,sa.jsx)(e.p,{children:"프론트엔드 환경에서는 굉장히 흔한 패턴이기 때문에 Tanstack query에서는 이를 지원해주는 훅을 갖고 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": postsData,\n  isPending,\n  isError,\n  fetchNextPage,\n} = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useInfiniteQuery"}),"({\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"posts"'}),"],\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"{ pageParam }"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"getPosts"}),"(pageParam, ",(0,sa.jsx)(e.span,{className:"hljs-variable constant_",children:"PAGE_LIMIT"}),"),\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"initialPageParam"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"getNextPageParam"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"lastPage, allPages, lastPageParam, allPageParams"}),") =>"]}),"\n    lastPage.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"hasMore"})," ? lastPageParam + ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"})," : ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n});\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"fetchNextPage"}),"라는 함수를 이용해서 fetch를 보내고 getNextPageParam을 이용해서 마지막인지를 판별합니다."]}),"\n",(0,sa.jsx)(e.p,{children:"하지만 이는 Suspense를 사용할 수는 없는데 다행히 Tanstack Query에서는 Suspense가 첨가된 InfiniteQuery인 useSuspenseInfiniteQuery를 지원해주고 있었다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://tanstack.com/query/latest/docs/framework/react/guides/migrating-to-v5#new-hooks-for-suspense",children:"https://tanstack.com/query/latest/docs/framework/react/guides/migrating-to-v5#new-hooks-for-suspense"})}),"\n",(0,sa.jsx)(e.h2,{children:"Streaming + 무한스크롤 + 낙관적 업데이트"}),"\n",(0,sa.jsx)(e.p,{children:"고민을 해보니 위의 세가지 (suspense, 무한스크롤, 낙관적 업데이트) 를 모두 적용할 수 있는 부분이 댓글 이라는 생각이 들었다."}),"\n",(0,sa.jsx)(e.p,{children:"댓글은 streaming방식과 무한스크롤 방식으로 구현하면 좋고 이를 수정, 추가, 삭제할 때 낙관적 업데이트가 적용된다면 엄청난 UX 향상이 있지 않나 싶었다."}),"\n",(0,sa.jsx)(e.p,{children:"제일 까다로운건 타입스크립트였다 (안에까지 들어가서 분석하면서 만드는게 참 쉽지 않았다...)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"usePostCommentsMutation"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queryClient = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useQueryClient"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," mockTime = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toISOString"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMutation"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mutationFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ articleId, content }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PostCommentsMutation"})]}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"postArticlesArticleIdComments"}),"({\n        articleId,\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": { content },\n      }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onMutate"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," ({ articleId, content, id, image, nickname }) => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cancelQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n      });\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," previousComments = queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"getQueryData"}),"<\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }]);\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (previousComments) {\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n          >,\n          [",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," }],\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n          >\n        >(\n          [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n          ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"input"}),":\n              | ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n                  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n                  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n                >\n              | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n          "]}),") =>"]})," {\n            ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!input) {\n              ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pages"}),": [\n                  {\n                    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nextCursor"}),": ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),",\n                    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"list"}),": [\n                      {\n                        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"writer"}),": {\n                          image,\n                          nickname,\n                          id,\n                        },\n                        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": mockTime,\n                        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": mockTime,\n                        content,\n                        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": -",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n                      },\n                    ],\n                  },\n                ],\n                ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pageParams"}),": [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"],\n              };\n            }\n            ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pages"}),": [\n                {\n                  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nextCursor"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pages"}),"[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"].",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextCursor"}),",\n                  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"list"}),": [\n                    {\n                      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"writer"}),": {\n                        image,\n                        nickname,\n                        id,\n                      },\n                      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": mockTime,\n                      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"createdAt"}),": mockTime,\n                      content,\n                      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": -",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),",\n                    },\n                    ...input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pages"}),"[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"].",(0,sa.jsx)(e.span,{className:"hljs-property",children:"list"}),",\n                  ],\n                },\n                ...input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pages"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"slice"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"),\n              ],\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pageParams"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pageParams"}),",\n            };\n          },\n        );\n      }\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { previousComments };\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onError"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, variables, context"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showToast"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"error"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"댓글 등록에 실패했습니다."'}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (context?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),") {\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n        >(\n          [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": variables.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"articleId"})," }],\n          context.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),",\n        );\n      }\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSettled"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data, error, variables"}),") =>"]})," {\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"invalidateQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": variables.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"articleId"})," }],\n      });\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"invalidateQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"article"'}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": variables.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"articleId"})," }],\n      });\n    },\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"중요한건 useInfiniteQuery를 거친 데이터(쿼리)는 서버에서 주는 데이터 구조와는 다르다는 것"}),"\n",(0,sa.jsx)(e.p,{children:"pages 단위의 배열과 pageParams를 가진 객체가 최상단 구조입니다."}),"\n",(0,sa.jsxs)(e.p,{children:["결론적으로 ",(0,sa.jsx)(e.code,{children:"pages[0]"}),"부분만 바로 낙관적 업데이트 시켜주면 됩니다."]}),"\n",(0,sa.jsx)(e.p,{children:"추가 로직을 구현했으니 삭제, 수정 로직도 비슷하게 구현할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"댓글 삭제의 코드는 다음과 같다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useDeleteCommentsMutation"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queryClient = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useQueryClient"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMutation"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mutationFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ commentId }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"DeleteCommentsMutation"})]}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"deleteCommentsCommentId"}),"({\n        commentId,\n      }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onMutate"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," ({ articleId, commentId }) => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cancelQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n      });\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," previousComments = queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"getQueryData"}),"<\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }]);\n\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n        | ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n          >\n        | ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"undefined"}),",\n        [",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," }],\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n        >\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }], ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"input"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!input) {\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," input;\n        } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pages"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pages"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"page"}),") =>"]})," ({\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nextCursor"}),": page.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextCursor"}),",\n              ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"list"}),": page.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"list"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"filter"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"comment"}),") =>"]})," comment.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," !== commentId),\n            })),\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pageParams"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pageParams"}),",\n          };\n        }\n      });\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { previousComments };\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onError"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, variables, context"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (context?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),") {\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n        >(\n          [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": variables.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"articleId"})," }],\n          context.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),",\n        );\n      }\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSettled"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data, error, variables"}),") =>"]})," {\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"invalidateQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": variables.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"articleId"})," }],\n      });\n    },\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"댓글 수정 코드"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"usePatchCommentsMutation"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queryClient = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useQueryClient"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useMutation"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mutationFn"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ commentId, data }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"PatchCommentsMutation"})]}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"patchCommentsCommentId"}),"({ data, commentId }),\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onMutate"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," ({ articleId, ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": { content }, commentId }) => {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"cancelQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n      });\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," previousComments = queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"getQueryData"}),"<\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }]);\n\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n        >,\n        [",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"string"}),", { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"articleId"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"number"})," }],\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),",\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),"[",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"nextCursor"'}),"]\n        >\n      >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }], ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"input"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!input) {\n          ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," input;\n        }\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pages"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pages"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"page"}),") =>"]})," ({\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nextCursor"}),": page.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nextCursor"}),",\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"list"}),": page.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"list"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"comment"}),") =>"]})," {\n              ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (comment.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"})," === commentId) {\n                ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," {\n                  ...comment,\n                  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"updatedAt"}),": ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"toISOString"}),"(),\n                  content,\n                };\n              }\n              ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," comment;\n            }),\n          })),\n          ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"pageParams"}),": input.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"pageParams"}),",\n        };\n      });\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," { previousComments };\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onError"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, { articleId }, context"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showToast"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"error"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"댓글 수정에 실패했습니다."'}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (context?.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),") {\n        queryClient.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"setQueryData"}),"<\n          ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"InfiniteData"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"GetArticlesArticleIdCommentsResponse"}),">\n        >([",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }], context.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"previousComments"}),");\n      }\n    },\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSettled"}),": ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data, error, { articleId }"}),") =>"]})," {\n      queryClient.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"invalidateQueries"}),"({\n        ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"queryKey"}),": [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"comments"'}),", { articleId }],\n      });\n    },\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"사실 코드 구현보다도 setQueryData와 InfiniteData의 타입을 읽으려고 더 노력했던 것 같다."}),"\n",(0,sa.jsx)(e.p,{children:"결론적으로는 다음의 구조만 알면 쉬웠다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.code,{children:"setQueryData<받는 데이터, 쿼리 키, 주는 데이터>"})}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.code,{children:"InfiniteData<전체 데이터 구조, pageParam의 구조>"})}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"트러블 슈팅"}),"\n",(0,sa.jsx)(e.h4,{children:"댓글을 연속으로 넣으면 두개씩 생겨버렸다."}),"\n",(0,sa.jsx)(e.p,{children:"생각해보니 댓글을 올리는 mutation이 pending 상태일 때나 그것과 연결된 쿼리가 아직 fetch하는 중일 때 댓글을 날려버리면 mutation이 엉켜서 문제가 발생합니다."}),"\n",(0,sa.jsx)(e.p,{children:"네이버는 댓글 관련 문제를 어떻게 해결하는지 보기 위해 네이버 웹툰 댓글을 같이 확인하면서 개발 중이었는데 거기선 이 문제를 연속 입력시 도배 방지로 댓글을 막는 것으로 해결한 것 같았다."}),"\n",(0,sa.jsx)(e.p,{children:"댓글 관련 infiniteQuery를 가져와서 isFetching (query가 fetch중인지 확인) 을 읽고, mutation의 isPending (mutation 실행 중인 상태 확인)을 읽어서 제한 조건에 해당하면 alert를 꺼내도록 로직을 구현해서 문제를 해결하였습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"default"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"CommentForm"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["{ boardId }: ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"ArticleCommentProps"})]}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { register, handleSubmit, setValue } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useForm"}),"({\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"mode"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"onSubmit"'}),",\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"resolver"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"yupResolver"}),"(schema),\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," articleId = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Number"}),"(boardId);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"data"}),": user } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useUserQuery"}),"();\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { isFetching } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"useArticlesCommentsQuery"}),"(articleId);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { mutate, isPending } = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"usePostCommentsMutation"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"onSubmit"}),": ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"SubmitHandler"}),"<",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CommentForm"}),"> = ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"formData"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (isFetching || isPending) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(\n        ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"도배 방지를 위하여 글을 입력한 후 일정시간 동안 추가입력을 제한하고 있습니다."'}),",\n      );\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n    }\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!user) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"잠시 후에 다시 시도해주세요."'}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"}),";\n    }\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"mutate"}),"({\n      articleId,\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"content"}),": formData.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"content"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"id"}),": user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"id"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"image"}),": user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"image"}),",\n      ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"nickname"}),": user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"nickname"}),",\n    });\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"setValue"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"content"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'""'}),");\n  };\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"onInvalid"})," = (",(0,sa.jsxs)(e.span,{className:"hljs-params",children:[(0,sa.jsx)(e.span,{className:"hljs-attr",children:"error"}),": ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"any"})]}),") => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(error.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"content"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"message"}),");\n  };\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"하이드레이션 에러"}),"\n",(0,sa.jsx)(e.p,{children:"댓글 수정을 구현할 때 하이드레이션 에러가 발생했습니다."}),"\n",(0,sa.jsx)(e.p,{children:"time때문에 발생한 것인데 서버에서 dehydrate된 query에서의 time과 클라이언트 단에서 나온 time이 달라서 발생한 문제였습니다."}),"\n",(0,sa.jsx)(e.p,{children:"new Date()로 구현되어 있기 때문에 다를 수 밖에 없었다."}),"\n",(0,sa.jsx)(e.p,{children:"이를 해결하기 위해 suppressHydrationWarning 이용해서 SSR 제거하였고 낙관적 업데이트를 정상적으로 적용할 수 있었다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:["<time\n  className=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"border-border-primary text-text-disabled border-l border-opacity-10 pl-4 text-xs font-medium leading-3 md:text-sm md:leading-[14px]"'}),"\n  suppressHydrationWarning\n>\n  {timeDiff} {comment.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"updatedAt"})," !== comment.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"createdAt"})," && ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"(수정됨)"'}),"}\n</time>\n"]})}),"\n",(0,sa.jsx)(e.h1,{children:"후기"}),"\n",(0,sa.jsx)(e.p,{children:"Tanstack Query에 푹 빠져서 쿼리 관리를 했던 소중한 경험이었다."}),"\n",(0,sa.jsx)(e.p,{children:"귀찮고 반복적인 일은 전부 함수로 만들어 놓은 개발의 세계에서 당연히 있겠지 싶었던 기능들의 집합체가 Tanstack query지 않나 싶었다."}),"\n",(0,sa.jsx)(e.p,{children:"새로운 기술을 배우는 건 늘 트러블 슈팅이 따르지만 그걸 해내는 쾌감이 너무 좋아서 계속 배우게 되는 것 같다."}),"\n",(0,sa.jsx)(e.p,{children:"더 성장해보겠습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"꼼꼼 프로젝트 진행 중에 겪은 경험들입니다. 오늘도 많이 성장한 것 같아요!"}),"\n",(0,sa.jsx)(e.p,{children:"읽어주셔서 감사합니다! 지켜봐주세요!"}),"\n",(0,sa.jsx)(e.p,{children:"감사합니다."}),"\n"]})]})}function eY(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(e$,{...s})}):e$(s)}function eK(s){let e={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"https://velog.velcdn.com/images/codefug/post/1863b8a0-6521-495b-85f2-22b0f35b6380/image.png",alt:""})}),"\n",(0,sa.jsx)(e.h1,{children:"Understanding Asynchronous Communication"}),"\n",(0,sa.jsx)(e.p,{children:"JS operates on a Single Thread, meaning it can only process one task at a time in a synchronous manner."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"Synchronous: Processing tasks in a serial manner, where the next task is processed only after a request starts and a response is received"}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"Asynchronous: Processing tasks in parallel, where the next task is processed regardless of whether a response has been received after a request starts"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Even when a network request for search occurs as a user enters a search term, other tasks can be processed. (Asynchronous operation)"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"In React, methods for asynchronous operation were introduced starting from version 16."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Single-Threaded JavaScript"}),"\n",(0,sa.jsxs)(e.p,{children:["In the past, the only unit for executing programs was the ",(0,sa.jsx)(e.strong,{children:"Process"}),"."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Process"})}),"\n",(0,sa.jsx)(e.p,{children:"A unit of work that runs a program and executes the program's state in memory"}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["Currently, multiple tasks are needed for a single program, and the smaller execution unit called ",(0,sa.jsx)(e.strong,{children:"thread"})," was created."]}),"\n",(0,sa.jsx)(e.p,{children:"thread: Multiple threads can be created within a single process, and threads can share memory with each other. Multiple tasks can be performed simultaneously."}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript is fundamentally single-threaded."}),"\n",(0,sa.jsx)(e.h2,{children:"Why JavaScript is Not Multi-Threaded"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Multi-threading is internally complex and can cause concurrency issues such as multiple modifications to the same resource, requiring handling of these issues."}),"\n",(0,sa.jsxs)(e.li,{children:["Unlike isolated ",(0,sa.jsx)(e.strong,{children:"Processes"}),", if one ",(0,sa.jsx)(e.strong,{children:"Thread"})," encounters a problem, other ",(0,sa.jsx)(e.strong,{children:"Threads"})," can also be affected."]}),"\n",(0,sa.jsxs)(e.li,{children:["If JS supported ",(0,sa.jsx)(e.strong,{children:"multi-threading"}),", allowing multiple threads to manipulate the DOM simultaneously, memory sharing would cause simultaneous access to the same resources, leading to timing issues and significant problems with DOM rendering."]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Event Loop"}),"\n",(0,sa.jsxs)(e.p,{children:["The concept inseparable from asynchronous operations is the ",(0,sa.jsx)(e.code,{children:"Event Loop"}),"."]}),"\n",(0,sa.jsxs)(e.p,{children:["Just like ",(0,sa.jsx)(e.code,{children:"Node.js"}),", browser-side JavaScript execution flow is based on the ",(0,sa.jsx)(e.code,{children:"Event Loop"}),"."]}),"\n",(0,sa.jsxs)(e.p,{children:["Understanding the ",(0,sa.jsx)(e.code,{children:"Event Loop"})," well is essential for proper architecture design."]}),"\n",(0,sa.jsx)(e.h3,{children:"How the JavaScript Engine Works"}),"\n",(0,sa.jsx)(e.p,{children:"The JavaScript engine has the following algorithm:"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["When there are tasks to process","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Process tasks in the order they arrived (first in, first out)."}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.li,{children:["When there are no tasks to process","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Sleep until a new task is added, then return to step 1."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"The JavaScript engine spends most of its time idle, only running when scripts, handlers, or events are activated."}),"\n",(0,sa.jsx)(e.p,{children:"Tasks that activate the JavaScript engine include:"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["When an external script ",(0,sa.jsx)(e.code,{children:'<script src="...">'})," is loaded, executing that script"]}),"\n",(0,sa.jsxs)(e.li,{children:["When a user moves the mouse, executing the ",(0,sa.jsx)(e.code,{children:"mousemove"})," event and event handler"]}),"\n",(0,sa.jsxs)(e.li,{children:["When the time set in ",(0,sa.jsx)(e.code,{children:"setTimeout"})," elapses, executing the callback function"]}),"\n",(0,sa.jsx)(e.li,{children:"And so on"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Tasks form a single set. The JavaScript engine processes these tasks sequentially and waits until new tasks are added. While waiting for tasks, CPU resource consumption approaches zero and the engine sleeps."}),"\n",(0,sa.jsxs)(e.p,{children:["When a task is added while the engine is busy, that task is added to the ",(0,sa.jsx)(e.strong,{children:"Macrotask queue"}),"."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["Note that the structure of ",(0,sa.jsx)(e.code,{children:"task queue"})," is a ",(0,sa.jsx)(e.code,{children:"set"}),", not a ",(0,sa.jsx)(e.code,{children:"queue"}),". This is because we need to select the oldest executable task from the selected queue.\nInstead of unconditionally dequeuing the first queue that arrived, we execute the oldest task among the executable ones in order."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3",children:"https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3"})}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108212123.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["(This diagram shows the state when processing ",(0,sa.jsx)(e.code,{children:"script"}),", with a ",(0,sa.jsx)(e.code,{children:"mousemove"})," handler also executing in the middle, and a callback arriving after the time set in ",(0,sa.jsx)(e.code,{children:"setTimeout"})," has elapsed)"]}),"\n",(0,sa.jsx)(e.p,{children:"The JavaScript engine processes these in order."}),"\n",(0,sa.jsx)(e.p,{children:"Two important things to know at this point:"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Rendering does not occur while the engine is processing a task. After processing is complete, DOM changes are reflected on the screen."}),"\n",(0,sa.jsx)(e.li,{children:'If a task takes a long time, new tasks that occur while processing that task cannot be handled. (The "unresponsive page" alert allows you to choose whether to minimize the current task along with the entire page.)'}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"Example 1: Splitting CPU-Intensive Tasks"}),"\n",(0,sa.jsx)(e.p,{children:"Let's assume there is one very CPU-intensive task."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," start = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Perform a heavy CPU-intensive task"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"for"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," j = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"; j < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e9"}),"; j++) {\n    i++;\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Time taken: "'})," + (",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"() - start) + ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"ms"'}),");\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["This code counts 1e9 (nine zeros) and then shows an alert. You can see that while ",(0,sa.jsx)(e.code,{children:"count()"})," is executing, the browser completely stops processing user events or DOM-related tasks.\n(When you run this and right-click on the page, nothing appears until the alert shows, and then the right-click menu appears after the alert.)"]}),"\n",(0,sa.jsx)(e.p,{children:"Let's improve this by splitting the code."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," start = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Split the heavy task and perform it (*)"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"do"})," {\n    i++;\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Exits the do while loop at multiples of 1e6: 2*1e6, 3*1e6, etc."}),"\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"while"})," (i % ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e6"})," != ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (i == ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e9"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Reaches here after repeating the do while loop 1e3 times"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Time taken: "'})," + (",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"() - start) + ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"ms"'}),");\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If it's a multiple of 1e6 but not 1e9"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(count); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Schedule a new call (**)"}),"\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["The alert appears after repeating the do while loop 1e3 times. Before that, since ",(0,sa.jsx)(e.code,{children:"count"})," is passed via ",(0,sa.jsx)(e.code,{children:"setTimeout"}),", synchronous code can run, allowing event handlers and DOM-related operations to be handled."]}),"\n",(0,sa.jsxs)(e.p,{children:["The above code actually has a slight time difference. We can fix this by moving ",(0,sa.jsx)(e.code,{children:"setTimeout"})," forward as follows."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," start = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Move scheduling code to the beginning of the function"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (i < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e9"})," - ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e6"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(count); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Schedule a new call"}),"\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"do"})," {\n    i++;\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"while"})," (i % ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e6"})," != ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (i == ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e9"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Time taken: "'})," + (",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"() - start) + ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"ms"'}),");\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["Partial rescheduling (",(0,sa.jsx)(e.code,{children:"setTimeout"}),") occurs before partial counting (",(0,sa.jsx)(e.code,{children:"do...while"}),")."]}),"\n",(0,sa.jsxs)(e.p,{children:["When there are many ",(0,sa.jsx)(e.code,{children:"setTimeout"})," calls, since the browser's minimum wait time is 4 milliseconds, scheduling before counting allows the wait time to be consumed while counting, making execution faster.\n(If the setTimeout logic is at the end, setTimeout(count) executes and count should run as the next macrotask, but it doesn't run immediately and waits 4ms before executing.)"]}),"\n",(0,sa.jsx)(e.h3,{children:"Example 2: Progress Bar"}),"\n",(0,sa.jsxs)(e.p,{children:["The advantage of splitting tasks into multiple parts is also evident when creating a ",(0,sa.jsx)(e.code,{children:"progress bar"})," to show progress status."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["<div id=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"progress"'}),"></div>\n\n",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]}),(0,sa.jsxs)(e.span,{className:"javascript",children:["\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"for"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"; i < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e6"}),"; i++) {\n      i++;\n      progress.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n    }\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]}),(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]})]}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"The browser renders DOM changes only after the current task in progress is complete, regardless of how long it takes."}),"\n",(0,sa.jsxs)(e.p,{children:["Therefore, the above code cannot fulfill the function of a ",(0,sa.jsx)(e.code,{children:"progress bar"}),". This is because DOM rendering only occurs after i has completely passed (after the current task in progress is complete)."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["<div id=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"progress"'}),"></div>\n\n",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]}),(0,sa.jsxs)(e.span,{className:"javascript",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Split the heavy task and perform it"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"do"})," {\n      i++;\n      progress.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"while"})," (i % ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e3"})," != ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (i < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e7"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(count);\n    }\n\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]}),(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]})]}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["By splitting the code as above, we can output the process of i changing. Since ",(0,sa.jsx)(e.code,{children:"count"})," is passed via ",(0,sa.jsx)(e.code,{children:"setTimeout"}),", synchronous operations can be performed between count and the count function, and ultimately the DOM change operation that ",(0,sa.jsx)(e.code,{children:"progress.innerHTML"})," has changed occurs."]}),"\n",(0,sa.jsx)(e.h3,{children:"Example 3: Work After Event Processing is Complete"}),"\n",(0,sa.jsxs)(e.p,{children:["When creating an event handler, if you want to execute a specific action after all event bubbling is complete, you can use ",(0,sa.jsx)(e.code,{children:"setTimeout"})," with ",(0,sa.jsx)(e.code,{children:"ms"})," set to 0."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["menu.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onclick"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create a custom event containing information about the clicked menu item"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," customEvent = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomEvent"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"menu-open"'}),", {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"bubbles"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Dispatch the custom event asynchronously"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," menu.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dispatchEvent"}),"(customEvent));\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:'Looking at the above, a custom event called "menu-open" is created and then passed via setTimeout.'}),"\n",(0,sa.jsxs)(e.p,{children:["Now the ",(0,sa.jsx)(e.code,{children:"menu-open"})," event is dispatched after the menu's click event is completely handled."]}),"\n",(0,sa.jsx)(e.h2,{children:"Macrotask and Microtask"}),"\n",(0,sa.jsx)(e.h3,{children:"Microtask"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Microtask"})," is mainly created using ",(0,sa.jsx)(e.code,{children:"Promise"}),"."]}),"\n",(0,sa.jsxs)(e.p,{children:["Handlers (consumer functions) of ",(0,sa.jsx)(e.code,{children:".then/catch/finally"})," used with ",(0,sa.jsx)(e.code,{children:"Promise"})," become ",(0,sa.jsx)(e.code,{children:"Microtask"}),". They can also be created using ",(0,sa.jsx)(e.code,{children:"await"})," which handles ",(0,sa.jsx)(e.code,{children:"Promise"}),"."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["Additionally, you can use the standard API ",(0,sa.jsx)(e.code,{children:"queueMicrotask(func)"})," to put function ",(0,sa.jsx)(e.code,{children:"func"})," into the ",(0,sa.jsx)(e.code,{children:"Microtask Queue"})," for processing."]}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["Each time the JavaScript engine processes one ",(0,sa.jsx)(e.strong,{children:"Macrotask"}),", it executes all tasks in the ",(0,sa.jsx)(e.strong,{children:"Microtask Queue"})," before performing other ",(0,sa.jsx)(e.code,{children:"Macrotask"})," or rendering operations."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"timeout"'}),"));\n\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise"'}),"));\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"code"'}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (Currently in a Macrotask that reads code in the script tag, executing code line by line)"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// 1. setTimeout(()=>alert("timeout")) - Executes in call stack, registers callback function in Macrotask queue after ms elapses'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// 2. Promise.resolve().then(()=>alert("promise")) - Registers callback function in Microtask Queue'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// 3. alert("code") - Called immediately. (Currently executing Macrotask that reads script tag.)'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 4. Macrotask that reads code in script tag ends"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 5. Execute then() callback function in Microtask queue (moves to call stack and executes, event loop doesn't return until this process is completely emptied)"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 6. Microtask queue is emptied"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// 7. ()=>alert("timeout") - Execute next Macrotask (move one Macrotask from call stack)'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (After that Macrotask ends, execute Microtask again to empty Microtask queue, then render > repeat next Macrotask execution)"}),"\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"Processing Logic"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241109193930.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["You can see that after one ",(0,sa.jsx)(e.code,{children:"Macrotask (script, mousemove, setTimeout, etc.)"})," is processed, all ",(0,sa.jsx)(e.code,{children:"Microtask"})," are processed, and then rendering proceeds."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"All Microtasks are processed before other event handlers, rendering operations, or other Macrotasks are executed."})}),"\n",(0,sa.jsxs)(e.p,{children:["Since reading code in script tags is also a ",(0,sa.jsx)(e.code,{children:"Macrotask"}),", Microtasks are executed after the process of putting script code into the call stack line by line and executing it is complete."]}),"\n",(0,sa.jsxs)(e.p,{children:["The reason this processing order is very important is that all ",(0,sa.jsx)(e.code,{children:"Microtask"})," can be processed in the same environment without being affected by tasks that change the application environment, such as mouse coordinate changes or data changes from network communication."]}),"\n",(0,sa.jsx)(e.p,{children:'The order is: "After current executing macrotask ends > Execute all existing microtasks > Render > Execute next macrotask".'}),"\n",(0,sa.jsxs)(e.p,{children:["To verify the above process, let's check using ",(0,sa.jsx)(e.strong,{children:"requestAnimationFrame"}),", which calls a callback function before repaint."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241109221737.png",alt:""})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"requestAnimationFrame"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241109214448.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"A window method used to process animations before browser repaint,"}),"\n",(0,sa.jsx)(e.p,{children:"Managed in a separate queue to ensure frame-by-frame rendering. (Frames per second are set based on monitor refresh rate.)"}),"\n",(0,sa.jsx)(e.p,{children:"Since it ensures frame-by-frame rendering, animation movements become smoother."}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["If you want to send a specific function to the ",(0,sa.jsx)(e.code,{children:"Microtask Queue"})," arbitrarily, you can use the ",(0,sa.jsx)(e.code,{children:"queueMicrotask"})," function.\n(The difference from ",(0,sa.jsx)(e.code,{children:"setTimeout"})," is that when using ",(0,sa.jsx)(e.code,{children:"setTimeout"})," with ",(0,sa.jsx)(e.code,{children:"ms"})," set to 0, it goes to the ",(0,sa.jsx)(e.code,{children:"Macrotask queue"}),", so the specific function will execute when the existing ",(0,sa.jsx)(e.code,{children:"Microtask Queue"})," is all done and the next ",(0,sa.jsx)(e.code,{children:"Macrotask"})," executes.)"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["<div id=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"progress"'}),"></div>\n\n",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]}),(0,sa.jsxs)(e.span,{className:"javascript",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Split the heavy task and perform it"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"do"})," {\n      i++;\n      progress.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"while"})," (i % ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e3"})," != ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (i < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e6"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"queueMicrotask"}),"(count);\n    }\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]}),(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]})]}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Since the count function in the Microtask Queue recursively calls itself and adds new count functions to the Microtask Queue before rendering occurs, only the final value appears on the actual screen. (Browser rendering occurs only after the microtask queue is emptied.)"}),"\n",(0,sa.jsx)(e.p,{children:"Let's understand this more clearly through the following example."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Assume sync, macro, micro elements contain numbers and are controlled by a button."}),"\nbutton.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"click"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"for"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"; i <= ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100000"}),"; i++) {\n    sync.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      macro.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n    }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"queueMicrotask"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      micro.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n    });\n  }\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"When the above handler is executed, the following results occur:"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"sync"})," does not render until it reaches 100,000."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"micro"})," does not render until it reaches 100,000."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"macro"})," waits a moment and then renders sequentially from 1 to 100,000."]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_1.jpg",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["While the sequentially executing code (",(0,sa.jsx)(e.code,{children:"sync.innerHTML = i"}),", ",(0,sa.jsx)(e.code,{children:"setTimeout"}),", ",(0,sa.jsx)(e.code,{children:"queryMicrotask"}),") is running, other operations cannot be performed in the browser. (We cannot discard everything in the call stack and proceed with operations.)"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["WEB APIs like ",(0,sa.jsx)(e.code,{children:"setTimeout"}),"'s timing function (a function that measures time and throws callbacks) run in external threads where the ",(0,sa.jsx)(e.code,{children:"Macrotask queue"})," is allocated. Assigning and processing tasks is the role of the browser or Node.js."]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_2.jpg",alt:""}),"\n",(0,sa.jsx)(e.img,{src:"/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_3.jpg",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["However, if another ",(0,sa.jsx)(e.code,{children:"Macrotask"})," (mouse event, etc.) enters the ",(0,sa.jsx)(e.code,{children:"Macrotask queue"})," in the middle and becomes executable first, the ",(0,sa.jsx)(e.code,{children:"queue"})," will process that ",(0,sa.jsx)(e.code,{children:"Macrotask"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:'Now that we know "why" to use it, let\'s learn more about "how" to use asynchronous operations and their flow in more detail.'}),"\n",(0,sa.jsx)(e.h1,{children:"History and Concepts of Asynchronous Operations"}),"\n",(0,sa.jsx)(e.h2,{children:"Callbacks"}),"\n",(0,sa.jsxs)(e.p,{children:["You can schedule asynchronous operations using functions provided by the host environment. (Functions like ",(0,sa.jsx)(e.code,{children:"setTimeout"}),")"]}),"\n",(0,sa.jsx)(e.p,{children:"Functions that load scripts or modules can also be considered asynchronous. Let's look at an example."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create a <script> tag and add it to the page."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When the tag is added to the page, it loads and executes the script in src."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"script"'}),");\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Load and execute the script at the specified path."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script.js"'}),");\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"At this point, the script executes asynchronously."}),"\n",(0,sa.jsx)(e.p,{children:"Therefore, code below loadScript does not wait for loadScript to finish."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script.js"'}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// script.js contains "function newFunction() {…}"'}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Trying to use newFunction from script.js"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// An error occurs saying the function doesn't exist!"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"newFunction"}),"();\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Let's add a callback here."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Callback Function"})}),"\n",(0,sa.jsx)(e.p,{children:"A function that is mainly passed as an argument to another function within a function. It is called inside the outer function to complete a routine or operation."}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src, callback"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"'script'"}),");\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When script triggers a load event (when loaded), execute callback with script."}),"\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onload"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(script);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"'/my/script.js'"}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Callback function executes after script loading is complete."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"newFunction"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Now the function call works properly."}),"\n  ...\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"The above approach is called callback-based asynchronous programming."}),"\n",(0,sa.jsx)(e.p,{children:"By passing a callback function to loadScript, newFunction can occur alongside asynchronous execution."}),"\n",(0,sa.jsx)(e.h3,{children:"Error Handling"}),"\n",(0,sa.jsx)(e.p,{children:"We need to be able to handle errors that occur when script loading fails."}),"\n",(0,sa.jsx)(e.p,{children:"Let's improve it as follows."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src, callback"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"script"'}),");\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// On success, put null and script as arguments"}),"\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onload"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", script);\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// On failure, put error object as argument"}),"\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onerror"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Error occurred while loading ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${src}"}),"`"]}),"));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script.js"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, script"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error handling"}),"\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Script loading completed successfully"}),"\n  }\n});\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["The above pattern is a common pattern called ",(0,sa.jsx)(e.strong,{children:"error-first callback"})," used to handle errors."]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"The first argument of callback is reserved for errors."}),"\n",(0,sa.jsx)(e.li,{children:"The second or subsequent arguments are arguments to pass to the callback function when no error occurs."}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"Callback within Callback"}),"\n",(0,sa.jsx)(e.p,{children:"If you want to load two scripts sequentially, you need to put a callback inside a callback."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script.js"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script2.js"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script3.js"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Executes after all three scripts are loaded"}),"\n    });\n  });\n});\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Callback Hell"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107193715.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"The above approach creates a situation called the pyramid of doom, or callback hell.\n(A situation where code gradually shifts to the right, harming readability and making code reuse difficult)"}),"\n",(0,sa.jsx)(e.p,{children:"To solve this, we can logically write it as follows:"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"1.js"'}),", step1);\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"step1"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, script"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleError"}),"(error);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2.js"'}),", step2);\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"step2"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, script"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleError"}),"(error);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"3.js"'}),", step3);\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"step3"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, script"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleError"}),"(error);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Perform other operations after all scripts are loaded."}),"\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This only improves the appearance; the internal logic still has the problem of needing to jump up and down to understand it, and code reuse remains difficult."}),"\n",(0,sa.jsx)(e.h3,{children:"Should We Never Use Callbacks?"}),"\n",(0,sa.jsx)(e.p,{children:"No."}),"\n",(0,sa.jsx)(e.p,{children:"They are still useful when you need to ensure a specific action is complete before executing the next code."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showCircle"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"150"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"150"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),", ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"div"}),") =>"]})," {\n  div.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"classList"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"add"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"message-ball"'}),");\n  div.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Hello!"'}),");\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Let's say showCircle(cx, cy, radius, callback) is a function that creates a slowly growing circle."}),"\n",(0,sa.jsx)(e.p,{children:'Inside the function, you can use that callback to execute a function that draws "Hello!" on the element after the circle is completely created.'}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["Using callbacks moves that task to the Macrotask queue rather than the Microtask Queue. (The behavior of ",(0,sa.jsx)(e.code,{children:"setTimeout"}),")\nThe difference between Microtask Queue and Macrotask queue can be understood in the lower part of this article."]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Promise"}),"\n",(0,sa.jsx)(e.p,{children:'When "producing code" that produces a promised result is ready, regardless of how long it takes, it allows all "consuming code" to use the result.'}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Producing Code"})}),"\n",(0,sa.jsx)(e.p,{children:"Time-consuming tasks like loading scripts from remote locations"}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Consuming Code"})}),"\n",(0,sa.jsx)(e.p,{children:"Waits for the result of producing code and then consumes it. There can be multiple consuming entities (functions)."}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// executor (producing code, 'producer')"}),"\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// promise.then/catch/finally etc."}),"\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"executor Function"}),"\n",(0,sa.jsxs)(e.p,{children:["The callback passed to ",(0,sa.jsx)(e.code,{children:"new Promise"})," is called executor and is automatically executed when ",(0,sa.jsx)(e.code,{children:"new Promise"})," is created, containing producing code that ultimately produces the result."]}),"\n",(0,sa.jsx)(e.p,{children:"In executor, you can write code without worrying about resolve and reject, but you must call either resolve or reject depending on the situation."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"resolve(value) - Called when the task completes successfully, with value representing the result"}),"\n",(0,sa.jsxs)(e.li,{children:["reject(error) - Called when an error occurs, with ",(0,sa.jsx)(e.code,{children:"error"})," representing the error object"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107200211.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"The promise object returned by the new Promise constructor has internal properties called PromiseState and PromiseResult."}),"\n",(0,sa.jsx)(e.p,{children:"When neither resolve nor reject occurs:"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107195926.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"When resolve occurs:"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107195831.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"When reject occurs:"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107200104.png",alt:""})}),"\n",(0,sa.jsx)(e.h4,{children:"executor Example"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["executor is automatically and immediately called by ",(0,sa.jsx)(e.code,{children:"new Promise"}),"."]}),"\n",(0,sa.jsxs)(e.li,{children:["executor receives ",(0,sa.jsx)(e.code,{children:"resolve"})," and ",(0,sa.jsx)(e.code,{children:"reject"})," functions as arguments. These functions are predefined by the JavaScript engine, so developers don't need to create them separately. However, one of ",(0,sa.jsx)(e.code,{children:"resolve"})," or ",(0,sa.jsx)(e.code,{children:"reject"})," must be called."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When Promise is created, executor function is automatically executed."}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// After 1 second, a signal that the task completed successfully is sent, and result becomes 'done'."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"done"'}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107200545.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// After 1 second, sends a signal that execution ended with an error."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),")), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107200740.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["A ",(0,sa.jsx)(e.code,{children:"Promise"})," where ",(0,sa.jsx)(e.code,{children:"resolve"})," or ",(0,sa.jsx)(e.code,{children:"reject"})," is complete is called a ",(0,sa.jsx)(e.code,{children:"settled Promise"}),"."]}),"\n",(0,sa.jsx)(e.h3,{children:"Notes"}),"\n",(0,sa.jsx)(e.h4,{children:"1. Once a Promise is settled, it cannot be changed."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"done"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"…"'}),")); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Ignored"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"…"'}),")); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Ignored"}),"\n});\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"2. Must reject with an Error object."}),"\n",(0,sa.jsx)(e.h4,{children:"3. Promise doesn't necessarily have to deal with asynchronous things."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Task doesn't take time to complete"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"123"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Immediately passes result (123) to resolve"}),"\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Doing it this way results in an immediately fulfilled state."}),"\n",(0,sa.jsx)(e.h4,{children:"4. PromiseState and PromiseResult are internal properties, so they cannot be accessed directly."}),"\n",(0,sa.jsx)(e.h3,{children:"Consumer Functions"}),"\n",(0,sa.jsxs)(e.p,{children:["Consumer functions are registered using the ",(0,sa.jsx)(e.code,{children:".then"}),", ",(0,sa.jsx)(e.code,{children:".catch"}),", ",(0,sa.jsx)(e.code,{children:".finally"})," methods."]}),"\n",(0,sa.jsx)(e.h4,{children:".then"}),"\n",(0,sa.jsx)(e.p,{children:"Consumer function that executes after Promise fulfilled or rejected is complete"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"done!"'}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// resolve function executes the first function (argument) of .then."}),"\npromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(\n  ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// Outputs "done!" after 1 second'}),"\n  ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(error), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Not executed"}),"\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"If you only want to handle success, you can omit the second argument."}),"\n",(0,sa.jsx)(e.h4,{children:".catch"}),"\n",(0,sa.jsxs)(e.p,{children:["You can handle only errors in the form ",(0,sa.jsx)(e.code,{children:".then(null, errorHandler)"}),", but you can express it more concisely using ",(0,sa.jsx)(e.code,{children:".catch"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),")), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// .catch(f) works the same as promise.then(null, f)"}),"\npromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// Outputs "Error: Error occurred!" after 1 second'}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:".finally"}),"\n",(0,sa.jsx)(e.p,{children:"A method that always executes when Promise is settled"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"/* Perform some time-consuming task, then call resolve, reject */"}),"\n})\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Executes regardless of success or failure when Promise is settled"}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"finally"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," stop loading indicator)\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"})," =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result), ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"})," =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(error));\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"finally takes no arguments and automatically passes the result or error to the next handler."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"result"'}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2000"}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"finally"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise is ready."'}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result)); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// <-- .then can handle result"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// After 2 seconds"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "Promise is ready."'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "result"'}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"finally"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise is ready."'}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(err)); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// <-- .catch can handle error object"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "Promise is ready."'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "Error occurred"'}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Real Usage Example"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src, callback"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"script"'}),");\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onload"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", script);\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onerror"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Error occurred while loading ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${src}"}),"`"]}),"));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"The above code is callback-based. It was implemented by directly embedding callbacks inside onload and onerror."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"script"'}),");\n    script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n\n    script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onload"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(script);\n    script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onerror"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Error occurred while loading ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${src}"}),"`"]}),"));\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Using Promise allows you to extract callback logic outside. You can only receive arguments passed in, and can use it as follows:"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(\n  ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.js"'}),",\n);\n\npromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(\n  ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Loaded ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${script.src}"}),"!`"]}),"),\n  ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Error: ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${error.message}"}),"`"]}),"),\n);\n\npromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Another handler..."'}),"));\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Now, by using then, catch, finally methods, you just throw in consumer functions, and the stored promise automatically puts arguments into the consumer functions and executes them."}),"\n",(0,sa.jsx)(e.h3,{children:"Promise Chaining"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107204412.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"A method of processing asynchronous tasks sequentially by chaining Promises"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (**)"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," result * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),";\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (***)"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," result * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),";\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 4"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," result * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),";\n  });\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["The above code works because ",(0,sa.jsx)(e.code,{children:".then"})," returns a Promise. The return value of ",(0,sa.jsx)(e.code,{children:".then"})," becomes the ",(0,sa.jsx)(e.code,{children:"result"})," of that Promise."]}),"\n",(0,sa.jsx)(e.h4,{children:"Returning Another Promise from Within a Consumer Function"}),"\n",(0,sa.jsxs)(e.p,{children:["By default, ",(0,sa.jsx)(e.code,{children:".then"})," wraps the value it returns in a ",(0,sa.jsx)(e.code,{children:"Promise"})," and returns it, but you can also create and return a ",(0,sa.jsx)(e.code,{children:"Promise"})," from ",(0,sa.jsx)(e.code,{children:".then"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(result * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n    });\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (**)"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(result * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n    });\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 4"}),"\n  });\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Real Example"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/one.js"'}),")\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/two.js"'}),");\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/three.js"'}),");\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Call functions defined in the loaded scripts"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// to verify that the scripts are loaded properly."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"one"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"two"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"three"}),"();\n  });\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Now we can improve loadScript."}),"\n",(0,sa.jsx)(e.p,{children:"Since Promise's executor executes immediately and the consumer function connected to the next method executes, you can directly connect methods to the loadScript function that returns a Promise above."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/one.js"'}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script1"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/two.js"'}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script2"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/three.js"'}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script3"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Here you can use functions defined in script1, script2, script3."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"one"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"two"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"three"}),"();\n    });\n  });\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"However, this creates another callback hell."}),"\n",(0,sa.jsx)(e.p,{children:"At this point, since the innermost loadScript can access all outer scopes, it might be better to use it like the above code depending on the need."}),"\n",(0,sa.jsx)(e.h4,{children:"Notes"}),"\n",(0,sa.jsx)(e.h5,{children:"thenable"}),"\n",(0,sa.jsxs)(e.p,{children:["Handlers (executor, consumer functions, etc.) can also return ",(0,sa.jsx)(e.code,{children:"thenable"})," objects that are not Promises."]}),"\n",(0,sa.jsx)(e.p,{children:"Thenable objects emerged from the fact that third-party libraries can implement their own objects compatible with Promise."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Thenable"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"num"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"num"})," = num;\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(resolve); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Since alert is added in the code below, function() { [native code] } appears immediately."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Fulfilled with this.num*2 after 1 second"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"num"})," * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (**)"}),"\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Thenable"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Shows 2 after 1,000 milliseconds"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110210716.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Using fetch with Chaining"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise"})," is frequently used for network requests on the frontend."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url);\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["Executing the above code sends a network request to ",(0,sa.jsx)(e.code,{children:"url"})," and returns a ",(0,sa.jsx)(e.code,{children:"Promise"}),"."]}),"\n",(0,sa.jsxs)(e.p,{children:["fetch passes the resource obtained by connecting to ",(0,sa.jsx)(e.code,{children:"url"})," to the handler when ",(0,sa.jsx)(e.code,{children:"resolve"})," occurs."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When the remote server responds, code below .then executes."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// response.text() creates a new fulfilled Promise with the response text"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// and returns it when the entire response text is downloaded."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"text"}),"();\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"text"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Content of the file received from remote"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(text); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// {"name": "Violet-Bora-Lee", "isAdmin": true}'}),"\n  });\n"]})}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["When the remote server sends a response with headers, ",(0,sa.jsx)(e.code,{children:"Promise"})," becomes ",(0,sa.jsx)(e.code,{children:"fulfilled"})," with the ",(0,sa.jsx)(e.code,{children:"response"})," object."]}),"\n",(0,sa.jsxs)(e.li,{children:["Promise becomes ",(0,sa.jsx)(e.code,{children:"fulfilled"})," before the entire ",(0,sa.jsx)(e.code,{children:"response"})," is completely downloaded."]}),"\n",(0,sa.jsxs)(e.li,{children:["To read the entire ",(0,sa.jsx)(e.code,{children:"response"})," after it's fully downloaded, you must call ",(0,sa.jsx)(e.code,{children:"response.text()"}),". (",(0,sa.jsx)(e.code,{children:"response.text()"})," returns a ",(0,sa.jsx)(e.code,{children:"fulfilled"})," ",(0,sa.jsx)(e.code,{children:"Promise"})," with the text as the ",(0,sa.jsx)(e.code,{children:"result"})," value when the entire text sent from the server is downloaded.)"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["You can read and parse data as ",(0,sa.jsx)(e.code,{children:"JSON"})," using ",(0,sa.jsx)(e.code,{children:"response.json()"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Same functionality as above code, but response.json() converts content loaded from remote server to JSON."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"name"}),")); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Violet-Bora-Lee, successfully retrieved only the name"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["Let's check an example of sending ",(0,sa.jsx)(e.code,{children:"fetch"})," sequentially."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Send request to user.json."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Load the received content as json."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Send request to GitHub."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${user.name}"}),"`"]}),"))\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Load the received content as json."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Show avatar image (githubUser.avatar_url) for 3 seconds."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," img = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"img"'}),");\n    img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = githubUser.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"avatar_url"}),";\n    img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"className"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise-avatar-example"'}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"body"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(img);\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," img.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"remove"}),"(), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n  });\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["If you want to do something more in the last then, you can return a ",(0,sa.jsx)(e.code,{children:"Promise"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${user.name}"}),"`"]}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," img = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"img"'}),");\n        img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = githubUser.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"avatar_url"}),";\n        img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"className"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise-avatar-example"'}),";\n        ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"body"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(img);\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n          img.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"remove"}),"();\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(githubUser); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (**)"}),"\n        }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),");\n      }),\n  )\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Operates after 3 seconds"}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") =>"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Successfully displayed image of ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${githubUser.name}"}),"`"]}),"),\n  );\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"The above code can be organized as follows to improve readability."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadJson"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"());\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadGithubUser"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"name"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${name}"}),"`"]}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]}),"\n    response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"(),\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showAvatar"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," img = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"img"'}),");\n    img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = githubUser.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"avatar_url"}),";\n    img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"className"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise-avatar-example"'}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"body"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(img);\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      img.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"remove"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(githubUser);\n    }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),");\n  });\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Perform the same task again using functions"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadJson"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadGithubUser"}),"(user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"name"}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(showAvatar)\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Finished showing ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${githubUser.name}"}),"`"]}),"));\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"In conclusion, Promise Chaining has the following structure."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107212119.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Promise and Error Handling"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When url doesn't exist"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://no-such-server.blabla"'}),") ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// rejected"}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(err));\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// TypeError: failed to fetch (output may vary)"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["When ",(0,sa.jsx)(e.code,{children:"Promise"})," is rejected, control flow moves to the nearest ",(0,sa.jsx)(e.code,{children:"rejection"})," handler."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When JSON format is incorrect"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${user.name}"}),"`"]}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," img = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"img"'}),");\n        img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = githubUser.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"avatar_url"}),";\n        img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"className"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise-avatar-example"'}),";\n        ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"body"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(img);\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n          img.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"remove"}),"();\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(githubUser);\n        }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),");\n      }),\n  )\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(error.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"message"}),"));\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Attaching catch at the end of the chain means that if any Promise above is rejected, that catch will catch the error."}),"\n",(0,sa.jsx)(e.h4,{children:"Implicit try...catch"}),"\n",(0,sa.jsxs)(e.p,{children:["There is an implicit ",(0,sa.jsx)(e.code,{children:"try...catch"})," around ",(0,sa.jsx)(e.code,{children:"Promise executor"})," and ",(0,sa.jsx)(e.code,{children:"Promise"})," handler code. When an exception occurs, the implicit ",(0,sa.jsx)(e.code,{children:"try...catch"})," catches the exception and treats it like ",(0,sa.jsx)(e.code,{children:"reject"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// The two codes below have the same functionality."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),");\n}).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: Error occurred!"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),"));\n}).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: Error occurred!"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["Using ",(0,sa.jsx)(e.code,{children:"throw"})," to throw an error means this itself is a rejected ",(0,sa.jsx)(e.code,{children:"Promise"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"OK"'}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise is rejected"}),"\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(error);\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),";\n  }); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: Error occurred!"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110214430.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["This implicit ",(0,sa.jsx)(e.code,{children:"try... catch"})," also catches abnormal errors that occur above the handler."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"OK"'}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"blabla"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Non-existent function"}),"\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ReferenceError: blabla is not defined"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["However, only synchronous errors are handled by the implicit ",(0,sa.jsx)(e.code,{children:"try...catch"}),". If asynchronous code exists inside executor and an error occurs inside, that error cannot be detected."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),");\n  }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n}).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert);\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Re-throwing"}),"\n",(0,sa.jsxs)(e.p,{children:["If ",(0,sa.jsx)(e.code,{children:".catch"})," terminates normally, it will return a ",(0,sa.jsx)(e.code,{children:"fulfilled"})," ",(0,sa.jsx)(e.code,{children:"Promise"}),". So the following logic is possible."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Execution order: catch -> then"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error was handled well. Execution continues normally."'}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// fulfilled Promise returned after catch meets .then."}),"\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Next handler will execute."'}),"));\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"You can use the above to subdivide error handling."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Execution order: catch -> catch"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Consumer function that only handles URIError"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"instanceof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"URIError"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error handling"}),"\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Unhandlable error"'}),");\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," error; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If not URIError, pass to next error handler"}),"\n    }\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"/* This will not execute. */"}),"\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (**)"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Unknown error occurred: ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${error}"}),"`"]}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// No return value => execution continues"}),"\n  });\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Unhandled Rejection"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"noSuchFunction"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error occurs because calling non-existent function"}),"\n}).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Handler that processes successful Promise. Can be one or multiple"}),"\n}); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// No .catch at the end!"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"If there's no handler to process the exception, the error gets trapped."}),"\n",(0,sa.jsxs)(e.p,{children:["When a general error occurs in ",(0,sa.jsx)(e.code,{children:"try...catch"})," and cannot be handled, the script dies and a message is output to the console window.\nThe same thing happens when a ",(0,sa.jsx)(e.code,{children:"rejected Promise"})," is not handled."]}),"\n",(0,sa.jsxs)(e.p,{children:["The JS engine tracks ",(0,sa.jsx)(e.code,{children:"Promise reject"})," and creates a global error when it confirms the error is trapped."]}),"\n",(0,sa.jsxs)(e.p,{children:["In browsers, such errors are handled with the ",(0,sa.jsx)(e.code,{children:"unhandledrejection"})," event. (It's a standard event defined in the HTML specification.)"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"unhandledrejection"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"event"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// unhandledrejection event has two special properties."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(event.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"promise"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [object Promise] - Promise that generated the error"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(event.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"reason"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: Error occurred! - Unhandled error object"}),"\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),");\n}); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// No .catch handler to handle the error"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107214313.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Promise API"}),"\n",(0,sa.jsx)(e.h4,{children:"Promise.all"}),"\n",(0,sa.jsx)(e.p,{children:"Executes multiple Promises simultaneously and waits until all Promises are ready."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// let promise = Promise.all([...promises...]);"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Takes an array of Promises and returns a new Promise."}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),")), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2000"}),")), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),")), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 3"}),"\n]).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Returns 1, 2, 3 when entire Promise is settled. Each Promise becomes an element of the array."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"When each Promise request is complete, result values are passed to the consumer function as another array in the order of the array."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108150808.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"fetch"})," is a function that sends a request to the url in the argument and returns ",(0,sa.jsx)(e.code,{children:"response"})," as a ",(0,sa.jsx)(e.code,{children:"Promise"}),". Let's look at an example using this:"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," urls = [\n  ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://api.github.com/users/iliakan"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://api.github.com/users/Violet-Bora-Lee"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://api.github.com/users/jeresig"'}),",\n];\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Use fetch to map urls to Promises."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," requests = urls.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url));\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise.all waits until all tasks are fulfilled."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"(requests).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"responses"}),") =>"]}),"\n  responses.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"forEach"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${response.url}"}),": ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${response.status}"}),"`"]}),")),\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108151347.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["This is logic that uses ",(0,sa.jsx)(e.code,{children:"Promise.all"})," to receive request responses as an array, then uses ",(0,sa.jsx)(e.code,{children:"Promise.all"})," again on that array to parse with ",(0,sa.jsx)(e.code,{children:"json()"}),", and displays the parsed data in the console window in the next consumer function."]}),"\n",(0,sa.jsx)(e.p,{children:"In conclusion, you can also add consumer function logic in the middle as follows."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," names = [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"iliakan"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Violet-Bora-Lee"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"jeresig"'}),"];\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," requests = names.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"name"}),") =>"]}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${name}"}),"`"]}),"),\n);\n\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"(requests)\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"responses"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// All responses have been successfully fulfilled."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"for"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," response ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"of"})," responses) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${response.url}"}),": ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${response.status}"}),"`"]}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// All urls have response code 200."}),"\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," responses;\n  })\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Map the array containing response messages with response.json() to read the content."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"responses"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"(responses.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"r"}),") =>"]})," r.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())))\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// JSON-formatted response messages are parsed and stored in array 'users'."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"users"}),") =>"]})," users.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"forEach"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"name"}),")));\n"]})}),"\n",(0,sa.jsx)(e.h5,{children:"Error Handling in Promise.all"}),"\n",(0,sa.jsx)(e.p,{children:"If even one in the internal array is rejected, the entire thing is considered an error."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),")),\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),")), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2000"}),"),\n  ),\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),")),\n]).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: Error occurred!"}),"\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Even if Promise reject occurs, calls continue."})}),"\n",(0,sa.jsx)(e.p,{children:"Without separate handling (AbortController), even if Promise rejected occurs, other Promise processing is not canceled. However, results are ignored."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108152428.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"The above example is an example of putting a rejected Promise in an array and running Promise.all.\nThe first argument Promise was rejected, causing a global error. (Because there's no catch method behind it)\nAt this point, you can see in network requests that fetch itself occurred."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108152443.png",alt:""})}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Array in Promise.all's argument"})}),"\n",(0,sa.jsx)(e.p,{children:"That array doesn't necessarily have to be Promise objects. You can put numbers as in the example below, and in that case, those numbers are passed to the consumer function as-is."}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n  }),\n  ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),",\n]).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1, 2, 3"}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Promise.allSettled"}),"\n",(0,sa.jsx)(e.p,{children:"Promise.all cannot receive all results if even one has an error."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/template.html"'}),"),\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/style.css"'}),"),\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/data.json"'}),"),\n]).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(render); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// render method needs all fetch results to work properly."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"This is useful when a render function that needs html, css, and json is the consumer function, as in the above example."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:".allSettled"})," was created to allow receiving other requests even if one has an error."]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["When response is successful – ",(0,sa.jsx)(e.code,{children:'{status:"fulfilled", value:result}'})]}),"\n",(0,sa.jsxs)(e.li,{children:["When an error occurs – ",(0,sa.jsx)(e.code,{children:'{status:"rejected", reason:error}'})]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"allSettled"}),"(urls.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url))).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"results"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n  results.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"forEach"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result, num"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (result.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," == ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"fulfilled"'}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${urls[num]}"}),": ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${result.value.status}"}),"`"]}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If response is successful, result goes into the value property."}),"\n    }\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (result.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," == ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"rejected"'}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${urls[num]}"}),": ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${result.reason}"}),"`"]}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If an error occurs, error object goes into the reason property."}),"\n    }\n  });\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108154631.png",alt:""})}),"\n",(0,sa.jsx)(e.h4,{children:"Promise.race"}),"\n",(0,sa.jsx)(e.p,{children:"Similar to Promise.all, it processes the entire Promise array but returns the result of the Promise that is settled first."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//let promise = Promise.race(iterable);"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"race"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),")),\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),")), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2000"}),"),\n  ),\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),")),\n]).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Promise.resolve and Promise.reject"}),"\n",(0,sa.jsxs)(e.p,{children:["resolve and reject methods are not used much due to the emergence of async/await. However, we'll look at them once since they're needed to understand polyfills that will come later.\n(",(0,sa.jsx)(e.code,{children:"async function"})," always wraps return value in Promise and returns a rejected Promise if you throw Error inside.)"]}),"\n",(0,sa.jsx)(e.h5,{children:"Promise.resolve"}),"\n",(0,sa.jsx)(e.p,{children:"Promise.resolve(value) creates a fulfilled Promise with result value of value."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// let promise = new Promise(resolve => resolve(value));"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," cache = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadCached"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (cache.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"has"}),"(url)) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(cache.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(url));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url)\n    .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"text"}),"())\n    .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"text"}),") =>"]})," {\n      cache.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(url, text);\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," text;\n    });\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"loadCached"})," stores that data in ",(0,sa.jsx)(e.code,{children:"cache"})," when doing ",(0,sa.jsx)(e.code,{children:"fetch"})," and retrieves it from ",(0,sa.jsx)(e.code,{children:"cache"})," and delivers it when the same request is sent next time.\nAt this point, using ",(0,sa.jsx)(e.code,{children:"Promise.resolve"})," to ensure that ",(0,sa.jsx)(e.code,{children:"loadCached"})," always returns a ",(0,sa.jsx)(e.code,{children:"Promise"})," allows the using side to add consumer functions through methods like ",(0,sa.jsx)(e.code,{children:".then/catch"})," to the ",(0,sa.jsx)(e.code,{children:"loadCached"})," function."]}),"\n",(0,sa.jsx)(e.h6,{children:"Polyfill for Promise allSettled using Promise.resolve"}),"\n",(0,sa.jsx)(e.p,{children:"allSettled hasn't been out long, so polyfills are needed in older browsers."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"allSettled"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"allSettled"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"promises"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"(\n      promises.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"p"}),") =>"]}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(p).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(\n          ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"value"}),") =>"]})," ({\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"status"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"fulfilled"'}),",\n            value,\n          }),\n          ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"reason"}),") =>"]})," ({\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// This is the second argument of then. The second argument of then is an error handler. (Same as catch.)"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"status"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"rejected"'}),",\n            reason,\n          }),\n        ),\n      ),\n    );\n  };\n}\n"]})}),"\n",(0,sa.jsx)(e.h5,{children:"Promise.reject"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise.reject(error)"})," returns a ",(0,sa.jsx)(e.code,{children:"rejected Promise"})," with result value of ",(0,sa.jsx)(e.code,{children:"error"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(error);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108160624.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Fetch: Abort"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"Although placed in the Promise section for article flow, strictly speaking, this is not a Promise API."}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["As mentioned in Promise.all, when an error occurs, Promise results are ignored but calls cannot be prevented.\nUsing the built-in object ",(0,sa.jsx)(e.code,{children:"AbortController"}),", you can prevent Promise calls themselves."]}),"\n",(0,sa.jsx)(e.h4,{children:"AbortController Object"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," controller = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AbortController"}),"();\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"AbortController has one property and one method."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108161157.png",alt:""})}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"signal"})," is a property that can be found directly on the instance without going through the prototype chain and can set ",(0,sa.jsx)(e.code,{children:"event listener"}),"."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"abort"})," retrieves the method from ",(0,sa.jsx)(e.code,{children:"AbortController"})," using the prototype chain, and when ",(0,sa.jsx)(e.code,{children:"abort"})," is executed, the following process occurs:","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:'instance.signal triggers an "abort" event.'}),"\n",(0,sa.jsx)(e.li,{children:"instance.signal.aborted becomes true."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Therefore, you attach a listener for cancellable work to signal\nand cancel it with the abort() function."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," controller = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AbortController"}),"();\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," signal = controller.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"signal"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Give the signal object to where cancellable work is performed, and set a listener that will execute when controller.abort() is executed."}),"\nsignal.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"abort"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"abort!"'}),"));\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Put the code below somewhere so it can be executed when desired."}),"\ncontroller.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"abort"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// abort!"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When abort event is triggered, aborted becomes true."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(signal.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"aborted"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// true"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["You could implement another event to create the same functionality and use it with fetch, but since fetch internally recognizes ",(0,sa.jsx)(e.code,{children:"AbortController"}),", it's better to use ",(0,sa.jsx)(e.code,{children:"AbortController"}),"."]}),"\n",(0,sa.jsx)(e.h4,{children:"Using with fetch"}),"\n",(0,sa.jsxs)(e.p,{children:["The ",(0,sa.jsx)(e.code,{children:"fetch"})," option has a property called ",(0,sa.jsx)(e.code,{children:"signal"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," controller = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AbortController"}),"();\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url, {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"signal"}),": controller.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"signal"}),",\n});\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["Now you can control the ",(0,sa.jsx)(e.code,{children:"fetch"})," request with the ",(0,sa.jsx)(e.code,{children:"controller.abort()"})," function as before."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"However, if fetch finishes faster than when abort occurs, it doesn't remove results that have already appeared."}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"AbortController is Scalable"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," urls = [...]; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// a list of urls to fetch in parallel"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," controller = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AbortController"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// an array of fetch promises"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," fetchJobs = urls.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"})," =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url, {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"signal"}),": controller.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"signal"}),"\n}));\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," results = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"(fetchJobs);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// if controller.abort() is called from elsewhere,"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// it aborts all fetches"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["By registering one ",(0,sa.jsx)(e.code,{children:"controller"})," with ",(0,sa.jsx)(e.code,{children:"signal"})," as above, all registered ",(0,sa.jsx)(e.code,{children:"fetch"})," operations follow the signal of one ",(0,sa.jsx)(e.code,{children:"controller"}),"."]}),"\n",(0,sa.jsxs)(e.p,{children:["It can also be used with ",(0,sa.jsx)(e.code,{children:"Promise"})," and can combine ",(0,sa.jsx)(e.code,{children:"fetch"})," and that ",(0,sa.jsx)(e.code,{children:"Promise"})," through ",(0,sa.jsx)(e.code,{children:"Promise.all"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," urls = [...];\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," controller = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AbortController"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ourJob = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// our task"}),"\n  ...\n  controller.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"signal"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"'abort'"}),", reject);\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," fetchJobs = urls.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"})," =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url, { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// fetches"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"signal"}),": controller.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"signal"}),"\n}));\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Wait for fetches and our task in parallel"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," results = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([...fetchJobs, ourJob]);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// if controller.abort() is called from elsewhere,"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// it aborts all fetches and ourJob"}),"\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"Promisification"}),"\n",(0,sa.jsxs)(e.p,{children:["Converting a function that receives callbacks into a function that returns a Promise is called ",(0,sa.jsx)(e.code,{children:"Promisification"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src, callback"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"script"'}),");\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onload"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", script);\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onerror"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Error occurred while loading ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${src}"}),"`"]}),"));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Usage:"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// loadScript('path/script.js', (err, script) => {...})"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["The above function uses callback functions. Let's ",(0,sa.jsx)(e.code,{children:"Promisify"})," it."]}),"\n",(0,sa.jsx)(e.p,{children:"It should receive an argument called src and not receive a callback, and the using side should be able to control it."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," loadScriptPromise = ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src"}),")=>"]}),"{\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),")=>"]}),"{\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Here (err, script)=>{...} is the callback function used in the existing usage from the code above."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// The callback function is just hidden inside."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(src,",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err, script"}),")=>"]}),"{\n	  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (err) ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(err);\n	  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(script);\n    })\n  })\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Usage:"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// loadScriptPromise('path/script.js').then(...)"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["This kind of ",(0,sa.jsx)(e.code,{children:"Promisification"})," can only be used for one function. To make it scalable, let's create a helper function."]}),"\n",(0,sa.jsxs)(e.p,{children:["The helper function should receive a function ",(0,sa.jsx)(e.code,{children:"f"})," and return a wrapper function."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"promisify"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"f"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"...args"}),") { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Returns wrapper function"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err, result"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Custom callback to use with f"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (err) {\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(err);\n        } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(result);\n        }\n      }\n\n      args.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(callback); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add the custom callback created above to the end of function f's arguments."}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Get the function that was put in when promisify was first declared"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// and execute it with the this from when it's called, and the args from when it's called."}),"\n      f.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"call"}),"(",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),", ...args); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Call the original function."}),"\n    });\n  };\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Usage:"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," loadScriptPromise = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"promisify"}),"(loadScript);\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScriptPromise"}),"(...).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(...);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"To handle multiple arguments in the above code, the following refactoring is needed."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// promisify(f, true) that gives you an array containing the callback's success results"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"promisify"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["f, manyArgs = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"})]}),") { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Check if multiple args"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"...args"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err, ...results"}),") { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Custom callback to use with f"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (err) {\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(err);\n        } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Judge based on whether there are multiple args to decide whether to put one or multiple in the result of the Promise to be returned"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(manyArgs ? results : results[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"]);\n        }\n      }\n\n      args.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(callback);\n\n      f.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"call"}),"(",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),", ...args);\n    });\n  };\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Usage:"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Here, f that goes into promisify is a function that needs multiple arguments and has a callback as the last argument."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// f(arg1, arg2, ..., (err, ...results)=>{});"}),"\nf = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"promisify"}),"(f, ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),");\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(...).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"arrayOfResults"})," =>"]})," ..., ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"err"})," =>"]})," ...);\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["However, ",(0,sa.jsx)(e.code,{children:"Promisification"})," cannot completely replace callbacks. This is because callbacks can be called multiple times, but Promise can only have one result. (Even if you call the callback of a Promisified function multiple times, the second time onwards is ignored.)"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["In fact, there are ",(0,sa.jsx)(e.code,{children:"promisify"})," libraries or ",(0,sa.jsx)(e.code,{children:"Node.js"})," built-in functions that handle this in advance."]}),"\n",(0,sa.jsx)(e.h3,{children:"Microtask Processing"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise"})," handlers (",(0,sa.jsx)(e.code,{children:".then/catch/finally"}),") always execute asynchronously."]}),"\n",(0,sa.jsxs)(e.p,{children:["Even if ",(0,sa.jsx)(e.code,{children:"Promise"})," is immediately fulfilled, code below ",(0,sa.jsx)(e.code,{children:".then/catch/finally"})," executes before these handlers execute."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"();\n\npromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise success!"'}),"));\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Code end"'}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Result"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// alert("Code end");'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// alert("Promise success!");'}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Microtask Queue"}),"\n",(0,sa.jsxs)(e.p,{children:["Proper management is needed to handle asynchronous tasks.\nFor this, ECMA specifies an internal queue (",(0,sa.jsx)(e.code,{children:"Internal Queue"}),") called ",(0,sa.jsx)(e.code,{children:"PromiseJobs"}),". (Since the ",(0,sa.jsx)(e.code,{children:"V8"})," engine calls this ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),", ",(0,sa.jsx)(e.code,{children:"Microtask Queue"})," is used more often.)"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Microtask Queue"})," operates as follows:"]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["Execute tasks that arrived first, first. (",(0,sa.jsx)(e.code,{children:"FIFO"}),")"]}),"\n",(0,sa.jsx)(e.li,{children:"Tasks in the queue only start executing when there's nothing left to execute."}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["In summary, when any ",(0,sa.jsx)(e.code,{children:"Promise"})," is ready, the ",(0,sa.jsx)(e.code,{children:".then/catch/finally"})," handlers of this ",(0,sa.jsx)(e.code,{children:"Promise"})," enter the queue but still don't execute."]}),"\n",(0,sa.jsx)(e.p,{children:"Afterwards, when the current code becomes free, the JavaScript engine takes tasks from the queue and executes them."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108195640.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise"})," handlers always pass through the internal queue (",(0,sa.jsx)(e.code,{children:"Promise jobs"}),", which is ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),")."]}),"\n",(0,sa.jsxs)(e.p,{children:["In the case of chains created using multiple ",(0,sa.jsx)(e.code,{children:".then/catch/finally"}),", each handler executes asynchronously. Each handler that entered the queue executes when the current code is complete and the execution of the previous handler in the queue is complete."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"()\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise Fulfilled"'}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"finish"'}),"));\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Doing it this way allows asynchronous operations to proceed sequentially."}),"\n",(0,sa.jsx)(e.h4,{children:"Unhandled Rejection"}),"\n",(0,sa.jsxs)(e.p,{children:["The ",(0,sa.jsx)(e.code,{children:"unhandledrejection"})," event means that when executing ",(0,sa.jsx)(e.code,{children:"Promise"}),", an error was passed without ",(0,sa.jsx)(e.code,{children:".catch"}),", causing a global error."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise failed!"'}),"));\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise failed!"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"unhandledrejection"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"event"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(event.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"reason"}),"));\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"unhandled rejection"})}),"\n",(0,sa.jsxs)(e.p,{children:["When the JavaScript engine looks for unhandled rejection, it checks the ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),".\nIt occurs if Promise error is not handled even at the end of the Microtask Queue."]}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"If catch is handled later"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise failed!"'}),"));\n",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," promise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Caught!"'}),")), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: Promise failed!"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"unhandledrejection"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"event"}),") =>"]}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(event.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"reason"}),"),\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108205243.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["You can see the order is: ",(0,sa.jsx)(e.code,{children:"unhandledrejection"}),"'s handler function > notification that there's a rejected Promise > catch consumer function."]}),"\n",(0,sa.jsx)(e.p,{children:"This is because of the following process:"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["When the current ",(0,sa.jsx)(e.code,{children:"Macrotask"})," ends (after ",(0,sa.jsx)(e.code,{children:"window.addEventListener"})," is all done), check the ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"unhandledrejection"})," is triggered when a task in the ",(0,sa.jsx)(e.code,{children:"Microtask Queue"})," remains in a ",(0,sa.jsx)(e.code,{children:"rejected"})," state. That is, it finds a ",(0,sa.jsx)(e.code,{children:"rejected Promise"})," state remaining and triggers ",(0,sa.jsx)(e.code,{children:"unhandledrejection"}),"."]}),"\n",(0,sa.jsxs)(e.li,{children:["Execute registered handler ",(0,sa.jsx)(e.code,{children:"(console.log(event.reason))"})]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"1,000ms"})," ends in ",(0,sa.jsx)(e.code,{children:"Web API"})," and ",(0,sa.jsx)(e.code,{children:"setTimeout"}),"'s callback function ",(0,sa.jsx)(e.code,{children:"( ()=>promise.catch(()=>console.log('Caught!')) )"})," moves to ",(0,sa.jsx)(e.code,{children:"Macrotask Queue"}),"."]}),"\n",(0,sa.jsxs)(e.li,{children:["Execute ",(0,sa.jsx)(e.code,{children:"()=>promise.catch(()=>console.log('Caught!'))"})," and return ",(0,sa.jsx)(e.code,{children:"promise.catch(()=>console.log('Caught!')"}),"."]}),"\n",(0,sa.jsxs)(e.li,{children:["Since variable ",(0,sa.jsx)(e.code,{children:"promise"})," containing ",(0,sa.jsx)(e.code,{children:"rejected Promise"})," was hit with ",(0,sa.jsx)(e.code,{children:".catch"})," handler, move ",(0,sa.jsx)(e.code,{children:"()=>console.log('Caught!')"})," to ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"."]}),"\n",(0,sa.jsxs)(e.li,{children:["After the move ends, one ",(0,sa.jsx)(e.code,{children:"Macrotask"})," has ended, so execute until ",(0,sa.jsx)(e.code,{children:"Microtask Queue"})," is emptied. Here, ",(0,sa.jsx)(e.code,{children:"()=>console.log('Caught!')"})," executes."]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"async, await"}),"\n",(0,sa.jsxs)(e.p,{children:["The ",(0,sa.jsx)(e.code,{children:"async"}),", ",(0,sa.jsx)(e.code,{children:"await"})," syntax was created to use ",(0,sa.jsx)(e.code,{children:"Promise"})," more conveniently."]}),"\n",(0,sa.jsx)(e.h3,{children:"async function"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["Putting ",(0,sa.jsx)(e.code,{children:"async"})," before ",(0,sa.jsx)(e.code,{children:"function"})," makes that function always return a Promise.\nEven if it returns a value that's not a Promise, it wraps the value in a fulfilled Promise and returns it."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110152440.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"That is, the following codes have the same functionality."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f1"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f2"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),");\n}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"await"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// await only works inside async function."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," value = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," promise;\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["When it encounters the ",(0,sa.jsx)(e.code,{children:"await"})," keyword, it waits until Promise is settled. Code in the same block below the ",(0,sa.jsx)(e.code,{children:"await"})," keyword moves to ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),". (Functionally the same as passing to ",(0,sa.jsx)(e.code,{children:".then"}),".)"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"done!"'}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," result = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," promise; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Wait until Promise is fulfilled (*)"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "done!"'}),"\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"();\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"While waiting for Promise to be settled, the engine can handle other tasks (executing other scripts, handling events), so CPU resources are not wasted."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["That is, ",(0,sa.jsx)(e.code,{children:"await"})," is syntax that allows you to get the ",(0,sa.jsx)(e.code,{children:"result"})," value of Promise more elegantly than ",(0,sa.jsx)(e.code,{children:"promise.then"}),"."]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["The ",(0,sa.jsx)(e.code,{children:"showAvatar"})," code that was an example in the ",(0,sa.jsx)(e.strong,{children:"Using fetch with Chaining"})," part can be organized with ",(0,sa.jsx)(e.code,{children:"async / await"})," syntax as follows."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showAvatar"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Read JSON"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," loadJsonResponse = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { name } = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," loadJsonResponse.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Read github user information"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," githubUserResponse = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${name}"}),"`"]}),",\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," githubUser = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," githubUserResponse.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Show avatar"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," img = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"img"'}),");\n  img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = githubUser.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"avatar_url"}),";\n  img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"className"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise-avatar-example"'}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"body"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(img);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Wait 3 seconds"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(resolve, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),"));\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// When await executes, think of it as catching the operation of that Promise being settled as executor, and code below it goes to Microtask Queue. (Same behavior as .then.)"}),"\n\n  img.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"remove"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," githubUser;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showAvatar"}),"();\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["await does not work in top-level code.\nFor this, you can use ",(0,sa.jsx)(e.code,{children:"IIFE ( Immediately Invoked function expression )"}),"."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," ()=>{\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"`/article/promise-chaining/user.json`"}),");\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," user = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n	...\n})();\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["Like ",(0,sa.jsx)(e.code,{children:"promise.then"}),", ",(0,sa.jsx)(e.code,{children:"await"})," can also receive ",(0,sa.jsx)(e.code,{children:"thenable"})," objects."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Thenable"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"num"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"num"})," = num;\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(resolve);\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Fulfilled after 1000 milliseconds (result is this.num*2)"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"num"})," * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// After 1 second, variable result becomes 2"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," result = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Thenable"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Same as new Promise((resolve)=>setTimeout(()=> resolve(this.num*2),1000)).then((result)=>alert(result))"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result);\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"();\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["You can also use ",(0,sa.jsx)(e.code,{children:"async"})," on ",(0,sa.jsx)(e.code,{children:"class method"}),". Methods with ",(0,sa.jsx)(e.code,{children:"async"})," attached return Promise like ",(0,sa.jsx)(e.code,{children:"async"})," functions and can use await."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Waiter"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wait"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),");\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Waiter"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wait"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"Error Handling"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"await promise"})," returns the value stored in the ",(0,sa.jsx)(e.code,{children:"result"})," of the Promise object.\nOn the other hand, if ",(0,sa.jsx)(e.code,{children:"Promise"})," is rejected, it throws an error as if a ",(0,sa.jsx)(e.code,{children:"throw"})," statement was written."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// The two codes below have the same functionality."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),"));\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Error occurred!"'}),");\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["Errors thrown by ",(0,sa.jsx)(e.code,{children:"await"})," can be caught using ",(0,sa.jsx)(e.code,{children:"try...catch"}),", just like errors thrown by ",(0,sa.jsx)(e.code,{children:"throw"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"try"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"http://invalid-address"'}),");\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"catch"})," (err) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(err); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// TypeError: failed to fetch"}),"\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"();\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["When an error occurs, control flow moves to the ",(0,sa.jsx)(e.code,{children:"catch"})," block."]}),"\n",(0,sa.jsxs)(e.p,{children:["Originally, if an ",(0,sa.jsx)(e.code,{children:"async function"})," has no return value, it returns with ",(0,sa.jsx)(e.code,{children:"undefined"})," in a ",(0,sa.jsx)(e.code,{children:"fulfilled Promise"}),", but"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110193617.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["If a ",(0,sa.jsx)(e.code,{children:"Promise"})," that was ",(0,sa.jsx)(e.code,{children:"await"}),"ed in an ",(0,sa.jsx)(e.code,{children:"async function"})," is ",(0,sa.jsx)(e.code,{children:"reject"}),"ed, it returns with an error in a ",(0,sa.jsx)(e.code,{children:"rejected"})," ",(0,sa.jsx)(e.code,{children:"Promise"}),". (Also, an error occurs.)"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110193853.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["In the above code, you can handle that ",(0,sa.jsx)(e.code,{children:"Error"})," by using ",(0,sa.jsx)(e.code,{children:".catch"})," in continuation."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110193713.png",alt:""})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["Errors not handled by ",(0,sa.jsx)(e.code,{children:".catch"})," here are treated as global errors, which can be handled with the ",(0,sa.jsx)(e.code,{children:"unhandledrejection"})," event's handler."]}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["Since ",(0,sa.jsx)(e.code,{children:"await"})," replaces ",(0,sa.jsx)(e.code,{children:".then"})," and ",(0,sa.jsx)(e.code,{children:"try..catch"})," replaces ",(0,sa.jsx)(e.code,{children:".catch"}),", you can use the same functionality but much more conveniently on the using side. However, since ",(0,sa.jsx)(e.code,{children:"await"})," cannot be used in top-level code (top-level code without async), cases occur where you must use ",(0,sa.jsx)(e.code,{children:".then/ .catch"}),"."]}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"async/ await"})," can also be used with ",(0,sa.jsx)(e.code,{children:"Promise.all"}),", and error handling can also use ",(0,sa.jsx)(e.code,{children:"try...catch"})," the same way."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Wait for an array containing Promise processing results."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," results = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url1),\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url2),\n  ...\n]);\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["There are three tasks to get a feel for it. It would be good to try solving them.\n",(0,sa.jsx)(e.a,{href:"https://ko.javascript.info/async-await#tasks",children:"https://ko.javascript.info/async-await#tasks"})]}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"Asynchronous Problem Solving"}),"\n",(0,sa.jsxs)(e.p,{children:["The following is a problem created to perfectly understand asynchronous logic.\nLet's think about what the result value is and why, considering each ",(0,sa.jsx)(e.code,{children:"queue"})," and ",(0,sa.jsx)(e.code,{children:"Web API"}),"."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"testFn"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Execute immediately"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// setTimeout executes immediately, timing function passed to Web API"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),");\n  }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"500"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Execute immediately"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (resolve) => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// executor function executes immediately when Promise is created."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"before"'}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Executes immediately up to here, all internal code below await goes to Microtask Queue"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// The callback console.log(4) is passed to Macrotask queue after setTimeout executes and 5000ms passes in Web API."}),"\n    }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5000"}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"next"'}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),");\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Execute immediately"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," t = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// executor inside Promise executes immediately, code below all moves to Microtask queue"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Same as new Promise((resolve)=>{console.log(6); resolve('a')}).then((t)=>{console.log(t); console.log(7)})"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"a"'}),");\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(t);\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),");\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110155653.png",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"Solution"}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{style:{textAlign:"left"}}),(0,sa.jsx)(e.th,{children:"1st task (Execute Macrotask called testFn)"}),(0,sa.jsx)(e.th,{children:"2nd task (Execute all Microtasks related to testFn)"}),(0,sa.jsx)(e.th,{children:"500ms passed since code execution"}),(0,sa.jsx)(e.th,{children:"3rd task (Execute Macrotask that outputs 2)"}),(0,sa.jsx)(e.th,{children:"Confirm Microtask Queue is empty and move on"}),(0,sa.jsx)(e.th,{children:"5000ms passed since code execution"}),(0,sa.jsx)(e.th,{children:"4th task (Execute Macrotask that outputs 4)"})]})}),(0,sa.jsxs)(e.tbody,{children:[(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"Macrotask queue state"}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"()=>console.log(2)"}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"()=>console.log(4)"}),(0,sa.jsx)(e.td,{})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"Microtask queue state"}),(0,sa.jsx)(e.td,{children:'console.log(4, "next"), resolve(4), console.log(t), console.log(7)'}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"Web API"}),(0,sa.jsxs)(e.td,{children:["Operation that passes ()=>console.log(2) to task queue when 500ms passes,",(0,sa.jsx)("br",{}),"Operation that passes ()=>console.log(4) to task queue when 5,000ms passes"]}),(0,sa.jsxs)(e.td,{children:["Operation that passes ()=>console.log(2) to task queue when 500ms passes,",(0,sa.jsx)("br",{}),"Operation that passes ()=>console.log(4) to task queue when 5,000ms passes"]}),(0,sa.jsx)(e.td,{children:"Operation that passes ()=>console.log(4) to task queue when 5,000ms passes"}),(0,sa.jsx)(e.td,{children:"Operation that passes ()=>console.log(4) to task queue when 5,000ms passes"}),(0,sa.jsx)(e.td,{children:"Operation that passes ()=>console.log(4) to task queue when 5,000ms passes"}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"Output"}),(0,sa.jsx)(e.td,{children:"1, 3, 4 'before', 5, 6"}),(0,sa.jsx)(e.td,{children:'4 "next", a, 7'}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"2"}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"4"})]})]})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["Since rendering proceeds in the order ",(0,sa.jsx)(e.code,{children:"Macrotask"})," > ",(0,sa.jsx)(e.code,{children:"Microtask"})," > ",(0,sa.jsx)(e.code,{children:"requestAnimationFrame"})," > ",(0,sa.jsx)(e.code,{children:"browser rendering"}),", if an event occurs in the middle of executing the above code and a ",(0,sa.jsx)(e.code,{children:"Macrotask"})," is created, browser rendering related to that ",(0,sa.jsx)(e.code,{children:"Macrotask"})," can occur and return to the above code."]}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"Conclusion"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["If previously I only knew that asynchronous code runs using Microtask Queue and event loop, now I can more accurately understand ",(0,sa.jsx)(e.strong,{children:"why asynchronous methods are needed"})," by understanding it together with browser rendering flow.",(0,sa.jsx)(e.br,{}),"\n","Since this article started with the thought of solidifying the basics, I tried to learn thoroughly, and it became a good opportunity to gather fragmented knowledge.",(0,sa.jsx)(e.br,{}),"\n","Since focusing on ",(0,sa.jsx)(e.strong,{children:"why this technology is needed"}),", I think I can see it from more diverse perspectives.",(0,sa.jsx)(e.br,{}),"\n","Let's move forward now."]}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"References"}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.a,{href:"https://wikibook.co.kr/react-deep-dive/",children:"https://wikibook.co.kr/react-deep-dive/"})}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.a,{href:"https://ko.javascript.info/async",children:"https://ko.javascript.info/async"})}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000001766397",children:"https://product.kyobobook.co.kr/detail/S000001766397"})}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.a,{href:"https://inpa.tistory.com/entry/%F0%9F%8C%90-requestAnimationFrame-%EA%B0%80%EC%9D%B4%EB%93%9C",children:"https://inpa.tistory.com/entry/%F0%9F%8C%90-requestAnimationFrame-%EA%B0%80%EC%9D%B4%EB%93%9C"})}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.a,{href:"https://www.youtube.com/watch?v=8aGhZQkoFbQ",children:"https://www.youtube.com/watch?v=8aGhZQkoFbQ"})}),"\n"]})]})}function eX(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eK,{...s})}):eK(s)}function eZ(s){let e={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"https://velog.velcdn.com/images/codefug/post/1863b8a0-6521-495b-85f2-22b0f35b6380/image.png",alt:""})}),"\n",(0,sa.jsx)(e.h1,{children:"비동기 통신의 이해"}),"\n",(0,sa.jsx)(e.p,{children:"JS는 Single Thread에서 작동합니다. 즉 한 번에 하나의 작업만 동기 방식으로 처리할 수 있습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"동기(synchronous) : 직렬 방식으로 작업을 처리하는 것, 요청이 시작하고 응답을 받은 후에야 다음 작업 처리"}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"비동기(Asynchronous) : 병렬 방식으로 작업을 처리하는 것, 요청이 시작한 후 응답과 관계 없이 다음 작업 처리"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"사용자가 검색어를 입력해 검색을 위한 네트워크 요청이 발생한 순간에도 다른 작업을 처리할 수 있습니다. (비동기적 작업 방식)"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"리액트에서는 16 버전에 접어들면서 비동기식으로 작동하는 방법이 소개 되었다."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"싱글 스레드 자바스크립트"}),"\n",(0,sa.jsxs)(e.p,{children:["과거, 프로그램을 실행하는 단위가 오직 ",(0,sa.jsx)(e.strong,{children:"Process"})," 뿐이었다."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Process"})}),"\n",(0,sa.jsx)(e.p,{children:"프로그램을 구동해 프로그램의 상태가 메모리 상에서 실행되는 작업 단위"}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["현재, 하나의 프로그램에 여러가지 작업이 필요해졌고 더 작은 실행 단위인 ",(0,sa.jsx)(e.strong,{children:"thread"}),"가 탄생했습니다."]}),"\n",(0,sa.jsx)(e.p,{children:"thread: 하나의 process에는 여러 개의 thread를 만들 수 있고, thread 끼리 메모리를 공유할 수 있습니다. 여러 작업을 동시 수행"}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript는 기본적으로 싱글 쓰레드 입니다."}),"\n",(0,sa.jsx)(e.h2,{children:"JS가 멀티 쓰레드가 아닌 이유"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"멀티 쓰레드는 내부적으로 처리가 복잡하며 같은 자원에 대해 여러 번 수정하는 등 동시성 문제가 발생할 수 있기에 이에 대한 처리가 필요하다."}),"\n",(0,sa.jsxs)(e.li,{children:["각각 격리되어 있는 ",(0,sa.jsx)(e.strong,{children:"Process"}),"와 다르게 하나의 ",(0,sa.jsx)(e.strong,{children:"Thread"}),"가 문제가 생기면 다른 ",(0,sa.jsx)(e.strong,{children:"Thread"}),"도 문제가 발생할 수 있습니다."]}),"\n",(0,sa.jsxs)(e.li,{children:["JS이 ",(0,sa.jsx)(e.strong,{children:"멀티 스레딩"}),"을 지원해서 동시에 여러 쓰레드가 DOM을 조작할 수 있었다면 메모리 공유로 인해 동시에 같은 자원에 접근하게 되고 이 때문에 타이밍 이슈가 발생할 수 있고 DOM 표시에 큰 문제를 발생시킬 수 있습니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Event Loop"}),"\n",(0,sa.jsxs)(e.p,{children:["비동기 동작과 뗄 수 없는 개념은 ",(0,sa.jsx)(e.code,{children:"Event Loop"}),"입니다."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Node.js"}),"와 마찬가지로 브라우저 측 자바스크립트 실행 흐름도 ",(0,sa.jsx)(e.code,{children:"Event Loop"}),"에 기반을 둔다."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Event Loop"}),"를 잘 알고 있어야 올바른 아키텍처 설계가 가능하다."]}),"\n",(0,sa.jsx)(e.h3,{children:"자바스크립트 엔진 동작 방식"}),"\n",(0,sa.jsx)(e.p,{children:"자바스크립트 엔진은 다음의 알고리즘을 갖고 있습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["처리해야 할 task가 있는 경우","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"먼저 들어온 task부터 차례대로 처리합니다."}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.li,{children:["처리해야 할 task가 없는 경우","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"잠들어 있다가 새로운 task가 추가되면 다시 1번 과정으로 돌아간다."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"자바스크립트 엔진은 대부분 시간을 아무런 일도 하지 않고 쉬다가 스크립트나 핸들러, 이벤트가 활성화될 때만 돌아간다."}),"\n",(0,sa.jsx)(e.p,{children:"자바스크립트 엔진을 활성화하는 task는 다음과 같다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["외부 스크립트 ",(0,sa.jsx)(e.code,{children:'<script src="...">'}),"가 로드될 때, 이 스크립트를 실행하는 것"]}),"\n",(0,sa.jsxs)(e.li,{children:["사용자가 마우스를 움직일 때 ",(0,sa.jsx)(e.code,{children:"mousemove"})," 이벤트와 이벤트 핸들러를 실행하는 것"]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"setTimeout"}),"에서 설정한 시간이 다 된 경우, 콜백 함수를 실행하는 것"]}),"\n",(0,sa.jsx)(e.li,{children:"기타 등등"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"task는 하나의 집합을 이룬다. 자바스크립트 엔진은 해당 task를 차례대로 처리하며 새로운 task가 추가될 때까지 기다린다. task를 기다리는 동안 CPU 자원 소비는 0에 가까워지고 엔진은 잠들게 됩니다."}),"\n",(0,sa.jsxs)(e.p,{children:["엔진이 바쁠 때 task가 추가되면 해당 task는 ",(0,sa.jsx)(e.strong,{children:"Macrotask queue"}),"에 추가됩니다."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["참고로 ",(0,sa.jsx)(e.code,{children:"task queue"}),"의 구조는 ",(0,sa.jsx)(e.code,{children:"queue"}),"가 아닌 ",(0,sa.jsx)(e.code,{children:"set"}),"입니다. 선택된 큐에서 실행 가능한 가장 오래된 task를 가져와야 하기 때문입니다.\n무조건 먼저 들어온 첫번째 큐를 ",(0,sa.jsx)(e.code,{children:"dequeue"}),"하는 것이 아니라 실행 가능한 것들 중에 가장 오래된 task를 차례대로 실행시킨다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3",children:"https://html.spec.whatwg.org/multipage/webappapis.html#definitions-3"})}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108212123.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["(",(0,sa.jsx)(e.code,{children:"script"}),"를 처리하는데 중간에 ",(0,sa.jsx)(e.code,{children:"mousemove"})," 핸들러도 실행되고 ",(0,sa.jsx)(e.code,{children:"setTimeout"}),"에서 설정한 시간이 지나서 콜백이 들어온 경우의 상태를 그림으로 나타냄)"]}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript 엔진은 이들을 차례대로 처리합니다."}),"\n",(0,sa.jsx)(e.p,{children:"이때 알아야 할 두가지는"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"엔진이 task를 처리하는 동안은 렌더링이 일어나지 않는다. 처리를 완료하면 DOM 변경을 화면에 반영합니다."}),"\n",(0,sa.jsx)(e.li,{children:"task에 긴 시간이 걸리면 task를 처리하는 동안 발생한 새로운 task를 처리하지 못합니다. ( 응답 없는 페이지라는 alert 창은 페이지 전체와 함께 현재 task를 최소시킬지 말지를 선택하게 합니다. )"}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"예시 1: CPU 소모가 많은 task 쪼개기"}),"\n",(0,sa.jsx)(e.p,{children:"CPU 소모가 아주 많은 task 하나가 있다고 가정해보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," start = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// CPU 소모가 많은 무거운 작업을 수행"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"for"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," j = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"; j < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e9"}),"; j++) {\n    i++;\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"처리에 걸린 시간: "'})," + (",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"() - start) + ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"ms"'}),");\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"1e9 (0이 9개)을 센 다음 alert를 하는 코드인데 해당 count()가 실행되는 동안 브라우저는 사용자 이벤트 처리나 DOM 관련 작업을 완전히 멈추게 되는 것을 확인할 수 있습니다.\n( 실행시키고 페이지에 마우스 우클릭을 하면 alert가 나올때까지 아무것도 안 보이다가 alert가 나오고 마우스 우클릭시 나오는 메뉴가 나온다. )"}),"\n",(0,sa.jsx)(e.p,{children:"코드를 쪼개서 이를 개선해보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," start = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 무거운 작업을 쪼갠 후 이를 수행 (*)"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"do"})," {\n    i++;\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2* 1e6, 3* 1e6 등 1e6의 배수에서 do while 문을 나가게 됩니다."}),"\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"while"})," (i % ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e6"})," != ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (i == ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e9"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 위의 do while문을 1e3번 반복하면 도착"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"처리에 걸린 시간: "'})," + (",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"() - start) + ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"ms"'}),");\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1e6의 배수이지만 1e9가 아닐 경우"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(count); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 새로운 호출을 스케줄링 (**)"}),"\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"do while문을 1e3번 반복해서 alert가 나오게 되는데 그 이전까지 setTimeout으로 count를 넘기기 때문에 동기적인 코드들은 돌아갈 수 있게 되고 이 때문에 이벤트 핸들러, DOM 관련 동작 들을 해결할 수 있게 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"위 코드는 사실 조금의 시간차가 존재합니다. 다음처럼 setTimeout을 앞으로 끌어오면 이를 해결할 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," start = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 스케줄링 코드를 함수 앞부분으로 옮김"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (i < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e9"})," - ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e6"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(count); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 새로운 호출을 스케줄링함"}),"\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"do"})," {\n    i++;\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"while"})," (i % ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e6"})," != ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (i == ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e9"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"처리에 걸린 시간: "'})," + (",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Date"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"now"}),"() - start) + ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"ms"'}),");\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["부분 카운팅 (",(0,sa.jsx)(e.code,{children:"do...while"}),")이 일어나기 전에 부분 재스케줄링(",(0,sa.jsx)(e.code,{children:"setTimeout"}),")이 일어나게 됩니다."]}),"\n",(0,sa.jsx)(e.p,{children:"setTimeout 호출이 많은 경우, 브라우저 최소 대기 시간이 4밀리초이기 때문에 숫자 세기 전에 스케줄링을 하면 숫자를 세면서 대기 시간을 소모하기 때문에 실행이 더 빨라진다.\n(setTimeout 로직이 뒤쪽에 있으면 setTimeout(count) 실행되고 바로 다음 macrotask로 count 함수가 실행돼야 되는데 안 가고 4ms 있다가 실행된다는 뜻)"}),"\n",(0,sa.jsx)(e.h3,{children:"예시 2: Progress bar"}),"\n",(0,sa.jsxs)(e.p,{children:["task를 여러 개로 쪼갤 때의 장점은 진행 상태를 나타내주는 ",(0,sa.jsx)(e.code,{children:"progress bar"}),"를 만들 때도 드러난다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["<div id=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"progress"'}),"></div>\n\n",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]}),(0,sa.jsxs)(e.span,{className:"javascript",children:["\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"for"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"; i < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e6"}),"; i++) {\n      i++;\n      progress.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n    }\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]}),(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]})]}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"브라우저는 시간이 오래 걸리든 아니든 상관 없이 현재 작업 중인 task가 끝나야 DOM 변경분을 화면에 렌더링합니다."}),"\n",(0,sa.jsxs)(e.p,{children:["그래서 위의 코드는 ",(0,sa.jsx)(e.code,{children:"progress bar"}),"의 기능을 완수하지 못합니다. i가 전부 지나가야(현재 작업 중인 task가 끝나야) DOM을 렌더링하기 때문입니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["<div id=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"progress"'}),"></div>\n\n",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]}),(0,sa.jsxs)(e.span,{className:"javascript",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 무거운 작업을 쪼갠 후 이를 수행"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"do"})," {\n      i++;\n      progress.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"while"})," (i % ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e3"})," != ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (i < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e7"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(count);\n    }\n\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]}),(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]})]}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["위처럼 코드를 분할하게 되면 i가 변화하는 과정을 출력해 줄 수 있다, ",(0,sa.jsx)(e.code,{children:"setTimeout"}),"으로 ",(0,sa.jsx)(e.code,{children:"count"}),"를 넘기기 때문에 count와 count 함수 사이에서 동기적인 동작들을 수행할 수 있게 되고 결론적으로 ",(0,sa.jsx)(e.code,{children:"progress.innerHTML"}),"이 변경되었다는 DOM 변경 동작이 일어나게 됩니다."]}),"\n",(0,sa.jsx)(e.h3,{children:"예시 3: 이벤트 처리가 끝난 이후에 작업"}),"\n",(0,sa.jsxs)(e.p,{children:["이벤트 핸들러를 만들 때 특정 액션을 모든 이벤트 버블링이 끝나고 실행시키고 싶다면 ",(0,sa.jsx)(e.code,{children:"ms"}),"가 0인 ",(0,sa.jsx)(e.code,{children:"setTimeout"}),"을 사용하면 됩니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["menu.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onclick"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 클릭한 메뉴 내 항목 정보가 담긴 커스텀 이벤트 생성"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," customEvent = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"CustomEvent"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"menu-open"'}),", {\n    ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"bubbles"}),": ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),",\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 비동기로 커스텀 이벤트를 디스패칭"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," menu.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"dispatchEvent"}),"(customEvent));\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:'위를 살펴보면 "menu-open" 이라는 커스텀 이벤트를 만든 후 해당 이벤트를 setTimeout으로 넘겼다.'}),"\n",(0,sa.jsxs)(e.p,{children:["이제 menu의 click 이벤트가 완전히 핸들링된 후에 ",(0,sa.jsx)(e.code,{children:"menu-open"})," 이벤트를 dispatching하게 됩니다."]}),"\n",(0,sa.jsx)(e.h2,{children:"Macrotask와 Microtask"}),"\n",(0,sa.jsx)(e.h3,{children:"Microtask"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Microtask"}),"는 주로 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 사용해 만든다."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise"}),"와 함께 쓰이는 ",(0,sa.jsx)(e.code,{children:".then/catch/finally"}),"의 핸들러 (소비 함수)가 ",(0,sa.jsx)(e.code,{children:"Microtask"}),"가 됩니다. 또는 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 핸들링하는 ",(0,sa.jsx)(e.code,{children:"await"}),"를 사용해 만들기도 합니다."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["이 외에도 표준 API인 ",(0,sa.jsx)(e.code,{children:"queueMicrotask(func)"}),"를 사용해서 함수 ",(0,sa.jsx)(e.code,{children:"func"}),"를 ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"에 넣어서 처리할 수 있습니다."]}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["자바스크립트 엔진은 ",(0,sa.jsx)(e.strong,{children:"Macrotask"}),"를 하나 처리할 때마다 js 엔진은 다른 ",(0,sa.jsx)(e.code,{children:"Macrotask"}),"를 수행하거나 렌더링하는 등의 작업을 하기 전에 ",(0,sa.jsx)(e.strong,{children:"Microtask Queue"}),"에 있는 모든 task를 실행합니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"timeout"'}),"));\n\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise"'}),"));\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"code"'}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (현재 호출 스택에서 script 태그에 있는 코드를 읽는 Macrotask중이며 코드를 한 줄씩 넣으면서 실행 중에 있음)"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// 1. setTimeout(()=>alert("timeout")) - 호출 스택에서 실행, ms가 지나면 콜백 함수를 Macrotask queue에 등록'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// 2. Promise.resolve().then(()=>alert("promise")) - 콜백 함수를 Microtask Queue에 등록'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// 3. alert("code") - 바로 호출됩니다. (현재 script 태그를 읽는 Macrotask를 수행 중입니다.)'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 4. script 태그에 있는 코드를 읽는 Macrotask 종료"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 5. Microtask queue에 있는 then() 콜백 함수 실행 (호출 스택으로 이동해서 실행, 이 과정에서 이벤트 루프는 다 비워질 때까지 안 돌아감)"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 6. Microtask queue 비워짐"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// 7. ()=>alert("timeout") - 다음 Macrotask 실행 (호출 스택에서 Macrotask 하나 이동)'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (해당 Macrotask가 끝나면 다시 Microtask 실행해서 Microtask queue 비우고 렌더링 > 다음 Macrotask 실행 반복)"}),"\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"처리 로직"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241109193930.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Macrotask (script, mousemove, setTimeout 등)"})," 하나가 처리되고 난 후 ",(0,sa.jsx)(e.code,{children:"Microtask"})," 전부가 처리되고 그 이후 렌더링이 진행되는 것을 확인할 수 있습니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Microtask는 다른 이벤트 핸들러나 렌더링 작업, 혹은 다른 Macrotask가 실행되기 전에 전부 처리됩니다."})}),"\n",(0,sa.jsxs)(e.p,{children:["script 태그에 있는 코드를 읽는 작업도 ",(0,sa.jsx)(e.code,{children:"Macrotask"}),"이기 때문에 script 코드를 한 줄씩 호출 스택에 담고 실행하는 과정이 끝난 후에 Microtask들을 실행합니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["이런 처리순서가 아주 중요한 이유는 마우스 좌표 변경이나 네트워크 통신에 의한 데이터 변경같이 애플리케이션 환경에 변화를 주는 작업에 영향을 받지 않고 모든 ",(0,sa.jsx)(e.code,{children:"Microtask"}),"를 동일한 환경에서 처리할 수 있기 때문입니다."]}),"\n",(0,sa.jsx)(e.p,{children:'"현재 실행 중인 macrotask 실행이 끝나면 > 현재 존재하는 모든 microtask 실행 > 렌더링 > 다음 macrotask 실행" 의 순서를 가진다.'}),"\n",(0,sa.jsxs)(e.p,{children:["위 과정을 확인하기 위해서 리페인트 전에 콜백 함수를 호출하는 ",(0,sa.jsx)(e.strong,{children:"requestAnimationFrame"}),"으로 확인해보겠습니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241109221737.png",alt:""})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"requestAnimationFrame"})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241109214448.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"브라우저 리페인트 전에 애니메이션 처리를 하기 위해 사용하는 윈도우 메소드,"}),"\n",(0,sa.jsx)(e.p,{children:"별도의 큐에서 관리되어 프레임 단위로 렌더링할 수 있도록 보장합니다. ( 초당 프레임 기준은 모니터 주사율에 의해 설정됩니다. )"}),"\n",(0,sa.jsx)(e.p,{children:"프레임 단위의 렌더링을 보장하기 때문에 애니메이션 동작이 더 부드러워진다."}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["만약 임의로 특정 함수를 ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"로 보내고 싶다면 ",(0,sa.jsx)(e.code,{children:"queueMicrotask"})," 함수를 사용하면 됩니다.\n( ",(0,sa.jsx)(e.code,{children:"setTimeout"}),"과 다른 점은 만약 ",(0,sa.jsx)(e.code,{children:"ms"}),"가 0초인 ",(0,sa.jsx)(e.code,{children:"setTimeout"}),"을 이용할 때는 ",(0,sa.jsx)(e.code,{children:"Macrotask queue"}),"로 보내져서 기존의 ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"가 다 끝나고 다음 ",(0,sa.jsx)(e.code,{children:"Macrotask"}),"가 실행될 때 특정 함수가 실행될 것입니다.)"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["<div id=",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"progress"'}),"></div>\n\n",(0,sa.jsxs)(e.span,{className:"xml",children:[(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["<",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]}),(0,sa.jsxs)(e.span,{className:"javascript",children:["\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 무거운 작업을 쪼갠 후 이를 수행"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"do"})," {\n      i++;\n      progress.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"while"})," (i % ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e3"})," != ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (i < ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1e6"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"queueMicrotask"}),"(count);\n    }\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"count"}),"();\n"]}),(0,sa.jsxs)(e.span,{className:"hljs-tag",children:["</",(0,sa.jsx)(e.span,{className:"hljs-name",children:"script"}),">"]})]}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"렌더링이 되기 전에 Microtask Queue에 있는 count 함수가 재귀 호출을 하며 Microtask Queue에 새로운 count 함수를 추가하는 방식이므로 실제 화면에는 최종값만 보이게 됩니다. ( microtask queue가 비워져야 브라우저 렌더링이 일어남. )"}),"\n",(0,sa.jsx)(e.p,{children:"다음 예제를 통해 확실히 알아가보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// sync, macro, micro 원소 안에 숫자가 있고 button으로 이들을 제어한다고 가정."}),"\nbutton.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"click"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"for"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," i = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"; i <= ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100000"}),"; i++) {\n    sync.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      macro.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n    }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),");\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"queueMicrotask"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      micro.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"innerHTML"})," = i;\n    });\n  }\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위 핸들러를 실행시키면 다음의 결과가 나온다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"sync"}),"는 렌더링이 일어나지 않다가 100,000 상태가 됩니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"micro"}),"는 렌더링이 일어나지 않다가 100,000 상태가 됩니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"macro"}),"는 잠시 기다리다가 1부터 100,000까지 차례대로 렌더링됩니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_1.jpg",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["이때 차례대로 실행되는 코드들(",(0,sa.jsx)(e.code,{children:"sync.innerHTML = i"}),", ",(0,sa.jsx)(e.code,{children:"setTimeout"}),", ",(0,sa.jsx)(e.code,{children:"queryMicrotask"}),") 이 실행되고 있을 때는 브라우저에서 다른 동작을 할 수 없다. ( 콜 스택에 있는거 다 버리고 동작을 진행할 수는 없으니 )"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"setTimeout"}),"의 타이밍 함수 (시간을 새서 콜백을 던져주는 함수)같은 WEB API는 ",(0,sa.jsx)(e.code,{children:"Macrotask queue"}),"가 할당되는 외부 쓰레드에서 진행됩니다. 작업을 할당해 처리하는 것은 브라우저나 Node.js의 역할입니다."]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_2.jpg",alt:""}),"\n",(0,sa.jsx)(e.img,{src:"/images/2024-11-10/macro%20task,%20micro%20task,%20call%20stack_241110_031903_3.jpg",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["단, 만약 중간에 다른 ",(0,sa.jsx)(e.code,{children:"Macrotask"}),"(마우스 이벤트 등등)가 ",(0,sa.jsx)(e.code,{children:"Macrotask queue"}),"로 들어와서 먼저 실행 가능 상태가 된다면 ",(0,sa.jsx)(e.code,{children:"queue"}),"에서는 해당 ",(0,sa.jsx)(e.code,{children:"Macrotask"}),"를 처리할 것입니다."]}),"\n",(0,sa.jsx)(e.p,{children:'이제 "왜" 사용하는지 알게 되었으니 비동기 작업을 "어떻게" 사용하는지, 그 흐름을 더 자세히 알아보겠습니다.'}),"\n",(0,sa.jsx)(e.h1,{children:"비동기 작업의 역사와 개념"}),"\n",(0,sa.jsx)(e.h2,{children:"콜백"}),"\n",(0,sa.jsxs)(e.p,{children:["호스트 환경이 제공하는 함수를 사용하면 비동기 동작을 스케줄링할 수 있습니다. ( ",(0,sa.jsx)(e.code,{children:"setTimeout"})," 같은 함수)"]}),"\n",(0,sa.jsx)(e.p,{children:"스크립트나 모듈을 로드하는 함수도 비동기라고 할 수 있는데 이를 예시로 살펴보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// <script> 태그를 만들고 페이지에 태그를 추가합니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 태그가 페이지에 추가되면 src에 있는 스크립트를 로딩하고 실행합니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"script"'}),");\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 해당 경로에 있는 스크립트를 불러오고 실행합니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script.js"'}),");\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이때 스크립트는 비동기적으로 실행됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"따라서 loadScript 아래 코드들은 loadScript가 끝나는 것을 기다리지 않는다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script.js"'}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// script.js엔 "function newFunction() {…}"이 있습니다.'}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// script.js에 있는 newFunction을 사용하려고 하는데"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 함수가 존재하지 않는다는 에러가 발생한다!"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"newFunction"}),"();\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"여기에 콜백을 추가해보겠습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"콜백 함수"})}),"\n",(0,sa.jsx)(e.p,{children:"주로 함수 안에 전달인자로 다른 함수에 전달되는 함수를 의미합니다. 일종의 루틴이나 동작을 완료하기 위해 외부 함수 내부에서 호출됩니다."}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src, callback"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"'script'"}),");\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// script가 load 이벤트를 일으키면 (load 되면) callback에 script를 담아서 실행시킨다."}),"\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onload"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(script);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"'/my/script.js'"}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 콜백 함수는 스크립트 로드가 끝나면 실행됩니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"newFunction"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 이제 함수 호출이 제대로 동작합니다."}),"\n  ...\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위의 방식을 콜백 기반 비동기 프로그래밍이라고 합니다."}),"\n",(0,sa.jsx)(e.p,{children:"loadScript에 콜백 함수를 전해줘서 newFunction이 비동기 실행과 나란히 일어날 수 있게 해준다."}),"\n",(0,sa.jsx)(e.h3,{children:"에러 핸들링"}),"\n",(0,sa.jsx)(e.p,{children:"스크립트 로딩이 실패하는 경우 발생하는 에러를 핸들링할 수 있어야 합니다."}),"\n",(0,sa.jsx)(e.p,{children:"다음과 같이 개선해보겠습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src, callback"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"script"'}),");\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 성공 시 null과 script를 인수에 넣고"}),"\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onload"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", script);\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 실패 시 에러 객체를 인수에 넣는다."}),"\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onerror"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${src}"}),"를 불러오는 도중에 에러가 발생했습니다.`"]}),"));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script.js"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, script"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 에러 처리"}),"\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 스크립트 로딩이 성공적으로 끝남"}),"\n  }\n});\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["위 패턴은 ",(0,sa.jsx)(e.strong,{children:"오류 우선 콜백"}),"으로 에러를 처리하기 위해 사용되는 흔한 패턴입니다."]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"callback의 첫 번째 인수는 에러를 위해 남겨둔다."}),"\n",(0,sa.jsx)(e.li,{children:"두 번째 혹은 그 이상의 인수들은 에러가 발생하지 않았을 때 콜백 함수에 넘겨줄 인수들입니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"콜백 속 콜백"}),"\n",(0,sa.jsx)(e.p,{children:"만약 두 개의 스크립트를 차례대로 불러오려 한다면 콜백 안에 콜백을 넣어야 합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script.js"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script2.js"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/my/script3.js"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 세 스크립트 로딩이 끝난 후 실행됨"}),"\n    });\n  });\n});\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"콜백 지옥"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107193715.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"위 방식은 멸망의 피라미드, 콜백 지옥이라 부르는 상황을 만든다.\n(코드가 오른쪽으로 점점 옮겨지면서 가독성도 해치고 코드 재사용이 어려운 상황)"}),"\n",(0,sa.jsx)(e.p,{children:"이를 해결하기 위해서 논리적으로 다음과 같이 짤 수는 있는데"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"1.js"'}),", step1);\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"step1"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, script"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleError"}),"(error);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"2.js"'}),", step2);\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"step2"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, script"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleError"}),"(error);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"3.js"'}),", step3);\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"step3"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error, script"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"handleError"}),"(error);\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 모든 스크립트가 로딩되면 다른 동작을 수행합니다."}),"\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이는 모양만 개선되었지 내부 로직은 결국 위아래 옮겨 다니면서 파악해야 하고 재사용이 어려운 문제를 그대로 갖고 있습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"무조건 콜백을 사용하면 안될까?"}),"\n",(0,sa.jsx)(e.p,{children:"아니다."}),"\n",(0,sa.jsx)(e.p,{children:"특정 동작이 끝나는 것이 보장되고 그다음 코드를 실행해야 할 때 사용하면 여전히 유용하다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showCircle"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"150"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"150"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"100"}),", ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"div"}),") =>"]})," {\n  div.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"classList"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"add"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"message-ball"'}),");\n  div.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"안녕하세요!"'}),");\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"showCircle(cx, cy, radius, callback)은 천천히 커지는 원을 만드는 함수라고 치자."}),"\n",(0,sa.jsx)(e.p,{children:'함수 내부에서 해당 callback을 이용해서 원을 다 만든 후에 요소에 "안녕하세요!"를 그리는 함수를 실행하도록 할 수 있습니다.'}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["콜백을 활용하면 해당 task를 Microtask Queue가 아니라 Macrotask queue로 task를 이동시킨다. ( ",(0,sa.jsx)(e.code,{children:"setTimeout"}),"의 동작 방식 )\nMicrotask Queue와 Macrotask queue의 차이는 이 글의 하단 부분에서 이해할 수 있습니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Promise"}),"\n",(0,sa.jsx)(e.p,{children:'시간이 얼마나 걸리던 상관없이 약속한 결과를 만들어내는 "제작 코드"가 준비되었을 때, 모든 "소비 코드"가 결과를 사용할 수 있도록 해준다.'}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"제작 코드"})}),"\n",(0,sa.jsx)(e.p,{children:"원격에서 스크립트를 불러오는 것 같은 시간이 걸리는 일"}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"소비 코드"})}),"\n",(0,sa.jsx)(e.p,{children:"제작 코드의 결과를 기다렸다가 이를 소비합니다. 소비의 주체(함수)는 여럿이 될 수 있습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// executor (제작 코드, '가수')"}),"\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// promise.then/catch/finally 등등"}),"\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"executor 함수"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"new Promise"}),"에 전달되는 콜백은 executor라고 해서 ",(0,sa.jsx)(e.code,{children:"new Promise"}),"가 만들어질 때 자동으로 실행되며 결과를 최종적으로 만들어내는 제작 코드를 포함합니다."]}),"\n",(0,sa.jsx)(e.p,{children:"executor에서는 resolve, reject를 신경 쓰지 않고 코드를 작성하면 되는데 상황에 따라 resolve, reject 중 하나를 호출해야 합니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"resolve(value) - 일이 성공적으로 끝났을 때 그 결과를 나타내는 value와 함께 호출"}),"\n",(0,sa.jsxs)(e.li,{children:["reject(error) - 에러 발생 시 에러 객체를 나타내는 ",(0,sa.jsx)(e.code,{children:"error"}),"와 함께 호출"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107200211.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"new Promise 생성자가 반환하는 promise 객체는 PromiseState, PromiseResult라는 내부 프로퍼티를 가진다."}),"\n",(0,sa.jsx)(e.p,{children:"resolve, reject 둘 다 일어나지 않았을 때"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107195926.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"resolve일 때"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107195831.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"reject일 때"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107200104.png",alt:""})}),"\n",(0,sa.jsx)(e.h4,{children:"executor 예시"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["executor는\xa0",(0,sa.jsx)(e.code,{children:"new Promise"}),"에 의해 자동으로 그리고 즉각적으로 호출됩니다."]}),"\n",(0,sa.jsxs)(e.li,{children:["executor는 인자로\xa0",(0,sa.jsx)(e.code,{children:"resolve"}),"와\xa0",(0,sa.jsx)(e.code,{children:"reject"}),"\xa0함수를 받는다. 이 함수들은 자바스크립트 엔진이 미리 정의한 함수이므로 개발자가 따로 만들 필요가 없다. 다만,\xa0",(0,sa.jsx)(e.code,{children:"resolve"}),"나\xa0",(0,sa.jsx)(e.code,{children:"reject"}),"\xa0중 하나는 반드시 호출해야 합니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise가 만들어지면 executor 함수는 자동으로 실행됩니다."}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1초 뒤에 일이 성공적으로 끝났다는 신호가 전달되면서 result는 '완료'가 됩니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"완료"'}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107200545.png",alt:""})}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1초 뒤에 에러와 함께 실행이 종료되었다는 신호를 보냅니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),")), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107200740.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"resolve"}),"나 ",(0,sa.jsx)(e.code,{children:"reject"}),"가 완료된 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 ",(0,sa.jsx)(e.code,{children:"settled Promise"})," 라고 부른다."]}),"\n",(0,sa.jsx)(e.h3,{children:"주의사항"}),"\n",(0,sa.jsx)(e.h4,{children:"1. 한번 처리된 Promise는 바뀌지 않는다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"완료"'}),");\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"…"'}),")); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 무시됨"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"…"'}),")); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 무시됨"}),"\n});\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"2. Error 객체와 함께 reject해야 합니다."}),"\n",(0,sa.jsx)(e.h4,{children:"3. 꼭 Promise가 비동기적인 것을 다루지 않아도 됩니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 일을 끝마치는 데 시간이 들지 않음"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"123"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 결과(123)를 즉시 resolve에 전달함"}),"\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위 방식대로 하면 즉시 이행 상태가 됩니다."}),"\n",(0,sa.jsx)(e.h4,{children:"4. PromiseState와 PromiseResult는 내부 프로퍼티이기 때문에 직접 접근할 수 있습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"소비함수"}),"\n",(0,sa.jsxs)(e.p,{children:["소비 함수는 ",(0,sa.jsx)(e.code,{children:".then"}),", ",(0,sa.jsx)(e.code,{children:".catch"}),", ",(0,sa.jsx)(e.code,{children:".finally"})," 메서드를 사용해 등록됩니다."]}),"\n",(0,sa.jsx)(e.h4,{children:".then"}),"\n",(0,sa.jsx)(e.p,{children:"Promise fulfilled 혹은 rejected가 완료되면 이후에 실행되는 소비함수"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"완료!"'}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// resolve 함수는 .then의 첫 번째 함수(인수)를 실행합니다."}),"\npromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(\n  ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// 1초 후 "완료!"를 출력'}),"\n  ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(error), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 실행되지 않음"}),"\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"성공 처리만 하고 싶다면 두번째 인수를 생략하면 됩니다."}),"\n",(0,sa.jsx)(e.h4,{children:".catch"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:".then(null, 에러처리함수)"})," 형태로 에러만을 처리해도 되지만 ",(0,sa.jsx)(e.code,{children:".catch"}),"를 활용해서 간결하게 표현할 수 있습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),")), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// .catch(f)는 promise.then(null, f)과 동일하게 작동합니다"}),"\npromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// 1초 뒤 "Error: 에러 발생!" 출력'}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:".finally"}),"\n",(0,sa.jsx)(e.p,{children:"Promise가 처리되면 항상 실행되는 메소드"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"/* 시간이 걸리는 어떤 일을 수행하고, 그 후 resolve, reject를 호출함 */"}),"\n})\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 성공\xb7실패 여부와 상관없이 Promise가 처리되면 실행됨"}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"finally"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," 로딩 인디케이터 중지)\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"})," =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result), ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"})," =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(error));\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"finally는 인수가 없으며 자동으로 다음 핸들러에 결과 혹은 에러를 전달합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"결과"'}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2000"}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"finally"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise가 준비되었습니다."'}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result)); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// <-- .then에서 result를 다룰 수 있음"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2초 후"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "Promise가 준비되었습니다."'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "결과"'}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"finally"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise가 준비되었습니다."'}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(err)); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// <-- .catch에서 에러 객체를 다룰 수 있음"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "Promise가 준비되었습니다."'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "에러 발생"'}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"실제 사용 예시"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src, callback"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"script"'}),");\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onload"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", script);\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onerror"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${src}"}),"를 불러오는 도중에 에러가 발생함`"]}),"));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위 코드는 콜백 방식입니다. onload와 onerror 안에 직접 callback을 박아 넣어서 구현했습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"script"'}),");\n    script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n\n    script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onload"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(script);\n    script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onerror"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${src}"}),"를 불러오는 도중에 에러가 발생함`"]}),"));\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n  });\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Promise를 사용하면 callback 로직을 밖으로 뺄 수 있습니다. 안으로 넘겨주는 인자만 받을 수 있으며 다음과 같이 사용할 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(\n  ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.js"'}),",\n);\n\npromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(\n  ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${script.src}"}),"을 불러왔습니다!`"]}),"),\n  ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Error: ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${error.message}"}),"`"]}),"),\n);\n\npromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"또 다른 핸들러..."'}),"));\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이제 then, catch, finally 메소드를 활용해서 소비 함수만 던져주면 저장된 promise에서 알아서 소비 함수 안에 인자를 넣어서 실행시킨다."}),"\n",(0,sa.jsx)(e.h3,{children:"Promise Chaining"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107204412.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Promise를 연결해서 비동기 작업을 차례대로 처리하는 방법"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (**)"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," result * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),";\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (***)"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," result * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),";\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 4"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," result * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),";\n  });\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["위의 코드가 가능한 이유는 ",(0,sa.jsx)(e.code,{children:".then"}),"이 Promise를 반환하기 때문입니다. ",(0,sa.jsx)(e.code,{children:".then"}),"의 리턴값이 해당 Promise의 ",(0,sa.jsx)(e.code,{children:"result"}),"가 됩니다."]}),"\n",(0,sa.jsx)(e.h4,{children:"또 다른 Promise를 소비 함수 안에서 반환하기"}),"\n",(0,sa.jsxs)(e.p,{children:["기본적으로 ",(0,sa.jsx)(e.code,{children:".then"}),"이 리턴할 값을 ",(0,sa.jsx)(e.code,{children:"Promise"}),"로 만들어서 리턴하지만 ",(0,sa.jsx)(e.code,{children:".then"}),"에서 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 만들어서 리턴시킬 수도 있습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(result * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n    });\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (**)"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(result * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n    });\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 4"}),"\n  });\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"실제 예시"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/one.js"'}),")\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/two.js"'}),");\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/three.js"'}),");\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 불러온 스크립트 안에 정의된 함수를 호출해"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 실제로 스크립트들이 정상적으로 로드되었는지 확인합니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"one"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"two"}),"();\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"three"}),"();\n  });\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이제 loadScript를 개선할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"Promise의 executor는 즉시 실행되고 다음 메소드로 연결된 소비 함수가 실행되기 때문에 위의 Promise를 리턴하는 함수 loadScript에 바로 메소드를 연결해줘도 됩니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/one.js"'}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script1"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/two.js"'}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script2"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/three.js"'}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"script3"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 여기서 script1, script2, script3에 정의된 함수를 사용할 수 있습니다."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"one"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"two"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"three"}),"();\n    });\n  });\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"하지만 이는 다른 콜백지옥을 만들게 됩니다."}),"\n",(0,sa.jsx)(e.p,{children:"이때 가장 내부에 있는 loadScript는 외부 스코프에 전부 접근할 수 있어서 필요에 의해선 위 코드처럼 사용하는 게 좋을 수도 있습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"참고 사항"}),"\n",(0,sa.jsx)(e.h5,{children:"thenable"}),"\n",(0,sa.jsxs)(e.p,{children:["핸들러(executor, 소비함수 등등)는 Promise가 아닌 ",(0,sa.jsx)(e.code,{children:"thenable"})," 객체를 반환하기도 합니다."]}),"\n",(0,sa.jsx)(e.p,{children:"thenable 객체는 서드파티 라이브러리가 Promise와 호환 가능한 자체 객체를 구현할 수 있다는 점에서 나오게 되었다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Thenable"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"num"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"num"})," = num;\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(resolve); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 아래 코드에서 alert를 넣었으므로 function() { [native code] }이 바로 일단 나온다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1초 후 this.num*2와 함께 이행됨"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"num"})," * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (**)"}),"\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Thenable"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1,000밀리 초 후 2를 보여줌"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110210716.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"fetch와 체이닝 함께 응용"}),"\n",(0,sa.jsxs)(e.p,{children:["프론트 단에서 네트워크 요청 시 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 자주 사용합니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url);\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["위 코드를 실행하면 ",(0,sa.jsx)(e.code,{children:"url"}),"에 네트워크 요청을 보내고 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 반환합니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["fetch는 ",(0,sa.jsx)(e.code,{children:"resolve"}),"시 ",(0,sa.jsx)(e.code,{children:"url"}),"로 연결해서 얻은 자원을 핸들러로 넘겨준다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 원격 서버가 응답하면 .then 아래 코드가 실행됩니다."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// response.text()는 응답 텍스트 전체가 다운로드되면"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 응답 텍스트를 새로운 이행 Promise를 만들고, 이를 반환합니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"text"}),"();\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"text"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 원격에서 받아온 파일의 내용"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(text); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// {"name": "Violet-Bora-Lee", "isAdmin": true}'}),"\n  });\n"]})}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["원격 서버가 헤더와 함께 응답을 보내면 ",(0,sa.jsx)(e.code,{children:"Promise"}),"는 ",(0,sa.jsx)(e.code,{children:"response"})," 객체와 함께 ",(0,sa.jsx)(e.code,{children:"fulfilled"}),"됩니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"response"})," 전체가 완전히 다운로드되기 전에 Promise는 ",(0,sa.jsx)(e.code,{children:"fulfilled"}),"가 됩니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"response"}),"가 다 다운로드 되고 전체를 읽기 위해서는 ",(0,sa.jsx)(e.code,{children:"response.text()"}),"를 호출해야 합니다. ( ",(0,sa.jsx)(e.code,{children:"response.text()"}),"는 서버에서 전송한 텍스트 전체가 다운로드되면 이 텍스트를 ",(0,sa.jsx)(e.code,{children:"result"}),"값으로 갖는 ",(0,sa.jsx)(e.code,{children:"fulfilled"}),"된 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 반환합니다. )"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"response.json()"}),"을 사용하면 데이터를 읽고 ",(0,sa.jsx)(e.code,{children:"JSON"}),"으로 파싱할 수 있습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 위 코드와 동일한 기능을 하지만, response.json()은 원격 서버에서 불러온 내용을 JSON으로 변경해줍니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"name"}),")); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Violet-Bora-Lee, 이름만 성공적으로 가져옴"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"fetch"}),"를 순차적으로 보내는 예시를 확인해보겠습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// user.json에 요청을 보냅니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 응답받은 내용을 json으로 불러옵니다."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// GitHub에 요청을 보냅니다."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${user.name}"}),"`"]}),"))\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 응답받은 내용을 json 형태로 불러옵니다."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 3초간 아바타 이미지(githubUser.avatar_url)를 보여줍니다."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," img = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"img"'}),");\n    img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = githubUser.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"avatar_url"}),";\n    img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"className"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise-avatar-example"'}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"body"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(img);\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," img.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"remove"}),"(), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n  });\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["만약 마지막 then에서 무언가를 더 하고 싶다면 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 리턴해주면 됩니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${user.name}"}),"`"]}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n        ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," img = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"img"'}),");\n        img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = githubUser.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"avatar_url"}),";\n        img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"className"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise-avatar-example"'}),";\n        ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"body"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(img);\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n          img.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"remove"}),"();\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(githubUser); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (**)"}),"\n        }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),");\n      }),\n  )\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 3초 후 동작함"}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") =>"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${githubUser.name}"}),"의 이미지를 성공적으로 출력하였습니다.`"]}),"),\n  );\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위의 코드는 다음과 같이 정리해서 가독성을 높일 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadJson"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"());\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadGithubUser"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"name"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${name}"}),"`"]}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]}),"\n    response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"(),\n  );\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showAvatar"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," img = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"img"'}),");\n    img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = githubUser.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"avatar_url"}),";\n    img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"className"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise-avatar-example"'}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"body"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(img);\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      img.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"remove"}),"();\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(githubUser);\n    }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),");\n  });\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 함수를 이용하여 다시 동일 작업 수행"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadJson"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadGithubUser"}),"(user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"name"}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(showAvatar)\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`Finished showing ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${githubUser.name}"}),"`"]}),"));\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ..."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"결론적으로 Promise Chaining은 다음의 구조입니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107212119.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Promise와 Error Handling"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 없는 url일 경우"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://no-such-server.blabla"'}),") ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 거부"}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(err));\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// TypeError: failed to fetch ( 출력되는 내용은 다를 수 있음 )"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise"}),"가 거부되면 제어 흐름이 제일 가까운 ",(0,sa.jsx)(e.code,{children:"rejection"})," 핸들러로 넘어간다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// JSON의 형식이 잘못되면"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/article/promise-chaining/user.json"'}),")\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${user.name}"}),"`"]}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"githubUser"}),") =>"]}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," img = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"img"'}),");\n        img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = githubUser.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"avatar_url"}),";\n        img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"className"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise-avatar-example"'}),";\n        ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"body"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(img);\n\n        ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n          img.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"remove"}),"();\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(githubUser);\n        }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),");\n      }),\n  )\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(error.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"message"}),"));\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"체인 끝에 catch를 붙이면 위쪽 Promise 중 하나라도 거부되면 해당 catch가 에러를 잡게 됩니다."}),"\n",(0,sa.jsx)(e.h4,{children:"암시적 try...catch"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise executor"}),"와 ",(0,sa.jsx)(e.code,{children:"Promise"})," 핸들러 코드 주위에는 암시적 ",(0,sa.jsx)(e.code,{children:"try...catch"}),"가 존재합니다. 예외가 발생하면 암시적 ",(0,sa.jsx)(e.code,{children:"try...catch"}),"에서 예외를 잡고 이를 ",(0,sa.jsx)(e.code,{children:"reject"}),"처럼 다룬다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 아래 두 코드는 같은 기능을 합니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),");\n}).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: 에러 발생!"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),"));\n}).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: 에러 발생!"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"throw"}),"를 사용해서 에러를 던지면 이 자체가 거부된 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 의미하게 됩니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"OK"'}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise가 거부됨"}),"\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(error);\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),";\n  }); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: 에러 발생!"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110214430.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["해당 암시적 ",(0,sa.jsx)(e.code,{children:"try... catch"}),"는 핸들러 위쪽에서 발생한 비정상 에러 또한 잡는다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"OK"'}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"blabla"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 존재하지 않는 함수"}),"\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ReferenceError: blabla is not defined"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["단 동기적 에러가 암시적 ",(0,sa.jsx)(e.code,{children:"try...catch"}),"에서 처리되는 것입니다. 다음과 같이 비동기 코드가 executor 내부에 존재하고 내부에 에러가 발생한다면 해당 에러를 감지할 수 없다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),");\n  }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n}).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert);\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"다시 던지기"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:".catch"}),"가 정상적으로 종료되면 ",(0,sa.jsx)(e.code,{children:"fulfilled"}),"인 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 리턴할 것입니다. 그래서 다음과 같은 로직이 가능하다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 실행 순서: catch -> then"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러가 잘 처리되었습니다. 정상적으로 실행이 이어집니다."'}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// catch 이후 리턴되는 fulfilled상태의 Promise가 .then을 만난다."}),"\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"다음 핸들러가 실행됩니다."'}),"));\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위를 활용해서 에러 핸들링을 세분화시킬 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 실행 순서: catch -> catch"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),");\n})\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// URIError만 처리하는 소비 함수"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (error ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"instanceof"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"URIError"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 에러 처리"}),"\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"처리할 수 없는 에러"'}),");\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," error; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// URIError가 아닐 경우 다음 에러 핸들러로 전달"}),"\n    }\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"/* 여기는 실행되지 않습니다. */"}),"\n  })\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"error"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (**)"}),"\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`알 수 없는 에러가 발생함: ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${error}"}),"`"]}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 반환값이 없음 => 실행이 계속됨"}),"\n  });\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"처리되지 못한 거부"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"noSuchFunction"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 존재하지 않는 함수를 호출하기 때문에 에러가 발생함"}),"\n}).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 성공상태의 Promise를 처리하는 핸들러. 한 개 혹은 여러 개가 있을 수 있음"}),"\n}); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 끝에 .catch가 없음!"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"예외를 처리해 줄 핸들러가 없으면 에러가 갇혀 버린다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"try...catch"}),"에서 일반적인 에러가 발생하고 이를 처리하지 못했을 때 스크립트가 죽고 콘솔 창에 메시지가 출력되는데\n",(0,sa.jsx)(e.code,{children:"rejected Promise"}),"가 처리되지 않아도 동일한 일이 발생합니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["JS 엔진은 ",(0,sa.jsx)(e.code,{children:"Promise reject"}),"를 추적하다가 에러가 갇힌 걸 확인하면 전역 에러를 생성합니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["브라우저에서는 ",(0,sa.jsx)(e.code,{children:"unhandledrejection"})," 이벤트로 이런 에러를 처리합니다. (HTML 명세서에 정의된 표준 이벤트입니다.)"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"unhandledrejection"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"event"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// unhandledrejection 이벤트엔 두 개의 특수 프로퍼티가 있습니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(event.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"promise"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [object Promise] - 에러를 생성하는 Promise"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(event.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"reason"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: 에러 발생! - 처리하지 못한 에러 객체"}),"\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),");\n}); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 에러를 처리할 수 있는 .catch 핸들러가 없음"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241107214313.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Promise API"}),"\n",(0,sa.jsx)(e.h4,{children:"Promise.all"}),"\n",(0,sa.jsx)(e.p,{children:"여러 개의 Promise를 동시에 실행시키고 모든 Promise가 준비될 때까지 기다린다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// let promise = Promise.all([...promises...]);"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise인 배열을 받고 새로운 Promise를 반환합니다."}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),")), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2000"}),")), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),")), ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 3"}),"\n]).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise 전체가 처리되면 1, 2, 3이 반환됩니다. 각 Promise는 배열을 구성하는 요소가 됩니다."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"각 Promise 요청이 다 끝나면 배열의 순서에 따라서 결과 값이 또 다른 배열 형태로 소비 함수로 전달됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108150808.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"fetch"}),"는 인수에 존재하는 url에 요청을 보내서 ",(0,sa.jsx)(e.code,{children:"response"}),"를 ",(0,sa.jsx)(e.code,{children:"Promise"})," 형태로 리턴하는 함수입니다. 이를 활용한 예제를 살펴보면"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," urls = [\n  ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://api.github.com/users/iliakan"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://api.github.com/users/Violet-Bora-Lee"'}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"https://api.github.com/users/jeresig"'}),",\n];\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// fetch를 사용해 url을 Promise로 매핑합니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," requests = urls.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url));\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise.all은 모든 작업이 이행될 때까지 기다립니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"(requests).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"responses"}),") =>"]}),"\n  responses.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"forEach"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${response.url}"}),": ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${response.status}"}),"`"]}),")),\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108151347.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise.all"}),"을 이용해서 요청 응답을 배열로 받은 후 그 배열을 다시 ",(0,sa.jsx)(e.code,{children:"Promise.all"}),"을 이용해서 ",(0,sa.jsx)(e.code,{children:"json()"}),"으로 파싱, 다음 소비 함수에서 해당 파싱된 데이터를 콘솔 창에 띄우는 로직입니다."]}),"\n",(0,sa.jsx)(e.p,{children:"결론적으로 다음과 같이 중간에 소비 함수의 로직을 늘릴 수도 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," names = [",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"iliakan"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Violet-Bora-Lee"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"jeresig"'}),"];\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," requests = names.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"name"}),") =>"]}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${name}"}),"`"]}),"),\n);\n\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"(requests)\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"responses"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 모든 응답이 성공적으로 이행되었습니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"for"})," (",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," response ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"of"})," responses) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${response.url}"}),": ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${response.status}"}),"`"]}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 모든 url의 응답코드가 200입니다."}),"\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," responses;\n  })\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 응답 메시지가 담긴 배열을 response.json()로 매핑해, 내용을 읽습니다."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"responses"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"(responses.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"r"}),") =>"]})," r.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"())))\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// JSON 형태의 응답 메시지는 파싱 되어 배열 'users'에 저장됩니다."}),"\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"users"}),") =>"]})," users.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"forEach"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"user"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(user.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"name"}),")));\n"]})}),"\n",(0,sa.jsx)(e.h5,{children:"Promise.all의 에러 핸들링"}),"\n",(0,sa.jsx)(e.p,{children:"내부 배열에서 하나라도 rejected가 일어나면 전체를 에러라고 판단합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),")),\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),")), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2000"}),"),\n  ),\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),")),\n]).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: 에러 발생!"}),"\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Promise reject가 일어나도 호출은 계속 일어난다."})}),"\n",(0,sa.jsx)(e.p,{children:"별도의 처리 (AbortController) 가 없다면 Promise rejected가 일어나도 다른 Promise 처리가 취소되진 않는다. 단, 결과는 무시됩니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108152428.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"위 예시는 rejected되는 Promise를 배열에 넣고 Promise.all을 돌린 예시입니다.\n첫 번째 인수인 Promise가 rejected되어 전역 에러가 일어났다. (catch 메소드가 뒤에 없으므로)\n이때 네트워크 요청에서 보면 fetch 자체는 일어난 것을 확인할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108152443.png",alt:""})}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Promise.all의 인수에 있는 배열"})}),"\n",(0,sa.jsx)(e.p,{children:"해당 배열은 꼭 Promise 객체가 아니어도 됩니다. 밑의 예시처럼 숫자를 넣을 수도 있는데 이때는 해당 숫자를 그대로 소비 함수로 전달합니다."}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n  }),\n  ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),",\n  ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),",\n]).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1, 2, 3"}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Promise.allSettled"}),"\n",(0,sa.jsx)(e.p,{children:"Promise.all은 하나라도 에러가 나면 전부 결과를 못 받는다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/template.html"'}),"),\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/style.css"'}),"),\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"/data.json"'}),"),\n]).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(render); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// render 메서드는 fetch 결과 전부가 있어야 제대로 동작합니다."}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위 예시와 같이 html, css, json이 전부 필요한 render 함수가 소비 함수일 경우 유용하다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:".allSettled"}),"는 하나가 에러가 나더라도 다른 요청을 받을 수 있게 하려고 태어났다."]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["응답이 성공하였을 때 –\xa0",(0,sa.jsx)(e.code,{children:'{status:"fulfilled", value:result}'})]}),"\n",(0,sa.jsxs)(e.li,{children:["에러가 발생하였을 때 –\xa0",(0,sa.jsx)(e.code,{children:'{status:"rejected", reason:error}'})]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"allSettled"}),"(urls.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url))).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"results"}),") =>"]})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n  results.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"forEach"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"result, num"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (result.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," == ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"fulfilled"'}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${urls[num]}"}),": ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${result.value.status}"}),"`"]}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 응답이 성공하면 결과가 value 프로퍼티 안에 들어가게 됩니다."}),"\n    }\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (result.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"status"})," == ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"rejected"'}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${urls[num]}"}),": ",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${result.reason}"}),"`"]}),");\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 에러가 발생하면 에러 객체가 reason 프로퍼티 안에 들어가게 됩니다."}),"\n    }\n  });\n});\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108154631.png",alt:""})}),"\n",(0,sa.jsx)(e.h4,{children:"Promise.race"}),"\n",(0,sa.jsx)(e.p,{children:"Promise.all과 유사하게 Promise 배열 전체를 처리하지만 가장 먼저 처리되는 Promise의 결과를 반환합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"//let promise = Promise.race(iterable);"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"race"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),")),\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),")), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2000"}),"),\n  ),\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),")),\n]).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Promise.resolve와 Promise.reject"}),"\n",(0,sa.jsxs)(e.p,{children:["resolve와 reject 메소드는 async/ await의 등장으로 잘 사용되지 않는다. 하지만 추후 나올 폴리 필을 이해하기 위해서라도 필요하기에 한번 알아보도록 하겠습니다.\n( ",(0,sa.jsx)(e.code,{children:"async function"}),"은 리턴값을 무조건 Promise로 꺼내고 내부에 throw Error해주면 rejected 상태의 Promise를 리턴합니다. )"]}),"\n",(0,sa.jsx)(e.h5,{children:"Promise.resolve"}),"\n",(0,sa.jsx)(e.p,{children:"Promise.resolve(value)는 결과값이 value인 fulfilled한 Promise를 생성합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// let promise = new Promise(resolve => resolve(value));"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," cache = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Map"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadCached"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (cache.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"has"}),"(url)) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(cache.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"get"}),"(url));\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url)\n    .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"response"}),") =>"]})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"text"}),"())\n    .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"text"}),") =>"]})," {\n      cache.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"set"}),"(url, text);\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," text;\n    });\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"loadCached"}),"는 ",(0,sa.jsx)(e.code,{children:"fetch"}),"를 할 때 ",(0,sa.jsx)(e.code,{children:"cache"}),"에 해당 데이터를 저장해두고 다음에 같은 요청을 보냈을 때 ",(0,sa.jsx)(e.code,{children:"cache"}),"에서 꺼내서 전달합니다.\n이때 ",(0,sa.jsx)(e.code,{children:"Promise.resolve"}),"를 이용해서 ",(0,sa.jsx)(e.code,{children:"loadCached"}),"가 항상 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 반환한다는 걸 정해둬서 사용하는 단에서는 ",(0,sa.jsx)(e.code,{children:"loadCached"})," 함수에 ",(0,sa.jsx)(e.code,{children:".then/catch"})," 등의 메소드를 통해서 소비 함수를 넣을 수 있게 됩니다."]}),"\n",(0,sa.jsx)(e.h6,{children:"Promise.resolve를 이용한 Promise allSettled의 폴리필"}),"\n",(0,sa.jsx)(e.p,{children:"allSettled는 나온 지 얼마 안 되어서 구식 브라우저에서는 폴리 필이 필요하다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"allSettled"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"allSettled"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"promises"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"(\n      promises.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"p"}),") =>"]}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(p).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(\n          ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"value"}),") =>"]})," ({\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"status"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"fulfilled"'}),",\n            value,\n          }),\n          ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"reason"}),") =>"]})," ({\n            ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// then의 두 번째 인수입니다. then의 두 번째 인수는 error 핸들러입니다. (catch와 같음.)"}),"\n            ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"status"}),": ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"rejected"'}),",\n            reason,\n          }),\n        ),\n      ),\n    );\n  };\n}\n"]})}),"\n",(0,sa.jsx)(e.h5,{children:"Promise.reject"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise.reject(error)"}),"는 결과값이 ",(0,sa.jsx)(e.code,{children:"error"}),"인 ",(0,sa.jsx)(e.code,{children:"rejected Promise"}),"를 반환합니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(error);\nㄴ;\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108160624.png",alt:""})}),"\n",(0,sa.jsx)(e.h3,{children:"Fetch: Abort"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"글 흐름을 위해 Promise 파트에 넣어놓긴 했지만 엄밀히 말하면 Promise API는 아니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Promise.all 에서도 에러 발생시 Promise 결과는 무시되나 호출은 막을 수 없다고 하였습니다.\nAbortController라는 빌트인 객체를 활용하면 Promise 호출 자체를 막을 수 있습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"AbortController Object"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," controller = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AbortController"}),"();\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"AbortController는 프로퍼티 하나, 메소드 하나를 갖고 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108161157.png",alt:""})}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"signal"}),"은 프로토타입 체인을 가치지 않고 바로 인스턴스에서 찾을 수 있으며 ",(0,sa.jsx)(e.code,{children:"event listener"}),"를 세팅할 수 있는 프로퍼티입니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"abort"}),"는 프로토타입 체인을 이용해서 ",(0,sa.jsx)(e.code,{children:"AbortController"}),"에 있는 메소드를 가져오는 것이며 ",(0,sa.jsx)(e.code,{children:"abort"}),"가 실행되면 다음의 과정이 일어난다.","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:'instance.signal이 "abort" event를 발생시킨다.'}),"\n",(0,sa.jsx)(e.li,{children:"instance.signal.aborted가 true가 됩니다."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"따라서 signal에 취소 가능한 작업을 리스너로 달아 놓고\nabort() 함수로 취소하는 것입니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," controller = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AbortController"}),"();\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," signal = controller.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"signal"}),";\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 취소가능한 작업을 수행하는 곳에 signal 객체를 주고, controller.abort()가 실행되면 실행될 리스너를 세팅합니다."}),"\nsignal.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"abort"'}),", ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"abort!"'}),"));\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 아래 코드를 어떤 곳에 넣어서 원할 때 실행할 수 있도록 합니다."}),"\ncontroller.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"abort"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// abort!"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// abort event가 트리거되면 aborted가 true로 바뀐다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(signal.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"aborted"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// true"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["다른 event를 구현해서 동일 기능을 만들어서 fetch와 쓸 수도 있지만, 내부적으로 fetch는 ",(0,sa.jsx)(e.code,{children:"AbortController"}),"를 인식하기 때문에 ",(0,sa.jsx)(e.code,{children:"AbortController"}),"를 사용하는 것이 좋다."]}),"\n",(0,sa.jsx)(e.h4,{children:"fetch와 함께 사용"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"fetch"})," 옵션에 ",(0,sa.jsx)(e.code,{children:"signal"}),"이라는 프로퍼티가 존재합니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," controller = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AbortController"}),"();\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url, {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"signal"}),": controller.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"signal"}),",\n});\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["이제 이전과 같이 ",(0,sa.jsx)(e.code,{children:"controller.abort()"})," 함수로 ",(0,sa.jsx)(e.code,{children:"fetch"})," 요청을 제어해주면 됩니다."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"단, fetch가 abort하는 시기보다 더 빨리 끝나면 이미 나온 결과를 없애진 않는다."}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"AbortController는 확장성 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," urls = [...]; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// a list of urls to fetch in parallel"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," controller = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AbortController"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// an array of fetch promises"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," fetchJobs = urls.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"})," =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url, {\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"signal"}),": controller.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"signal"}),"\n}));\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," results = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"(fetchJobs);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// if controller.abort() is called from elsewhere,"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// it aborts all fetches"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["위와 같이 ",(0,sa.jsx)(e.code,{children:"signal"}),"로 하나의 ",(0,sa.jsx)(e.code,{children:"controller"}),"를 등록해두면 등록된 모든 ",(0,sa.jsx)(e.code,{children:"fetch"}),"가 하나의 ",(0,sa.jsx)(e.code,{children:"controller"}),"의 신호를 따르게 됩니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["또한 ",(0,sa.jsx)(e.code,{children:"Promise"}),"와 함께 사용할 수 있으며 ",(0,sa.jsx)(e.code,{children:"Promise.all"}),"을 통해서 ",(0,sa.jsx)(e.code,{children:"fetch"}),"와 해당 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 결합할 수도 있습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," urls = [...];\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," controller = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"AbortController"}),"();\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," ourJob = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// our task"}),"\n  ...\n  controller.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"signal"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"'abort'"}),", reject);\n});\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," fetchJobs = urls.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"})," =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url, { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// fetches"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-attr",children:"signal"}),": controller.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"signal"}),"\n}));\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Wait for fetches and our task in parallel"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," results = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([...fetchJobs, ourJob]);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// if controller.abort() is called from elsewhere,"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// it aborts all fetches and ourJob"}),"\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"Promisification"}),"\n",(0,sa.jsxs)(e.p,{children:["콜백을 받는 함수를 Promise를 반환하는 함수로 바꾸는 것을 ",(0,sa.jsx)(e.code,{children:"Promisification"})," 이라고 합니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src, callback"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," script = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"script"'}),");\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = src;\n\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onload"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", script);\n  script.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"onerror"})," = ",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${src}"}),"를 불러오는 도중에 에러가 발생함`"]}),"));\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(script);\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 사용법:"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// loadScript('path/script.js', (err, script) => {...})"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["위 함수는 콜백 함수를 활용한 함수로써 이를 ",(0,sa.jsx)(e.code,{children:"Promisification"})," 해보겠습니다."]}),"\n",(0,sa.jsx)(e.p,{children:"src라는 인수를 받아야 되고 콜백을 받지 않고 사용하는 단에서 제어할 수 있어야 합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," loadScriptPromise = ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"src"}),")=>"]}),"{\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),")=>"]}),"{\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 여기서 (err, script)=>{...} 이건 위의 코드에서 보면 기존의 사용법에서 쓰이는 콜백 함수입니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 콜백 함수가 내부로 숨겨진 것일 뿐입니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScript"}),"(src,",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err, script"}),")=>"]}),"{\n	  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (err) ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(err);\n	  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(script);\n    })\n  })\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 사용법:"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// loadScriptPromise('path/script.js').then(...)"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["이러한 ",(0,sa.jsx)(e.code,{children:"Promisification"})," 은 하나의 함수에서만 쓸 수 있습니다. 이를 확장성 있게 하려면 헬퍼 함수를 만들어 보겠습니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["헬퍼 함수는 함수 ",(0,sa.jsx)(e.code,{children:"f"}),"를 받아서 래퍼 함수를 반환해야 합니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"promisify"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"f"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"...args"}),") { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 래퍼 함수를 반환함"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err, result"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// f에 사용할 커스텀 콜백"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (err) {\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(err);\n        } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(result);\n        }\n      }\n\n      args.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(callback); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 위에서 만든 커스텀 콜백을 함수 f의 인수 끝에 추가합니다."}),"\n\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 처음 promisify를 선언할 때 넣었던 함수를 가져와서"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 호출할 때의 this, 그리고 호출할 때 넣은 args를 가져와서 실행시킨다."}),"\n      f.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"call"}),"(",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),", ...args); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 기존 함수를 호출합니다."}),"\n    });\n  };\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 사용법:"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," loadScriptPromise = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"promisify"}),"(loadScript);\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"loadScriptPromise"}),"(...).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(...);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위 코드에서 여러 인수를 처리하기 위해선 다음과 같은 리팩토링이 필요하다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 콜백의 성공 결과를 담은 배열을 얻게 해주는 promisify(f, true)"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"promisify"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-params",children:["f, manyArgs = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"false"})]}),") { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// args 다수 여부 확인"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," (",(0,sa.jsx)(e.span,{className:"hljs-params",children:"...args"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"callback"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err, ...results"}),") { ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// f에 사용할 커스텀 콜백"}),"\n        ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (err) {\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(err);\n        } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n          ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// args 다수 여부로 판단해서 리턴될 Promise의 result에 하나만 넣을지 여러 개 넣을지 판단"}),"\n          ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(manyArgs ? results : results[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"]);\n        }\n      }\n\n      args.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(callback);\n\n      f.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"call"}),"(",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),", ...args);\n    });\n  };\n};\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 사용법:"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 여기서 promisify에 들어가는 f는 여러 인수가 필요하고 콜백이 마지막 인수로 들어가는 함수입니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// f(arg1, arg2, ..., (err, ...results)=>{});"}),"\nf = ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"promisify"}),"(f, ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"true"}),");\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(...).",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"arrayOfResults"})," =>"]})," ..., ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:[(0,sa.jsx)(e.span,{className:"hljs-params",children:"err"})," =>"]})," ...);\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["단, ",(0,sa.jsx)(e.code,{children:"Promisification"})," 은 콜백을 완전히 대체하지는 못합니다. 콜백은 여러 번 호출할 수 있고 Promise는 하나의 결과만 가질 수 있기 때문입니다. ( Promisification한 함수의 콜백을 여러 번 호출해도 두 번째부터는 무시됩니다. )"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["사실 이를 미리 처리해주는 ",(0,sa.jsx)(e.code,{children:"promisify"})," 라이브러리나 ",(0,sa.jsx)(e.code,{children:"Node.js"})," 내장 함수가 존재합니다."]}),"\n",(0,sa.jsx)(e.h3,{children:"Microtask 처리"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise"})," 핸들러 (",(0,sa.jsx)(e.code,{children:".then/catch/finally"}),")는 항상 비동기적으로 실행됩니다."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise"}),"가 즉시 이행돼도 ",(0,sa.jsx)(e.code,{children:".then/catch/finally"})," 아래에 있는 코드들은 이 핸들러가 실행되기 전에 실행됩니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"();\n\npromise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise 성공!"'}),"));\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"코드 종료"'}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 결과"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// alert("코드 종료");'}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// alert("Promise 성공!");'}),"\n"]})}),"\n",(0,sa.jsx)(e.h4,{children:"Microtask Queue"}),"\n",(0,sa.jsxs)(e.p,{children:["비동기 작업을 처리하려면 적절한 관리가 필요하다.\n이를 위해 ECMA에선 ",(0,sa.jsx)(e.code,{children:"PromiseJobs"}),"라는 내부 큐(",(0,sa.jsx)(e.code,{children:"Internal Queue"}),")를 명시합니다. ( ",(0,sa.jsx)(e.code,{children:"V8"}),"엔진에서 이를 ",(0,sa.jsx)(e.code,{children:"Microtask Queue"})," 라고 부르기 때문에 ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"를 더 자주 쓴다. )"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"는 다음처럼 동작합니다."]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["먼저 들어온 작업을 먼저 실행합니다. (",(0,sa.jsx)(e.code,{children:"FIFO"}),")"]}),"\n",(0,sa.jsx)(e.li,{children:"실행할 것이 아무것도 남아있지 않을 때만 큐에 있는 작업이 실행되기 시작합니다."}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["요약하면 어떤 ",(0,sa.jsx)(e.code,{children:"Promise"})," 가 준비되었을 때 이 ",(0,sa.jsx)(e.code,{children:"Promise"}),"의 ",(0,sa.jsx)(e.code,{children:".then/catch/finally"})," 핸들러는 큐에 들어가게 되며 여전히 실행되지 않는다."]}),"\n",(0,sa.jsx)(e.p,{children:"이후 현재 코드에서 자유로운 상태가 되었을 때 자바스크립트 엔진은 큐에서 작업을 꺼내 실행합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108195640.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise"})," 핸들러는 항상 내부 큐(",(0,sa.jsx)(e.code,{children:"Promise jobs"}),"이자 ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),")를 통과하게 됩니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["여러 개의 ",(0,sa.jsx)(e.code,{children:".then/catch/finally"}),"를 사용해 만든 체인의 경우, 각 핸들러는 비동기적으로 실행됩니다. 큐에 들어간 핸들러 각각은 현재 코드가 완료되고, 큐에 들어있는 이전 핸들러의 실행이 완료되었을 때 실행됩니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"()\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise Fulfilled"'}),"))\n  .",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"finish"'}),"));\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"위와 같이 하면 비동기 동작을 차례대로 진행할 수 있습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"처리되지 못한 거부"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"unhandledrejection"})," 이벤트는 ",(0,sa.jsx)(e.code,{children:"Promise"}),"를 실행할 때 ",(0,sa.jsx)(e.code,{children:".catch"})," 없이 에러가 전달돼서 전역 에러가 난 것을 의미합니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise 실패!"'}),"));\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise 실패!"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"unhandledrejection"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"event"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(event.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"reason"}),"));\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"unhandled rejection"})}),"\n",(0,sa.jsxs)(e.p,{children:["자바스크립트 엔진은 처리되지 못한 거부(unhandled rejection)를 찾을 때 ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"를 확인합니다.\nMicrotask Queue 끝에도 Promise error가 처리되지 않았다면 발생합니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h5,{children:"만약 catch를 나중에 처리한다면"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"Promise 실패!"'}),"));\n",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," promise.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"catch"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"err"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"잡았다!"'}),")), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Error: Promise 실패!"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"window"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"addEventListener"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"unhandledrejection"'}),", ",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"event"}),") =>"]}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(event.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"reason"}),"),\n);\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241108205243.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"unhandledrejection"}),"의 핸들러 함수 > rejected Promise 있다고 알림 > catch 소비 함수\n순서인 것을 확인할 수 있습니다."]}),"\n",(0,sa.jsx)(e.p,{children:"이는 다음의 과정 때문에 그러하다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["현재 ",(0,sa.jsx)(e.code,{children:"Macrotask"}),"가 끝나면 (",(0,sa.jsx)(e.code,{children:"window.addEventListener"}),"까지 다 끝나고 나면) ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"를 확인합니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"unhandledrejection"}),"은 ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"에 있는 작업이 ",(0,sa.jsx)(e.code,{children:"rejected"}),"된 상태로 남아있을 때 발동됩니다. 즉 ",(0,sa.jsx)(e.code,{children:"rejected Promise"})," 상태로 남아 있는 것을 발견하고 ",(0,sa.jsx)(e.code,{children:"unhandledrejection"}),"을 발동시킨다."]}),"\n",(0,sa.jsxs)(e.li,{children:["등록된 핸들러 ",(0,sa.jsx)(e.code,{children:"(console.log(event.reason))"})," 실행"]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"Web API"}),"에서 ",(0,sa.jsx)(e.code,{children:"1,000ms"}),"가 끝나고 ",(0,sa.jsx)(e.code,{children:"setTimeout"}),"의 콜백 함수 ",(0,sa.jsx)(e.code,{children:"( ()=>promise.catch(()=>console.log('잡았다!')) )"}),"가 ",(0,sa.jsx)(e.code,{children:"Macrotask Queue"}),"로 이동됩니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"()=>promise.catch(()=>console.log('잡았다!'))"}),"를 실행해서 ",(0,sa.jsx)(e.code,{children:"promise.catch(()=>console.log('잡았다!')"})," 리턴합니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"rejected Promise"}),"가 담겨있는 변수 ",(0,sa.jsx)(e.code,{children:"promise"}),"를 ",(0,sa.jsx)(e.code,{children:".catch"}),"핸들러로 찍었기에 ",(0,sa.jsx)(e.code,{children:"()=>console.log('잡았다!')"}),"를 ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"로 이동시킨다."]}),"\n",(0,sa.jsxs)(e.li,{children:["이동이 끝나면 ",(0,sa.jsx)(e.code,{children:"Macrotask"})," 하나가 끝났으니 ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"를 비워질 때까지 실행합니다. 여기서 ",(0,sa.jsx)(e.code,{children:"()=>console.log('잡았다!')"}),"가 실행됩니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"async, await"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Promise"}),"를 편하게 사용하기 위해 ",(0,sa.jsx)(e.code,{children:"async"}),", ",(0,sa.jsx)(e.code,{children:"await"})," 문법이 탄생하게 되었다."]}),"\n",(0,sa.jsx)(e.h3,{children:"async function"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," funciton ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"function"})," 앞에 ",(0,sa.jsx)(e.code,{children:"async"}),"를 붙이면 해당 함수는 항상 Promise를 반환합니다.\n만약 Promise가 아닌 값을 반환하더라도 fulfilled 상태의 Promise로 값을 감싸서 반환합니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110152440.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"즉 다음의 코드들은 같은 기능을 합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," funciton ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f1"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," funciton ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f2"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),"){\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),");\n}\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"await"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// await는 async function 안에서만 동작합니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," value = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," promise;\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"await"})," 키워드를 만나면 Promise가 처리될 때까지 기다린다. ",(0,sa.jsx)(e.code,{children:"await"}),"키워드 아래에 있는 동일 블록의 코드들은 ",(0,sa.jsx)(e.code,{children:"Microtask Queue"}),"로 이동합니다. ( 기능적으로 ",(0,sa.jsx)(e.code,{children:".then"}),"으로 넘기는 것과 같다. )"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," promise = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"완료!"'}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),");\n  });\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," result = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," promise; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise가 이행될 때까지 기다림 (*)"}),"\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:'// "완료!"'}),"\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"();\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Promise가 처리될 때까지 기다리는 동안 엔진은 다른 일(다른 스크립트 실행, 이벤트 처리)을 처리할 수 있기 때문에 CPU 리소스가 낭비되지 않는다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["즉, ",(0,sa.jsx)(e.code,{children:"await"}),"은 ",(0,sa.jsx)(e.code,{children:"promise.then"}),"보다 좀 더 세련되게 Promise의 ",(0,sa.jsx)(e.code,{children:"result"})," 값을 얻을 수 있도록 해주는 문법입니다."]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.strong,{children:"fetch와 체이닝 함께 응용"})," 파트에서 예시로 있었던 ",(0,sa.jsx)(e.code,{children:"showAvatar"})," 코드를 ",(0,sa.jsx)(e.code,{children:"async / await"})," 문법으로 정리해보면 다음과 같다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showAvatar"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"url"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// JSON 읽기"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," loadJsonResponse = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url);\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," { name } = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," loadJsonResponse.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// github 사용자 정보 읽기"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," githubUserResponse = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(\n    ",(0,sa.jsxs)(e.span,{className:"hljs-string",children:["`https://api.github.com/users/",(0,sa.jsx)(e.span,{className:"hljs-subst",children:"${name}"}),"`"]}),",\n  );\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," githubUser = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," githubUserResponse.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 아바타 보여주기"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," img = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"createElement"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"img"'}),");\n  img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"src"})," = githubUser.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"avatar_url"}),";\n  img.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"className"})," = ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"promise-avatar-example"'}),";\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"document"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"body"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"append"}),"(img);\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 3초 대기"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(resolve, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3000"}),"));\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// await가 실행되면 해당 Promise가 처리되는 동작을 executor로 잡고 그 아래의 코드들은 Microtask Queue로 간다고 생각하면 됩니다. (.then과 동작이 똑같음.)"}),"\n\n  img.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"remove"}),"();\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," githubUser;\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"showAvatar"}),"();\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["await은 최상위 레벨 코드에서 동작하지 않는다.\n이를 위해서 ",(0,sa.jsx)(e.code,{children:"IIFE ( Immediately Invoked function expression )"}),"를 사용할 수 있습니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," ()=>{\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:"`/article/promise-chaining/user.json`"}),");\n	",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," user = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," response.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"json"}),"();\n	...\n})();\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"promise.then"}),"처럼 ",(0,sa.jsx)(e.code,{children:"await"}),"도 ",(0,sa.jsx)(e.code,{children:"thenable"})," 객체를 받을 수 있습니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Thenable"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"num"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"num"})," = num;\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve, reject"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(resolve);\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1000밀리 초 후에 이행됨(result는 this.num*2)"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"num"})," * ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"), ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1000"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// (*)"}),"\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1초 후, 변수 result는 2가 됨"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," result = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Thenable"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// new Promise((resolve)=>setTimeout(()=> resolve(this.num*2),1000)).then((result)=>alert(result)) 와 같다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(result);\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"();\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"class method"}),"에도 ",(0,sa.jsx)(e.code,{children:"async"}),"를 사용할 수 있습니다. ",(0,sa.jsx)(e.code,{children:"async"}),"가 붙은 메서드는 ",(0,sa.jsx)(e.code,{children:"async"})," 함수와 같이 Promise를 반환하며 await을 사용할 수 있습니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Waiter"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wait"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),");\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Waiter"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"wait"}),"().",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"then"}),"(alert); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n"]})}),"\n",(0,sa.jsx)(e.h3,{children:"에러 핸들링"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"await promise"}),"는 Promise 객체의 ",(0,sa.jsx)(e.code,{children:"result"}),"에 저장된 값을 반환합니다.\n반면 ",(0,sa.jsx)(e.code,{children:"Promise"}),"가 거부되면 마치 ",(0,sa.jsx)(e.code,{children:"throw"}),"문을 작성한 것처럼 에러를 던진다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 아래 두 코드의 기능은 같다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reject"}),"(",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),"));\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"throw"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Error"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"에러 발생!"'}),");\n}\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"await"}),"가 던진 에러는 ",(0,sa.jsx)(e.code,{children:"throw"}),"가 던진 에러를 잡을 때처럼 ",(0,sa.jsx)(e.code,{children:"try...catch"}),"를 사용해 잡을 수 있습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"function"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"try"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," response = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"http://유효하지-않은-주소"'}),");\n  } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"catch"})," (err) {\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"alert"}),"(err); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// TypeError: failed to fetch"}),"\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"f"}),"();\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["에러가 발생하면 ",(0,sa.jsx)(e.code,{children:"catch"})," 블록으로 제어 흐름이 넘어가게 됩니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["원래 ",(0,sa.jsx)(e.code,{children:"async function"}),"에 리턴값이 없으면 ",(0,sa.jsx)(e.code,{children:"fulfilled Promise"}),"에 ",(0,sa.jsx)(e.code,{children:"undefined"}),"가 담겨서 리턴되지만"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110193617.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"async function"}),"에서 ",(0,sa.jsx)(e.code,{children:"await"}),"한 ",(0,sa.jsx)(e.code,{children:"Promise"}),"가 ",(0,sa.jsx)(e.code,{children:"reject"}),"된다면 ",(0,sa.jsx)(e.code,{children:"rejected"}),"된 ",(0,sa.jsx)(e.code,{children:"Promise"}),"에 에러가 담겨서 리턴됩니다. (또한,에러도 발생합니다.)"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110193853.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["위의 코드에서 ",(0,sa.jsx)(e.code,{children:".catch"}),"를 이어서 사용해서 해당 ",(0,sa.jsx)(e.code,{children:"Error"}),"를 핸들링할 수 있습니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110193713.png",alt:""})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["여기서 ",(0,sa.jsx)(e.code,{children:".catch"}),"로 핸들링 되지 않은 에러는 전역 에러로 처리되는데 이는 ",(0,sa.jsx)(e.code,{children:"unhandledrejection"}),"이벤트의 핸들러로 처리할 수 있습니다."]}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:".then"}),"을 ",(0,sa.jsx)(e.code,{children:"await"}),"가 대신해주고 ",(0,sa.jsx)(e.code,{children:".catch"}),"를 ",(0,sa.jsx)(e.code,{children:"try..catch"}),"로 대신해주기 때문에 동일한 기능을 쓰지만 사용하는 쪽에서 훨씬 편하게 쓸 수 있습니다. 하지만 ",(0,sa.jsx)(e.code,{children:"await"}),"은 최상위 레벨 코드에서는 사용할 수 없어서 (async가 없는 최상위 레벨 코드) ",(0,sa.jsx)(e.code,{children:".then/ .catch"}),"를 사용해야만 하는 경우가 발생합니다."]}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"async/ await"}),"은 ",(0,sa.jsx)(e.code,{children:"Promise.all"}),"과도 함께 쓸 수 있다, 에러 핸들링 역시 똑같이 ",(0,sa.jsx)(e.code,{children:"try...catch"}),"를 활용할 수 있습니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise 처리 결과가 담긴 배열을 기다립니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"let"})," results = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"all"}),"([\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url1),\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fetch"}),"(url2),\n  ...\n]);\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["감을 익히기 위한 세 가지 과제가 있습니다. 한번 풀어보면 좋을 것 같다.\n",(0,sa.jsx)(e.a,{href:"https://ko.javascript.info/async-await#tasks",children:"https://ko.javascript.info/async-await#tasks"})]}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"비동기 관련 문제 풀이"}),"\n",(0,sa.jsxs)(e.p,{children:["다음은 비동기 관련 로직을 완벽하게 이해하기 위해서 만들어 본 문제입니다.\n각 ",(0,sa.jsx)(e.code,{children:"queue"}),"와 ",(0,sa.jsx)(e.code,{children:"Web API"}),"를 생각하면서 결과값은 무엇이고 왜인지 생각해보겠습니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"export"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"testFn"})," = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"async"})," (",(0,sa.jsx)(e.span,{className:"hljs-params"}),") => {\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 바로 실행"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// setTimeout 바로 실행, Web API로 타이밍 함수 넘김"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),");\n  }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"500"}),");\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 바로 실행"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"async"})," (resolve) => {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// executor 함수는 Promise 생성과 함께 바로 실행됩니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"전"'}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-built_in",children:"setTimeout"}),"(",(0,sa.jsx)(e.span,{className:"hljs-function",children:"() =>"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 여기까지 바로 실행, await 아래 내부 코드들은 전부 Microtask Queue로"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// console.log(4)라는 콜백은 setTimeout이 실행되고 Web API에서 5000이라는 ms가 지난 후에 Macrotask queue로 전달됩니다."}),"\n    }, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5000"}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"다음"'}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),");\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 바로 실행"}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," t = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"await"})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Promise"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"resolve"}),") =>"]})," {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Promise 내부의 executor는 바로 실행되고 아래 코드들은 전부 Microtask queue로 이동"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// new Promise((resolve)=>{console.log(6); resolve('a')}).then((t)=>{console.log(t); console.log(7)})과 같다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),");\n    ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"resolve"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"a"'}),");\n  });\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(t);\n  ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),");\n};\n"]})}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2024-11-10/Pasted%20image%2020241110155653.png",alt:""})}),"\n",(0,sa.jsx)(e.h2,{children:"풀이"}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{style:{textAlign:"left"}}),(0,sa.jsx)(e.th,{children:"1번째 task (testFn이라는 Macrotask 실행)"}),(0,sa.jsx)(e.th,{children:"2번째 task (testFn 관련 Microtask 전부 실행)"}),(0,sa.jsx)(e.th,{children:"코드 실행부터 500ms 지남"}),(0,sa.jsx)(e.th,{children:"3번째 task ( 2를 출력하는 Macrotask 실행 )"}),(0,sa.jsx)(e.th,{children:"Microtask Queue 비어있는 것 확인하고 다음으로 넘어감"}),(0,sa.jsx)(e.th,{children:"코드 실행부터 5000ms 지남"}),(0,sa.jsx)(e.th,{children:"4번째 task ( 4를 출력하는 Macrotask 실행)"})]})}),(0,sa.jsxs)(e.tbody,{children:[(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"Macrotask queue 상태"}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"()=>console.log(2)"}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"()=>console.log(4)"}),(0,sa.jsx)(e.td,{})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"Microtask queue 상태"}),(0,sa.jsx)(e.td,{children:'console.log(4, "다음"), resolve(4), console.log(t), console.log(7)'}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"Web API"}),(0,sa.jsxs)(e.td,{children:["500ms를 기다리면 ()=>console.log(2)를 task queue로 넘기는 동작 실행,",(0,sa.jsx)("br",{}),"5,000ms를 기다리면 ()=>console.log(4)를 taskqueue로 넘기는 동작 실행"]}),(0,sa.jsxs)(e.td,{children:["500ms를 기다리면 ()=>console.log(2)를 task queue로 넘기는 동작 실행,",(0,sa.jsx)("br",{}),"5,000ms를 기다리면 ()=>console.log(4)를 taskqueue로 넘기는 동작 실행"]}),(0,sa.jsx)(e.td,{children:"5,000ms를 기다리면 ()=>console.log(4)를 taskqueue로 넘기는 동작 실행"}),(0,sa.jsx)(e.td,{children:"5,000ms를 기다리면 ()=>console.log(4)를 taskqueue로 넘기는 동작 실행"}),(0,sa.jsx)(e.td,{children:"5,000ms를 기다리면 ()=>console.log(4)를 taskqueue로 넘기는 동작 실행"}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"출력"}),(0,sa.jsx)(e.td,{children:"1, 3, 4 '전', 5, 6"}),(0,sa.jsx)(e.td,{children:'4 "다음", a, 7'}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"2"}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"4"})]})]})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"Macrotask"})," > ",(0,sa.jsx)(e.code,{children:"Microtask"})," > ",(0,sa.jsx)(e.code,{children:"requestAnimationFrame"})," > ",(0,sa.jsx)(e.code,{children:"브라우저 렌더링"})," 순서로 렌더링이 진행되기 때문에 위의 코드 실행 중간에 이벤트가 발생해서 ",(0,sa.jsx)(e.code,{children:"Macrotask"}),"가 하나 생기게 되면 해당 ",(0,sa.jsx)(e.code,{children:"Macrotask"}),"에 관련된 브라우저 렌더링이 일어나고 위의 코드로 복귀하게 될 수 있습니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"마무리"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["기존에는 비동기 코드가 Microtask Queue와 이벤트 루프를 활용해서 돌아간다는 정도만 알고 있었다면, 이제는 브라우저 렌더링 흐름과 함께 이해하면서\n",(0,sa.jsx)(e.strong,{children:"비동기 방식이 왜 필요한지"}),"를 더 정확히 알 수 있었다.",(0,sa.jsx)(e.br,{}),"\n","기본기를 탄탄하게 다져 보자는 생각으로 시작한 글이기에, 촘촘하게 배우려고 노력했고, 파편화된 지식을 모을 좋은 기회가 되었다.",(0,sa.jsx)(e.br,{}),"\n",(0,sa.jsx)(e.strong,{children:"이 기술이 왜 필요한지에"})," 집중하면서부터는 좀 더 다양한 시각으로 볼 수 있게 된 것 같다.",(0,sa.jsx)(e.br,{}),"\n","이제 더 나아가 보겠습니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"참고 문헌"}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.a,{href:"https://wikibook.co.kr/react-deep-dive/",children:"https://wikibook.co.kr/react-deep-dive/"})}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.a,{href:"https://ko.javascript.info/async",children:"https://ko.javascript.info/async"})}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000001766397",children:"https://product.kyobobook.co.kr/detail/S000001766397"})}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.a,{href:"https://inpa.tistory.com/entry/%F0%9F%8C%90-requestAnimationFrame-%EA%B0%80%EC%9D%B4%EB%93%9C",children:"https://inpa.tistory.com/entry/%F0%9F%8C%90-requestAnimationFrame-%EA%B0%80%EC%9D%B4%EB%93%9C"})}),"\n",(0,sa.jsx)(e.li,{children:(0,sa.jsx)(e.a,{href:"https://www.youtube.com/watch?v=8aGhZQkoFbQ",children:"https://www.youtube.com/watch?v=8aGhZQkoFbQ"})}),"\n"]})]})}function e0(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(eZ,{...s})}):eZ(s)}function e2(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"Arrays are a basic data type that can efficiently manage elements of the same type. You can group data of the same type under one variable name and access desired data randomly using something called an index."}),"\n",(0,sa.jsx)(e.p,{children:"Let's learn more about arrays."}),"\n",(0,sa.jsx)(e.h1,{children:"Array Declaration"}),"\n",(0,sa.jsx)(e.p,{children:"Array declarations can be created using various methods."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"]; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [0, 0, 0, 0, 0, 0]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr2 = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [empty \xd7 6]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr3 = [...",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),")].",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"_"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [0, 0, 0, 0, 0, 0]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr4 = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fill"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [0, 0, 0, 0, 0, 0]"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Arrays refer to data structures stored in computers like this."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250615180237.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["Starting from 0, to access the 3rd data, you use ",(0,sa.jsx)(e.code,{children:"arr[2]"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript's Array object supports the same functionality as arrays. JavaScript arrays have different internal implementations than typical arrays, but you can think of them as having the same usage."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] JavaScript Arrays"}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript arrays are implemented to dynamically adjust size. So JavaScript arrays can use all the functionality of arrays from other languages while also being variable in size, which reduces considerations in coding tests. They also provide operations like slicing, insertion, deletion, and concatenation, making them more convenient."}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"Arrays and Dimensions"}),"\n",(0,sa.jsx)(e.p,{children:"Arrays exist in various dimensions. Since computer memory structure is one-dimensional, all are stored in one-dimensional space regardless of dimension. (They are allocated contiguously in memory.)"}),"\n",(0,sa.jsx)(e.h2,{children:"One-Dimensional Array"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250615181200.png",alt:""}),"\nThe appearance of a one-dimensional array is the same as the actual array allocated in memory. Each data in the array is allocated consecutively from low addresses to high addresses in memory."]}),"\n",(0,sa.jsx)(e.h2,{children:"Two-Dimensional Array"}),"\n",(0,sa.jsx)(e.p,{children:"A two-dimensional array is an extension of a one-dimensional array. In JavaScript, it's declared as follows."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Literal"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr = [\n  [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"],\n  [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),"],\n  [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"9"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"11"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"12"}),"],\n];\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Implementing a 2D array using fill method and spread operator"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr2 = [...",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),")].",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"_, i"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fill"}),"(i));\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// arr2: [[0, 0, 0], [1, 1, 1], [2, 2, 2]]"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Two-dimensional arrays are stored in one-dimensional space in actual memory, allocating data in row order as shown in the right side of the picture below."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250615215144.png",alt:""})}),"\n",(0,sa.jsx)(e.h1,{children:"Array Time Complexity"}),"\n",(0,sa.jsx)(e.h2,{children:"Data Access"}),"\n",(0,sa.jsx)(e.p,{children:'Arrays can access data at all positions in the array at once using a method called "random access."'}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"];\narr[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"]; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["It's constant (",(0,sa.jsx)(e.code,{children:"O(1)"}),") regardless of the number of data items."]}),"\n",(0,sa.jsx)(e.h2,{children:"Data Addition"}),"\n",(0,sa.jsx)(e.p,{children:"When adding data, it differs depending on where you add it. This is related to memory."}),"\n",(0,sa.jsx)(e.h3,{children:"Insert at the End"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250616080701.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["When inserting data at the end, as shown in the picture, it doesn't affect the position of other data. Therefore, it's constant (",(0,sa.jsx)(e.code,{children:"O(1)"}),") regardless of the number of data items."]}),"\n",(0,sa.jsx)(e.h3,{children:"Insert in the Middle"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250616080846.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["If you insert data in the middle, you need to push operations for as many data items as there are behind it. (e.g., N-a items where N is the number of data items, and a is the number of existing data items in front of the insertion position) If the number of data items to push is N, the time complexity becomes ",(0,sa.jsx)(e.code,{children:"O(N)"}),"."]}),"\n",(0,sa.jsx)(e.h3,{children:"Insert at the Beginning"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250616080759.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["When inserting data at the beginning, you need to push existing data one space. Time complexity increases proportionally to the number of data items (",(0,sa.jsx)(e.code,{children:"O(N)"}),")"]}),"\n",(0,sa.jsxs)(e.p,{children:["In conclusion, arrays are good to use when you frequently need to access or read data. However, you need to consider that sufficient memory space must be secured. Usually, a one-dimensional integer array can handle up to 10 million items, and a two-dimensional array can handle up to 3000 * 3000 size. Also, you need to check if there are many data insertions in the middle. If data is frequently inserted in the middle or at the beginning, time complexity becomes high (",(0,sa.jsx)(e.code,{children:"O(N)"})," time complexity)"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] Difference from Lists"}),"\n",(0,sa.jsx)(e.p,{children:"Lists are data structures with variable size, and arrays have fixed size. JavaScript arrays are dynamic arrays, so they can change size and can also be treated as lists."}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"Array Manipulation"}),"\n",(0,sa.jsx)(e.h2,{children:"Data Addition"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add element to the end of array"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr1 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// push(element to add)"}),"\narr1.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 2, 3, 4]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr2 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// concat(element to add)"}),"\narr2.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"concat"}),"([",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),"]); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 2, 3, 4, 5]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add element to the beginning of array"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr3 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// unshift(element to add)"}),"\narr3.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unshift"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [0, 1, 2, 3]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add element to the beginning or end of array"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr4 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ... is the spread operator that spreads the array"}),"\narr4 = [...arr4, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"]; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 2, 3, 4]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add element in the middle of array"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr5 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// splice(start index, number of elements to remove, element to add)"}),"\narr5.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"splice"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1.5"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 1.5, 2, 3]"}),"\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!INFO] JS Optimization for shift, unshift"}),"\n",(0,sa.jsx)(e.p,{children:"In JavaScript, when manipulating arrays through unshift and shift when the number of data items is less than 15,000, the engine optimizes this to have lower time complexity than other array manipulations."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] Brackets in Official Documentation"}),"\n",(0,sa.jsxs)(e.p,{children:["In official documentation, splice is shown as ",(0,sa.jsx)(e.code,{children:"array.splice(start[, deleteCount[, item1[, item2[, ...]]]])"})," like this. Parts wrapped in brackets are optional parameters, and parts not wrapped in brackets are required parameters. You can see that splice requires start. By the way, if you only provide start, it returns data after the start index and the original array only has data up to the start index."]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Data Deletion"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// To remove the last element of the array, use the pop method."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr1 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," result1 = arr1.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"pop"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Remove and return the last element"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(arr1); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 2]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// To remove the first element of the array, use the shift method."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// shift also optimizes up to 15,000 data items in the engine like unshift."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr2 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," result2 = arr2.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"shift"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Remove and return the first element"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(arr2); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [2, 3]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// To remove an element at a specific position in the array, use the splice method."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr3 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," result3 = arr3.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"splice"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Remove 1 element from index 1"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(arr3); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 3]"}),"\n"]})}),"\n",(0,sa.jsx)(e.h2,{children:"Applying Specific Operations (Using Higher-Order Functions)"}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript arrays have useful higher-order functions. They can replace complex logic using existing loops and conditionals."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Higher-order functions that apply specific operations to each element of the array"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// map, filter, reduce"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Higher-order function that returns the result of applying specific operations to each element of the array"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr1 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Returns a new array with each element of the array squared."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," squares = arr1.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"x"}),") =>"]})," x * x); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 4, 9, 16]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Higher-order function that returns an array composed only of elements that satisfy specific conditions"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr2 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Returns an array composed only of even elements from the array."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," evens = arr2.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"filter"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"x"}),") =>"]})," x % ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [2, 4]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Higher-order function that accumulates the result of applying specific operations to each element of the array"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr3 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If you don't provide an initial value of 0, the first element of the array becomes the initial value."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," sum = arr3.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reduce"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"x, y"}),") =>"]})," x + y, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 10"}),"\n"]})}),"\n",(0,sa.jsx)(e.h1,{children:"References"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"Algorithm concepts seem to disappear particularly quickly if you don't study them consistently.\nI'll study consistently so I can fill them back in when they disappear.\nIf there are any incorrect knowledge, please leave a comment!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you for reading."}),"\n"]})]})}function e1(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(e2,{...s})}):e2(s)}function e4(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",span:"span",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"배열은 같은 타입의 원소들을 효율적으로 관리할 수 있는 기본 자료형입니다. 하나의 변수 이름으로 동일한 타입의 데이터를 그룹화하여 관리할 수 있고, 인덱스라는 것으로 원하는 데이터에 임의 접근할 수 있습니다."}),"\n",(0,sa.jsx)(e.p,{children:"배열에 대해서 더 자세히 알아봅시다."}),"\n",(0,sa.jsx)(e.h1,{children:"배열 선언"}),"\n",(0,sa.jsx)(e.p,{children:"배열 선언은 다양한 방식을 이용해서 만들 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"]; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [0, 0, 0, 0, 0, 0]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr2 = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [empty \xd7 6]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr3 = [...",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),")].",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"_"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [0, 0, 0, 0, 0, 0]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr4 = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fill"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [0, 0, 0, 0, 0, 0]"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["배열은 컴퓨터에서 이런 모습으로 저장되는 자료구조를 말합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250615180237.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["0부터 시작해서 3번째 데이터에 접근하려면 ",(0,sa.jsx)(e.code,{children:"arr[2]"}),"로 접근합니다."]}),"\n",(0,sa.jsx)(e.p,{children:"JS의 Array 객체는 배열과 같은 기능을 지원합니다. JS의 배열은 일반적인 배열과 내부 구현이 다르지만 사용 방법은 같다고 생각하면 좋습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] JS 배열"}),"\n",(0,sa.jsx)(e.p,{children:"자바스크립트의 배열은 동적으로 크기를 조절할 수 있도록 구현되어 있습니다. 그래서 자바스크립트의 배열은 다른 언어의 배열 기능을 그대로 사용할 수 있으면서 배열 크기도 가변적이므로 코딩 테스트에서 고려할 사항을 조금 더 줄여줍니다. 또 슬라이싱, 삽입, 삭제, 연결 등의 연산을 제공하므로 더 편리합니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"배열과 차원"}),"\n",(0,sa.jsx)(e.p,{children:"배열은 다양한 차원이 존재하는데요. 컴퓨터의 메모리 구조는 1차원이기에 차원과는 상관없이 모두 1차원 공간에 저장됩니다. (메모리에 연속 할당됩니다.)"}),"\n",(0,sa.jsx)(e.h2,{children:"1차원 배열"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250615181200.png",alt:""}),"\n1차원 배열의 모습은 메모리에 할당된 실제 배열의 모습과 같습니다. 배열의 각 데이터는 메모리의 낮은 주소에서 높은 주소 방향으로 연이어 할당됩니다."]}),"\n",(0,sa.jsx)(e.h2,{children:"2차원 배열"}),"\n",(0,sa.jsx)(e.p,{children:"2차원 배열은 1차원 배열을 확장한 것인데요. JS에서는 다음과 같이 선언합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 리터럴"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr = [\n  [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"],\n  [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),"],\n  [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"9"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"10"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"11"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"12"}),"],\n];\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// fill 메소드와 spread operator를 이용한 2차원 배열을 구현"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr2 = [...",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),")].",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"_, i"}),") =>"]})," ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),").",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"fill"}),"(i));\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// arr2: [[0, 0, 0], [1, 1, 1], [2, 2, 2]]"}),"\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"2차원 배열은 실제 메모리에서는 아래 사진의 오른쪽처럼 행의 순서로 데이터를 할당해서 1차원 공간에 저장합니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250615215144.png",alt:""})}),"\n",(0,sa.jsx)(e.h1,{children:"배열의 시간 복잡도"}),"\n",(0,sa.jsx)(e.h2,{children:"데이터에 접근"}),"\n",(0,sa.jsx)(e.p,{children:'배열은 "임의 접근" 이라는 방식으로 배열의 모든 위치에 있는 데이터에 한번에 접근할 수 있습니다.'}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"];\narr[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"]; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["데이터의 개수와 상관없이 상수 (",(0,sa.jsx)(e.code,{children:"O(1)"}),") 입니다."]}),"\n",(0,sa.jsx)(e.h2,{children:"데이터 추가"}),"\n",(0,sa.jsx)(e.p,{children:"데이터를 추가할 때는 어떤 위치에 추가하느냐에 따라서 다릅니다. 이는 메모리와 연관이 있습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"맨 뒤에 삽입"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250616080701.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["맨 뒤에 데이터를 삽입할 경우 그림처럼 다른 데이터 위치에 영향을 주지 않습니다. 따라서 데이터의 개수와 상관없이 상수 (",(0,sa.jsx)(e.code,{children:"O(1)"}),") 입니다."]}),"\n",(0,sa.jsx)(e.h3,{children:"중간에 삽입"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250616080846.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["데이터를 중간에 삽입한다면 뒤에 있는 데이터의 개수만큼 미는 연산을 해야 합니다. (ex N-a개 (N은 데이터의 개수, a는 삽입되는 위치의 앞쪽에 존재하는 기존 데이터들의 개수)) 밀어야 하는 데이터 개수가 N개라면 시간 복잡도는 ",(0,sa.jsx)(e.code,{children:"O(N)"}),"이 됩니다."]}),"\n",(0,sa.jsx)(e.h3,{children:"맨 앞에 삽입"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-05-24/Pasted%20image%2020250616080759.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["맨 앞에 데이터를 삽입할 경우 기존의 데이터를 한 칸씩 밀어야 합니다. 데이터의 개수에 비례하게 시간 복잡도가 올라갑니다 (",(0,sa.jsx)(e.code,{children:"O(N)"}),")"]}),"\n",(0,sa.jsxs)(e.p,{children:["결론적으로 배열은 데이터에 자주 접근하거나 읽어야 하는 경우에 사용하면 좋습니다. 하지만 메모리 공간이 충분히 확보가 되어야 한다는 점을 고려해야 합니다. 보통 정수형 1차원 배열은 1000 만개, 2차원 배열은 3000 * 3000 크기를 최대로 보면 됩니다. 또한, 중간에 데이터 삽입이 많은지 확인해야 합니다. 중간이나 맨 앞에 데이터를 빈번하게 삽입하면 시간 복잡도가 높아집니다 (",(0,sa.jsx)(e.code,{children:"O(N)"}),"의 시간복잡도)"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] 리스트와의 차이점"}),"\n",(0,sa.jsx)(e.p,{children:"리스트는 크기가 변하는 자료구조이고 배열은 크기가 고정입니다. JS의 배열은 동적 배열이라서 크기가 변할 수 있으므로 리스트로도 취급될 수 있습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"배열 조작"}),"\n",(0,sa.jsx)(e.h2,{children:"데이터 추가"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 뒤에 요소를 추가"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr1 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// push(추가할 요소)"}),"\narr1.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 2, 3, 4]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr2 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// concat(추가할 요소)"}),"\narr2.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"concat"}),"([",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),"]); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 2, 3, 4, 5]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 앞에 요소를 추가"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr3 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// unshift(추가할 요소)"}),"\narr3.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"unshift"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [0, 1, 2, 3]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 앞이나 뒤에 요소를 추가"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr4 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// ...은 전개 연산자로 배열을 펼쳐준다."}),"\narr4 = [...arr4, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"]; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 2, 3, 4]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 중간에 요소를 추가"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr5 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// splice(시작 인덱스, 제거할 요소 개수, 추가할 요소)"}),"\narr5.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"splice"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1.5"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 1.5, 2, 3]"}),"\n"]})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!INFO] shift, unshift의 JS 최적화"}),"\n",(0,sa.jsx)(e.p,{children:"JS에서는 데이터의 개수가 15,000개보다 적을 때 unshift, shift 를 통해서 배열을 조작하면 엔진에서 이를 최적화하여 다른 배열 조작보다 더 적은 시간 복잡도를 가진다고 합니다."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] 공식 문서에서의 대괄호"}),"\n",(0,sa.jsxs)(e.p,{children:["공식문서에서 splice를 보면 ",(0,sa.jsx)(e.code,{children:"array.splice(start[, deleteCount[, item1[, item2[, ...]]]])"})," 이런 식으로 표현되어 있는데요. 대괄호로 감싸져있는 부분은 optional 매개변수이고 대괄호로 감싸져있지 않은 부분은 필수 매개변수입니다. splice는 start가 꼭 필요한 메소드임을 알 수 있습니다. 참고로 start만 넣게 되면 start 인덱스의 뒤쪽 데이터는 반환하고 기존 배열은 start 인덱스까지의 배열만 남게 됩니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"데이터 삭제"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 마지막 요소를 제거하려면 pop 메서드를 사용합니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr1 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," result1 = arr1.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"pop"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 마지막 요소를 제거하고 반환"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(arr1); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 2]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 첫 번째 요소를 제거하려면 shift 메서드를 사용합니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// shift 역시 unshift와 같이 데이터 15,000개까지 엔진에서 최적화를 해준다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr2 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," result2 = arr2.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"shift"}),"(); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 첫 번째 요소를 제거하고 반환"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(arr2); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [2, 3]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 특정 위치의 요소를 제거하려면 splice 메서드를 사용합니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr3 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," result3 = arr3.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"splice"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1번 인덱스부터 1개의 요소를 제거"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(arr3); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 3]"}),"\n"]})}),"\n",(0,sa.jsx)(e.h2,{children:"특정 연산 적용 (고차함수 이용)"}),"\n",(0,sa.jsx)(e.p,{children:"JS 배열에는 유용한 고차 함수들이 존재합니다. 기존 반복문, 조건문을 이용한 복잡한 로직을 대체할 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 각 요소에 대해 특정 연산을 적용하는 고차함수"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// map, filter, reduce"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 각 요소에 대해 특정 연산을 적용한 결과를 반환하는 고차함수"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr1 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 각 요소를 제곱한 새로운 배열을 반환합니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," squares = arr1.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"map"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"x"}),") =>"]})," x * x); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [1, 4, 9, 16]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 요소 중 특정 조건을 만족하는 요소만으로 구성된 배열을 반환하는 고차함수"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr2 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 요소 중 짝수인 요소만으로 구성된 배열을 반환합니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," evens = arr2.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"filter"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"x"}),") =>"]})," x % ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// [2, 4]"}),"\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 각 요소에 대해 특정 연산을 적용한 결과를 누적하는 고차함수"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr3 = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),"];\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 초기값 0을 주지 않으면 배열의 첫 번째 요소가 초기값이 됩니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," sum = arr3.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"reduce"}),"(",(0,sa.jsxs)(e.span,{className:"hljs-function",children:["(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"x, y"}),") =>"]})," x + y, ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),"); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 10"}),"\n"]})}),"\n",(0,sa.jsx)(e.h1,{children:"참고 문헌"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"알고리즘은 꾸준히 공부해주지 않으면 개념들이 유독 빠르게 사라지는 것 같아요.\n사라지면 다시 채워넣을 수 있도록 꾸준히 공부해보겠습니다.\n잘못된 지식이 있다면 댓글 부탁드려요!"}),"\n",(0,sa.jsx)(e.p,{children:"읽어주셔서 감사해요."}),"\n"]})]})}function e5(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(e4,{...s})}):e4(s)}function e3(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"A stack is a data structure where the first data entered is taken out last."}),"\n",(0,sa.jsx)(e.h1,{children:"Concept"}),"\n",(0,sa.jsx)(e.h2,{children:"LIFO"}),"\n",(0,sa.jsx)(e.p,{children:"Last In First Out"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617074936.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"The rule where what goes in first comes out last is called Last In First Out or LIFO. The operation of inserting into the stack is called push, and the operation of taking out is called pop."}),"\n",(0,sa.jsx)(e.p,{children:"The operation process is as follows."}),"\n",(0,sa.jsxs)(e.p,{children:["Initially, there is an empty stack.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075530.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["After pushing 1, it exists as follows.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075548.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["If you push 2 here, it stacks on top as follows.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075609.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["If you pop here, according to the LIFO method, 2 at the top comes out.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075641.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["After pushing 3, 3 stacks on top of 1 again.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075716.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["Finally, if you pop twice in a row, it comes out from the top and returns to the beginning.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075757.png",alt:""})]}),"\n",(0,sa.jsx)(e.h2,{children:"ADT"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!INFO] ADT"}),"\n",(0,sa.jsx)(e.p,{children:"Abstract Data Type\nA data type that only has an interface and is not actually implemented. Think of it as a blueprint for a data type."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"A stack must have operations like push, pop, isFull, isEmpty. Also, a variable called top must exist to implement stack operations."}),"\n",(0,sa.jsx)(e.p,{children:"Organizing this into a table looks like this."}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{children:"Name"}),(0,sa.jsx)(e.th,{children:"Definition"}),(0,sa.jsx)(e.th,{children:"Description"})]})}),(0,sa.jsxs)(e.tbody,{children:[(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"isFull"}),(0,sa.jsx)(e.td,{children:"boolean isFull()"}),(0,sa.jsx)(e.td,{children:"Check if the stack is full of data"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"isEmpty"}),(0,sa.jsx)(e.td,{children:"boolean isEmpty()"}),(0,sa.jsx)(e.td,{children:"Check if the stack is empty"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"push"}),(0,sa.jsx)(e.td,{children:"void push(ItemType item)"}),(0,sa.jsx)(e.td,{children:"Insert data into the stack"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"pop"}),(0,sa.jsx)(e.td,{children:"ItemType pop()"}),(0,sa.jsx)(e.td,{children:"Return the top data of the stack"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"top"}),(0,sa.jsx)(e.td,{children:"Int top"}),(0,sa.jsx)(e.td,{children:"Record the top data of the stack"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"data"}),(0,sa.jsxs)(e.td,{children:["ItemType data",(0,sa.jsx)(e.code,{children:"[maxsize]"})]}),(0,sa.jsx)(e.td,{children:"Array that manages the stack, manages up to maxsize data items"})]})]})]}),"\n",(0,sa.jsxs)(e.p,{children:["Based on the table, the ADT looks like this.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617080823.png",alt:""})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE]"}),"\n",(0,sa.jsx)(e.p,{children:"Note that -1 is entered in top. top is used as an index of data. When there is one data item, the index is 0, so -1 is used to represent when there is nothing."}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["When adding data to the stack, it can be expressed as follows.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617083445.png",alt:""})]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["Perform isFull to check if more can be added to the data array","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["If possible, increase top by 1 and add data to data",(0,sa.jsx)(e.code,{children:"[top]"})]}),"\n",(0,sa.jsx)(e.li,{children:"If not possible, exit"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["When taking data from the stack, it can be expressed as follows.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617083637.png",alt:""})]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["Perform isEmpty to check if there is data in the data array","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["If there is, decrease top by 1 and return data",(0,sa.jsx)(e.code,{children:"[top+1]"})]}),"\n",(0,sa.jsx)(e.li,{children:"If there isn't, exit"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Now let's implement a stack based on this ADT."}),"\n",(0,sa.jsx)(e.h1,{children:"Implementation"}),"\n",(0,sa.jsx)(e.p,{children:"According to the ADT, it can be implemented as follows."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Stack"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"maxSize"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"})," = [];\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"top"})," = -",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"maxSize"})," = maxSize;\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isFull"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"top"})," === ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"maxSize"})," - ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isEmpty"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"top"})," === -",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"element"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isFull"}),"()) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"스택이 가득찼어요"'}),");\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),"[",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"top"}),"++] = element;\n    }\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"pop"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isEmpty"}),"()) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"스택이 비어있어요"'}),");\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),"[--",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"top"}),"];\n    }\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Since JavaScript dynamically manages arrays, you can use arrays like stacks without isFull and isEmpty using array methods."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," stack = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(maxsize);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// push : stack.push(1)"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// pop : stack.pop()"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// top : stack.length-1"}),"\n"]})}),"\n",(0,sa.jsx)(e.h1,{children:"References"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"Algorithm concepts seem to disappear particularly quickly if you don't study them consistently.\nI'll study consistently so I can fill them back in when they disappear.\nIf there are any incorrect knowledge, please leave a comment!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you for reading."}),"\n"]})]})}function e6(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(e3,{...s})}):e3(s)}function e7(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"스택은 먼저 입력한 데이터를 제일 나중에 꺼낼 수 있는 자료구조입니다."}),"\n",(0,sa.jsx)(e.h1,{children:"개념"}),"\n",(0,sa.jsx)(e.h2,{children:"LIFO"}),"\n",(0,sa.jsx)(e.p,{children:"Last In First Out"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617074936.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"먼저 들어간 것이 마지막에 나오는 규칙을 후입선출 또는 LIFO Last In First Out라고 합니다. 이때 스택에 삽입하는 연산을 푸시push, 꺼내는 연산을 팝pop이라고 합니다."}),"\n",(0,sa.jsx)(e.p,{children:"동작과정을 살펴보면 다음과 같습니다."}),"\n",(0,sa.jsxs)(e.p,{children:["처음에 빈 스택이 존재합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075530.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["이후 1을 push하게 되면 다음과 같이 존재합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075548.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["여기서 2를 push하면 다음과 같이 그 위로 쌓이게 됩니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075609.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["여기서 pop을 하면 LIFO 방식에 따라서 가장 위에 있는 2가 빠져나오게 됩니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075641.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["이후 3을 push하면 다시 1위로 3이 쌓이게 됩니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075716.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["마지막으로 pop을 2번 연속으로 하게 되면 위에서부터 빠져나오다가 다시 처음으로 돌아갑니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617075757.png",alt:""})]}),"\n",(0,sa.jsx)(e.h2,{children:"ADT"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!INFO] ADT"}),"\n",(0,sa.jsx)(e.p,{children:"Abstract Data Type ( 추상 자료형 )\n인터페이스만 있고 실제로 구현은 되지 않은 자료형입니다. 일종의 자료형의 설계도라고 보시면 됩니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"스택은 push, pop, isFull, isEmpty 같은 연산이 있어야 합니다. 또한 변수로 top도 있어야 스택 동작을 구현할 수 있어요."}),"\n",(0,sa.jsx)(e.p,{children:"이를 표로 정리하면 다음과 같습니다."}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{children:"이름"}),(0,sa.jsx)(e.th,{children:"정의"}),(0,sa.jsx)(e.th,{children:"설명"})]})}),(0,sa.jsxs)(e.tbody,{children:[(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"isFull"}),(0,sa.jsx)(e.td,{children:"boolean isFull()"}),(0,sa.jsx)(e.td,{children:"스택에 데이터가 가득 차 있는지 확인"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"isEmpty"}),(0,sa.jsx)(e.td,{children:"boolean isEmpty()"}),(0,sa.jsx)(e.td,{children:"스택에 데이터가 비어 있는지 확인"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"push"}),(0,sa.jsx)(e.td,{children:"void push(ItemType item)"}),(0,sa.jsx)(e.td,{children:"스택에 데이터 삽입"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"pop"}),(0,sa.jsx)(e.td,{children:"ItemType pop()"}),(0,sa.jsx)(e.td,{children:"스택의 맨 위 데이터 반환"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"top"}),(0,sa.jsx)(e.td,{children:"Int top"}),(0,sa.jsx)(e.td,{children:"스택의 맨 위 데이터 기록"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"data"}),(0,sa.jsxs)(e.td,{children:["ItemType data",(0,sa.jsx)(e.code,{children:"[maxsize]"})]}),(0,sa.jsx)(e.td,{children:"스택을 관리하는 배열, 최대 maxsize 개의 데이터를 관리"})]})]})]}),"\n",(0,sa.jsxs)(e.p,{children:["표를 기반으로 ADT를 나타내면 다음과 같습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617080823.png",alt:""})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE]"}),"\n",(0,sa.jsx)(e.p,{children:"주목할 점은 top에 -1이 들어간 것입니다. top은 data의 인덱스로써 사용됩니다. 데이터가 하나 있을 때 인덱스는 0이므로 아무것도 없을 때를 표현하기 위해 -1을 넣은 것입니다."}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["스택에 데이터를 추가하는 경우 다음과 같이 표현할 수 있습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617083445.png",alt:""})]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["isFull을 수행하여 data 배열에 더 넣을 수 있는지 확인","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["넣을 수 있다면 top을 1 증가시키고 data",(0,sa.jsx)(e.code,{children:"[top]"}),"에 데이터 추가"]}),"\n",(0,sa.jsx)(e.li,{children:"넣을 수 없다면 종료"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["스택에 데이터를 꺼낸다면 다음과 같이 표현할 수 있습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-05-31/Pasted%20image%2020250617083637.png",alt:""})]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["isEmpty를 수행하여 data 배열에 데이터가 있는지 확인","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["있다면 top을 1 감소시키고 data",(0,sa.jsx)(e.code,{children:"[top+1]"}),"을 반환"]}),"\n",(0,sa.jsx)(e.li,{children:"없다면 종료"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"이제 이러한 ADT를 기반으로 스택을 구현해봅시다."}),"\n",(0,sa.jsx)(e.h1,{children:"구현"}),"\n",(0,sa.jsx)(e.p,{children:"ADT 대로라면 다음과 같이 구현할 수 있어요."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Stack"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"maxSize"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"})," = [];\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"top"})," = -",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"maxSize"})," = maxSize;\n  }\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isFull"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"top"})," === ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"maxSize"})," - ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isEmpty"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"top"})," === -",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"element"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isFull"}),"()) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"스택이 가득찼어요"'}),");\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),"[",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"top"}),"++] = element;\n    }\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"pop"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isEmpty"}),"()) {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(",(0,sa.jsx)(e.span,{className:"hljs-string",children:'"스택이 비어있어요"'}),");\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),"[--",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"top"}),"];\n    }\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"JS는 동적으로 배열을 관리하기 때문에 isFull, isEmpty 없이도 배열 메소드를 이용해 스택처럼 사용할 수 있어요."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-tsx",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," stack = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Array"}),"(maxsize);\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// push : stack.push(1)"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// pop : stack.pop()"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// top : stack.length-1"}),"\n"]})}),"\n",(0,sa.jsx)(e.h1,{children:"참고 문헌"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"알고리즘은 꾸준히 공부해주지 않으면 개념들이 유독 빠르게 사라지는 것 같아요.\n사라지면 다시 채워넣을 수 있도록 꾸준히 공부해보겠습니다.\n잘못된 지식이 있다면 댓글 부탁드려요!"}),"\n",(0,sa.jsx)(e.p,{children:"읽어주셔서 감사해요."}),"\n"]})]})}function e8(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(e7,{...s})}):e7(s)}function e9(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"A queue is a data structure where the first data entered comes out first."}),"\n",(0,sa.jsx)(e.h1,{children:"Concept"}),"\n",(0,sa.jsx)(e.h2,{children:"FIFO"}),"\n",(0,sa.jsx)(e.p,{children:"First In First Out"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617210033.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"Like stacks, the operation of inserting into a queue is called push, and the operation of taking out is called pop."}),"\n",(0,sa.jsx)(e.h2,{children:"Operation Process"}),"\n",(0,sa.jsxs)(e.p,{children:["Declare an empty queue.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617210119.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["Let's insert 2 and 5. According to the FIFO rule, 2 is behind 5.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617210209.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["Let's pop here. You can see that 2 comes out first, not 5. If you pop once more, 5 comes out.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617210308.png",alt:""})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] Queues Used in Various Fields"}),"\n",(0,sa.jsx)(e.p,{children:"The queue's operation method of processing what comes in first is used very frequently in programming. Examples include:"}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:"Task Queue: When multiple clients request work from a server, the server processes tasks in the order they were requested."}),"\n",(0,sa.jsx)(e.li,{children:"Event Processing: Queues can be used when processing user events in applications or systems, such as keyboard input or mouse movement."}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Queue ADT (Abstract Data Type)"}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{children:"Category"}),(0,sa.jsx)(e.th,{children:"Definition"}),(0,sa.jsx)(e.th,{children:"Description"})]})}),(0,sa.jsxs)(e.tbody,{children:[(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"Operation"}),(0,sa.jsx)(e.td,{children:"boolean isFull()"}),(0,sa.jsx)(e.td,{children:"Check if the number of data items in the queue is maxsize."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"boolean isEmpty()"}),(0,sa.jsx)(e.td,{children:"Check if the number of data items in the queue is 0."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"void push"}),(0,sa.jsx)(e.td,{children:"Add data to the queue."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"ItemType pop"}),(0,sa.jsx)(e.td,{children:"Remove the first data entered from the queue."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"State"}),(0,sa.jsx)(e.td,{children:"int front"}),(0,sa.jsx)(e.td,{children:"Record the front of the queue."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"int rear"}),(0,sa.jsx)(e.td,{children:"Record the rear of the queue."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{}),(0,sa.jsxs)(e.td,{children:["ItemType data",(0,sa.jsx)(e.code,{children:"[maxsize]"})]}),(0,sa.jsx)(e.td,{children:"Array that manages queue data. Manages up to maxsize data items."})]})]})]}),"\n",(0,sa.jsxs)(e.p,{children:["Drawing the ADT based on the state and operations defined in the table looks like this.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020240909094927.png",alt:""})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!INFO]"}),"\n",(0,sa.jsx)(e.p,{children:"Note that front and rear are -1. front means the front of the queue, and rear means the rear of the queue. It's a structure where data is removed using front and added through rear. If there is no data, you need to express that there is no data at both the front and rear of the queue. -1 is used for this."}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["When adding data to the queue, it can be expressed as follows.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617212028.png",alt:""})]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["First check if the queue is full.","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"If full, exit"}),"\n",(0,sa.jsx)(e.li,{children:"If not full, increase rear by 1 and add data at the rear position."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["When removing data from the queue, it can be expressed as follows\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617212214.png",alt:""})]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["Check if the queue is empty.","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"If empty, exit"}),"\n",(0,sa.jsx)(e.li,{children:"If not empty, increase front by 1 so that isEmpty returns true when executed next time."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617212315.png",alt:""}),"\nUsing front, the actual data is not deleted, but it's managed as if the data was deleted."]}),"\n",(0,sa.jsx)(e.h2,{children:"Limitations of Linear Queue"}),"\n",(0,sa.jsx)(e.p,{children:"The linear queue method structurally manages data from after front to rear. Since data at front and before front cannot be used, it's inefficient."}),"\n",(0,sa.jsx)(e.p,{children:"Making the current linear structure circular allows continuous reuse of space, solving this problem. A queue with a circular structure is called a circular queue. Reusing space allows efficient use of memory space."}),"\n",(0,sa.jsx)(e.h1,{children:"Implementing Queue in JS"}),"\n",(0,sa.jsx)(e.p,{children:"There are three ways to implement a queue."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Mimicking a queue with array push and shift"}),"\n",(0,sa.jsx)(e.li,{children:"Implementing a queue using arrays"}),"\n",(0,sa.jsx)(e.li,{children:"Implementing a queue using linked lists"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Let's learn in detail."}),"\n",(0,sa.jsx)(e.h2,{children:"Mimicking Queue with Array push and shift"}),"\n",(0,sa.jsxs)(e.p,{children:["The FIFO structure of a queue can be mimicked, but the array method ",(0,sa.jsx)(e.code,{children:"shift"})," has ",(0,sa.jsx)(e.code,{children:"O(n)"})," time complexity, so it's slower than Queue's pop time complexity of ",(0,sa.jsx)(e.code,{children:"O(1)"}),"."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!INFO] shift Time Complexity"}),"\n",(0,sa.jsxs)(e.p,{children:["Arrays in JavaScript are dynamic arrays. In terms of memory space, subsequent elements are created in the space behind the first element. According to this principle, when the ",(0,sa.jsx)(e.code,{children:"push"})," method is executed, it only adds an element to the back of the memory space, so it has ",(0,sa.jsx)(e.code,{children:"O(1)"})," time complexity."]}),"\n",(0,sa.jsxs)(e.p,{children:["However, when you remove the first element of the memory space with ",(0,sa.jsx)(e.code,{children:"shift"}),", the operation of moving elements from the second element to the last element one space forward occurs. This causes ",(0,sa.jsx)(e.code,{children:"O(n)"})," time complexity.\n(Reference: ",(0,sa.jsx)(e.a,{href:"https://codefug.github.io/posts/2025-05-24",children:"https://codefug.github.io/posts/2025-05-24"})," )"]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create array"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queue = [];\n\nqueue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),");\nqueue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),");\nqueue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," firstItem = queue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"shift"}),"();\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(firstItem); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n\nqueue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),");\nqueue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),");\n\nfirstItem = queue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"shift"}),"();\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(firstItem); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2"}),"\n"]})}),"\n",(0,sa.jsx)(e.h2,{children:"Implementing Queue Using Arrays"}),"\n",(0,sa.jsx)(e.p,{children:"You can implement a queue by putting an array as a class property and controlling it with front and rear."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Queue"})," {\n  items = [];\n  front = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n  rear = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"item"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"items"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(item);\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"rear"}),"++;\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"pop"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"items"}),"[",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"front"}),"++];\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isEmpty"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"front"})," === ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"rear"}),";\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"At first glance, it looks like a well-implemented queue, but there are problems where rear and front keep increasing and array memory keeps increasing. For a perfect implementation, you need to use a linked list."}),"\n",(0,sa.jsx)(e.h2,{children:"Using Linked Lists"}),"\n",(0,sa.jsx)(e.p,{children:"JavaScript doesn't provide linked lists by default. So you need to implement them yourself. (You need to know this to become a great developer who reduces time complexity.)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Define one node. A linked list is a list that connects nodes, treating each node as one value."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Node"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"})," = data; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Current value of the instance"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"next"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),"; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Next value"}),"\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Queue that uses Node."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Queue"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Initialize head, tail, size."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tail"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"size"})," = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Add a node."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"item"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Create newNode and handle two cases."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newNode = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Node"}),"(item);\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1. If it's the first node: Connect head and tail here."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"})," = newNode;\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tail"})," = newNode;\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2. If it's not the first node: Connect tail and new node."}),"\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Set current tail's next value to newNode"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tail"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"next"})," = newNode;\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Change current tail to newNode."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tail"})," = newNode;\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"size"}),"++;\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Remove and return the node to remove."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"pop"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If there's no data, return null and exit."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If there's data, store the node to return in removeNode first"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," removeNode = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Move head to the next value."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"})," = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"next"}),";\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// If the next value was null, the data is empty, so initialize tail as well."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tail"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Decrease array size"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"size"}),"--;\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Return the removeNode stored earlier."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," removeNode.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),";\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isEmpty"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"size"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"Now you've become a great developer who has solved both the remaining memory space problem and the time complexity problem."}),"\n",(0,sa.jsx)(e.h1,{children:"References"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"Algorithm concepts seem to disappear particularly quickly if you don't study them consistently.\nI'll study consistently so I can fill them back in when they disappear.\nIf there are any incorrect knowledge, please leave a comment!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you for reading."}),"\n"]})]})}function ns(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(e9,{...s})}):e9(s)}function ne(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"큐는 먼저 들어간 데이터가 먼저 나오는 자료구조입니다."}),"\n",(0,sa.jsx)(e.h1,{children:"개념"}),"\n",(0,sa.jsx)(e.h2,{children:"FIFO"}),"\n",(0,sa.jsx)(e.p,{children:"First In First Out"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617210033.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"스택과 마찬가지로 큐도 삽입하는 연산을 push, 꺼내는 연산을 pop이라고 합니다."}),"\n",(0,sa.jsx)(e.h2,{children:"동작 과정"}),"\n",(0,sa.jsxs)(e.p,{children:["빈 큐를 하나 선언합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617210119.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["2, 5를 삽입해봅시다. FIFO 규칙에 의해서 2가 5보다 뒤에 있게 됩니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617210209.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["여기서 pop을 해봅시다. 5가 아닌 2가 먼저 나오는 것을 보실 수 있습니다. pop을 한 번 더 진행하면 5가 빠져나옵니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617210308.png",alt:""})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] 다양한 분야에서 사용되는 큐"}),"\n",(0,sa.jsx)(e.p,{children:"먼저 들어온 것을 먼저 처리하는 큐의 동작 방식은 프로그래밍에서 굉장히 많이 활용됩니다. 다음과 같은 사례들이 있습니다."}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:"작업 대기열 : 네트워크 통신을 할 때 다수의 클라이언트에서 서버에 작업을 요청하면 서버는 요청이 들어온 순서대로 작업을 처리합니다."}),"\n",(0,sa.jsx)(e.li,{children:"이벤트 처리 : 어떤 애플리케이션이나 시스템에서 사용자의 이벤트, 예를 들어 키보드 입력이나 마우스 움직임을 처리할 때 큐를 활용할 수 있습니다."}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"큐의 ADT (Abstract Data Type)"}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{children:"구분"}),(0,sa.jsx)(e.th,{children:"정의"}),(0,sa.jsx)(e.th,{children:"설명"})]})}),(0,sa.jsxs)(e.tbody,{children:[(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"연산"}),(0,sa.jsx)(e.td,{children:"boolean isFull()"}),(0,sa.jsx)(e.td,{children:"큐에 들어있는 데이터의 개수가 maxsize인지 확인합니다."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"boolean isEmpty()"}),(0,sa.jsx)(e.td,{children:"큐에 들어있는 데이터의 개수가 0인지 확인합니다."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"void push"}),(0,sa.jsx)(e.td,{children:"큐에 데이터를 넣습니다."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"ItemType pop"}),(0,sa.jsx)(e.td,{children:"큐에서 처음에 넣은 데이터를 꺼냅니다."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"상태"}),(0,sa.jsx)(e.td,{children:"int front"}),(0,sa.jsx)(e.td,{children:"큐의 맨 앞을 기록합니다."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{}),(0,sa.jsx)(e.td,{children:"int rear"}),(0,sa.jsx)(e.td,{children:"큐의 맨 뒤를 기록합니다."})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{}),(0,sa.jsxs)(e.td,{children:["ItemType data",(0,sa.jsx)(e.code,{children:"[maxsize]"})]}),(0,sa.jsx)(e.td,{children:"큐의 데이터를 관리하는 배열입니다. 최대 maxsize개의 데이터를 관리합니다."})]})]})]}),"\n",(0,sa.jsxs)(e.p,{children:["테이블에 정의된 상태, 연산을 기반으로 ADT를 그려보면 다음과 같습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020240909094927.png",alt:""})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!INFO]"}),"\n",(0,sa.jsx)(e.p,{children:"front와 rear가 -1인 것을 주목해주세요. front는 큐의 앞, rear는 큐의 뒤를 뜻하는데요. front를 이용해서 데이터를 빼고 rear를 통해서 데이터를 더하는 구조입니다. 아무런 데이터가 없다면 큐의 앞, 뒤 모두에 데이터가 없다는 것을 표현해줘야 하는데요. 이를 위해 -1을 사용합니다."}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["큐에 데이터를 추가하는 경우 다음과 같이 표현할 수 있습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617212028.png",alt:""})]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["먼저 큐가 가득 찼는지 확인합니다.","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"가득 찼다면 종료"}),"\n",(0,sa.jsx)(e.li,{children:"가득차지 않았다면 rear를 1 높혀주고 rear의 위치에 데이터를 넣습니다."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["큐에서 데이터를 제거하면 다음과 같이 표현할 수 있습니다\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617212214.png",alt:""})]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["큐가 비었는지 확인합니다.","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"비었다면 종료"}),"\n",(0,sa.jsx)(e.li,{children:"비어있지 않다면 front를 1 높혀줘서 isEmpty를 다음에 실행했을 때 true가 되도록 합니다."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-06-07/Pasted%20image%2020250617212315.png",alt:""}),"\nfront를 이용해서 실제 데이터를 삭제하지 않지만 데이터를 삭제한 것처럼 관리하는 것입니다."]}),"\n",(0,sa.jsx)(e.h2,{children:"선형 큐의 한계"}),"\n",(0,sa.jsx)(e.p,{children:"선형 큐를 이용한 방식은 구조적으로 front의 다음부터 rear까지의 데이터를 관리하는 것을 볼 수 있습니다. front와 front 이전 위치의 데이터는 사용할 수 없기 때문에 비효율적입니다."}),"\n",(0,sa.jsx)(e.p,{children:"현재 선형인 구조를 원형으로 만들면 공간을 계속 재활용하게 만들어 이 문제를 해결할 수 있게 됩니다. 원형으로 된 구조의 큐를 원형 큐라고 합니다. 공간을 재활용하여 메모리 공간을 효율적으로 사용할 수 있습니다."}),"\n",(0,sa.jsx)(e.h1,{children:"JS로 큐 구현"}),"\n",(0,sa.jsx)(e.p,{children:"큐를 구현하는 방법에는 3가지가 있습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"배열의 push, shift로 큐 흉내내기"}),"\n",(0,sa.jsx)(e.li,{children:"배열을 이용하여 큐를 구현하기"}),"\n",(0,sa.jsx)(e.li,{children:"연결 리스트를 이용하여 큐를 구현하기"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"자세히 알아봅시다."}),"\n",(0,sa.jsx)(e.h2,{children:"배열의 push, shift로 큐를 흉내"}),"\n",(0,sa.jsxs)(e.p,{children:["큐의 FIFO의 구조는 흉내낼 수 있지만 배열의 메소드 ",(0,sa.jsx)(e.code,{children:"shift"}),"는 ",(0,sa.jsx)(e.code,{children:"O(n)"}),"의 시간 복잡도를 가지고 있기 때문에 Queue의 pop의 시간복잡도",(0,sa.jsx)(e.code,{children:"O(1)"}),"보다 느립니다."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!INFO] shift 시간 복잡도"}),"\n",(0,sa.jsxs)(e.p,{children:["JS에서 배열은 동적 배열입니다. 메모리 공간 상으로 첫번째 원소를 기준으로 뒤쪽 공간에 다음 원소들을 생성합니다. 이 원리에 의해서 ",(0,sa.jsx)(e.code,{children:"push"})," 메소드를 실행하게 되면 메모리 공간 뒤쪽에 원소를 추가하기만 하기 때문에 ",(0,sa.jsx)(e.code,{children:"O(1)"}),"의 시간 복잡도를 갖습니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["하지만 ",(0,sa.jsx)(e.code,{children:"shift"}),"로 메모리 공간의 첫번째 원소를 없애버리게 되면 두번째 원소부터 끝 원소까지 이전 원소로 한 칸씩 이동하는 동작을 하게 됩니다. 이 때문에 ",(0,sa.jsx)(e.code,{children:"O(n)"}),"이라는 시간 복잡도를 가지게 됩니다.\n( 참고: ",(0,sa.jsx)(e.a,{href:"https://codefug.github.io/posts/2025-05-24",children:"https://codefug.github.io/posts/2025-05-24"})," )"]}),"\n"]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열 생성"}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," queue = [];\n\nqueue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),");\nqueue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),");\nqueue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),");\n\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," firstItem = queue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"shift"}),"();\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(firstItem); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1"}),"\n\nqueue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),");\nqueue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),");\n\nfirstItem = queue.",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"shift"}),"();\n",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"console"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"log"}),"(firstItem); ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2"}),"\n"]})}),"\n",(0,sa.jsx)(e.h2,{children:"배열을 이용하여 큐 구현"}),"\n",(0,sa.jsx)(e.p,{children:"클래스의 프로퍼티로 배열을 넣고 이를 front와 rear로 제어하는 방식으로 큐를 구현할 수 있습니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Queue"})," {\n  items = [];\n  front = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n  rear = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"item"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"items"}),".",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(item);\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"rear"}),"++;\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"pop"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"items"}),"[",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"front"}),"++];\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isEmpty"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"front"})," === ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"rear"}),";\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"언뜻 보기에는 잘 구현된 큐로 볼 수 있으나 rear와 front가 계속해서 증가하고 배열 메모리도 계속해서 증가하는 문제가 있습니다. 완벽한 구현을 위해서는 연결 리스트를 활용해야 합니다."}),"\n",(0,sa.jsx)(e.h2,{children:"연결 리스트를 이용하는 방식"}),"\n",(0,sa.jsx)(e.p,{children:"JS에서는 연결 리스트를 기본 제공하지 않습니다. 그래서 직접 구현해야 합니다. (시간 복잡도를 줄이는 멋진 개발자가 되기 위해선 알아야 합니다.)"}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:[(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 노드 하나를 정의합니다. 연결 리스트는 이 노드를 하나의 값으로 취급하여 연결한 리스트입니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Node"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"data"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"})," = data; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 인스턴스의 현재 값"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"next"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),"; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 다음 값"}),"\n  }\n}\n\n",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Node를 사용할 Queue입니다."}),"\n",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Queue"})," {\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// head, tail, size를 초기화합니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tail"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"size"})," = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 노드를 추가해줍니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"push"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"item"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// newNode를 만들어서 두가지 경우의 수를 처리합니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," newNode = ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"new"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Node"}),"(item);\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 1. 첫 노드일 경우: head와 tail을 여기에 연결해줍니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"})," = newNode;\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tail"})," = newNode;\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 2. 첫 노드가 아닐 경우: tail과 새 노드를 연결해줍니다."}),"\n    } ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"else"})," {\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 현재 tail의 다음값을 newNode로 하고"}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tail"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"next"})," = newNode;\n      ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 현재 tail을 newNode로 바꿔줍니다."}),"\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tail"})," = newNode;\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"size"}),"++;\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 지울 노드를 꺼내고 반환해줍니다."}),"\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"pop"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 데이터가 없다면 null을 반환하고 끝냅니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 데이터가 있다면 반환할 노드를 미리 removeNode에 저장해놓고"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," removeNode = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// head를 다음 값으로 이동시킵니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"})," = ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"next"}),";\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 만약 다음 값이 null이었다면 데이터가 비었으므로 tail도 초기화시켜줍니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"if"})," (!",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"head"}),") {\n      ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"tail"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    }\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 배열의 크기를 줄여주고"}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"size"}),"--;\n\n    ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 미리 저장했던 removeNode를 꺼내줍니다."}),"\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," removeNode.",(0,sa.jsx)(e.span,{className:"hljs-property",children:"data"}),";\n  }\n\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"isEmpty"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params"}),") {\n    ",(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"return"})," ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"size"})," === ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"0"}),";\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.p,{children:"이제 잔여 메모리 공간 문제와 시간 복잡도 문제를 해결한 멋진 개발자가 되었습니다."}),"\n",(0,sa.jsx)(e.h1,{children:"참고 문헌"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"알고리즘은 꾸준히 공부해주지 않으면 개념들이 유독 빠르게 사라지는 것 같아요.\n사라지면 다시 채워넣을 수 있도록 꾸준히 공부해보겠습니다.\n잘못된 지식이 있다면 댓글 부탁드려요!"}),"\n",(0,sa.jsx)(e.p,{children:"읽어주셔서 감사해요."}),"\n"]})]})}function nn(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(ne,{...s})}):ne(s)}function na(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",ul:"ul",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"If you simply want to find data, you might think of sequential search. This is not appropriate for handling large amounts of data because in the worst case, you need to look at all data."}),"\n",(0,sa.jsxs)(e.p,{children:["If you set a rule for where any value is stored, you could find it by accessing it directly. The data structure born from this concept is ",(0,sa.jsx)(e.code,{children:"hash"}),"."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"hash"})," can be easily used as an Object in JavaScript, but internally it's implemented by using a hash function to convert values into indices and storing them as key-value pairs. Let's learn more in detail."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!INFO]"}),"\n",(0,sa.jsx)(e.p,{children:"Hash stores keys and data in one-to-one correspondence, so you can access data directly through keys."}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"Concept"}),"\n",(0,sa.jsxs)(e.p,{children:["Hash is a data structure we use a lot in our daily lives.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250617224108.png",alt:""}),"\nContacts can be seen as a ",(0,sa.jsx)(e.code,{children:"hash"})," with a name as the key corresponding to a number as the value. To find a value using a key in hash, you need a hash function that converts the key into a hash value or index in between. I'll explain hash functions in more detail below. Let's first look at the characteristics."]}),"\n",(0,sa.jsx)(e.h2,{children:"Characteristics"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Hash operates unidirectionally. You can find values through keys, but you cannot find keys through values."}),"\n",(0,sa.jsxs)(e.li,{children:["You can find the desired value immediately with ",(0,sa.jsx)(e.code,{children:"O(1)"})," time complexity. This is because the key itself becomes an index through the hash function, so no search process is needed."]}),"\n",(0,sa.jsx)(e.li,{children:"To use values as indices, you need to go through an appropriate conversion process."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] Unidirectional Hash"}),"\n",(0,sa.jsx)(e.p,{children:"Hash that operates only unidirectionally has the characteristic of safely providing information externally, so it's used a lot in network security."}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["When you need to find a phone number that matches a name, let's say there's no hash.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618081621.png",alt:""}),"\nIf you don't use hash, as shown in the picture above, you need to sequentially search all arrays to find the name, then use another array at the corresponding index to find the phone number. You can see the search efficiency is poor."]}),"\n",(0,sa.jsxs)(e.p,{children:["But if you use hash, the story is different.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618082006.png",alt:""}),"\nBecause you can find the location of a specific value directly through the hash function, search efficiency is good.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618082154.png",alt:""})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE]"}),"\n",(0,sa.jsx)(e.p,{children:"Hash table: The space where keys and corresponding values are stored\nbucket: Each data in the hash table"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Fields That Utilize Hash Characteristics"}),"\n",(0,sa.jsx)(e.p,{children:"Hash can only search unidirectionally, but in return, it can quickly search for desired values. Due to these characteristics, it's used when storing and searching data, or when security is needed."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] Real-World Cases Where Hash Is Used"}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:"Password Management: Hash functions are used to store passwords when storing them."}),"\n",(0,sa.jsx)(e.li,{children:"Database Indexing: Hash is used when efficiently searching data stored in databases."}),"\n",(0,sa.jsx)(e.li,{children:"Blockchain: Each block in blockchain contains the hash value of the previous block, and you can verify data integrity through this."}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"Implementation"}),"\n",(0,sa.jsx)(e.p,{children:"As explained initially, in JavaScript you can use hash just by using Object. Understanding the principles of hash allows you to use this structure in other larger hierarchies as well, so knowing it is the path to becoming a great developer."}),"\n",(0,sa.jsx)(e.h2,{children:"Hash Function"}),"\n",(0,sa.jsx)(e.p,{children:"There are things to consider when implementing hash functions."}),"\n",(0,sa.jsxs)(e.p,{children:["First, values returned by hash functions should not exceed the hash table.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618083156.png",alt:""}),"\nSince the return value of the hash function becomes an index, the return value of the hash function should be a value from 0 to N-1, which is smaller than N, the size of the hash table."]}),"\n",(0,sa.jsxs)(e.p,{children:["Second, collisions of values converted by hash functions should occur as little as possible.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618083427.png",alt:""}),"\nCollisions in hash functions can't be completely avoided, but it's good to minimize them."]}),"\n",(0,sa.jsx)(e.h3,{children:"Commonly Used Hash Functions"}),"\n",(0,sa.jsx)(e.p,{children:"Let's see what hash functions are actually used."}),"\n",(0,sa.jsx)(e.h4,{children:"Numeric Hash Functions"}),"\n",(0,sa.jsx)(e.h5,{children:"Division Method"}),"\n",(0,sa.jsx)(e.p,{children:"The division method is the easiest to think of. It's a method that uses the remainder when dividing a key by a prime number as an index."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"h(x) = x mod k ( x%k, k should be a prime number to reduce collisions. )"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618084825.png",alt:""})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] Why Using Prime Numbers Reduces Collisions"}),"\n",(0,sa.jsxs)(e.p,{children:["Let's use 15 instead of a prime number.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618084931.png",alt:""}),"\nIf you apply 15, you can see that the same hash value repeats regularly as shown in the picture above. If it's a multiple of 3 or 5, which are divisors of k, it all proceeds in this form."]}),"\n",(0,sa.jsxs)(e.p,{children:["The reason is simple. If one of N's divisors is M, then there's always a number where ",(0,sa.jsx)(e.code,{children:"M * K = N"}),". That's why we use prime numbers, which only have 1 or themselves as divisors."]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"When using the division method, the table size becomes the prime number K used in the division method. If you need to store a very large amount of data, you need to find a prime number that large. Currently, there's no efficient way to find that number. That's why other methods were created."}),"\n",(0,sa.jsx)(e.h5,{children:"Multiplication Method"}),"\n",(0,sa.jsx)(e.p,{children:"The multiplication method uses modular operations similar to the division method but doesn't use prime numbers."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"h(x) = ( ( ( x _ A ) mod 1 ) _ m) (m is the maximum number of buckets, A is the golden ratio)"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"The golden ratio mathematically means the ratio where when you divide an arbitrary length into two parts, the ratio of the whole to the long part is the same as the ratio of the long part to the short part. For calculations, we'll use only the fractional part 0.618033... instead of the actual golden ratio 1.618033..."}),"\n",(0,sa.jsx)(e.p,{children:"Let's proceed with the formula."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"x * A: Add x and golden ratio A."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618085741.png",alt:""})}),"\n",(0,sa.jsxs)(e.ol,{start:"2",children:["\n",(0,sa.jsxs)(e.li,{children:["\n",(0,sa.jsx)(e.p,{children:"( ( x * A ) mod 1 ): Discard the integer part and take only the fractional part. ( ex) If it's 3.1523, only 0.1523 remains. )"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618085806.png",alt:""})}),"\n"]}),"\n",(0,sa.jsxs)(e.li,{children:["\n",(0,sa.jsxs)(e.p,{children:["( ( ( x _ A ) mod 1 ) _ m): Multiply by m, the maximum number of buckets, to map to the hash table. Since we only took the fractional part in step 2, it was in the range 0 ~ 0.99..., and multiplying by m gives us the range 0 ~ m-1.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618125004.png",alt:""}),"\nThe multiplication method implements logic using the golden ratio instead of prime numbers. Therefore, no additional work is needed even when the table size increases."]}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"String Hash Functions"}),"\n",(0,sa.jsx)(e.p,{children:"Let's create a hash where the key's data type is a string. String hashing converts string characters to numbers and converts these numbers to polynomial values for hashing."}),"\n",(0,sa.jsxs)(e.p,{children:["For this, we use the ",(0,sa.jsx)(e.code,{children:"polynomial rolling method"}),"."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:'hash(s) = (s[0] + s[1] _ p + s[2]_ p\xb2 + ... + s[n− 1]* p"-1) mod m ( p is 31, m is the maximum hash table size )'}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] Mersenne Prime"}),"\n",(0,sa.jsxs)(e.p,{children:["A number that is prime among numbers that can be expressed in the format 2",(0,sa.jsx)("sup",{children:"N"}),"-1."]}),"\n",(0,sa.jsx)(e.p,{children:"Research results show it's effective in reducing collisions in hashing."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"The operation process is as follows."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["A table matching a to z with numbers and a key\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619081042.png",alt:""})]}),"\n",(0,sa.jsxs)(e.li,{children:["Calculate according to the table ( s",(0,sa.jsx)(e.code,{children:"[0]*p"}),(0,sa.jsx)("sup",{children:"0"})," is ",(0,sa.jsx)(e.code,{children:"1*1"}),". )\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619081120.png",alt:""})]}),"\n",(0,sa.jsxs)(e.li,{children:["From ",(0,sa.jsx)(e.code,{children:"s[1]"})," onwards, numbers exceeding the table size start to appear. First, iterate through all of them.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619081147.png",alt:""})]}),"\n",(0,sa.jsxs)(e.li,{children:["After iterating through all numbers, add all those values and perform modular operation with the hash table size to fit the hash table size.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619081428.png",alt:""}),"\nThrough the above process, you can convert a string to a number through a hashing function. The problem here is that even for a simple string like ",(0,sa.jsx)(e.code,{children:"apple"}),", too large a number came out as a result. If the string gets larger here, overflow can occur. To prevent this, perform the following operation."]}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"(a+b)%c=(a%c+b%c)%c"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Simply put, instead of performing modular operation on the final value, perform modular operation at each calculation step. When the hash function is directly applied, it's in the following form"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"hash(s) =(s[0]%m+s[1]_ p%m+s[2]_ p\xb2 %m ...... s[n -1]* p(n-1)%m)%m"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Hash Function Collision Handling"}),"\n",(0,sa.jsxs)(e.p,{children:["When hash function results are the same for different keys, it's called a ",(0,sa.jsx)(e.code,{children:"collision"}),". Since you can't put 2 values in one bucket, you must handle collisions when managing hash tables."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619082027.png",alt:""}),"\nVarious methods exist to solve this."]}),"\n",(0,sa.jsx)(e.h3,{children:"Handling with Chaining"}),"\n",(0,sa.jsx)(e.p,{children:"Connect data with the same hash value using a linked list."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619082251.png",alt:""}),"\nIf return values that went through the hash function collide, you can solve the problem by making the hash table elements themselves into linked lists and connecting them. However, there are two disadvantages here."]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Hash table space utilization: As collisions occur more, hash table space is used less and linked list length gradually increases."}),"\n",(0,sa.jsxs)(e.li,{children:["Search performance degradation: As collisions occur more, the linked list that needs to be traversed grows, eventually having ",(0,sa.jsx)(e.code,{children:"O(N)"})," time complexity.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619082613.png",alt:""})]}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"Handling with Open Addressing"}),"\n",(0,sa.jsx)(e.p,{children:"A method that finds an empty bucket and inserts the colliding value. It uses the hash table as much as possible, so it uses memory more efficiently than chaining."}),"\n",(0,sa.jsx)(e.h4,{children:"Linear Probing Method"}),"\n",(0,sa.jsx)(e.p,{children:"When a collision occurs, move at regular intervals until you find another empty bucket. (Usually the interval is 1.)"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"h(k,i) = ( h(k) + i ) mod m (m is the maximum number of buckets that can be accommodated, i is the interval)"}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["When doing linear probing, you must not exceed the table range, so modular operation is applied.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619082842.png",alt:""}),"\nOf course, this method isn't perfect either. Moving down one space at a time, values that collided eventually gather in an area. This is called a cluster. As clusters form, the probability of hash values overlapping increases."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE]"}),"\n",(0,sa.jsx)(e.p,{children:"There's also a method of moving by square numbers to prevent this, but the probability of the problem only decreases, it doesn't disappear."}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"Double Hashing Method"}),"\n",(0,sa.jsx)(e.p,{children:"A method that uses 2 hash functions, and sometimes uses N functions for more robust hashing."}),"\n",(0,sa.jsx)(e.p,{children:"The role of the second hash function is to decide what to do when a collision occurs with the first hash function."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["h(k,i) = (h",(0,sa.jsx)("sub",{children:"1"}),"(k) + i",(0,sa.jsx)(e.code,{children:"*"}),"h",(0,sa.jsx)("sub",{children:"2"}),"(k)) mod m (h",(0,sa.jsx)("sub",{children:"n"})," is the nth hash)"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Similar to linear probing in that it adds, but to reduce clusters, m is made a square number or prime number. This is to make the jump position different for each given key through hash functions to avoid cluster formation as much as possible."}),"\n",(0,sa.jsx)(e.h1,{children:"References"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"Algorithm concepts seem to disappear particularly quickly if you don't study them consistently.\nI'll study consistently so I can fill them back in when they disappear.\nIf there are any incorrect knowledge, please leave a comment!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you for reading."}),"\n"]})]})}function nl(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(na,{...s})}):na(s)}function nc(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",ul:"ul",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"단순하게 데이터를 찾는다고 하면 순차 탐색을 생각할 수 있습니다. 이는 최악의 경우 모든 데이터를 살펴봐야 하기에 대용량 데이터를 다루기에는 적절하지 않습니다."}),"\n",(0,sa.jsxs)(e.p,{children:["어떠한 값이 저장되는 위치를 어떤 규칙으로 정한다면 바로 접근해서 찾아낼 수 있을 텐데요. 이런 개념으로 탄생한 자료구조가 ",(0,sa.jsx)(e.code,{children:"hash"})," 입니다."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.code,{children:"hash"}),"는 JS에서 Object로 쉽게 쓸 수 있지만 내부적으로는 해시 함수를 사용해서 변환한 값을 인덱스로 삼아서 키, 값으로 저장하는 방식으로 구현되어 있습니다. 더 자세하게 알아봅시다."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!INFO]"}),"\n",(0,sa.jsx)(e.p,{children:"해시는 키와 데이터를 일대일 대응하여 저장하므로 키를 통해 데이터에 바로 접근할 수 있습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"개념"}),"\n",(0,sa.jsxs)(e.p,{children:["해시는 우리의 일상 생활에서 정말 많이 사용하는 자료구조입니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250617224108.png",alt:""}),"\n연락처는 이름 이라는 key에 대응되는 번호 라는 value 를 가진 ",(0,sa.jsx)(e.code,{children:"hash"}),"로 볼 수 있습니다. hash에서 key를 갖고 value를 찾기 위해서는 중간에 key를 해시값 또는 인덱스로 변환해주는 해시 함수가 필요합니다. 해시 함수에 대한 설명은 아래에서 더 자세히 하겠습니다. 우선 특징부터 살펴봅시다."]}),"\n",(0,sa.jsx)(e.h2,{children:"특징"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"해시는 단방향으로 동작합니다. 키를 통해 값을 찾을 수 있지만 값을 통해 키를 찾을 수는 없습니다."}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.code,{children:"O(1)"}),"의 시간 복잡도로 찾고자 하는 값을 바로 찾을 수 있습니다. 해시 함수에 의해서 key 자체가 인덱스가 되서 탐색 과정이 필요 없는 것입니다."]}),"\n",(0,sa.jsx)(e.li,{children:"값을 인덱스로 사용하려면 적절한 변환 과정을 거쳐야 합니다."}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] 단방향으로 동작하는 해시"}),"\n",(0,sa.jsx)(e.p,{children:"단방향으로만 동작하는 해시는 외부에 정보를 안전하게 제공한다는 특징이 있어 네트워크 보안에서 많이 활용됩니다."}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["이름에 맞는 전화번호를 찾아야 할 때 hash가 없다고 해봅시다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618081621.png",alt:""}),"\n해시를 사용하지 않으면 위의 사진처럼 모든 배열을 순차 탐색해서 해당 이름을 찾은 후에 해당 인덱스에 맞는 또 다른 배열을 이용해서 전화번호를 찾아야 합니다. 탐색 효율이 떨어지는 것을 볼 수 있습니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["하지만 해시를 사용한다면 이야기가 달라집니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618082006.png",alt:""}),"\n해시 함수를 통해서 특정 값이 있는 위치를 바로 찾을 수 있기 때문에 탐색 효율이 좋습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618082154.png",alt:""})]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE]"}),"\n",(0,sa.jsx)(e.p,{children:"해시 테이블: 키와 대응한 값이 저장되어 있는 공간\nbucket: 해시 테이블의 각 데이터"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"해시의 특성을 활용하는 분야"}),"\n",(0,sa.jsx)(e.p,{children:"해시는 단방향으로만 검색할 수 있는 대신 빠르게 원하는 값을 검색할 수 있습니다. 이러한 특징으로 인해 데이터를 저장하고 검색하거나, 보안이 필요한 때에 활용됩니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] 해시가 사용되는 실제 사례"}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:"비밀번호 관리: 비밀번호를 저장할 때 해시 함수를 활용해서 비밀번호를 저장합니다."}),"\n",(0,sa.jsx)(e.li,{children:"데이터베이스 인덱싱: 데이터베이스에 저장된 데이터를 효율적으로 검색할 때 해시를 활용합니다."}),"\n",(0,sa.jsx)(e.li,{children:"블록체인: 블록체인의 각 블록은 이전 블록의 해시값을 포함하고 있으며, 이를 통해 데이터 무결성을 확인할 수 있습니다."}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"구현"}),"\n",(0,sa.jsx)(e.p,{children:"처음 설명했던 것처럼 JS에서는 Object만 사용해도 hash를 쓸 수 있습니다. hash의 원리를 이해하면 이 구조를 다른 좀 더 큰 계층에서도 사용할 수 있기에 알아는 두는 것이 멋진 개발자가 되는 길입니다."}),"\n",(0,sa.jsx)(e.h2,{children:"해시 함수"}),"\n",(0,sa.jsx)(e.p,{children:"해시 함수를 구현에서 고려해야 하는 사항들이 있습니다."}),"\n",(0,sa.jsxs)(e.p,{children:["첫번째로 해시 함수로 반환되는 값은 해시 테이블을 넘어선 안됩니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618083156.png",alt:""}),"\n해시 함수의 반환 값이 인덱스로 되기 때문에 해시 함수의 반환값은 해시 테이블의 크기인 N보다 작은 0부터 N-1까지의 값이어야 합니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["두 번째로 해시 함수가 변환한 값의 충돌은 최대한 적게 발생해야 합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618083427.png",alt:""}),"\n해시 함수의 충돌이 안 날수는 없으나 최소한으로 줄이는 것이 좋습니다."]}),"\n",(0,sa.jsx)(e.h3,{children:"자주 사용하는 해시 함수"}),"\n",(0,sa.jsx)(e.p,{children:"실제로는 어떤 해시 함수를 사용하는지 알아봅시다."}),"\n",(0,sa.jsx)(e.h4,{children:"숫자 해시 함수"}),"\n",(0,sa.jsx)(e.h5,{children:"나눗셈법"}),"\n",(0,sa.jsx)(e.p,{children:"나눗셈법은 가장 떠올리기 쉽습니다. 키를 소수로 나눈 나머지를 인덱스로 활용하는 방법입니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"h(x) = x mod k ( x%k, k는 소수로 해야 충돌이 적습니다. )"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618084825.png",alt:""})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] 소수를 사용하는 방식이 충돌이 적은 이유"}),"\n",(0,sa.jsxs)(e.p,{children:["소수 대신 15를 사용해봅시다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618084931.png",alt:""}),"\n15를 적용하면 위 그림처럼 규칙적으로 계속 같은 해시값이 반복되는 것을 확인하실 수 있습니다. k의 약수 중 하나인 3, 5의 배수면 전부 이런 형태로 진행됩니다."]}),"\n",(0,sa.jsxs)(e.p,{children:["이유는 간단합니다. N의 약수 중 하나를 M이라고 한다면 ",(0,sa.jsx)(e.code,{children:"M * K = N"}),"이 되는 수가 무조건 있기 때문입니다. 그렇기에 K가 1 또는 자기 자신만 있는 수인 소수를 사용하는 것입니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"나눗셈 법을 사용하면 테이블의 크기는 나눗셈 법에서 사용하는 소수 K가 됩니다. 아주 많은 데이터를 저장해야 한다면 그만큼 큰 소수를 구해야 합니다. 현재로써는 그 수를 구하는 효율적인 방법이 없다고 합니다. 그래서 다른 방식들도 생겨나게 되었습니다."}),"\n",(0,sa.jsx)(e.h5,{children:"곱셈법"}),"\n",(0,sa.jsx)(e.p,{children:"곱셈법에서는 나눗셈법과 비슷하게 모듈러 연산을 활용하지만 소수를 활용하지 않습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"h(x) = ( ( ( x _ A ) mod 1 ) _ m) (m은 최대 버킷의 개수, A는 황금비)"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"황금비는 수학적으로 임의의 길이를 두 부분으로 나누었을 때, 전체와 긴 부분의 비율이 긴 부분과 짧은 부분의 비율과 같은 비율을 뜻합니다. 지금은 계산에서 실제 황금비인 1.618033...을 사용하지 않고 소수부인 0.618033... 만 사용하겠습니다."}),"\n",(0,sa.jsx)(e.p,{children:"공식을 진행해봅시다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"x * A: x와 황금비 A를 더합니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618085741.png",alt:""})}),"\n",(0,sa.jsxs)(e.ol,{start:"2",children:["\n",(0,sa.jsxs)(e.li,{children:["\n",(0,sa.jsx)(e.p,{children:"( ( x * A ) mod 1 ): 정수 부분을 버리고 소수 부분만 취합니다. ( ex) 3.1523이면 0.1523만 남게 됩니다. )"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618085806.png",alt:""})}),"\n"]}),"\n",(0,sa.jsxs)(e.li,{children:["\n",(0,sa.jsxs)(e.p,{children:["( ( ( x _ A ) mod 1 ) _ m): 최대 버킷의 개수인 m을 곱해서 해시 테이블에 매핑합니다. 2단계에서 소수 부분만 취했기 때문에 0 ~ 0.99... 까지의 범위에 있었는데 여기에 m을 곱해줘서 0 ~ m-1 의 범위를 갖게 되었습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250618125004.png",alt:""}),"\n곱셈법은 소수 대신 황금비를 사용하여 로직을 구현합니다. 따라서 테이블의 크기가 커져도 추가 작업이 필요 없습니다."]}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"문자열 해시 함수"}),"\n",(0,sa.jsx)(e.p,{children:"키의 자료형이 문자열인 해시를 만들어 봅시다. 문자열 해싱은 문자열의 문자를 숫 자로 변환하고 이 숫자들을 다항식의 값으로 변환해서 해싱합니다."}),"\n",(0,sa.jsxs)(e.p,{children:["이를 위해 ",(0,sa.jsx)(e.code,{children:"polynomial rolling method"}),"을 사용합니다."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:'hash(s) = (s[0] + s[1] _ p + s[2]_ p\xb2 + ... + s[n− 1]* p"-1) mod m ( p는 31, m은 해시 테이블 최대 크기 )'}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] 메르센 소수"}),"\n",(0,sa.jsxs)(e.p,{children:["2",(0,sa.jsx)("sup",{children:"N"}),"-1 형식으로 표시할 수 있는 숫자 중 소수인 수를 말합니다."]}),"\n",(0,sa.jsx)(e.p,{children:"해시에서 충돌을 줄이는데 효과적이라는 연구 결과가 있습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"동작 과정은 다음과 같습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:["a부터 z까지 숫자와 매치한 표와 키\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619081042.png",alt:""})]}),"\n",(0,sa.jsxs)(e.li,{children:["표에 맞춰서 계산 ( s",(0,sa.jsx)(e.code,{children:"[0]*p"}),(0,sa.jsx)("sup",{children:"0"}),"은 ",(0,sa.jsx)(e.code,{children:"1*1"}),"입니다. )\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619081120.png",alt:""})]}),"\n",(0,sa.jsxs)(e.li,{children:["그 이후인 ",(0,sa.jsx)(e.code,{children:"s[1]"}),"부터는 테이블의 크기를 넘어간 수가 나오기 시작합니다. 우선 전부 순회해줍니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619081147.png",alt:""})]}),"\n",(0,sa.jsxs)(e.li,{children:["모든 수들을 순회하고 나면 해당 값들을 전부 더하고 해시 테이블의 크기로 모듈러 연산을 해서 해시 테이블의 크기에 맞춰줍니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619081428.png",alt:""}),"\n위 과정을 통하면 문자열을 해싱 함수를 통해 숫자로 만들 수 있습니다. 이때 문제는 ",(0,sa.jsx)(e.code,{children:"apple"}),"이라는 단순한 문자열임에도 너무 큰 수가 결과로 나온 것입니다. 여기서 더 문자열이 커지게 되면 오버플로우가 발생할 수 있습니다. 이를 위해 다음의 연산을 수행해줍니다."]}),"\n"]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"(a+b)%c=(a%c+b%c)%c"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"간단하게 설명하면 최종값을 모듈러 연산하는 것이 아니라 각 계산 과정마다 모듈러 연산을 수행하는 것입니다. 해시 함수가 직접 적용하면 다음의 형태입니다"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"hash(s) =(s[0]%m+s[1]_ p%m+s[2]_ p\xb2 %m ...... s[n -1]* p(n-1)%m)%m"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"해시 함수 충돌 처리"}),"\n",(0,sa.jsxs)(e.p,{children:["서로 다른 키에 대해서 해시 함수의 결괏값이 같으면 ",(0,sa.jsx)(e.code,{children:"충돌"}),"이라고 합니다. 하나의 버킷에는 2개의 값을 넣을 수 없기 때문에 해시 테이블을 관리할 때는 반드시 충돌 처리를 해야 합니다."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619082027.png",alt:""}),"\n이를 해결하기 위해서는 다양한 방법이 존재합니다."]}),"\n",(0,sa.jsx)(e.h3,{children:"체이닝으로 처리"}),"\n",(0,sa.jsx)(e.p,{children:"연결리스트로 같은 해시값을 가지는 데이터를 연결합니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619082251.png",alt:""}),"\n해시 함수를 거친 반환값이 충돌한다면 해시 테이블의 원소 자체를 연결 리스트로 만들어 연결함으로써 문제를 해결할 수 있습니다. 하지만 여기에는 두가지 단점이 존재합니다."]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"해시 테이블 공간 활용성: 충돌이 일어날수록 해시 테이블 공간을 덜 사용하고 연결 리스트의 길이가 점점 길어질 수 있습니다."}),"\n",(0,sa.jsxs)(e.li,{children:["검색 성능 저하: 충돌이 일어날수록 순회해야 하는 연결리스트가 커지면서 결국 ",(0,sa.jsx)(e.code,{children:"O(N)"}),"의 시간복잡도를 갖게 됩니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619082613.png",alt:""})]}),"\n"]}),"\n",(0,sa.jsx)(e.h3,{children:"개방 주소법으로 처리"}),"\n",(0,sa.jsx)(e.p,{children:"빈 버킷을 찾아 충돌값을 삽입하는 방법입니다. 해시 테이블을 최대한 활용하므로 체이닝보다 메모리를 더 효율적으로 사용하게 됩니다."}),"\n",(0,sa.jsx)(e.h4,{children:"선형 탐사 방식"}),"\n",(0,sa.jsx)(e.p,{children:"충돌이 발생하면 다른 빈 버킷을 찾을 때까지 일정한 간격으로 이동합니다. (보통 간격은 1입니다.)"}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"h(k,i) = ( h(k) + i ) mod m (m은 수용할 수 있는 최대 버킷, i는 간격)"}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["선형 탐사 시 테이블의 범위를 넘으면 안 되므로 모듈러 연산을 적용합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-14/Pasted%20image%2020250619082842.png",alt:""}),"\n물론 이 방식도 완벽할 순 없습니다. 1칸씩 내려가다 보면 결국 충돌이 발생한 값끼리 모이는 영역이 생깁니다. 이를 클러스터(cluster)라고 합니다. 클러스터가 생길 때마다 해시값은 겹칠 확률이 더 올라갑니다."]}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE]"}),"\n",(0,sa.jsx)(e.p,{children:"이를 방지하기 위해 제곱수만큼 이동하는 방법도 있지만 문제의 확률이 작아졌을 뿐 없어지진 않습니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"이중 해싱 방식"}),"\n",(0,sa.jsx)(e.p,{children:"해시 함수를 2개 사용하는 방식이며 때에 따라 N개를 사용하기도 해서 좀 더 견고한 해싱을 하는 방식입니다."}),"\n",(0,sa.jsx)(e.p,{children:"두번째 해시 함수의 역할은 첫번째 해시 함수로 충돌이 발생했을 때 어떻게 할지 정하는 역할입니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsxs)(e.p,{children:["h(k,i) = (h",(0,sa.jsx)("sub",{children:"1"}),"(k) + i",(0,sa.jsx)(e.code,{children:"*"}),"h",(0,sa.jsx)("sub",{children:"2"}),"(k)) mod m (h",(0,sa.jsx)("sub",{children:"n"}),"은 n차 해시)"]}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"선형 탐사와 비슷하게 더하는 방식이지만 클러스터를 줄이기 위해서 m을 제곱수나 소수로 합니다. 주어지는 키마다 점프하는 위치를 해시 함수로 다르게 해서 클러스터 형성을 최대한 피하기 위함입니다."}),"\n",(0,sa.jsx)(e.h1,{children:"참고 문헌"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"알고리즘은 꾸준히 공부해주지 않으면 개념들이 유독 빠르게 사라지는 것 같습니다.\n사라지면 다시 채워넣을 수 있도록 꾸준히 공부해보겠습니다.\n잘못된 지식이 있다면 댓글 부탁드립니다!"}),"\n",(0,sa.jsx)(e.p,{children:"읽어주셔서 감사합니다."}),"\n"]})]})}function nr(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(nc,{...s})}):nc(s)}function ni(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"Trees have a useful structure for storing and searching data. They are often used when you want to express hierarchical structures. Let's learn together."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] Fields Where Trees Are Used"}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:"Artificial Intelligence: Decision trees are used when creating judgment criteria for AI."}),"\n",(0,sa.jsx)(e.li,{children:"Autocomplete Features: Trees are also used a lot in string processing. Search engines also use a tree structure called trie for autocomplete search suggestions."}),"\n",(0,sa.jsx)(e.li,{children:"Databases: Trees are used to structure and index data so it can be easily searched, inserted, and deleted. B-trees or B+ trees are often used."}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"Concept"}),"\n",(0,sa.jsx)(e.p,{children:"A tree is a data structure shaped like an upside-down tree with branches extending from the trunk."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621101921.png",alt:""}),"\nVarious terms exist. Let's learn them one by one."]}),"\n",(0,sa.jsx)(e.h2,{children:"Structure"}),"\n",(0,sa.jsx)(e.h3,{children:"Nodes That Make Up a Tree"}),"\n",(0,sa.jsx)(e.p,{children:"A node is an element that makes up a tree, and the node at the top is called the root node. In the picture above, the node with value 1 is the root node."}),"\n",(0,sa.jsx)(e.h4,{children:"Nodes with Parent-Child and Sibling Relationships"}),"\n",(0,sa.jsx)(e.p,{children:"Family-related terms are sometimes used."}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsxs)(e.li,{children:["Nodes with the same parent node: ",(0,sa.jsx)(e.strong,{children:"sibling nodes"})]}),"\n",(0,sa.jsxs)(e.li,{children:["If there is a node below a specific node in the tree, the specific node is the ",(0,sa.jsx)(e.strong,{children:"parent node"}),", and the node below is the ",(0,sa.jsx)(e.strong,{children:"child node"}),"."]}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"Terminal Nodes Without Children"}),"\n",(0,sa.jsxs)(e.p,{children:["Nodes without children are called ",(0,sa.jsx)(e.strong,{children:"leaf nodes"}),"."]}),"\n",(0,sa.jsx)(e.h3,{children:"Edges That Connect Nodes"}),"\n",(0,sa.jsxs)(e.p,{children:["The lines connecting nodes are called ",(0,sa.jsx)(e.strong,{children:"edges"})," or ",(0,sa.jsx)(e.strong,{children:"edges"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:"Trees have nodes connected by unidirectional edges, and the path from the root node to each node is unique."}),"\n",(0,sa.jsxs)(e.p,{children:["The minimum number of edges traversed from the root node to a specific node is expressed as ",(0,sa.jsx)(e.strong,{children:"level"}),". (Root is 0, then 1, 2, 3, 4...)"]}),"\n",(0,sa.jsx)(e.h4,{children:"Number of Downward Edges, Degree"}),"\n",(0,sa.jsxs)(e.p,{children:["The number of edges going downward from a specific node is called ",(0,sa.jsx)(e.strong,{children:"degree"}),". Node 1 can be said to have degree 3."]}),"\n",(0,sa.jsx)(e.h1,{children:"Binary Tree Implementation"}),"\n",(0,sa.jsxs)(e.p,{children:["A tree where the maximum degree of all nodes does not exceed 2 is called a ",(0,sa.jsx)(e.strong,{children:"binary tree"}),"."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621105144.png",alt:""}),"\nThere are two ways to implement it."]}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:"Using arrays"}),"\n",(0,sa.jsx)(e.li,{children:"Using pointers"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Let's get more familiar with trees by implementing a binary tree."}),"\n",(0,sa.jsx)(e.h2,{children:"Implementation Using Arrays"}),"\n",(0,sa.jsx)(e.p,{children:"Arrays are linear data structures, and trees are hierarchical data structures. To express a tree with an array, the following three rules are needed."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"Root node"})," is stored at array index ",(0,sa.jsx)(e.strong,{children:"1"}),"."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"Left"})," child node's array index is ",(0,sa.jsx)(e.strong,{children:"parent node's array index \xd7 2"}),"."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"Right"})," child node's array index is ",(0,sa.jsx)(e.strong,{children:"parent node's array index \xd7 2 + 1"}),"."]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["Implementing according to the above rules looks like this.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621105442.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["Looking at just the indices, they increase like 1, 2, 4, 8, with index increasing as ",(0,sa.jsx)(e.code,{children:"parent \xd7 2"}),". Following the dotted arrows, you can see indices flowing like 1, 3, 7. You can see it increases as ",(0,sa.jsx)(e.code,{children:"parent \xd7 2 + 1"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621105813.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["If you set the root node to 0, the left child node is ",(0,sa.jsx)(e.code,{children:"parent \xd7 2 + 1"})," and the right child node is ",(0,sa.jsx)(e.code,{children:"parent \xd7 2 + 2"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:"You might think implementing with arrays is enough. But implementing with arrays inevitably creates empty indices, like indices 9, 10, 11, 12, 13 being empty for index 14 in the picture above."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"When a binary tree has N nodes, creating a binary tree with an array takes O(N)."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Implementation Using Pointers"}),"\n",(0,sa.jsx)(e.p,{children:"In a tree implemented with pointers, a node has the node's value, left child node, and right child node."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621111301.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["Trees implemented with pointers don't waste memory space like arrays because they don't perform index operations.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621111338.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"You implement by creating one node through the class below and connecting them with left and right properties."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Node"}),"(){\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"value"}),"){\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"value"})," = value;\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"left"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"right"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.h1,{children:"Traversing Binary Trees"}),"\n",(0,sa.jsxs)(e.p,{children:["Visiting a specific data structure without missing anything is called ",(0,sa.jsx)(e.strong,{children:"traversal"}),". In terms of arrays, traversal is needed when searching for specific data using array indices. There are a total of 3 methods for tree traversal"]}),"\n",(0,sa.jsx)(e.p,{children:"Simply explained, they are as follows."}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:"Preorder Traversal: Visit in order: value > left child > right child"}),"\n",(0,sa.jsx)(e.li,{children:"Inorder Traversal: Visit in order: left child > value > right child"}),"\n",(0,sa.jsx)(e.li,{children:"Postorder Traversal: Visit in order: left child > right child > value\nLet's learn in more detail."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Preorder Traversal"}),"\n",(0,sa.jsx)(e.p,{children:"Visit in order: current node > left child node > right child node."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] Visit"}),"\n",(0,sa.jsx)(e.p,{children:'In traversal, "visit" means the state where traversal is complete. The term "visit" is used to distinguish between passing by and not passing by during traversal. In the following picture, one house was just passed by, and the other two houses have completed visits.'}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145855.png",alt:""})}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"Let's say we're doing a preorder traversal of the array below."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," a = [",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),", ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),", ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),"];\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["Since it's a tree assuming index 1 as root, drawn as a picture it looks like this.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145125.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"Let's start traversal from the root. Since it's current node > left child > right child, we mark the root and start."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622144957.png",alt:""}),"\nReturn value: 1"]}),"\n",(0,sa.jsxs)(e.p,{children:["Then go to the left child node and traverse again. Now 4 becomes the current node.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145209.png",alt:""}),"\nReturn value: 1, 4"]}),"\n",(0,sa.jsxs)(e.p,{children:["Continue traversing in the same way until you meet 2, which has no children.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145326.png",alt:""}),"\nReturn value: 1, 4, 3, 2"]}),"\n",(0,sa.jsxs)(e.p,{children:["Go back up and traverse 5, the right child of the most recent node.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145418.png",alt:""}),"\nReturn value: 1, 4, 3, 2, 5"]}),"\n",(0,sa.jsxs)(e.p,{children:["Traverse the entire tree in this way.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145427.png",alt:""}),"\nReturn value: 1, 4, 3, 2, 5, 8, 7, 6"]}),"\n",(0,sa.jsx)(e.p,{children:"This traversal method is easy to understand intuitively because it visits (outputs) the current node first. It's a method often used when copying trees."}),"\n",(0,sa.jsx)(e.h2,{children:"Inorder Traversal"}),"\n",(0,sa.jsx)(e.p,{children:"Visit in order: left child node > current node > right child node. It's a method that just passes through the current node and goes down to the left node."}),"\n",(0,sa.jsx)(e.p,{children:"Let's traverse the same tree as preorder traversal."}),"\n",(0,sa.jsxs)(e.p,{children:['Starting from the root with value 1, go to the end node of the left child. At this time, since we\'re not "visiting," only 2 is returned.\n',(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622150201.png",alt:""}),"\nReturn value: 2"]}),"\n",(0,sa.jsxs)(e.p,{children:["Since the order is left child > current node > right child, go back up from 2 (which was 3's left child) and traverse 3.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622150244.png",alt:""}),"\nReturn value: 2, 3"]}),"\n",(0,sa.jsxs)(e.p,{children:["Go back up to the root in this way.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152000.png",alt:""}),"\nReturn value: 2, 3, 4, 5, 1"]}),"\n",(0,sa.jsxs)(e.p,{children:["Complete traversal by recursively going through left node, current node, right node again.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152148.png",alt:""}),"\nReturn value: 2, 3, 4, 5, 1, 8, 6, 7"]}),"\n",(0,sa.jsx)(e.p,{children:"As additional information, this method is used when getting values in sorted order in binary search trees that will appear later, so you should know it well."}),"\n",(0,sa.jsx)(e.h2,{children:"Postorder Traversal"}),"\n",(0,sa.jsx)(e.p,{children:"This is the last traversal method."}),"\n",(0,sa.jsx)(e.p,{children:"Visit in order: left child node > right child node > current node."}),"\n",(0,sa.jsxs)(e.p,{children:["According to the rules, go to the end of the left child like inorder traversal. Since 2 has no left or right children, visit the current node 2.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152402.png",alt:""}),"\nReturn value: 2"]}),"\n",(0,sa.jsxs)(e.p,{children:["Going back up is the same as inorder traversal, but it changes a bit at 4. 4 is a node with both left and right children. That is, if the left child 3 has been visited, the next order is the right child. That is, 5 is visited before 4.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152456.png",alt:""}),"\nReturn value: 2, 3, 5"]}),"\n",(0,sa.jsxs)(e.p,{children:["The same phenomenon occurs at the root.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152626.png",alt:""}),"\nReturn value: 2, 3, 5, 4, 6"]}),"\n",(0,sa.jsxs)(e.p,{children:["When the root is finally visited, traversal ends.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152729.png",alt:""}),"\nReturn value: 2, 3, 5, 4, 6, 7, 8, 1"]}),"\n",(0,sa.jsx)(e.p,{children:"When deleting nodes, you shouldn't delete the parent first. You need to delete child nodes first to delete up to the root node recursively while maintaining the tree. So the characteristic of postorder traversal of visiting child nodes first is often used in tree deletion."}),"\n",(0,sa.jsx)(e.h1,{children:"Binary Search Tree"}),"\n",(0,sa.jsx)(e.p,{children:"A binary tree with a unique sorting method that places values smaller than the current node to the left child position and values greater than or equal to the right child position based on data size"}),"\n",(0,sa.jsx)(e.h2,{children:"Searching Binary Trees"}),"\n",(0,sa.jsx)(e.p,{children:"The good thing about trees is that they can be designed to search efficiently."}),"\n",(0,sa.jsx)(e.p,{children:"You can give specific rules to binary trees with a maximum of 2 child nodes to use them for your purpose. Let's learn about one of them, the binary search tree."}),"\n",(0,sa.jsx)(e.p,{children:'The rule of a binary search tree is "Place values smaller than the current node to the left child position and values greater than or equal to the right child position based on data size."'}),"\n",(0,sa.jsx)(e.p,{children:"Let's put the following array into a binary search tree."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"9"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"];\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["The first data becomes the root node. It becomes a tree with only 3.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622153638.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["Now place smaller values to the left and larger values to the right based on this. 4 is larger than 3, so it should be placed on the right.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622153724.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"This method happens recursively. If 3, 4, 2 are positioned based on 3, then from 8 onwards, the rules are applied recursively in the order 3 > 4. (It's not a rule like always from the third value. It's because 3's two child positions are both filled, so from 8 onwards it's applied recursively.)"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622153743.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["Completing the binary search tree through this method looks like this.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622153949.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"Now searching based on this tree can be done in the following order."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Start from the root, move to the left child node if the value is smaller, and move to the right child node if the value is larger."}),"\n",(0,sa.jsx)(e.li,{children:"If a specific value is found, end the search."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"You can tell it's very efficient just from the simple rules above without calculating. I'll cover detailed time complexity later."}),"\n",(0,sa.jsx)(e.h3,{children:"Difference from Array Search"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622154332.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"In the above situation, when searching for 5 in an array, 7 comparison operations are needed. This is because you need to traverse the array until it appears."}),"\n",(0,sa.jsx)(e.p,{children:"Searching in a binary search tree in the same situation ends in just 2 times. (Search index order: 0 > 2 > 5, and since index 5 has no left child, you can confirm that 5 doesn't exist.)"}),"\n",(0,sa.jsx)(e.h3,{children:"Time Complexity of Binary Search Tree"}),"\n",(0,sa.jsx)(e.p,{children:"The time complexity of a binary search tree depends on tree balance. A balanced tree means that each node's degree is maintained similarly, and each node's number of child nodes is maintained similarly."}),"\n",(0,sa.jsxs)(e.p,{children:["When balance is maintained, it can be said to be most ideal. The time complexity at the most ideal time is ",(0,sa.jsx)(e.strong,{children:"O(logN)"}),". (This is because the tracking target is exactly halved during insertion and search.)"]}),"\n",(0,sa.jsxs)(e.p,{children:["Conversely, if balance is not maintained, insertion and search operations have ",(0,sa.jsx)(e.strong,{children:"O(N)"})," time complexity. This matches arrays."]}),"\n",(0,sa.jsx)(e.p,{children:"Let's find out why."}),"\n",(0,sa.jsx)(e.h4,{children:"Unbalanced Tree: Skewed Form Tree"}),"\n",(0,sa.jsxs)(e.p,{children:["degenerate binary tree\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622155353.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"The rule of a binary search tree is that if the value you're looking for is smaller than the value you're currently searching, search the left child, otherwise search the right child, and if equal, end the search."}),"\n",(0,sa.jsx)(e.p,{children:"If it's unbalanced, this rule often becomes unnecessary. Because you'll only go in one direction. Thinking extremely, this becomes a structure no different from an array. That is, it has the same time complexity as arrays, O(N)."}),"\n",(0,sa.jsx)(e.p,{children:"But this is just one case among many. If even one in the picture above moves to the opposite child of the root node, you could say performance is better than arrays."}),"\n",(0,sa.jsx)(e.h4,{children:"Balanced Tree: Balanced Binary Search Tree"}),"\n",(0,sa.jsx)(e.p,{children:"Balanced binary search trees are often called AVL trees, red-black trees, etc. in detail. Using these, the number of search operations is proportional to tree height, and since tree height is logN, search time complexity can be maintained at O(logN)."}),"\n",(0,sa.jsx)(e.h1,{children:"References"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"Algorithm concepts seem to disappear particularly quickly if you don't study them consistently.\nI'll study consistently so I can fill them back in when they disappear.\nIf there are any incorrect knowledge, please leave a comment!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you for reading."}),"\n"]})]})}function nt(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(ni,{...s})}):ni(s)}function nh(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.p,{children:"트리는 데이터를 저장하고 탐색하기에 유용한 구조를 갖고 있습니다. 계층 구조로 표현하고자 할 때 많이 사용되는데요. 같이 알아봅시다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] 트리가 활용되는 분야"}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:"인공지능: 인공지능의 판단 기준을 만들 때 의사 결정 트리를 사용합니다."}),"\n",(0,sa.jsx)(e.li,{children:"자동 완성 기능: 문자열 처리에도 트리가 많이 활용됩니다. 검색 엔진에서도 자동 검색어 추천 기능도 trie라는 트리 구조를 활용합니다."}),"\n",(0,sa.jsx)(e.li,{children:"데이터베이스: 데이터를 쉽게 검색, 삽입, 삭제할 수 있도록 트리를 활용해서 데이터를 구조화하고 인덱싱합니다. 이때 B-트리나 B+트리를 많이 사용해요."}),"\n"]}),"\n"]}),"\n",(0,sa.jsx)(e.h1,{children:"개념"}),"\n",(0,sa.jsx)(e.p,{children:"트리는 나무 기둥에서 가지가 뻗어나가는 모습을 거꾸로 뒤집어 놓은 모양의 데이터 구조입니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621101921.png",alt:""}),"\n다양한 용어들이 존재합니다. 하나씩 알아봅시다."]}),"\n",(0,sa.jsx)(e.h2,{children:"구성"}),"\n",(0,sa.jsx)(e.h3,{children:"트리를 구성하는 노드"}),"\n",(0,sa.jsx)(e.p,{children:"노드는 트리를 구성하는 요소이며 가장 위에 있는 노드를 루트 노드라고 합니다. 위 그림에서는 1을 값으로 갖고 있는 노드가 루트 노드입니다."}),"\n",(0,sa.jsx)(e.h4,{children:"부모-자식, 형제 관계를 가지는 노드"}),"\n",(0,sa.jsx)(e.p,{children:"가족 관련된 용어들이 사용되는 경우가 있습니다."}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsxs)(e.li,{children:["같은 부모 노드를 갖는 노드: ",(0,sa.jsx)(e.strong,{children:"형제 노드"})]}),"\n",(0,sa.jsxs)(e.li,{children:["트리에서 특정 노드 아래에 있는 노드가 있다면 특정 노드는 ",(0,sa.jsx)(e.strong,{children:"부모 노드"}),", 아래 있는 노드는 ",(0,sa.jsx)(e.strong,{children:"자식 노드"})," 라고 합니다."]}),"\n"]}),"\n",(0,sa.jsx)(e.h4,{children:"자식이 없는 말단 노드"}),"\n",(0,sa.jsxs)(e.p,{children:["자식이 없는 노드는 ",(0,sa.jsx)(e.strong,{children:"리프 노드"}),"라고 합니다."]}),"\n",(0,sa.jsx)(e.h3,{children:"노드를 연결하는 에지"}),"\n",(0,sa.jsxs)(e.p,{children:["노드와 노드를 이어주는 선을 ",(0,sa.jsx)(e.strong,{children:"edge"})," 또는 ",(0,sa.jsx)(e.strong,{children:"간선"})," 이라고 합니다."]}),"\n",(0,sa.jsx)(e.p,{children:"트리는 노드와 노드가 단방향 간선으로 연결되어 있고 루트 노드에서 각 노드까지 경로는 유일합니다."}),"\n",(0,sa.jsxs)(e.p,{children:["루트 노드로부터 특정 노드까지 거쳐가는 최소한의 간선 수를 ",(0,sa.jsx)(e.strong,{children:"레벨"}),"로 표현합니다. ( 루트는 0 그 이후부터 1 2 3 4 ... )"]}),"\n",(0,sa.jsx)(e.h4,{children:"아래로 향하는 간선의 개수, 차수"}),"\n",(0,sa.jsxs)(e.p,{children:["특정 노드에서 아래로 향하는 간선의 개수를 ",(0,sa.jsx)(e.strong,{children:"차수"}),"라고 합니다. 노드 1은 차수가 3이라고 할 수 있습니다."]}),"\n",(0,sa.jsx)(e.h1,{children:"이진 트리 구현"}),"\n",(0,sa.jsxs)(e.p,{children:["모든 노드의 최대 차수가 2를 넘지 않는 트리를 ",(0,sa.jsx)(e.strong,{children:"이진 트리"})," 라고 합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621105144.png",alt:""}),"\n구현할 수 있는 방법에는 두 가지가 있습니다."]}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:"배열을 사용하는 방법"}),"\n",(0,sa.jsx)(e.li,{children:"포인터를 사용하는 방법"}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"이진 트리를 구현해보면서 트리랑 좀 더 친해져봅시다."}),"\n",(0,sa.jsx)(e.h2,{children:"배열로 구현하기"}),"\n",(0,sa.jsx)(e.p,{children:"배열은 선형 자료구조이고 트리는 계층 자료구조입니다. 배열로 트리를 표현하려면 다음 3가지 규칙이 필요합니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"루트 노드"}),"는 배열 인덱스 ",(0,sa.jsx)(e.strong,{children:"1번에 저장"}),"합니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"왼쪽"})," 자식 노드의 배열 인덱스는 ",(0,sa.jsx)(e.strong,{children:"부모 노드의 배열 인덱스 x 2"}),"입니다."]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"오른쪽"})," 자식 노드의 배열 인덱스는 ",(0,sa.jsx)(e.strong,{children:"부모 노드의 배열 인덱스 x 2 + 1"}),"입니다."]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["위 규칙에 맞게 구현하면 다음과 같습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621105442.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["인덱스만 살펴보면 1 2 4 8 이렇게 인덱스가 ",(0,sa.jsx)(e.code,{children:"부모 * 2"}),"로 증가합니다. 점선 화살표를 따라가며 인덱스를 확인해보면 1 3 7로 흘러가는 것을 보실 수 있습니다. ",(0,sa.jsx)(e.code,{children:"부모 * 2 + 1"}),"로 증가하는 것을 보실 수 있습니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621105813.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["루트 노드를 0으로 설정하면 왼쪽 자식 노드는 ",(0,sa.jsx)(e.code,{children:"부모 * 2 + 1"})," 이고 오른쪽 자식 노드는 ",(0,sa.jsx)(e.code,{children:"부모 * 2 + 2"}),"가 됩니다."]}),"\n",(0,sa.jsx)(e.p,{children:"배열로 구현하면 되는 것 아닌가 싶으실 수 있습니다. 배열로 구현하면 위 그림에서 14 인덱스를 위해 9 10 11 12 13 인덱스가 비어 있는 것처럼 빈 인덱스가 생기는 상황이 올 수 밖에 없습니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"이진 트리의 노드가 N개일 때, 배열로 이진 트리를 생성하면 O(N)이 걸립니다."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"포인터로 구현하기"}),"\n",(0,sa.jsx)(e.p,{children:"포인터로 구현된 트리에서 노드는 노드의 값, 왼쪽 자식 노드, 오른쪽 자식 노드를 가집니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621111301.png",alt:""})}),"\n",(0,sa.jsxs)(e.p,{children:["포인터로 구현된 트리는 배열과 달리 인덱스 연산을 하지 않으므로 메모리 공간을 낭비하지 않습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250621111338.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"아래 클래스를 통해서 한 노드를 구현하고 left, right 프로퍼티로 연결하는 방식으로 구현합니다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"class"})," ",(0,sa.jsx)(e.span,{className:"hljs-title class_",children:"Node"}),"(){\n  ",(0,sa.jsx)(e.span,{className:"hljs-title function_",children:"constructor"}),"(",(0,sa.jsx)(e.span,{className:"hljs-params",children:"value"}),"){\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"value"})," = value;\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"left"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n    ",(0,sa.jsx)(e.span,{className:"hljs-variable language_",children:"this"}),".",(0,sa.jsx)(e.span,{className:"hljs-property",children:"right"})," = ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),";\n  }\n}\n"]})}),"\n",(0,sa.jsx)(e.h1,{children:"이진 트리 순회하기"}),"\n",(0,sa.jsxs)(e.p,{children:["데이터를 위해 특정 자료구조를 빠짐 없이 방문하는 것을 ",(0,sa.jsx)(e.strong,{children:"순회"}),"라고 합니다. 배열로 치면 배열의 인덱스로 특정 데이터를 검색할 때 순회가 필요합니다. 트리에서의 순회에는 총 3가지 방법이 있습니다"]}),"\n",(0,sa.jsx)(e.p,{children:"간단하게 설명해보면 다음과 같습니다."}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsx)(e.li,{children:"전위 순회 ( Preorder ) : 값 > 왼쪽 자식 > 오른쪽 자식 순서로 방문"}),"\n",(0,sa.jsx)(e.li,{children:"중위 순회 ( Inorder ) : 왼쪽 자식 > 값 > 오른쪽 자식 순서로 방문"}),"\n",(0,sa.jsx)(e.li,{children:"후위 순회 ( Postorder ) : 왼쪽 자식 > 오른쪽 자식 > 값 순서로 방문\n더 자세히 알아봅시다."}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"전위 순회"}),"\n",(0,sa.jsx)(e.p,{children:"현재 노드 > 왼쪽 자식 노드 > 오른쪽 자식 노드 순서로 방문합니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!NOTE] 방문"}),"\n",(0,sa.jsx)(e.p,{children:"탐색에서 방문이란 탐색을 마친 상태를 말합니다. 탐색 과정에서 지나치 는 것과 그렇지 않은 것을 구분하기 위해 방문이라는 용어를 사용합니다. 다음 그림을 보면 한 집은 집 앞을 지나가기만 했고, 나머지 두 집은 방문을 완료했습니다."}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145855.png",alt:""})}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"아래 배열을 전위 순회한다고 해봅시다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," a = [",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"5"}),", ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),", ",(0,sa.jsx)(e.span,{className:"hljs-literal",children:"null"}),"];\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["인덱스 1부터 루트라고 가정한 트리이므로 그림으로 그리면 다음과 같습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145125.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"루트 부터 순회를 시작해봅시다. 우선 현재 노드 > 왼쪽 자식 > 오른쪽 자식이기에 루트를 찍고 시작합니다."}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622144957.png",alt:""}),"\n반환값: 1"]}),"\n",(0,sa.jsxs)(e.p,{children:["이후 왼쪽 자식 노드로 가서 다시 순회를 돌립니다. 이제 4가 현재 노드가 되었습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145209.png",alt:""}),"\n반환값: 1, 4"]}),"\n",(0,sa.jsxs)(e.p,{children:["이 방식으로 똑같이 순회해주다가 자식이 없는 2를 만납니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145326.png",alt:""}),"\n반환값: 1, 4, 3, 2"]}),"\n",(0,sa.jsxs)(e.p,{children:["거슬러 올라가서 가장 최근의 노드중 오른쪽 자식인 5를 순회합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145418.png",alt:""}),"\n반환값: 1, 4, 3, 2, 5"]}),"\n",(0,sa.jsxs)(e.p,{children:["이 방식으로 전체 트리를 순회하면 됩니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622145427.png",alt:""}),"\n반환값: 1, 4, 3, 2, 5, 8, 7, 6"]}),"\n",(0,sa.jsx)(e.p,{children:"이 방식으로 순회할 경우 현재 노드를 우선 방문(출력)하기 때문에 직관적으로 이해하기 쉽습니다. 트리를 복사할 때 많이 사용하는 방식입니다."}),"\n",(0,sa.jsx)(e.h2,{children:"중위 순회"}),"\n",(0,sa.jsx)(e.p,{children:"왼쪽 자식 노드 > 현재 노드 > 오른쪽 자식 노드 순서로 방문합니다. 현재 노드를 거치기만 하고 왼쪽 노드로 내려가는 방식입니다."}),"\n",(0,sa.jsx)(e.p,{children:"전위 순회랑 똑같은 트리를 순회해봅시다."}),"\n",(0,sa.jsxs)(e.p,{children:['값이 1인 루트부터 시작해서 왼쪽 자식의 끝 노드까지 갑니다. 이때 "방문"하지 않기 때문에 2만 반환됩니다.\n',(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622150201.png",alt:""}),"\n반환값: 2"]}),"\n",(0,sa.jsxs)(e.p,{children:["왼쪽 자식 > 현재 노드 > 오른쪽 자식 순서이기 때문에 2 (3의 왼쪽 자식이었던) 에서 거슬러 올라가서 3을 순회합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622150244.png",alt:""}),"\n반환값: 2, 3"]}),"\n",(0,sa.jsxs)(e.p,{children:["이 방식으로 루트까지 거슬러 올라갑니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152000.png",alt:""}),"\n반환값: 2, 3, 4, 5, 1"]}),"\n",(0,sa.jsxs)(e.p,{children:["다시 왼쪽 노드, 현재 노드, 오른쪽 노드 방식을 재귀하면서 순회를 완료합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152148.png",alt:""}),"\n반환값: 2, 3, 4, 5, 1, 8, 6, 7"]}),"\n",(0,sa.jsx)(e.p,{children:"추가 정보로 이 방식은 뒤에 나올 이진 탐색 트리에서 정렬된 순서대로 값을 가져올 때 활용되니 잘 알아두셔야 합니다."}),"\n",(0,sa.jsx)(e.h2,{children:"후위 순회"}),"\n",(0,sa.jsx)(e.p,{children:"마지막 순회 방식입니다."}),"\n",(0,sa.jsx)(e.p,{children:"왼쪽 자식 노드 > 오른쪽 자식 노드 > 현재 노드 순서로 방문합니다."}),"\n",(0,sa.jsxs)(e.p,{children:["규칙에 따라 중위 순회와 똑같이 왼쪽 자식의 끝으로 갑니다. 2의 왼쪽 자식, 오른쪽 자식은 없기 때문에 현재 노드인 2를 방문합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152402.png",alt:""}),"\n반환값: 2"]}),"\n",(0,sa.jsxs)(e.p,{children:["거슬러 올라가는 건 중위순회와 같지만 4에서 조금 바뀝니다. 4는 왼쪽 자식, 오른쪽 자식 둘다 있는 노드입니다. 즉 왼쪽 자식인 3이 방문되었다면 다음 순서는 오른쪽 자식입니다. 즉 4 전에 5가 방문됩니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152456.png",alt:""}),"\n반환값: 2, 3, 5"]}),"\n",(0,sa.jsxs)(e.p,{children:["위 현상은 루트에서도 똑같이 일어납니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152626.png",alt:""}),"\n반환값: 2, 3, 5, 4, 6"]}),"\n",(0,sa.jsxs)(e.p,{children:["마지막에 루트가 방문되면 순회가 끝나게 됩니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622152729.png",alt:""}),"\n반환값: 2, 3, 5, 4, 6, 7, 8, 1"]}),"\n",(0,sa.jsx)(e.p,{children:"노드를 삭제할 때는 부모를 먼저 삭제하면 안됩니다. 자식 노드부터 삭제해야 트리를 유지하면서 재귀로 루트 노드까지 삭제할 수 있기 때문입니다. 그래서 자식 노드부터 방문한다는 후휘 순회의 특성은 트리 삭제에 자주 활용됩니다."}),"\n",(0,sa.jsx)(e.h1,{children:"이진 탐색 트리"}),"\n",(0,sa.jsx)(e.p,{children:"데이터 크기를 따져서 현재 노드보다 값이 작으면 왼쪽 자식 위치에, 크거나 같으면 오른쪽 자식 위치에 배치하는 독특한 정렬 방식을 가진 이진 트리"}),"\n",(0,sa.jsx)(e.h2,{children:"이진 트리 탐색하기"}),"\n",(0,sa.jsx)(e.p,{children:"트리의 좋은 점은 탐색을 효율적으로 하도록 설계할 수 있다는 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"자식 노드가 최대 2개인 이진 트리에 특정 규칙을 부여해서 목적에 맞게 사용할 수 있습니다. 그 중 하나인 이진 탐색 트리에 대해서 알아봅시다."}),"\n",(0,sa.jsx)(e.p,{children:'이진 탐색 트리의 규칙은 "데이터 크기를 따져서 현재 노드보다 값이 작으면 왼쪽 자식 위치에, 크거나 같으면 오른쪽 자식 위치에 배치합니다." 입니다.'}),"\n",(0,sa.jsx)(e.p,{children:"다음의 배열을 이진 탐색 트리에 넣어봅시다."}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-ts",children:[(0,sa.jsx)(e.span,{className:"hljs-keyword",children:"const"})," arr = [",(0,sa.jsx)(e.span,{className:"hljs-number",children:"3"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"4"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"8"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"9"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),", ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"];\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["첫 데이터는 루트 노드가 됩니다. 3만이 존재하는 트리가 됩니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622153638.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["이제 이를 기준으로 값이 작으면 왼쪽 값이 크면 오른쪽에 둡니다. 4는 3보다 크니 오른쪽에 둬야 합니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622153724.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["이 방식은 재귀적으로 일어납니다. 3, 4, 2 까지는 3을 기준으로 위치가 정해졌다면 8부터는 3 > 4 순서로 규칙이 재귀적으로 적용됩니다. ( 무조건 세번째 값부터라던지 그런 규칙이 아닙니다. 3의 두 자식 위치가 다 찼기 때문에 8부터 재귀적으로 적용된 것입니다. )\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622153743.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["이 방식을 통해 최종적으로 이진 탐색 트리를 완성하면 다음과 같습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622153949.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"이제 이 트리를 기반으로 탐색을 하면 다음의 순서로 할 수 있습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"루트부터 시작해서 값이 작으면 왼쪽 자식 노드로, 값이 크면 오른쪽 자식 노드로 이동합니다."}),"\n",(0,sa.jsx)(e.li,{children:"특정 값을 찾으면 탐색을 종료합니다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"위의 간단한 규칙으로 찾을 수 있어서 굉장히 효율적인 것을 계산하지 않아도 알 수 있겠죠. 자세한 시간 복잡도는 뒤에서 다루겠습니다."}),"\n",(0,sa.jsx)(e.h3,{children:"배열 탐색과의 차이"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622154332.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"위 상황에서 배열에서는 5를 탐색한다고 했을 때 이를 찾기 위해 7번의 비교 연산이 필요합니다. 나올 때까지 배열을 순회해야 하기 때문입니다."}),"\n",(0,sa.jsx)(e.p,{children:"이진 탐색 트리로 같은 상황에서 찾으면 단 2번 만에 탐색이 종료됩니다. ( 탐색하는 인덱스 순서: 0 > 2 > 5, 인덱스 5의 왼쪽 자식이 없으므로 5가 없다는 것을 확인할 수 있습니다. )"}),"\n",(0,sa.jsx)(e.h3,{children:"이진 탐색 트리의 시간 복잡도"}),"\n",(0,sa.jsx)(e.p,{children:"이진 탐색 트리의 시간 복잡도는 트리 균형에 의존합니다. 균형이 잡힌 트리는 각 노드의 차수가 비슷하게 유지되면서 각 노드의 자식 노드 수가 비슷하게 유지되는 것을 말합니다."}),"\n",(0,sa.jsxs)(e.p,{children:["균형이 유지될 경우 가장 이상적이라고 할 수 있습니다. 가장 이상적일 때의 시간 복잡도는 ",(0,sa.jsx)(e.strong,{children:"O(logN)"})," 입니다. ( 삽입, 탐색 때 추적 대상이 정확히 반씩 줄어들기 때문입니다. )"]}),"\n",(0,sa.jsxs)(e.p,{children:["반대로 균형이 유지 되지 않았다면 삽입과 탐색 연산 시 ",(0,sa.jsx)(e.strong,{children:"O(N)"})," 의 시간복잡도를 갖습니다. 이는 배열과 일치합니다."]}),"\n",(0,sa.jsx)(e.p,{children:"어떤 이유인지 알아봅시다."}),"\n",(0,sa.jsx)(e.h4,{children:"비균형적인 트리: 치우쳐진 형태의 트리"}),"\n",(0,sa.jsxs)(e.p,{children:["degenerate binary tree\n",(0,sa.jsx)(e.img,{src:"/images/2025-06-21/Pasted%20image%2020250622155353.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"이진 탐색 트리의 규칙은 현재 찾고 싶은 값이 현재 탐색하고 있는 값보다 작으면 그 왼쪽 자식을 탐색하고 아니면 오른쪽 자식, 같으면 탐색을 종료하는 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"비균형적이면 위 규칙이 필요없는 경우가 많아집니다. 한 방향으로만 갈테니까요. 극단적으로 생각하면 이는 배열과 별 다를 게 없는 구조가 됩니다. 즉 시간 복잡도도 배열과 같이 O(N)을 갖는 것입니다."}),"\n",(0,sa.jsx)(e.p,{children:"하지만 이는 수많은 경우 중에 한 경우입니다. 만약 위 그림에서 하나라도 루트 노드의 반대쪽 자식으로 이동한다면 배열보다는 성능이 좋다고 할 수 있습니다."}),"\n",(0,sa.jsx)(e.h4,{children:"균형적인 트리: 균형 이진 탐색 트리"}),"\n",(0,sa.jsx)(e.p,{children:"균형 이진 탐색 트리는 세부적으로 AVL 트리, 레드-블랙 트리 등으로 구분하여 부르곤 합니다. 이를 활용하면 탐색 연산 횟수가 트리 높이에 비례하고 트리의 높이는 logN이므로 탐색 시간 복잡도를 O(logN)으로 유지할 수 있습니다."}),"\n",(0,sa.jsx)(e.h1,{children:"참고 문헌"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"알고리즘은 꾸준히 공부해주지 않으면 개념들이 유독 빠르게 사라지는 것 같습니다.\n사라지면 다시 채워넣을 수 있도록 꾸준히 공부해보겠습니다.\n잘못된 지식이 있다면 댓글 부탁드립니다!"}),"\n",(0,sa.jsx)(e.p,{children:"읽어주셔서 감사합니다."}),"\n"]})]})}function nj(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(nh,{...s})}):nh(s)}function nd(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"Concept"}),"\n",(0,sa.jsxs)(e.p,{children:["Set: A data structure with elements that have no ",(0,sa.jsx)(e.strong,{children:"order"})," and no ",(0,sa.jsx)(e.strong,{children:"duplicates"})]}),"\n",(0,sa.jsx)(e.h2,{children:"Types of Sets"}),"\n",(0,sa.jsx)(e.p,{children:"They are called various names depending on their characteristics."}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{children:"Name"}),(0,sa.jsx)(e.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,sa.jsxs)(e.tbody,{children:[(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"Finite Set"}),(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"A set with a finite number of elements"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"Infinite Set"}),(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"A set with an infinite number of elements"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"Empty Set"}),(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"A set with no elements"})]})]})]}),"\n",(0,sa.jsxs)(e.p,{children:["Mathematically, there are more sets, but let's focus on ",(0,sa.jsx)(e.strong,{children:"mutually exclusive sets"}),"."]}),"\n",(0,sa.jsx)(e.h3,{children:"Mutually Exclusive Sets"}),"\n",(0,sa.jsxs)(e.p,{children:["Sets with no intersection\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720145721.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["The picture above shows ",(0,sa.jsx)(e.code,{children:"A={1,2,3}"}),", ",(0,sa.jsx)(e.code,{children:"B={4,5,6,7}"}),". ",(0,sa.jsx)(e.code,{children:"A"})," and ",(0,sa.jsx)(e.code,{children:"B"})," have no overlapping elements, so they can be seen as having no intersection."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720145823.png",alt:""}),"\nIf there are common elements, they don't correspond to mutually exclusive sets."]}),"\n",(0,sa.jsx)(e.h2,{children:"Application Fields"}),"\n",(0,sa.jsx)(e.p,{children:"In coding tests, mutually exclusive sets are often used in graph algorithms. This is because you can check for cycles by checking if they're mutually exclusive. (This only applies to undirected graphs.)"}),"\n",(0,sa.jsx)(e.p,{children:"There are also other uses:"}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Image Segmentation: Distinguishing between people and backgrounds"}),"\n",(0,sa.jsx)(e.li,{children:"Road Network Construction: Designing roads so they don't intersect"}),"\n",(0,sa.jsx)(e.li,{children:"Minimum Spanning Tree Algorithm: Checking for cycle formation when adding edges"}),"\n",(0,sa.jsx)(e.li,{children:"Game Development: Distinguishing so players and enemies don't overlap when they collide"}),"\n",(0,sa.jsx)(e.li,{children:"Clustering Tasks: Organizing tasks so they don't overlap"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"Implementation"}),"\n",(0,sa.jsxs)(e.p,{children:["Sets are usually expressed as trees, and the representative operations are ",(0,sa.jsx)(e.strong,{children:"Union"})," and ",(0,sa.jsx)(e.strong,{children:"Find"}),". Let's first see how sets are expressed."]}),"\n",(0,sa.jsx)(e.h3,{children:"Expressing Sets as Trees Using Arrays"}),"\n",(0,sa.jsx)(e.p,{children:"To express sets using arrays, each set needs a representative element."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"Representative Element"})}),"\n",(0,sa.jsx)(e.p,{children:"An element among the set's elements that represents the set\nConceptually, a set's representative element and a tree's root node are the same."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"To express all sets in one array, you must follow the following rule."}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"Array index"})," means ",(0,sa.jsx)(e.strong,{children:"self"}),", ",(0,sa.jsx)(e.strong,{children:"array value"})," means ",(0,sa.jsx)(e.strong,{children:"parent node"}),"."]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["For example, if ",(0,sa.jsx)(e.code,{children:"set[3] = 9"}),", it means node 3's parent is 9. For root nodes, since there's no parent, the index itself is used as the value."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720151103.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"This naturally makes the minimum size of the array 1 larger than the largest value among the elements."}),"\n",(0,sa.jsx)(e.h4,{children:"Example"}),"\n",(0,sa.jsx)(e.p,{children:"If you manage root nodes well, you can express multiple sets in one array. (The number of sets is the number of root nodes)"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720151432.png",alt:""})}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{children:"0"}),(0,sa.jsx)(e.th,{children:"1"}),(0,sa.jsx)(e.th,{children:"2"}),(0,sa.jsx)(e.th,{children:"3"}),(0,sa.jsx)(e.th,{children:"4"}),(0,sa.jsx)(e.th,{children:"5"}),(0,sa.jsx)(e.th,{children:"6"}),(0,sa.jsx)(e.th,{children:"7"}),(0,sa.jsx)(e.th,{children:"8"}),(0,sa.jsx)(e.th,{children:"9"})]})}),(0,sa.jsx)(e.tbody,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"null"}),(0,sa.jsx)(e.td,{children:"1"}),(0,sa.jsx)(e.td,{children:"1"}),(0,sa.jsx)(e.td,{children:"2"}),(0,sa.jsx)(e.td,{children:"4"}),(0,sa.jsx)(e.td,{children:"1"}),(0,sa.jsx)(e.td,{children:"null"}),(0,sa.jsx)(e.td,{children:"null"}),(0,sa.jsx)(e.td,{children:"4"}),(0,sa.jsx)(e.td,{children:"3"})]})})]}),"\n",(0,sa.jsx)(e.h4,{children:"Implementation Process"}),"\n",(0,sa.jsx)(e.h5,{children:"1. Initial State"}),"\n",(0,sa.jsxs)(e.p,{children:["The initial state is where each element is set as its own root node. Let's set the value of indices not in the set to -1 arbitrarily.\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720152506.png",alt:""}),"\nAs shown in the set part below, all elements are expressed as root nodes. (Index and value are the same)"]}),"\n",(0,sa.jsx)(e.h5,{children:"2. Set Connection"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720152949.png",alt:""}),"\nApplying based on the given sets, it's structured as above. To check if node 9 belongs to set A with root node 1 or set B with root node 4, you can search in the direction ",(0,sa.jsx)(e.code,{children:"set[9]=3 set[3]=2 set[2]=1 set[1]=1"}),"."]}),"\n",(0,sa.jsx)(e.p,{children:"We've checked how sets themselves are mainly implemented. Now let's check what operations are performed on these sets."}),"\n",(0,sa.jsx)(e.h3,{children:"Union-Find Algorithm"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"union-find algorithm"})}),"\n",(0,sa.jsx)(e.p,{children:"The main operations used in set algorithms are union (merge) and find (search)."}),"\n",(0,sa.jsx)(e.h4,{children:"find"}),"\n",(0,sa.jsx)(e.p,{children:"A method to search for what the root node of a specific node is"}),"\n",(0,sa.jsx)(e.p,{children:"Search recursively upward from a specific node to find the root node."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Check the current node's parent node"}),"\n",(0,sa.jsx)(e.li,{children:"If the parent node is a root node while checking, end the search operation"}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["Let's give an example.\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720153703.png",alt:""}),"\nLet's find the root node of node 7 with find(7)."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720153835.png",alt:""}),"\nWhile going up by converting values to indices and going to parent nodes, repeat until a node where value and index are the same (root node) appears. find(7) goes through the following process to find the root node."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["set[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),"] = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),";\nset[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),"] = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),";\nset[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"] = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\nset[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"] = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// Value and index are the same (found)"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["However, this has worst-case time complexity of ",(0,sa.jsx)(e.strong,{children:"O"}),"(N).\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720154108.png",alt:""}),"\nYou can use path compression for more optimization."]}),"\n",(0,sa.jsx)(e.h5,{children:"Path Compression"}),"\n",(0,sa.jsxs)(e.p,{children:["To make find operations efficient, you can use a method that reduces tree height while maintaining set form.\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720154301.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["Since the goal of the find operation is to find the ",(0,sa.jsx)(e.strong,{children:"root node"}),", it's a method of optimization by only putting the root node."]}),"\n",(0,sa.jsx)(e.h4,{children:"Union"}),"\n",(0,sa.jsxs)(e.p,{children:["An operation that merges two sets into one, making the ",(0,sa.jsx)(e.strong,{children:"root nodes"})," of the two sets the same."]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Find root nodes of the two sets through find operations."}),"\n",(0,sa.jsx)(e.li,{children:"Compare the values of the two found root nodes."}),"\n",(0,sa.jsx)(e.li,{children:"Merge the two sets. (Make the root nodes of the two sets the same.)"}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["When there are two sets\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720154725.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["After finding the root nodes of the two sets through find operations\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720154749.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["You can make the sets into one by designating set A's root node 1 as the root node and making set B's root node 2 its child.\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720154828.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"However, Union operations have the disadvantage that operation cost increases as tree depth increases."}),"\n",(0,sa.jsxs)(e.p,{children:["You can introduce the concept of ",(0,sa.jsx)(e.strong,{children:"rank"})," to solve this."]}),"\n",(0,sa.jsx)(e.h5,{children:"Rank"}),"\n",(0,sa.jsxs)(e.p,{children:["The path length from the current node to the deepest node when based on the current node\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720155206.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"When performing Union operations based on rank, the following process is followed."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"Get the root nodes of the two nodes. (find)"}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"Compare"})," the ",(0,sa.jsx)(e.strong,{children:"rank"})," of the root nodes with the following logic.","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"If rank values are different"}),", change the root node with the larger rank value to the parent node of the smaller root node. (Tree depth doesn't get deeper.)"]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"If rank values are the same"}),", select any root node to change and add 1 to the final root node's rank."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["Explaining with a picture, when there are two sets\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720155543.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["Compare set A's root node 1's ",(0,sa.jsx)(e.code,{children:"rank 2"})," with set B's root node 5's ",(0,sa.jsx)(e.code,{children:"rank 1"}),". Since set A has a larger rank, according to logic 1 explained above, connect set A's root node as parent and set B's root node as child, and don't change the rank.\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720155804.png",alt:""})]}),"\n",(0,sa.jsx)(e.h1,{children:"References"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"Algorithm concepts seem to disappear particularly quickly if you don't study them consistently.\nI'll study consistently so I can fill them back in when they disappear.\nIf there are any incorrect knowledge, please leave a comment!"}),"\n",(0,sa.jsx)(e.p,{children:"Thank you for reading."}),"\n"]})]})}function no(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(nd,{...s})}):nd(s)}function np(s){let e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...sR(),...s.components};return(0,sa.jsxs)(sa.Fragment,{children:[(0,sa.jsx)(e.h1,{children:"개념"}),"\n",(0,sa.jsxs)(e.p,{children:["집합: ",(0,sa.jsx)(e.strong,{children:"순서"}),"와 ",(0,sa.jsx)(e.strong,{children:"중복"}),"이 없는 원소들을 갖는 자료구조"]}),"\n",(0,sa.jsx)(e.h2,{children:"집합의 종류"}),"\n",(0,sa.jsx)(e.p,{children:"특성에 따라 부르는 말이 다양합니다."}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{children:"이름"}),(0,sa.jsx)(e.th,{style:{textAlign:"left"},children:"설명"})]})}),(0,sa.jsxs)(e.tbody,{children:[(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"유한 집합"}),(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"원소의 개수가 유한한 집합"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"무한 집합"}),(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"원소의 개수가 무한한 집합"})]}),(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"공집합"}),(0,sa.jsx)(e.td,{style:{textAlign:"left"},children:"아무 원소도 없는 집합"})]})]})]}),"\n",(0,sa.jsxs)(e.p,{children:["수학적으로는 더 많은 집합들이 있겠지만 ",(0,sa.jsx)(e.strong,{children:"상호배타적 집합"}),"에 집중해봅시다."]}),"\n",(0,sa.jsx)(e.h3,{children:"상호배타적 집합"}),"\n",(0,sa.jsxs)(e.p,{children:["교집합이 없는 집합 관계\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720145721.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["위 그림은 A=",3,", B=",7,"을 나타낸 그림입니다. A와 B는 겹치는 원소가 없으므로 교집합이 없다고 볼 수 있습니다."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720145823.png",alt:""}),"\n만약 공통 원소가 있으면 상호배타적 집합에 해당하지 않습니다."]}),"\n",(0,sa.jsx)(e.h2,{children:"활용 분야"}),"\n",(0,sa.jsx)(e.p,{children:"흔히 코딩 테스트에서는 그래프 알고리즘에서 상호배타적 집합을 많이 활용합니다. 사이클을 확인할 때 상호배타적인지를 확인하면 되기 때문입니다. ( 무방향 그래프에서만 해당합니다. )"}),"\n",(0,sa.jsx)(e.p,{children:"이외에도 다음과 같은 활용도가 있습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"이미지 분할: 사람과 배경의 구분"}),"\n",(0,sa.jsx)(e.li,{children:"도로 네트워크 구성: 도로가 교차하지 않도록 설계"}),"\n",(0,sa.jsx)(e.li,{children:"최소 신장 트리 알고리즘: 간선을 추가할 때 사이클 형성 여부 체크"}),"\n",(0,sa.jsx)(e.li,{children:"게임 개발: 플레이어와 적군이 충돌할 때 겹치지 않도록 구분"}),"\n",(0,sa.jsx)(e.li,{children:"클러스터링 작업: 작업이 겹치지 않도록 구성"}),"\n"]}),"\n",(0,sa.jsx)(e.h2,{children:"구현"}),"\n",(0,sa.jsxs)(e.p,{children:["보통 집합은 트리로 표현되며 대표적인 연산은 ",(0,sa.jsx)(e.strong,{children:"Union"}),"과 ",(0,sa.jsx)(e.strong,{children:"Find"}),"가 있습니다. 우선 집합을 어떻게 표현하는지부터 살펴봅시다."]}),"\n",(0,sa.jsx)(e.h3,{children:"배열을 활용한 트리로 집합 표현"}),"\n",(0,sa.jsx)(e.p,{children:"배열을 활용하여 집합을 표현하기 위해선 각 집합에 대표 원소가 있어야 합니다."}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"대표 원소"})}),"\n",(0,sa.jsx)(e.p,{children:"집합의 원소 중 집합을 대표하는 역할\n개념적으로 집합의 대표 원소와 트리의 루트 노드는 같다."}),"\n"]}),"\n",(0,sa.jsx)(e.p,{children:"하나의 배열에 집합을 모두 표현하려면 다음의 법칙을 따라야 합니다."}),"\n",(0,sa.jsxs)(e.ul,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"배열의 인덱스"}),"는 ",(0,sa.jsx)(e.strong,{children:"자신"}),", ",(0,sa.jsx)(e.strong,{children:"배열값"}),"은 ",(0,sa.jsx)(e.strong,{children:"부모 노드"}),"를 의미합니다."]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["예를들면 ",(0,sa.jsx)(e.code,{children:"set[3] = 9"})," 라면 노드 3의 부모는 9임을 의미하는 것입니다. 루트 노드의 경우에는 부모가 없기에 본인의 인덱스를 그대로 값으로 내려줍니다."]}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720151103.png",alt:""})}),"\n",(0,sa.jsx)(e.p,{children:"이렇게 되면 자연스럽게 배열의 최소 크기는 원소 중에서 가장 큰 값보다 1 큰 값이 됩니다."}),"\n",(0,sa.jsx)(e.h4,{children:"예시"}),"\n",(0,sa.jsx)(e.p,{children:"루트 노드만 잘 관리하면 여러 개의 집합을 하나의 배열로 표현할 수 있게 됩니다. (집합의 개수는 루트 노드의 개수)"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720151432.png",alt:""})}),"\n",(0,sa.jsxs)(e.table,{children:[(0,sa.jsx)(e.thead,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.th,{children:"0"}),(0,sa.jsx)(e.th,{children:"1"}),(0,sa.jsx)(e.th,{children:"2"}),(0,sa.jsx)(e.th,{children:"3"}),(0,sa.jsx)(e.th,{children:"4"}),(0,sa.jsx)(e.th,{children:"5"}),(0,sa.jsx)(e.th,{children:"6"}),(0,sa.jsx)(e.th,{children:"7"}),(0,sa.jsx)(e.th,{children:"8"}),(0,sa.jsx)(e.th,{children:"9"})]})}),(0,sa.jsx)(e.tbody,{children:(0,sa.jsxs)(e.tr,{children:[(0,sa.jsx)(e.td,{children:"null"}),(0,sa.jsx)(e.td,{children:"1"}),(0,sa.jsx)(e.td,{children:"1"}),(0,sa.jsx)(e.td,{children:"2"}),(0,sa.jsx)(e.td,{children:"4"}),(0,sa.jsx)(e.td,{children:"1"}),(0,sa.jsx)(e.td,{children:"null"}),(0,sa.jsx)(e.td,{children:"null"}),(0,sa.jsx)(e.td,{children:"4"}),(0,sa.jsx)(e.td,{children:"3"})]})})]}),"\n",(0,sa.jsx)(e.h4,{children:"구현 과정"}),"\n",(0,sa.jsx)(e.h5,{children:"1. 초기 상태"}),"\n",(0,sa.jsxs)(e.p,{children:["초기 상태는 자기 자신을 루트 노드로 설정한 상태입니다. 집합에 없는 인덱스의 값은 -1로 임의로 정해봅시다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720152506.png",alt:""}),"\n아래 집합 부분과 같이 각 원소들이 전부 루트 노드로 표현되고 있습니다. ( 인덱스와 값이 같음 )"]}),"\n",(0,sa.jsx)(e.h5,{children:"2. 집합 연결"}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720152949.png",alt:""}),"\n주어진 집합을 기준으로 적용하면 위와 같이 구성됩니다. 만약 노드 9가 루트 노드가 1인 집합 A에 속하는지 루트 노드가 4인 집합 B에 속하는지 확인하려면 ",(0,sa.jsx)(e.code,{children:"set[9]=3 set[3]=2 set[2]=1 set[1]=1"}),"의 방향으로 탐색하면 됩니다."]}),"\n",(0,sa.jsx)(e.p,{children:"집합 자체를 주로 어떤 방식으로 구현하는지 확인해봤습니다. 이제 이 집합으로 어떤 연산을 하는지 확인해봅시다."}),"\n",(0,sa.jsx)(e.h3,{children:"유니온-파인드 알고리즘"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.strong,{children:"union-find algorithm"})}),"\n",(0,sa.jsx)(e.p,{children:"집합 알고리즘에 주로 쓰이는 연산은 합치기(union)와 탐색(find)입니다."}),"\n",(0,sa.jsx)(e.h4,{children:"find"}),"\n",(0,sa.jsx)(e.p,{children:"특정 노드의 루트 노드가 무엇인지 탐색하는 방법"}),"\n",(0,sa.jsx)(e.p,{children:"특정 노드부터 재귀로 거슬러 올라가며 루트 노드를 찾습니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"현재 노드의 부모 노드를 확인"}),"\n",(0,sa.jsx)(e.li,{children:"확인하다가 부모 노드가 루트 노드면 찾기 연산 종료"}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["예시를 들어봅시다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720153703.png",alt:""}),"\nfind(7)로 노드 7의 루트 노드를 찾아봅시다."]}),"\n",(0,sa.jsxs)(e.p,{children:[(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720153835.png",alt:""}),"\n값을 인덱스로 바꾸면서 부모 노드로 올라가는 과정을 거치면서 값과 인덱스가 같은 노드(루트 노드)가 나올 때까지 반복해줍니다. find(7)은 다음의 과정을 거쳐서 루트 노드를 찾게 됩니다."]}),"\n",(0,sa.jsx)(e.pre,{children:(0,sa.jsxs)(e.code,{className:"hljs language-js",children:["set[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"7"}),"] = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),";\nset[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"6"}),"] = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),";\nset[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"2"}),"] = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),";\nset[",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"] = ",(0,sa.jsx)(e.span,{className:"hljs-number",children:"1"}),"; ",(0,sa.jsx)(e.span,{className:"hljs-comment",children:"// 값과 인덱스가 같음 ( 찾음 )"}),"\n"]})}),"\n",(0,sa.jsxs)(e.p,{children:["하지만 이는 최악의 경우의 시간 복잡도가 ",(0,sa.jsx)(e.strong,{children:"O"}),"(N)입니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720154108.png",alt:""}),"\n좀 더 최적화하기 위해 경로 압축을 활용할 수 있습니다."]}),"\n",(0,sa.jsx)(e.h5,{children:"경로 압축"}),"\n",(0,sa.jsxs)(e.p,{children:["효율적인 find 연산을 위해서는 집합 형태를 유지하면서도 트리 높이를 줄이는 방식을 사용하면 됩니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720154301.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["파인드 연산이 목표로 하는 것은 ",(0,sa.jsx)(e.strong,{children:"루트 노드"}),"를 찾는 것이기에 루트 노드만 넣어둬서 최적화하는 방식인 것입니다."]}),"\n",(0,sa.jsx)(e.h4,{children:"Union"}),"\n",(0,sa.jsxs)(e.p,{children:["두 집합을 하나로 합치는 연산, 두 집합의 ",(0,sa.jsx)(e.strong,{children:"루트 노드"}),"를 같게 만드는 것입니다."]}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"두 집합에서 find 연산을 통해 루트 노드를 찾습니다."}),"\n",(0,sa.jsx)(e.li,{children:"찾은 두 루트 노드의 값을 비교합니다."}),"\n",(0,sa.jsx)(e.li,{children:"두 집합을 합칩니다. (두 집합의 루트 노드를 같게 만듭니다.)"}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["두 집합이 있다고 했을 때\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720154725.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["find 연산으로 두 집합의 루트 노드를 찾은 후에\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720154749.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["집합 A의 루트 노드 1을 루트 노드로 지정하고 집합 B의 루트 노드 2를 그 자식으로 두면 집합을 하나로 만들 수 있습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720154828.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"하지만 Union 연산은 트리의 깊이가 깊어지면 깊어질수록 연산 비용이 커진다는 단점이 있습니다."}),"\n",(0,sa.jsxs)(e.p,{children:["이를 해결하기 위해 ",(0,sa.jsx)(e.strong,{children:"랭크"})," 라는 개념을 도입할 수 있습니다."]}),"\n",(0,sa.jsx)(e.h5,{children:"랭크"}),"\n",(0,sa.jsxs)(e.p,{children:["현재 노드를 기준으로 하였을 때 가장 깊은 노드까지의 경로 길이\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720155206.png",alt:""})]}),"\n",(0,sa.jsx)(e.p,{children:"랭크를 기반으로 Union 연산을 진행하면 다음과 같은 과정을 거칩니다."}),"\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsx)(e.li,{children:"두 노드의 루트 노드를 구합니다. ( find )"}),"\n",(0,sa.jsxs)(e.li,{children:["루트 노드의 ",(0,sa.jsx)(e.strong,{children:"랭크"}),"를 다음의 논리로 ",(0,sa.jsx)(e.strong,{children:"비교"}),"합니다..","\n",(0,sa.jsxs)(e.ol,{children:["\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"랭크값이 다르면"})," 랭크값이 더 큰 루트 노드를 작은 루트 노드의 부모 노드로 바꿉니다. ( 트리의 깊이는 더 깊어지지 않는다. )"]}),"\n",(0,sa.jsxs)(e.li,{children:[(0,sa.jsx)(e.strong,{children:"랭크값이 같으면"})," 루트 노드를 아무거나 선택해서 바꾸고 최종 루트 노드의 랭크에 1을 더합니다."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,sa.jsxs)(e.p,{children:["그림으로 설명해보면 두 집합이 있을 때\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720155543.png",alt:""})]}),"\n",(0,sa.jsxs)(e.p,{children:["집합 A의 루트 노드 1의 ",(0,sa.jsx)(e.code,{children:"랭크 2"})," 와 집합 B의 루트 노드 5의 ",(0,sa.jsx)(e.code,{children:"랭크 1"}),"을 비교합니다. 집합 A가 랭크가 더 크기 때문에 앞서 설명한 논리 1번에 의해서 집합 A의 루트 노드를 부모로, 집합 B의 루트 노드를 자식으로 연결하고 랭크는 바꾸지 않습니다.\n",(0,sa.jsx)(e.img,{src:"/images/2025-07-20/Pasted%20image%2020250720155804.png",alt:""})]}),"\n",(0,sa.jsx)(e.h1,{children:"참고 문헌"}),"\n",(0,sa.jsx)(e.p,{children:(0,sa.jsx)(e.a,{href:"https://product.kyobobook.co.kr/detail/S000213641007",children:"https://product.kyobobook.co.kr/detail/S000213641007"})}),"\n",(0,sa.jsxs)(e.blockquote,{children:["\n",(0,sa.jsx)(e.p,{children:"[!SUMMARY]"}),"\n",(0,sa.jsx)(e.p,{children:"알고리즘은 꾸준히 공부해주지 않으면 개념들이 유독 빠르게 사라지는 것 같습니다.\n사라지면 다시 채워넣을 수 있도록 꾸준히 공부해보겠습니다.\n잘못된 지식이 있다면 댓글 부탁드립니다!"}),"\n",(0,sa.jsx)(e.p,{children:"읽어주셔서 감사합니다."}),"\n"]})]})}function nm(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}={...sR(),...s.components};return e?(0,sa.jsx)(e,{...s,children:(0,sa.jsx)(np,{...s})}):np(s)}let nx={ko:{"2024-05-18":l,"2024-05-19":r,"2024-05-20":t,"2024-05-22":j,"2024-05-23":o,"2024-05-31":m,"2024-06-08":N,"2024-06-10":g,"2024-06-14":y,"2024-06-15":k,"2024-06-17":_,"2024-06-18":P,"2024-07-21":S,"2024-07-22-1":C,"2024-07-22-2":R,"2024-09-11":M,"2024-09-14-1":O,"2024-09-14-2":D,"2024-09-14-3":F,"2024-09-14-4":z,"2024-11-10":W,"2025-05-24":J,"2025-05-31":Q,"2025-06-07":Y,"2025-06-14":X,"2025-06-21":ss,"2025-07-20":sn},en:{"2024-05-18":a,"2024-05-19":c,"2024-05-20":i,"2024-05-22":h,"2024-05-23":d,"2024-05-31":p,"2024-06-08":x,"2024-06-10":u,"2024-06-14":f,"2024-06-15":w,"2024-06-17":b,"2024-06-18":v,"2024-07-21":T,"2024-07-22-1":I,"2024-07-22-2":A,"2024-09-11":E,"2024-09-14-1":q,"2024-09-14-2":L,"2024-09-14-3":B,"2024-09-14-4":U,"2024-11-10":H,"2025-05-24":V,"2025-05-31":G,"2025-06-07":$,"2025-06-14":K,"2025-06-21":Z,"2025-07-20":se}};var nN=n(8664);function nu(){return(0,sa.jsx)("div",{className:"prose dark:prose-invert max-w-none",children:(0,sa.jsxs)("div",{className:"space-y-4",children:[(0,sa.jsx)(nN.E,{className:"h-6 w-full"}),(0,sa.jsx)(nN.E,{className:"h-6 w-5/6"}),(0,sa.jsx)(nN.E,{className:"h-6 w-4/6"}),(0,sa.jsx)(nN.E,{className:"h-32 w-full"}),(0,sa.jsx)(nN.E,{className:"h-6 w-full"}),(0,sa.jsx)(nN.E,{className:"h-6 w-3/4"}),(0,sa.jsx)(nN.E,{className:"h-48 w-full"})]})})}function ng(s){var e;let{postId:n}=s,a=(0,sl.Ym)(),[l,c]=(0,sc.useState)(!1);if((0,sc.useLayoutEffect)(()=>{c(!0)},[]),!l)return(0,sa.jsx)(nu,{});let r=null==(e=nx[a])?void 0:e[n];if(!r)return null;let i=r.default;return(0,sa.jsx)(i,{})}},5634:(s,e,n)=>{"use strict";n.d(e,{default:()=>c});var a=n(9700),l=n(5323);function c(){let s=(0,l.c)("post");return(0,a.jsx)("div",{children:s("notFound")})}},6830:(s,e,n)=>{"use strict";n.d(e,{E:()=>i});var a=n(9700),l=n(5661),c=n(1946);let r=(0,l.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(s){let{className:e,variant:n,...l}=s;return(0,a.jsx)("div",{className:(0,c.cn)(r({variant:n}),e),...l})}},6846:(s,e,n)=>{"use strict";n.d(e,{GtmPageView:()=>l});var a=n(1464);function l(s){let{slug:e}=s;return(0,a.useEffect)(()=>{if(e){var s;null==(s=window.dataLayer)||s.push({event:"page_view",url:window.location.href,...{page_title:e}})}},[e]),null}},6884:(s,e,n)=>{Promise.resolve().then(n.bind(n,6846)),Promise.resolve().then(n.bind(n,2821)),Promise.resolve().then(n.bind(n,7568)),Promise.resolve().then(n.bind(n,5634)),Promise.resolve().then(n.bind(n,34))},7471:(s,e,n)=>{"use strict";n.d(e,{A:()=>a});let a=(0,n(7800).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7568:(s,e,n)=>{"use strict";n.d(e,{PostHeaderClient:()=>m});var a=n(9700),l=n(6087),c=n(1464),r=n(7800);let i=(0,r.A)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),t=(0,r.A)("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);var h=n(4944),j=n(6830);function d(s){let{frontMatter:e}=s,{title:n,categories:l,excerpt:c,header:r,date:d}=e;return(0,a.jsxs)("header",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"relative mb-6 h-[300px] w-full overflow-hidden rounded-xl sm:h-[400px] md:h-[450px]",children:[(0,a.jsx)(h.default,{src:r.teaser,alt:n,fill:!0,sizes:"(max-width: 768px) 100vw, 1200px",priority:!0,className:"object-cover object-center transition-transform duration-500 hover:scale-105"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent to-black/70"}),(0,a.jsx)("div",{className:"absolute top-4 left-4 flex flex-wrap gap-2 sm:top-6 sm:left-6",children:Array.isArray(l)?l.map(s=>(0,a.jsxs)(j.E,{variant:"secondary",className:"bg-white/90 font-medium text-gray-800 text-xs hover:bg-white sm:text-sm",children:[(0,a.jsx)(i,{className:"mr-1 h-3 w-3"})," ",s]},s)):(0,a.jsxs)(j.E,{variant:"secondary",className:"bg-white/90 font-medium text-gray-800 text-xs hover:bg-white sm:text-sm",children:[(0,a.jsx)(i,{className:"mr-1 h-3 w-3"})," ",l]})})]}),(0,a.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,a.jsx)("h1",{className:"mb-0 font-bold text-3xl text-gray-900 tracking-tight sm:text-4xl md:text-5xl dark:text-gray-50",children:n}),(0,a.jsx)("div",{className:"flex items-center justify-end gap-4 text-gray-600 text-sm dark:text-gray-400",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(t,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("time",{dateTime:d,children:d})]})}),(0,a.jsx)("p",{className:"text-gray-600 text-lg leading-relaxed md:text-xl dark:text-gray-300",children:c})]}),(0,a.jsx)("div",{className:"border-gray-200 border-b dark:border-gray-800"})]})}var o=n(8664);function p(){return(0,a.jsxs)("header",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"relative mb-6 h-[300px] w-full overflow-hidden rounded-xl sm:h-[400px] md:h-[450px]",children:[(0,a.jsx)(o.E,{className:"h-full w-full"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent to-black/70"}),(0,a.jsxs)("div",{className:"absolute top-4 left-4 flex flex-wrap gap-2 sm:top-6 sm:left-6",children:[(0,a.jsx)(o.E,{className:"h-6 w-20"}),(0,a.jsx)(o.E,{className:"h-6 w-16"})]})]}),(0,a.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,a.jsx)(o.E,{className:"h-10 w-3/4 sm:h-12 md:h-14"}),(0,a.jsx)("div",{className:"flex items-center justify-end gap-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(t,{className:"mr-2 h-4 w-4 text-gray-400"}),(0,a.jsx)(o.E,{className:"h-4 w-24"})]})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.E,{className:"h-5 w-full"}),(0,a.jsx)(o.E,{className:"h-5 w-5/6"}),(0,a.jsx)(o.E,{className:"h-5 w-4/6"})]})]}),(0,a.jsx)("div",{className:"border-gray-200 border-b dark:border-gray-800"})]})}function m(s){let{frontMatters:e}=s,n=(0,l.Ym)(),[r,i]=(0,c.useState)(!1);if((0,c.useLayoutEffect)(()=>{i(!0)},[]),!r)return(0,a.jsx)(p,{});let t=e[n]||e.ko;return(0,a.jsx)(d,{frontMatter:t})}},8664:(s,e,n)=>{"use strict";n.d(e,{E:()=>c});var a=n(9700),l=n(1946);function c(s){let{className:e,...n}=s;return(0,a.jsx)("div",{className:(0,l.cn)("animate-pulse rounded-md bg-primary/10",e),...n})}}},s=>{s.O(0,[87,308,187,144,789,290,358],()=>s(s.s=6884)),_N_E=s.O()}]);